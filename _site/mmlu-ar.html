<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>مقياس MMLU</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>مقياس MMLU | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="مقياس MMLU" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="ar" />
<meta name="description" content="مقدمة" />
<meta property="og:description" content="مقدمة" />
<link rel="canonical" href="https://lzwjava.github.io/mmlu-ar" />
<meta property="og:url" content="https://lzwjava.github.io/mmlu-ar" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-25T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="مقياس MMLU" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2025-01-25T00:00:00+08:00","datePublished":"2025-01-25T00:00:00+08:00","description":"مقدمة","headline":"مقياس MMLU","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/mmlu-ar"},"url":"https://lzwjava.github.io/mmlu-ar"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=0e43ffc8e3f9ce168192fc3236853cf8df63eca5">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=0e43ffc8e3f9ce168192fc3236853cf8df63eca5" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       مقياس MMLU | أصلي، ترجم بواسطة AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/ar/2025-01-25-mmlu-ar.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsar2025-01-25-mmlu-ar.md</span> -->
      

      <!-- <span>2025-01-25-mmlu-ar.md</span> -->

      
        

        
          
          <a href="#" class="button">2025.01</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/mmlu-en" >English</option>
        <option value="/mmlu-zh" >中文</option>
        <option value="/mmlu-ja" >日本語</option>
        <option value="/mmlu-es" >Español</option>
        <option value="/mmlu-hi" >हिंदी</option>
        <option value="/mmlu-fr" >Français</option>
        <option value="/mmlu-de" >Deutsch</option>
        <option value="/mmlu-ar" selected>العربية</option>
        <option value="/mmlu-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h2 id="مقدمة">مقدمة</h2>

<p>يقدّم هذا المنشور تقييم لنموذج لغة باستخدام معيار MMLU (فهم لغة متعددة المهام الضخمة).</p>

<p>يكون معيار MMLU اختبار شامل للمودل على قدرته على تنفيذ مجموعة متنوعة من المهام عبر مجموعة واسعة من الموضوعات. ويحتوي على أسئلة متعددة الاختيار تغطي مجالات متنوعة مثل الرياضيات، التاريخ، القانون، والطب.</p>

<p><strong>روابط البيانات:</strong></p>

<ul>
  <li><a href="https://paperswithcode.com/dataset/mmlu">أوراق بالرموز</a></li>
  <li><a href="https://huggingface.co/datasets/cais/mmlu">مجموعات Hugging Face</a></li>
</ul>

<h2 id="llama-server">llama-server</h2>

<p>للتشغيل llama-server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build/bin/llama-server <span class="nt">-m</span> models/7B/mistral-7b-instruct-v0.2.Q4_K_M.gguf <span class="nt">--port</span> 8080
</code></pre></div></div>

<h2 id="معيار-mmlu">معيار MMLU</h2>

<p>يحكم هذا السكريبت على معيار MMLU باستخدام ثلاثة خلفيات مختلفة: <code class="language-plaintext highlighter-rouge">ollama</code>, <code class="language-plaintext highlighter-rouge">llama-server</code>, و<code class="language-plaintext highlighter-rouge">deepseek</code>.</p>

<p>للتشغيل الشفرة الخاصة بمقياس MMLU:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># إعداد التحليل النصي
</span><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"تقييم مجموعة بيانات MMLU باستخدام خلفيات مختلفة."</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--type"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"ollama"</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">"ollama"</span><span class="p">,</span> <span class="s">"llama"</span><span class="p">,</span> <span class="s">"deepseek"</span><span class="p">,</span> <span class="s">"gemini"</span><span class="p">,</span> <span class="s">"mistral"</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="s">"نوع الخلفية: ollama, llama, deepseek, gemini أو mistral"</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--model"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"اسم النموذج"</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># تحميل مجموعة بيانات MMLU
</span><span class="n">subject</span> <span class="o">=</span> <span class="s">"college_computer_science"</span>  <span class="c1"># اختيار الموضوع
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s">"cais/mmlu"</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s">"test"</span><span class="p">)</span>

<span class="c1"># تنسيق التوصية مع مثال واحد
</span><span class="k">def</span> <span class="nf">format_mmlu_prompt</span><span class="p">(</span><span class="n">example</span><span class="p">):</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"سؤال: </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s">'question'</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
    <span class="n">prompt</span> <span class="o">+=</span> <span class="s">"الاختيارات:</span><span class="se">\n</span><span class="s">"</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s">'choices'</span><span class="p">]):</span>
        <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s">'A'</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s">. </span><span class="si">{</span><span class="n">choice</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
    <span class="n">prompt</span> <span class="o">+=</span> <span class="s">"أعط إجابتك. أعط الاختيار فقط.</span><span class="se">\n</span><span class="s">"</span>
    <span class="k">return</span> <span class="n">prompt</span>

<span class="c1"># تهيئة عميل DeepSeek إذا لزم الأمر
</span><span class="k">def</span> <span class="nf">initialize_deepseek_client</span><span class="p">():</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"DEEPSEEK_API_KEY"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"خطأ: لم يتم تعيين المتغير البيئي DEEPSEEK_API_KEY."</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="s">"https://api.deepseek.com"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">call_gemini_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">gemini_api_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"GEMINI_API_KEY"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gemini_api_key</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"خطأ: لم يتم تعيين المتغير البيئي GEMINI_API_KEY."</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent"</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="n">gemini_api_key</span><span class="p">}</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">"contents"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"parts"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]}]}</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"دخول إلى API Gemini: </span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response_json</span>
        <span class="k">elif</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">))</span>  <span class="c1"># الانسحاب التدرجة
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ في API Gemini: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">response_json</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">call_mistral_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">"mistral-small-2501"</span><span class="p">,</span> <span class="n">process_response</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"MISTRAL_API_KEY"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"خطأ: لم يتم تعيين المتغير البيئي MISTRAL_API_KEY."</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.mistral.ai/v1/chat/completions"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">,</span>
        <span class="s">"Accept"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">,</span>
        <span class="s">"Authorization"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"Bearer </span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="s">"</span>
    <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s">"messages"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span>
                <span class="s">"content"</span><span class="p">:</span> <span class="n">prompt</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"دخول إلى API Mistral: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"URL API Mistral: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"عنوانات API Mistral: </span><span class="si">{</span><span class="n">headers</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response_json</span> <span class="ow">and</span> <span class="n">response_json</span><span class="p">[</span><span class="s">'choices'</span><span class="p">]:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">response_json</span><span class="p">[</span><span class="s">'choices'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'message'</span><span class="p">][</span><span class="s">'content'</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">process_response</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">process_mistral_response</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ في API Mistral: صيغة الرد غير صالحة: </span><span class="si">{</span><span class="n">response_json</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ في API Mistral: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">stre</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span>
        <span class="k">if</span> <span class="s">'429'</span> <span class="ow">in</span>  <span class="n">stre</span><span class="p">:</span>
            <span class="c1"># print(f"Response status code: {e.response.status_code}")
</span>            <span class="c1"># print(f"Response content: {e.response.text}")
</span>            <span class="k">print</span><span class="p">(</span><span class="s">"طلبات كثيرة جدًا، نأمل 10 ثوانٍ ومراجعة"</span><span class="p">)</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">call_mistral_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">process_response</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">e</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">process_ollama_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الخروج من API: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">output_text</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"choices"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">"message"</span><span class="p">][</span><span class="s">"content"</span><span class="p">]</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"Answer:\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"\*\*Answer\*\*:\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The correct answer is\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The correct choice is\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The correct choice would be\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The answer is\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The answer appears to be\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The correct answer should be\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">"The correct answer would be\s*([A-D])"</span><span class="p">,</span> <span class="n">output_text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">match</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stripped_output</span> <span class="o">=</span> <span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stripped_output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">first_word</span> <span class="o">=</span> <span class="n">stripped_output</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_word</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">first_word</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">first_word_comma</span> <span class="o">=</span> <span class="n">stripped_output</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">","</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_word_comma</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">first_word_comma</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">first_word_period</span> <span class="o">=</span> <span class="n">stripped_output</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_word_period</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">first_word_period</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"لم يمكن استخراج إجابة حرف واحد من الخروج: </span><span class="si">{</span><span class="n">output_text</span><span class="si">}</span><span class="s">, إعادة إجابة عشوائية"</span><span class="p">)</span>
                            <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">,</span> <span class="s">"C"</span><span class="p">,</span> <span class="s">"D"</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">predicted_answer</span> <span class="o">=</span> <span class="s">""</span>

        <span class="k">return</span> <span class="n">predicted_answer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>

<span class="k">def</span> <span class="nf">process_llama_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">output_text</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"choices"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">"message"</span><span class="p">][</span><span class="s">"content"</span><span class="p">]</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">""</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الخروج من API: </span><span class="si">{</span><span class="n">output_text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predicted_answer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>

<span class="k">def</span> <span class="nf">process_deepseek_response</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">"deepseek-chat"</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"دخول إلى API Deepseek: </span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">chat</span><span class="p">.</span><span class="n">completions</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span> <span class="s">"content"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}</span>
                <span class="p">],</span>
                <span class="n">max_tokens</span><span class="o">=</span><span class="mi">100</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span> <span class="ow">and</span> <span class="n">response</span><span class="p">.</span><span class="n">choices</span><span class="p">:</span>
                <span class="n">output_text</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">message</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">""</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الخروج من API: </span><span class="si">{</span><span class="n">output_text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">predicted_answer</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"خطأ: لا يوجد رد من API."</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">""</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">"502"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ البوابة السيئة (502) أثناء مكالمة API، إعادة المحاولة في </span><span class="si">{</span><span class="n">backoff_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span><span class="si">}</span><span class="s"> ثانية..."</span><span class="p">)</span>
                <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"خطأ أثناء مكالمة API: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">""</span>
    <span class="k">return</span> <span class="s">""</span>

<span class="k">def</span> <span class="nf">process_mistral_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">output_text</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">""</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الخروج من API: </span><span class="si">{</span><span class="n">output_text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predicted_answer</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"خطأ: لا يوجد رد من API Mistral"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>

<span class="k">def</span> <span class="nf">process_gemini_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">):</span>
    <span class="n">json_response</span> <span class="o">=</span> <span class="n">call_gemini_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">json_response</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"لا يوجد رد من API Gemini بعد المحاولات."</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>
    <span class="k">if</span> <span class="s">'candidates'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">json_response</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">json_response</span><span class="p">[</span><span class="s">'candidates'</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"لا يوجد مرشحين موجودون في الرد، إعادة المحاولة..."</span><span class="p">)</span>
        <span class="n">json_response</span> <span class="o">=</span> <span class="n">call_gemini_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">json_response</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">json_response</span> <span class="ow">or</span> <span class="s">'candidates'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">json_response</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">json_response</span><span class="p">[</span><span class="s">'candidates'</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"لا يوجد مرشحين موجودون في الرد بعد المحاولة."</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">""</span>

    <span class="n">first_candidate</span> <span class="o">=</span> <span class="n">json_response</span><span class="p">[</span><span class="s">'candidates'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">'content'</span> <span class="ow">in</span> <span class="n">first_candidate</span> <span class="ow">and</span> <span class="s">'parts'</span> <span class="ow">in</span> <span class="n">first_candidate</span><span class="p">[</span><span class="s">'content'</span><span class="p">]:</span>
        <span class="n">first_part</span> <span class="o">=</span> <span class="n">first_candidate</span><span class="p">[</span><span class="s">'content'</span><span class="p">][</span><span class="s">'parts'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">'text'</span> <span class="ow">in</span> <span class="n">first_part</span><span class="p">:</span>
            <span class="n">output_text</span> <span class="o">=</span> <span class="n">first_part</span><span class="p">[</span><span class="s">'text'</span><span class="p">]</span>
            <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_text</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">""</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الخروج من API: </span><span class="si">{</span><span class="n">output_text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">predicted_answer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"لا يوجد نص موجود في الرد"</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">""</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"صيغة الرد غير متوقعة: محتوى أو أجزاء مفقود"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">""</span>

<span class="k">def</span> <span class="nf">_call_ollama_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"http://localhost:11434/v1/chat/completions"</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"messages"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span> <span class="s">"content"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}],</span>
        <span class="s">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s">"max_tokens"</span><span class="p">:</span> <span class="mi">300</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">}</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"دخول إلى API: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">process_ollama_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_call_llama_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"http://localhost:8080/v1/chat/completions"</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"messages"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span> <span class="s">"content"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">}</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"دخول إلى API: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">process_llama_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_get_predicted_answer</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
    <span class="n">predicted_answer</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"ollama"</span><span class="p">:</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">_call_ollama_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">model</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"llama"</span><span class="p">:</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">_call_llama_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"deepseek"</span><span class="p">:</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">process_deepseek_response</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">model</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"gemini"</span><span class="p">:</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">process_gemini_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"mistral"</span><span class="p">:</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">call_mistral_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">model</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"نوع الخلفية غير صالح"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predicted_answer</span>

<span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">client</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"deepseek"</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">initialize_deepseek_client</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">model</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"ollama"</span><span class="p">:</span>
            <span class="n">args</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">"mistral:7b"</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"deepseek"</span><span class="p">:</span>
            <span class="n">args</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">"deepseek-chat"</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"mistral"</span><span class="p">:</span>
            <span class="n">args</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">"mistral-small-latest"</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s">"تقييم"</span><span class="p">):</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">format_mmlu_prompt</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
        <span class="n">predicted_answer</span> <span class="o">=</span> <span class="n">_get_predicted_answer</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">client</span><span class="p">)</span>

        <span class="n">answer_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">"A"</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">"B"</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">"C"</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s">"D"</span><span class="p">}</span>
        <span class="n">ground_truth_answer</span> <span class="o">=</span> <span class="n">answer_map</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s">"answer"</span><span class="p">],</span> <span class="s">""</span><span class="p">)</span>
        <span class="n">is_correct</span> <span class="o">=</span> <span class="n">predicted_answer</span><span class="p">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">ground_truth_answer</span>
        <span class="k">if</span> <span class="n">is_correct</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"سؤال: </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s">'question'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الاختيارات: A. </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s">'choices'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">, B. </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s">'choices'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">, C. </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s">'choices'</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s">, D. </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s">'choices'</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الاجابة المتوقعة: </span><span class="si">{</span><span class="n">predicted_answer</span><span class="si">}</span><span class="s">, الأصل: </span><span class="si">{</span><span class="n">ground_truth_answer</span><span class="si">}</span><span class="s">, صحيح: </span><span class="si">{</span><span class="n">is_correct</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"-"</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"تم معالجة </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s">. الدقة الحالية: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">correct</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">correct</span><span class="p">,</span> <span class="n">total</span>

<span class="c1"># حلقة التقييم
</span><span class="n">correct</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="n">evaluate_model</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>

<span class="c1"># حساب الدقة
</span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الموضوع: </span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"الدقة: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">correct</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="النتائج">النتائج</h2>

<h3 id="تقييم-بدون-أمثلة">تقييم بدون أمثلة</h3>

<table>
  <thead>
    <tr>
      <th>النموذج</th>
      <th>طريقة</th>
      <th>الموضوع</th>
      <th>الدقة</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>mistral-7b-instruct-v0.2, Q4_K_M</td>
      <td>macOS m2, 16GB, llama-server</td>
      <td>MMLU college_computer_science</td>
      <td>40.00% (40/100)</td>
    </tr>
    <tr>
      <td>Mistral-7B-Instruct-v0.3, Q4_0</td>
      <td>macOS m2, 16GB, ollama</td>
      <td>MMLU college_computer_science</td>
      <td>40.00% (40/100)</td>
    </tr>
    <tr>
      <td>deepseek v3 (API)</td>
      <td>API, 2025.1.25</td>
      <td>MMLU college_computer_science</td>
      <td>78.00% (78/100)</td>
    </tr>
    <tr>
      <td>gemini-1.5-flash (API)</td>
      <td>API, 2025.1.25</td>
      <td>MMLU college_computer_science</td>
      <td>72.00% (72/100)</td>
    </tr>
    <tr>
      <td>deepseek r1 (API)</td>
      <td>API, 2025.1.26</td>
      <td>MMLU college_computer_science</td>
      <td>87.14% (61/70)</td>
    </tr>
    <tr>
      <td>Mistral Small Latest (API)</td>
      <td>API, 2025.01.31</td>
      <td>MMLU college_computer_science</td>
      <td>65.00% (65/100)</td>
    </tr>
    <tr>
      <td>Mistral Large Latest (API)</td>
      <td>API, 2025.01.31</td>
      <td>MMLU college_computer_science</td>
      <td>73.00% (73/100)</td>
    </tr>
    <tr>
      <td>Mistral Small 2501 (API)</td>
      <td>API, 2025.01.31</td>
      <td>MMLU college_computer_science</td>
      <td>66.00% (66/100)</td>
    </tr>
    <tr>
      <td>Grok 2 Latest</td>
      <td>API, 2025.02.02</td>
      <td>MMLU college_computer_science</td>
      <td>72.00% (72/100)</td>
    </tr>
  </tbody>
</table>

<h3 id="الشكل">الشكل</h3>

<p>هنا سنتحوق إلى نموذج بناءً على الجدول أعلاه.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># البيانات العينة (استبدل ببياناتك الحقيقية)
</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s">'mistral-7b-instruct-v0.2 (llama.cpp)'</span><span class="p">,</span> <span class="s">'Mistral-7B-Instruct-v0.3 (ollama)'</span><span class="p">,</span> <span class="s">'deepseek v3 (API)'</span><span class="p">,</span> <span class="s">'gemini-1.5-flash (API)'</span><span class="p">,</span> <span class="s">'deepseek r1 (API)'</span><span class="p">]</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">40.00</span><span class="p">,</span> <span class="mf">40.00</span><span class="p">,</span> <span class="mf">78.00</span><span class="p">,</span> <span class="mf">72.00</span><span class="p">,</span> <span class="mf">87.14</span><span class="p">]</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s">"college_computer_science"</span>

<span class="c1"># إنشاء الرسم البياني
</span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s">'skyblue'</span><span class="p">,</span> <span class="s">'lightcoral'</span><span class="p">,</span> <span class="s">'lightgreen'</span><span class="p">,</span> <span class="s">'gold'</span><span class="p">,</span> <span class="s">'lightcoral'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'النموذج'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'الدقة (%)'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s">'دقة قياس MMLU لـ </span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># تعيين حدود محور y إلى 0-100 للحصول على النسبة المئوية
</span><span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">"right"</span><span class="p">)</span>  <span class="c1"># دوران علامات محور x للحصول على قابلية القراءة أفضل
</span><span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># إضافة القيم الدقة على قمة الأعمدة
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">accuracy</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">%'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">)</span>

<span class="c1"># حفظ الرسم البياني كـ ملف JPG في المحور الحالي
</span><span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="sa">f</span><span class="s">'mmlu_accuracy_chart.jpg'</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<p class="centered"><img src="assets/images/mmlu/mmlu_accuracy_chart.jpg" alt="" />
<em class="caption">دقة قياس MMLU</em></p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-ar" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
