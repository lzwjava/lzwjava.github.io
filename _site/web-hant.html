<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>網頁編程入門</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>網頁編程入門 | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="網頁編程入門" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="hant" />
<meta name="description" content="上期講到我們把斐波那契數列功能，改寫成了面向對象的版本，實現了一個終端接口。" />
<meta property="og:description" content="上期講到我們把斐波那契數列功能，改寫成了面向對象的版本，實現了一個終端接口。" />
<link rel="canonical" href="https://lzwjava.github.io/web-hant" />
<meta property="og:url" content="https://lzwjava.github.io/web-hant" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="網頁編程入門" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2021-03-07T00:00:00+08:00","datePublished":"2021-03-07T00:00:00+08:00","description":"上期講到我們把斐波那契數列功能，改寫成了面向對象的版本，實現了一個終端接口。","headline":"網頁編程入門","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/web-hant"},"url":"https://lzwjava.github.io/web-hant"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=a94302371a2563e92b963d3013f4602ab4b348b0">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=a94302371a2563e92b963d3013f4602ab4b348b0" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       網頁編程入門 | 原創，AI翻譯
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/hant/2021-03-07-web-hant.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postshant2021-03-07-web-hant.md</span> -->
      

      <!-- <span>2021-03-07-web-hant.md</span> -->

      
        

        
          
          <a href="#" class="button">2021.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/web-en" >English</option>
        <option value="/web-zh" >中文</option>
        <option value="/web-ja" >日本語</option>
        <option value="/web-es" >Español</option>
        <option value="/web-hi" >हिंदी</option>
        <option value="/web-fr" >Français</option>
        <option value="/web-de" >Deutsch</option>
        <option value="/web-ar" >العربية</option>
        <option value="/web-hant" selected>繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>上期講到我們把斐波那契數列功能，改寫成了面向對象的版本，實現了一個終端接口。</p>

<p><code class="language-plaintext highlighter-rouge">server.py</code>：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BaseHandler</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Server</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handlerClass</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">handlerClass</span> <span class="o">=</span> <span class="n">handlerClass</span>

  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">request</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">handlerClass</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">fib_handle.py</code>：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fib</span> <span class="kn">import</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">server</span> <span class="kn">import</span> <span class="n">BaseHandler</span><span class="p">,</span> <span class="n">Server</span>

<span class="k">class</span> <span class="nc">FibHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'f(n)='</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">pass</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">FibHandler</span><span class="p">)</span>
<span class="n">server</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>  
</code></pre></div></div>
<h2 id="簡單-web-服務器">簡單 Web 服務器</h2>

<p>那如何改成<code class="language-plaintext highlighter-rouge">Web</code>接口呢。</p>

<p>我們把上面的<code class="language-plaintext highlighter-rouge">Server</code>換成<code class="language-plaintext highlighter-rouge">HTTP協議</code>的<code class="language-plaintext highlighter-rouge">Server</code>就行了。先來看看Python中的<code class="language-plaintext highlighter-rouge">HTTP服務器</code>是怎麼樣的。</p>

<p>Python 的標準庫中提供了一個網頁服務器。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m http.server
</code></pre></div></div>

<p>在終端中運行它。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-m</span> http.server
Serving HTTP on :: port 8000 <span class="o">(</span>http://[::]:8000/<span class="o">)</span> ...
</code></pre></div></div>

<p>在瀏覽器中打開便可以看到效果。</p>

<p><img src="/assets/images/web/webserver.png" alt="webserver" style="zoom:50%;" /></p>

<p>這把當前目錄列舉出來了。接著當瀏覽這個網頁時，再回去看終端。這會，很有意思。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-m</span> http.server
Serving HTTP on :: port 8000 <span class="o">(</span>http://[::]:8000/<span class="o">)</span> ...
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET / HTTP/1.1"</span> 200 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] code 404, message File not found
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET /favicon.ico HTTP/1.1"</span> 404 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] code 404, message File not found
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET /apple-touch-icon-precomposed.png HTTP/1.1"</span> 404 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] code 404, message File not found
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET /apple-touch-icon.png HTTP/1.1"</span> 404 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:38] <span class="s2">"GET / HTTP/1.1"</span> 200 -
</code></pre></div></div>

<p>這是網頁訪問日誌。其中<code class="language-plaintext highlighter-rouge">GET</code>表示網頁服務的一種數據訪問操作。<code class="language-plaintext highlighter-rouge">HTTP/1.1</code>表示使用了 <code class="language-plaintext highlighter-rouge">HTTP</code>的<code class="language-plaintext highlighter-rouge">1.1</code>版本的協議。</p>

<p>如何用它來打造我們的斐波那契數列服務。先網上找找樣例代碼，稍微改改，寫一個最簡單的Web服務器：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">SimpleHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>

<span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">"hi"</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">8000</span><span class="p">),</span> <span class="n">Handler</span><span class="p">)</span>

<span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></div>

<p>這些是不是很眼熟。幾乎跟上面我們使用<code class="language-plaintext highlighter-rouge">Server</code>是一樣的。注意到<code class="language-plaintext highlighter-rouge">SimpleHTTPRequestHandler</code>不是基礎類，還有一個叫<code class="language-plaintext highlighter-rouge">BaseHTTPRequestHandler</code>。<code class="language-plaintext highlighter-rouge">SimpleHTTPRequestHandler</code>相對於多處理了一些內容。這些加上斐波那契數列處理功能是容易的。</p>

<p>這裡的<code class="language-plaintext highlighter-rouge">127.0.0.1</code>表示本機的地址，<code class="language-plaintext highlighter-rouge">8000</code>表示本機的端口。端口怎麼理解呢。就好像家裡的一個窗戶一樣，是家裡跟外界溝通的一個端口。<code class="language-plaintext highlighter-rouge">bytes</code>表示把字符串變成字節。<code class="language-plaintext highlighter-rouge">utf-8</code>是一種字符串編碼方式。<code class="language-plaintext highlighter-rouge">send_response</code>、<code class="language-plaintext highlighter-rouge">send_header</code>和<code class="language-plaintext highlighter-rouge">end_headers</code>都是在輸出一些內容，來輸出<code class="language-plaintext highlighter-rouge">HTTP</code>協議所規定的內容，好能被瀏覽器所理解。這樣我們在網頁裡就看到了<code class="language-plaintext highlighter-rouge">hi</code>。</p>

<p><img src="/assets/images/web/hi.png" alt="hi" style="zoom:50%;" /></p>

<p>接著試試再從請求從得到參數。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">SimpleHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
<span class="kn">from</span> <span class="nn">fib</span> <span class="kn">import</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span><span class="n">parse_qs</span>

<span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>      
      <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>
      <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
      <span class="n">qs</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>      
      <span class="n">result</span> <span class="o">=</span> <span class="s">""</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>          
          <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
          <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">8000</span><span class="p">),</span> <span class="n">Handler</span><span class="p">)</span>

<span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/web/n10.png" alt="n10" style="zoom:50%;" /></p>

<p>有點複雜吧。這裡就是在解析一些參數。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>self.path<span class="o">=</span>/?n<span class="o">=</span>3
<span class="nv">parsed</span><span class="o">=</span>ParseResult<span class="o">(</span><span class="nv">scheme</span><span class="o">=</span><span class="s1">''</span>, <span class="nv">netloc</span><span class="o">=</span><span class="s1">''</span>, <span class="nv">path</span><span class="o">=</span><span class="s1">'/'</span>, <span class="nv">params</span><span class="o">=</span><span class="s1">''</span>, <span class="nv">query</span><span class="o">=</span><span class="s1">'n=3'</span>, <span class="nv">fragment</span><span class="o">=</span><span class="s1">''</span><span class="o">)</span>
<span class="nv">qs</span><span class="o">={</span><span class="s1">'n'</span>: <span class="o">[</span><span class="s1">'3'</span><span class="o">]}</span>
<span class="nv">ns</span><span class="o">=[</span><span class="s1">'3'</span><span class="o">]</span>
<span class="nv">n</span><span class="o">=</span>3
</code></pre></div></div>

<h2 id="遞歸進階">遞歸進階</h2>

<p>讓我們稍稍重構一下代碼。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">SimpleHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
<span class="kn">from</span> <span class="nn">fib</span> <span class="kn">import</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span><span class="n">parse_qs</span>

<span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">parse_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
      <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="n">qs</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="s">'n'</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="k">return</span> <span class="n">n</span>
      <span class="k">return</span> <span class="bp">None</span>
      
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>

      <span class="n">result</span> <span class="o">=</span> <span class="s">""</span>
      <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parse_n</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
              
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">8000</span><span class="p">),</span> <span class="n">Handler</span><span class="p">)</span>

<span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></div>

<p>引入 <code class="language-plaintext highlighter-rouge">parse_n</code>的函數來把從請求路徑中解析得到<code class="language-plaintext highlighter-rouge">n</code>封裝在一塊。</p>

<p>現在程序有這樣的問題。小王請求了斐波那契數列的第10000位，過了一些天，小明又請求了斐波那契數列的第10000位。兩次，小王和小明都等待了半天，才得到結果。我們該如何提高這個<code class="language-plaintext highlighter-rouge">Web服務的</code>效率呢。</p>

<p>注意到如果<code class="language-plaintext highlighter-rouge">n</code>相同，<code class="language-plaintext highlighter-rouge">f(n)</code>的值總是一樣的。我們進行了一番實驗。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1 - - <span class="o">[</span>10/Mar/2021 00:33:01] <span class="s2">"GET /?n=1000 HTTP/1.1"</span> 200 -
<span class="nt">----------------------------------------</span>
Exception occurred during processing of request from <span class="o">(</span><span class="s1">'127.0.0.1'</span>, 50783<span class="o">)</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
    ...
    <span class="k">if </span>v[n] <span class="o">!=</span> <span class="nt">-1</span>:
IndexError: list index out of range
</code></pre></div></div>

<p>原來數組不夠大，那就把v數組改成10000吧。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>然而當n為<code class="language-plaintext highlighter-rouge">2000</code>時，出現了遞歸深度溢出錯誤：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1 - - <span class="o">[</span>10/Mar/2021 00:34:00] <span class="s2">"GET /?n=2000 HTTP/1.1"</span> 200 -
<span class="nt">----------------------------------------</span>
Exception occurred during processing of request from <span class="o">(</span><span class="s1">'127.0.0.1'</span>, 50821<span class="o">)</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
    ...
    <span class="k">if </span>v[n] <span class="o">!=</span> <span class="nt">-1</span>:
RecursionError: maximum recursion depth exceeded <span class="k">in </span>comparison
</code></pre></div></div>

<p>然而這一切都還挺快的。</p>

<p>為什麼。因為<code class="language-plaintext highlighter-rouge">f(1)</code>到<code class="language-plaintext highlighter-rouge">f(1000)</code>，都只需要算一次。這意味著當在算<code class="language-plaintext highlighter-rouge">f(1000)</code>的時候，<code class="language-plaintext highlighter-rouge">+</code>運算也許只被執行了1000次左右。我們知道<code class="language-plaintext highlighter-rouge">Python</code>的遞歸深度大約在1000左右。這意味著我們可以這樣優化程序，如果要算<code class="language-plaintext highlighter-rouge">2000</code>，那我先算<code class="language-plaintext highlighter-rouge">1000</code>的。不，這樣還是可能會出現<code class="language-plaintext highlighter-rouge">遞歸深度溢出錯誤</code>。如果要算2000，先算1200吧。如果要算1200，先算400吧。</p>

<p>這樣算完400和1200之後，再算2000，遞歸深度大概在800左右，就不會出現遞歸深度溢出錯誤了。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</code></pre></div></div>

<p>增加了<code class="language-plaintext highlighter-rouge">fplus</code>函數。</p>

<p>然而不禁讓人想，<code class="language-plaintext highlighter-rouge">fplus</code>被遞歸調用<code class="language-plaintext highlighter-rouge">1000</code>次怎麼樣。1000 * 800 = 800000。當我把n設為80萬之後，又出現遞歸深度錯誤了。繼續試探了一下，發現事情更複雜。然而這樣優化之後，算2000是非常輕鬆的了。</p>

<h2 id="文件讀寫">文件讀寫</h2>

<p>似乎把話題岔開了。回到Web開發的話題上。第一次請求<code class="language-plaintext highlighter-rouge">f(400)</code>，第二次請求<code class="language-plaintext highlighter-rouge">f(600)</code>。那麼第二次請求時，第一次請求所產生的<code class="language-plaintext highlighter-rouge">v</code>數組的值，我們是能用上的。然而當我們把程序退出。再啟動就用不上了。按我們的方法，斐波那契數列計算是很快的。然而設想，如果很慢怎麼辦。尤其就如當我們沒有引入v數組的時候，有著大量重複的計算。這時我們希望能把好不容易得到的結果保存起來。</p>

<p>這時，就引入<code class="language-plaintext highlighter-rouge">緩存</code>的概念了。<code class="language-plaintext highlighter-rouge">v</code>數組這裡就是一個緩存。不過它只存在於程序生命週期裡。程序關閉後，它就沒了。怎麼辦呢。很自然，我們會想到存到文件裡去。</p>

<p>如何把v數組保存到文件呢。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 0
1 1
2 1
3 2
4 3
...
</code></pre></div></div>

<p>我們的<code class="language-plaintext highlighter-rouge">v</code>數組可以這樣保存。每一行保存為<code class="language-plaintext highlighter-rouge">n f(n)</code>。既然<code class="language-plaintext highlighter-rouge">n</code>是自然增長的。或許我們可以只保存<code class="language-plaintext highlighter-rouge">f(n)</code>值。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
2
3
...
</code></pre></div></div>

<p>來試試吧。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"demofile2.txt"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Now the file has more content!"</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#open and read the file after the appending:
</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"demofile2.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">open</code>的第二個參數可以是<code class="language-plaintext highlighter-rouge">a</code>，表示會加在文件末尾；或者是<code class="language-plaintext highlighter-rouge">w</code>，表示會覆蓋掉文件。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'hi'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>運行一下，果然有文件<code class="language-plaintext highlighter-rouge">fib_v</code>。</p>

<p><code class="language-plaintext highlighter-rouge">fib_v</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hi
</code></pre></div></div>

<p>當我們再運行一次的時候，變成了這樣。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hihi
</code></pre></div></div>

<p>如何換行呢。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'hi</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>這會打印一次，出現了<code class="language-plaintext highlighter-rouge">hihihi</code>，沒看見換行呢。然而再打印一次，換行了。可見第一次已經打印了換行符，只是在末尾，看不見。</p>

<p>如何讀取呢。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python fib.py
hihihi
hi
</code></pre></div></div>

<p>接下來，改改我們的斐波那契程序。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
   <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">lines</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
           <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>   

<span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
   <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="s">''</span>
   <span class="n">start</span> <span class="o">=</span> <span class="bp">True</span>
   <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">vv</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
         <span class="k">break</span>      
      <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
         <span class="n">s</span> <span class="o">+=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span>
      <span class="n">start</span> <span class="o">=</span> <span class="bp">False</span>   
      <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
   <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
   <span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">fcache</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">save</span><span class="p">()</span>
   <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="n">read</span><span class="p">()</span>
<span class="n">fcache</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">save</span><span class="p">()</span>
</code></pre></div></div>

<p>終於我們寫好程序了。程序運行後，<code class="language-plaintext highlighter-rouge">fib_v</code>文件是這樣的。</p>

<p><code class="language-plaintext highlighter-rouge">fib_v</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
2
3
5
8
13
21
34
55
</code></pre></div></div>

<p>看到上面的解析有點麻煩。<code class="language-plaintext highlighter-rouge">\n</code>是換行符。有沒有更簡單統一的解析方式。人們發明了<code class="language-plaintext highlighter-rouge">JSON</code>這件數據格式。</p>

<h2 id="json">JSON</h2>

<p>JSON的全名是<code class="language-plaintext highlighter-rouge">JavaScript Object Notation</code>。以下是<code class="language-plaintext highlighter-rouge">JSON</code>的例子。</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"John"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"New York"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>以上這樣來表示一種映射。</p>

<p>JSON有這樣基本元素：</p>

<ol>
  <li>數字或字符串</li>
  <li>列表</li>
  <li>映射</li>
</ol>

<p>而這些基本元素又可以任意嵌套。就是列表裡可以有列表。映射裡也可以有列表。等等</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"John"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"age"</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cars"</span><span class="p">:[</span><span class="w"> </span><span class="s2">"Ford"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BMW"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Fiat"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>寫成一行，和這樣寫得好看點是意義上的差別的。或許我們可以想像它們的計算圖。空格不會影響他們的計算圖。</p>

<p>接著我們要把v數組變成<code class="language-plaintext highlighter-rouge">json</code>格式的字符串。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="n">fplus</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>當我們這麼寫的時候。報錯了。<code class="language-plaintext highlighter-rouge">TypeError: dump() missing 1 required positional argument: 'fp'</code>。在<code class="language-plaintext highlighter-rouge">vscode</code>上可以這樣來看到函數定義。</p>

<p><img src="assets/images/web/json.png" alt="json" /></p>

<p>可以用鼠標移動到<code class="language-plaintext highlighter-rouge">dump</code>上就行。很方便吧。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fplus</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>計算到100顯示的數有點多，這裡改為10。原來dump的第二個參數傳如<code class="language-plaintext highlighter-rouge">file</code>對象就行。</p>

<p>這樣可以看到文件：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>注意後面省略了很多<code class="language-plaintext highlighter-rouge">-1</code>。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sv</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">read</span><span class="p">()</span>

<span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">vv</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
</code></pre></div></div>

<p>當這樣時，可見打印出了：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
2
3
5
8
13
21
34
55
</code></pre></div></div>

<p>這幾個函數一起檢查一下：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sv</span><span class="p">)):</span>
        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            

<span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sv</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>        
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">read</span><span class="p">()</span>
<span class="n">fplus</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">save</span><span class="p">()</span>
</code></pre></div></div>

<p>然後到文件查看，果然保存了正確的值，而且很整齊。</p>

<p>```json
[0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946, 17711, 28657, 46368, 75025, 121393, 196418, 317811, 514229, 832040, 1346269, 2178309, 3524578, 5702887, 9227465, 14930352, 24157817</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-hant" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
