<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>mathjax2mobi：Convertir MathJax HTML a libros electrónicos</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>mathjax2mobi：Convertir MathJax HTML a libros electrónicos | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="mathjax2mobi：Convertir MathJax HTML a libros electrónicos" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="es" />
<meta name="description" content="Descripción del Proyecto" />
<meta property="og:description" content="Descripción del Proyecto" />
<link rel="canonical" href="https://lzwjava.github.io/feynman-es" />
<meta property="og:url" content="https://lzwjava.github.io/feynman-es" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="mathjax2mobi：Convertir MathJax HTML a libros electrónicos" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2021-03-15T00:00:00+08:00","datePublished":"2021-03-15T00:00:00+08:00","description":"Descripción del Proyecto","headline":"mathjax2mobi：Convertir MathJax HTML a libros electrónicos","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/feynman-es"},"url":"https://lzwjava.github.io/feynman-es"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=a621c9d4a12f9021a54fc66ee6b839717353f88d">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=a621c9d4a12f9021a54fc66ee6b839717353f88d" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       mathjax2mobi：Convertir MathJax HTML a libros electrónicos | Original, traducido por IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/es/2021-03-15-feynman-es.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postses2021-03-15-feynman-es.md</span> -->
      

      <!-- <span>2021-03-15-feynman-es.md</span> -->

      
        

        
          
          <a href="#" class="button">2021.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/feynman-en" >English</option>
        <option value="/feynman-zh" >中文</option>
        <option value="/feynman-ja" >日本語</option>
        <option value="/feynman-es" selected>Español</option>
        <option value="/feynman-hi" >हिंदी</option>
        <option value="/feynman-fr" >Français</option>
        <option value="/feynman-de" >Deutsch</option>
        <option value="/feynman-ar" >العربية</option>
        <option value="/feynman-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="descripción-del-proyecto">Descripción del Proyecto</h3>

<p>Primero, hablemos brevemente sobre la situación del proyecto.</p>

<p><img src="assets/images/feynman/feynman_online.jpg" alt="feynman_online" /></p>

<p><img src="/assets/images/feynman/change.JPG" alt="cambio" style="zoom:50%;" /></p>

<p><img src="assets/images/feynman/latex.JPG" alt="latex" /></p>

<p><img src="assets/images/feynman/epub_black.JPG" alt="epub_negro" /></p>

<p><img src="assets/images/feynman/epub_beautiful.JPG" alt="epub_beautiful" /></p>

<p>Después de terminar el proyecto, me sentí un poco feliz. Escribí este pequeño párrafo.</p>

<p>Después de un día entero escribiendo código, ¡finalmente obtuve un hermoso libro electrónico de las Lecciones de Física de Feynman! Las Lecciones de Física de Feynman están disponibles públicamente en la web, renderizadas en <code class="language-plaintext highlighter-rouge">LaTeX</code>. La gente suele usar <code class="language-plaintext highlighter-rouge">LaTeX</code> para escribir artículos académicos, ya que es excelente para renderizar fórmulas matemáticas. Al estar disponibles en la web, se utiliza la biblioteca <code class="language-plaintext highlighter-rouge">MathJax</code>. Esta convierte el código fuente de <code class="language-plaintext highlighter-rouge">LaTeX</code> en código <code class="language-plaintext highlighter-rouge">HTML</code>, generando muchos elementos <code class="language-plaintext highlighter-rouge">div</code> y <code class="language-plaintext highlighter-rouge">span</code>. Sin embargo, los libros electrónicos no soportan este método. Entonces, la idea fue extraer las páginas web, revertir el renderizado de <code class="language-plaintext highlighter-rouge">MathJax</code> y luego reemplazarlo con imágenes <code class="language-plaintext highlighter-rouge">SVG</code>. Surgieron varios problemas: primero, el código fuente tiene muchas macros personalizadas de <code class="language-plaintext highlighter-rouge">LaTeX</code> que necesitaban ser añadidas; segundo, incrustar muchos <code class="language-plaintext highlighter-rouge">SVG</code> causaba problemas. Si era un solo <code class="language-plaintext highlighter-rouge">SVG</code>, no había problema, pero con muchos, surgían errores. Probablemente se trataba de algún extraño bug entre el navegador y los <code class="language-plaintext highlighter-rouge">SVG</code>. La solución fue guardar los <code class="language-plaintext highlighter-rouge">SVG</code> como archivos e incluirlos mediante la etiqueta <code class="language-plaintext highlighter-rouge">img</code>. Además, las fórmulas se dividen en dos tipos: las que están dentro del texto y las que están en una línea separada. ¡Así que, al final, obtuve un hermoso libro electrónico!</p>

<h3 id="información-consultada">Información consultada</h3>

<p>Aquí se documentan los recursos consultados durante la resolución del proyecto. Dado que se trata de un tutorial, se muestra a los estudiantes una idea general de cómo es la experiencia de llevar a cabo un proyecto.</p>

<p><img src="assets/images/feynman/s1.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s2.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s3.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s4.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s5.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s6.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s7.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s8.PNG" alt="" /></p>

<h3 id="iniciar-el-proyecto">Iniciar el proyecto</h3>

<p>Las conferencias de física de Feynman ya están disponibles para leer en línea. Me gustaría leerlas en mi <code class="language-plaintext highlighter-rouge">Kindle</code>. Sin embargo, dado que contienen muchas fórmulas matemáticas, el manuscrito original probablemente fue creado usando <code class="language-plaintext highlighter-rouge">LaTeX</code>. Utilizan la biblioteca <code class="language-plaintext highlighter-rouge">MathJax</code> para mostrar el contenido en formato <code class="language-plaintext highlighter-rouge">LaTeX</code> en la página web.</p>

<p>Por ejemplo.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax_Preview"</span> <span class="na">style=</span><span class="s">"color: inherit; display: none;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"MathJax_Display"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax MathJax_FullWidth"</span> <span class="na">id=</span><span class="s">"MathJax-Element-10-Frame"</span> <span class="na">tabindex=</span><span class="s">"0"</span> <span class="na">style=</span><span class="s">""</span><span class="nt">&gt;</span>
              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"mi"</span> <span class="na">id=</span><span class="s">"MathJax-Span-159"</span> <span class="na">style=</span><span class="s">"font-family: MathJax_Math-italic;"</span><span class="nt">&gt;</span>d<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/span&gt;</span>  
    <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"math/tex; mode=display"</span> <span class="na">id=</span><span class="s">"MathJax-Element-10"</span><span class="nt">&gt;</span><span class="err">\</span><span class="nx">begin</span><span class="p">{</span><span class="nx">equation</span><span class="p">}</span>
<span class="err">\</span><span class="nx">label</span><span class="p">{</span><span class="nl">Eq</span><span class="p">:</span><span class="nl">I</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="nx">dT</span><span class="o">/</span><span class="nx">dt</span> <span class="o">=</span> <span class="nx">Fv</span><span class="p">.</span>
<span class="err">\</span><span class="nx">end</span><span class="p">{</span><span class="nx">equation</span><span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>Arriba se muestra un fragmento de código <code class="language-plaintext highlighter-rouge">html</code>. En este bloque de código <code class="language-plaintext highlighter-rouge">html</code>, debajo de la etiqueta <code class="language-plaintext highlighter-rouge">script</code>, se encuentra el texto original en <code class="language-plaintext highlighter-rouge">LaTeX</code>. <code class="language-plaintext highlighter-rouge">MathJax</code> lo convierte en múltiples etiquetas <code class="language-plaintext highlighter-rouge">span</code> para mostrarlo.</p>

<p>Ahora tenemos una idea. Consiste en cambiar el método de visualización de <code class="language-plaintext highlighter-rouge">mathjax</code> a imágenes <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<p>Encontré un proyecto en GitHub llamado <code class="language-plaintext highlighter-rouge">tuxu/latex2svg</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">latex2svg</span> <span class="kn">import</span> <span class="n">latex2svg</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="sa">r</span><span class="s">'\( e^{i \pi} + 1 = 0 \)'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'depth'</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
</code></pre></div></div>

<p>Intenta ejecutarlo, pero ocurrió un error.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    raise RuntimeError<span class="o">(</span><span class="s1">'latex no encontrado'</span><span class="o">)</span>
RuntimeError: latex no encontrado
</code></pre></div></div>

<p>Mira el código.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Ejecutar LaTeX y crear archivo DVI
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'latex_cmd'</span><span class="p">]</span><span class="o">+</span><span class="s">' code.tex'</span><span class="p">),</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">check_returncode</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'latex no encontrado'</span><span class="p">)</span>
</code></pre></div></div>

<p>Esto también depende del comando <code class="language-plaintext highlighter-rouge">latex</code>.</p>

<p>Instálalo.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install</span> <span class="nt">--cask</span> mactex
<span class="o">==&gt;</span> Advertencias
Debes reiniciar la ventana de tu terminal para que la instalación de las herramientas CLI de MacTex surta efecto.
Alternativamente, los usuarios de Bash y Zsh pueden ejecutar el comando:
  <span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>/usr/libexec/path_helper<span class="si">)</span><span class="s2">"</span>
<span class="o">==&gt;</span> Descargando http://mirror.ctan.org/systems/mac/mactex/mactex-20200407.pkg
<span class="o">==&gt;</span> Descargando desde https://mirrors.aliyun.com/CTAN/systems/mac/mactex/mactex-20200407.pkg
<span class="c">######################################################################## 100.0%</span>
Todas las dependencias de la fórmula están satisfechas.
<span class="o">==&gt;</span> Instalando Cask mactex
<span class="o">==&gt;</span> Ejecutando el instalador para mactex<span class="p">;</span> es posible que se necesite tu contraseña.
installer: El nombre del paquete es MacTeX
installer: Se aplicaron cambios en el archivo de opciones <span class="s1">'/private/tmp/choices20210315-4643-5884ro.xml'</span>
installer: Instalando en la ruta base /
installer: La instalación fue exitosa.
🍺  ¡mactex se instaló correctamente!
</code></pre></div></div>

<p>Instalación exitosa.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% latex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 <span class="o">(</span>TeX Live 2020<span class="o">)</span> <span class="o">(</span>preloaded <span class="nv">format</span><span class="o">=</span>latex<span class="o">)</span>
 restricted <span class="se">\w</span>rite18 enabled.
<span class="k">**</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="sa">r</span><span class="s">'\( e^{i \pi} + 1 = 0 \)'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'depth'</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
</code></pre></div></div>

<p>En este código, se utiliza la función <code class="language-plaintext highlighter-rouge">latex2svg</code> para convertir una expresión matemática en LaTeX a un formato SVG. Luego, se imprimen dos valores: la profundidad (<code class="language-plaintext highlighter-rouge">depth</code>) y el código SVG (<code class="language-plaintext highlighter-rouge">svg</code>) generado. No se realizan cambios en el código, ya que los nombres de las funciones y variables deben permanecer en inglés.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svg</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'1.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">svg</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
<span class="n">svg</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Se puede generar <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<p>Así que intenta generar todos los textos <code class="language-plaintext highlighter-rouge">latex</code> obtenidos en <code class="language-plaintext highlighter-rouge">mathjax</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">latex2svg</span> <span class="kn">import</span> <span class="n">latex2svg</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html'</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
<span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
</code></pre></div></div>

<p>Lamentablemente, ocurrió un error.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">raise</span> <span class="n">CalledProcessError</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">returncode</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">stdout</span><span class="p">,</span>
<span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span><span class="p">:</span> <span class="n">El</span> <span class="n">comando</span> <span class="s">'['</span><span class="n">latex</span><span class="s">', '</span><span class="o">-</span><span class="n">interaction</span><span class="s">', '</span><span class="n">nonstopmode</span><span class="s">', '</span><span class="o">-</span><span class="n">halt</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">error</span><span class="s">', '</span><span class="n">code</span><span class="p">.</span><span class="n">tex</span><span class="s">']'</span> <span class="n">devolvió</span> <span class="n">un</span> <span class="n">estado</span> <span class="n">de</span> <span class="n">salida</span> <span class="n">no</span> <span class="n">cero</span><span class="p">:</span> <span class="mf">1.</span>
</code></pre></div></div>

<p>¿Cuál fórmula específica está incorrecta?</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2
</code></pre></div></div>

<h2 id="latex">LaTeX</h2>

<p>LaTeX es un sistema de composición tipográfica de alta calidad, ampliamente utilizado para la producción de documentos técnicos y científicos. A diferencia de los procesadores de texto tradicionales, LaTeX se basa en un enfoque de marcado, donde el contenido se escribe en texto plano con comandos que indican la estructura y el formato del documento.</p>

<h3 id="características-principales-de-latex">Características principales de LaTeX</h3>

<ol>
  <li><strong>Calidad tipográfica</strong>: LaTeX produce documentos con un aspecto profesional, especialmente en lo que respecta a la disposición de fórmulas matemáticas.</li>
  <li><strong>Separación de contenido y formato</strong>: El autor se concentra en el contenido, mientras que LaTeX se encarga del diseño y la maquetación.</li>
  <li><strong>Amplia comunidad y recursos</strong>: Existen numerosos paquetes y plantillas que extienden las capacidades de LaTeX.</li>
  <li><strong>Compatibilidad multiplataforma</strong>: Los documentos de LaTeX pueden ser compilados en diferentes sistemas operativos.</li>
</ol>

<h3 id="ejemplo-básico-de-un-documento-en-latex">Ejemplo básico de un documento en LaTeX</h3>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[utf8]</span><span class="p">{</span>inputenc<span class="p">}</span>

<span class="k">\title</span><span class="p">{</span>Ejemplo de documento en LaTeX<span class="p">}</span>
<span class="k">\author</span><span class="p">{</span>Autor<span class="p">}</span>
<span class="k">\date</span><span class="p">{</span><span class="k">\today</span><span class="p">}</span>

<span class="nt">\begin{document}</span>

<span class="k">\maketitle</span>

<span class="k">\section</span><span class="p">{</span>Introducción<span class="p">}</span>
Este es un ejemplo básico de un documento en LaTeX. Aquí puedes escribir el contenido de tu documento.

<span class="k">\section</span><span class="p">{</span>Matemáticas<span class="p">}</span>
LaTeX es especialmente conocido por su capacidad para manejar ecuaciones matemáticas. Por ejemplo, la ecuación de la relatividad de Einstein:

<span class="p">\[</span><span class="nb"> E </span><span class="o">=</span><span class="nb"> mc</span><span class="p">^</span><span class="m">2</span><span class="nb"> </span><span class="p">\]</span>

<span class="nt">\end{document}</span>
</code></pre></div></div>

<h3 id="compilación-del-documento">Compilación del documento</h3>

<p>Para compilar un documento de LaTeX, generalmente se utiliza un editor como <strong>TeXShop</strong>, <strong>TeXworks</strong>, o un entorno de desarrollo integrado (IDE) como <strong>Overleaf</strong>. El proceso de compilación convierte el archivo <code class="language-plaintext highlighter-rouge">.tex</code> en un archivo PDF listo para su visualización o impresión.</p>

<h3 id="conclusión">Conclusión</h3>

<p>LaTeX es una herramienta poderosa para la creación de documentos técnicos y científicos. Aunque tiene una curva de aprendizaje inicial, su capacidad para producir documentos de alta calidad y su flexibilidad lo convierten en una opción preferida para muchos profesionales y académicos.</p>

<p>Si estás interesado en aprender más sobre LaTeX, te recomiendo explorar recursos en línea como <a href="https://www.overleaf.com/">Overleaf</a> o <a href="https://www.latex-project.org/">LaTeX Project</a>.</p>

<p>Vamos a aprender un poco sobre <code class="language-plaintext highlighter-rouge">latex</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt]</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>lingmacros<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>tree-dvips<span class="p">}</span>
<span class="nt">\begin{document}</span>
</code></pre></div></div>

<p>\section*{Notas para mi artículo}</p>

<p>No olvides incluir ejemplos de topicalización.
Se ven así:</p>

<p>{\small
\enumsentence{Topicalización del sujeto oracional:\ 
\shortex{7}{a John$_i$ [a &amp; kltukl &amp; [el &amp; 
  {\bf l-}oltoir &amp; er &amp; ngii$_i$ &amp; a Mary]]}
{ &amp; {\bf R-}claro &amp; {\sc comp} &amp; 
  {\bf IR}.{\sc 3s}-amar   &amp; P &amp; él &amp; }
{John, (es) claro que Mary lo ama.}}
}</p>

<p>\subsection*{Cómo manejar la topicalización}</p>

<p>Asumiré una estructura de árbol como (\ex{1}).</p>

<p>{\small
\enumsentence{Estructura de las Proyecciones de A$’$:\ [2ex]
\begin{tabular}[t]{cccc}
    &amp; \node{i}{CP}\ [2ex]
    \node{ii}{Spec} &amp;   &amp;\node{iii}{C$’$}\ [2ex]
        &amp;\node{iv}{C} &amp; &amp; \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
}</p>

<p>\subsection*{Estado de ánimo}</p>

<p>El modo cambia cuando hay un tema, así como cuando
hay movimiento WH. \emph{Irrealis} es el modo cuando
hay un tema no sujeto o una frase WH en Comp.
\emph{Realis} es el modo cuando hay un tema sujeto
o una frase WH.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\end{document}</span>
</code></pre></div></div>

<p>Encontré un ejemplo de código fuente en <code class="language-plaintext highlighter-rouge">LaTeX</code> en línea.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% latex code.tex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 <span class="o">(</span>TeX Live 2020<span class="o">)</span> <span class="o">(</span>preloaded <span class="nv">format</span><span class="o">=</span>latex<span class="o">)</span>
 restricted <span class="se">\w</span>rite18 enabled.
entering extended mode
<span class="o">(</span>./code.tex
LaTeX2e &lt;2020-02-02&gt; patch level 5
L3 programming layer &lt;2020-03-06&gt;
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/base/article.cls
Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/base/size12.clo<span class="o">))</span>
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/lingmacros.sty<span class="o">)</span>
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/tree-dvips.sty
tree-dvips version .91 of May 16, 1995
<span class="o">)</span> <span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/l3backend/l3backend-dvips.def<span class="o">)</span>
<span class="o">(</span>./code.aux<span class="o">)</span> <span class="o">[</span>1] <span class="o">(</span>./code.aux<span class="o">)</span> <span class="o">)</span>
Output written on code.dvi <span class="o">(</span>1 page, 3416 bytes<span class="o">)</span><span class="nb">.</span>
Transcript written on code.log.
</code></pre></div></div>

<p><img src="assets/images/feynman/latex.png" alt="latex" /></p>

<p>Vamos a mirar el código fuente y el resultado renderizado para ver qué podemos aprender.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<p>Así es como se envuelve el documento.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\section*</span><span class="p">{</span>Notas para mi artículo<span class="p">}</span>
</code></pre></div></div>

<p>Esto indica el comienzo de un título de <code class="language-plaintext highlighter-rouge">section</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\subsection*</span><span class="p">{</span>Cómo manejar la topicalización<span class="p">}</span>
</code></pre></div></div>

<p>Esto representa un subtítulo.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\shortex</span><span class="p">{</span>7<span class="p">}{</span>a John<span class="p">$_</span><span class="nb">i</span><span class="p">$</span> [a <span class="p">&amp;</span> kltukl <span class="p">&amp;</span> [el <span class="p">&amp;</span> 
  <span class="p">{</span><span class="k">\bf</span> l-<span class="p">}</span>oltoir <span class="p">&amp;</span> er <span class="p">&amp;</span> ngii<span class="p">$_</span><span class="nb">i</span><span class="p">$</span> <span class="p">&amp;</span> a Mary]]<span class="p">}</span>
</code></pre></div></div>

<p><img src="assets/images/feynman/shortex.png" alt="shortex" /></p>

<p>Se puede usar <code class="language-plaintext highlighter-rouge">$_i$</code> para representar subíndices. <code class="language-plaintext highlighter-rouge">{\bf l-}</code> para representar texto en negrita.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\enumsentence</span><span class="p">{</span>Estructura de las Proyecciones de A<span class="p">$</span><span class="nb">'</span><span class="p">$</span>:<span class="k">\\</span> [2ex]
<span class="nt">\begin{tabular}</span>[t]<span class="p">{</span>cccc<span class="p">}</span>
    <span class="p">&amp;</span> <span class="k">\node</span><span class="p">{</span>i<span class="p">}{</span>CP<span class="p">}</span><span class="k">\\</span> [2ex]
    <span class="k">\node</span><span class="p">{</span>ii<span class="p">}{</span>Spec<span class="p">}</span> <span class="p">&amp;</span>   <span class="p">&amp;</span><span class="k">\node</span><span class="p">{</span>iii<span class="p">}{</span>C<span class="p">$</span><span class="nb">'</span><span class="p">$}</span><span class="k">\\</span> [2ex]
        <span class="p">&amp;</span><span class="k">\node</span><span class="p">{</span>iv<span class="p">}{</span>C<span class="p">}</span> <span class="p">&amp;</span> <span class="p">&amp;</span> <span class="k">\node</span><span class="p">{</span>v<span class="p">}{</span>SAgrP<span class="p">}</span>
<span class="nt">\end{tabular}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>i<span class="p">}{</span>ii<span class="p">}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>i<span class="p">}{</span>iii<span class="p">}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>iii<span class="p">}{</span>iv<span class="p">}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>iii<span class="p">}{</span>v<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/feynman/node.png" alt="nodo" style="zoom:50%;" /></p>

<p>Observa que <code class="language-plaintext highlighter-rouge">nodeconnect</code> se utiliza para representar las conexiones.</p>

<h3 id="convertir-latex-a-svg">Convertir LaTeX a SVG</h3>

<p>Si necesitas convertir ecuaciones o fórmulas escritas en LaTeX a imágenes en formato SVG (Scalable Vector Graphics), hay varias herramientas y métodos que puedes utilizar. A continuación, te presento algunas opciones:</p>

<h4 id="1-usando-mathjax-y-dvisvgm">1. <strong>Usando <code class="language-plaintext highlighter-rouge">MathJax</code> y <code class="language-plaintext highlighter-rouge">dvisvgm</code></strong></h4>
<ul>
  <li><strong>MathJax</strong> es una biblioteca JavaScript que permite renderizar ecuaciones LaTeX en la web.</li>
  <li><strong>dvisvgm</strong> es una herramienta de línea de comandos que convierte archivos DVI (generados por LaTeX) a SVG.</li>
</ul>

<p><strong>Pasos:</strong></p>
<ol>
  <li>Escribe tu ecuación en un archivo <code class="language-plaintext highlighter-rouge">.tex</code>.</li>
  <li>Compila el archivo <code class="language-plaintext highlighter-rouge">.tex</code> a DVI usando <code class="language-plaintext highlighter-rouge">latex</code>.</li>
  <li>Convierte el archivo DVI a SVG usando <code class="language-plaintext highlighter-rouge">dvisvgm</code>.</li>
</ol>

<p><strong>Ejemplo:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   latex equation.tex
   dvisvgm equation.dvi
</code></pre></div></div>

<h4 id="2-usando-pandoc">2. <strong>Usando <code class="language-plaintext highlighter-rouge">Pandoc</code></strong></h4>
<ul>
  <li><strong>Pandoc</strong> es una herramienta de conversión de documentos que puede convertir archivos LaTeX a HTML con SVG incrustado.</li>
</ul>

<p><strong>Pasos:</strong></p>
<ol>
  <li>Escribe tu ecuación en un archivo <code class="language-plaintext highlighter-rouge">.tex</code>.</li>
  <li>Usa Pandoc para convertir el archivo <code class="language-plaintext highlighter-rouge">.tex</code> a HTML.</li>
</ol>

<p><strong>Ejemplo:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   pandoc <span class="nt">-s</span> equation.tex <span class="nt">-o</span> equation.html
</code></pre></div></div>

<h4 id="3-usando-latex-y-pdf2svg">3. <strong>Usando <code class="language-plaintext highlighter-rouge">LaTeX</code> y <code class="language-plaintext highlighter-rouge">pdf2svg</code></strong></h4>
<ul>
  <li><strong>pdf2svg</strong> es una herramienta que convierte archivos PDF a SVG.</li>
</ul>

<p><strong>Pasos:</strong></p>
<ol>
  <li>Escribe tu ecuación en un archivo <code class="language-plaintext highlighter-rouge">.tex</code>.</li>
  <li>Compila el archivo <code class="language-plaintext highlighter-rouge">.tex</code> a PDF usando <code class="language-plaintext highlighter-rouge">pdflatex</code>.</li>
  <li>Convierte el archivo PDF a SVG usando <code class="language-plaintext highlighter-rouge">pdf2svg</code>.</li>
</ol>

<p><strong>Ejemplo:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   pdflatex equation.tex
   pdf2svg equation.pdf equation.svg
</code></pre></div></div>

<h4 id="4-usando-overleaf">4. <strong>Usando <code class="language-plaintext highlighter-rouge">Overleaf</code></strong></h4>
<ul>
  <li><strong>Overleaf</strong> es un editor de LaTeX en línea que permite exportar documentos a varios formatos, incluyendo SVG.</li>
</ul>

<p><strong>Pasos:</strong></p>
<ol>
  <li>Escribe tu ecuación en Overleaf.</li>
  <li>Compila el documento.</li>
  <li>Exporta el documento como SVG.</li>
</ol>

<h4 id="5-usando-inkscape">5. <strong>Usando <code class="language-plaintext highlighter-rouge">Inkscape</code></strong></h4>
<ul>
  <li><strong>Inkscape</strong> es un editor de gráficos vectoriales que puede importar archivos PDF generados por LaTeX y exportarlos como SVG.</li>
</ul>

<p><strong>Pasos:</strong></p>
<ol>
  <li>Escribe tu ecuación en un archivo <code class="language-plaintext highlighter-rouge">.tex</code>.</li>
  <li>Compila el archivo <code class="language-plaintext highlighter-rouge">.tex</code> a PDF usando <code class="language-plaintext highlighter-rouge">pdflatex</code>.</li>
  <li>Abre el archivo PDF en Inkscape.</li>
  <li>Exporta el archivo como SVG.</li>
</ol>

<h4 id="6-usando-mathjax-en-línea">6. <strong>Usando <code class="language-plaintext highlighter-rouge">MathJax</code> en línea</strong></h4>
<ul>
  <li>Si necesitas una solución rápida y no quieres instalar software, puedes usar herramientas en línea como <a href="https://www.mathjax.org/">MathJax</a> o <a href="https://www.quicklatex.com/">QuickLaTeX</a> para renderizar ecuaciones LaTeX directamente en SVG.</li>
</ul>

<p><strong>Pasos:</strong></p>
<ol>
  <li>Escribe tu ecuación en LaTeX en la herramienta en línea.</li>
  <li>Descarga la imagen SVG generada.</li>
</ol>

<h3 id="conclusión-1">Conclusión</h3>
<p>Convertir ecuaciones LaTeX a SVG es un proceso sencillo con las herramientas adecuadas. Dependiendo de tus necesidades y preferencias, puedes elegir entre soluciones locales o en línea. ¡Espero que esta guía te haya sido útil!</p>

<p>Continuar con el proyecto.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[16pt]</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="nt">\begin{document}</span>
</code></pre></div></div>

<p>[\tfrac{1}{2}mv^2]</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\end{document}</span>
</code></pre></div></div>

<p><img src="/assets/images/feynman/frac.png" alt="frac" style="zoom:50%;" /></p>

<p>Esto se puede renderizar correctamente. En el código, es posible que no se renderice porque no se ha añadido <code class="language-plaintext highlighter-rouge">\usepackage{amsmath}</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt,preview]</span><span class="p">{</span>standalone<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="na">[utf8x]</span><span class="p">{</span>inputenc<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsfonts<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amssymb<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>newtxtext<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[libertine]</span><span class="p">{</span>newtxmath<span class="p">}</span>
</code></pre></div></div>

<p>\begin{document}
\begin{preview}
\tfrac{1}{2}mv^2
\end{preview}
\end{document}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```shell
! Falta un $ insertado.
&lt;texto insertado&gt;
                $
l.12 \tfrac{1}{2}
                 mv^2
</code></pre></div></div>

<p>Así es como salió mal. Y al cambiarlo de esta manera, funciona.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">\[</span><span class="nv">\tfrac</span><span class="p">{</span><span class="m">1</span><span class="p">}{</span><span class="m">2</span><span class="p">}</span><span class="nb">mv</span><span class="p">^</span><span class="m">2</span><span class="p">\]</span>
</code></pre></div></div>

<p>El código LaTeX anterior representa la fórmula de la energía cinética, que se traduce al español como:</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">\[</span><span class="nv">\tfrac</span><span class="p">{</span><span class="m">1</span><span class="p">}{</span><span class="m">2</span><span class="p">}</span><span class="nb">mv</span><span class="p">^</span><span class="m">2</span><span class="p">\]</span>
</code></pre></div></div>

<p>Esta fórmula sigue siendo la misma en español, ya que es una expresión matemática universal.</p>

<p>Realizar diversas pruebas y exploraciones.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">latex2svg</span> <span class="kn">import</span> <span class="n">latex2svg</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html'</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
<span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="s">'$'</span> <span class="o">+</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span> <span class="o">+</span> <span class="s">'$'</span>
    <span class="c1"># if 'frac' in mathjax.string:
</span>    <span class="c1">#     wrap = '$' + mathjax.string + '$'
</span>    <span class="k">if</span> <span class="s">'FLP'</span> <span class="ow">in</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="s">'Fig'</span> <span class="ow">in</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="s">'eps'</span> <span class="ow">in</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>
    <span class="c1"># print(out)
</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">],</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
    <span class="n">svg</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'svg'</span><span class="p">)</span>
    <span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
    <span class="c1"># print(out['svg'])
</span>    <span class="c1"># break
</span>    <span class="c1"># mathjax.replaceWith(out['svg'])    
</span>    
    <span class="c1"># print(dir(mathjax))
</span>    <span class="c1"># break
</span>    
    <span class="c1"># out = latex2svg(wrap)    
</span>    <span class="c1"># print(out['svg'])
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># print(len(soup.contents))
</span>    
<span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
<span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># print(soup.contents)
</span></code></pre></div></div>

<p>Traducción al español:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># print(len(soup.contents))
</span>    
<span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
<span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># print(soup.contents)
</span></code></pre></div></div>

<p>Nota: El código no necesita traducción, ya que es un bloque de código en Python. Las instrucciones y los nombres de las funciones y variables deben permanecer en inglés para mantener la funcionalidad del código.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
# print(out['depth'])
# print(out['svg'])
</span></code></pre></div></div>

<p>Traducción al español:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
# print(out['depth'])
# print(out['svg'])
</span></code></pre></div></div>

<p>En este código, se utiliza la función <code class="language-plaintext highlighter-rouge">latex2svg</code> para convertir una expresión LaTeX en un gráfico SVG. Luego, se imprime la profundidad (<code class="language-plaintext highlighter-rouge">depth</code>) y el código SVG (<code class="language-plaintext highlighter-rouge">svg</code>) del resultado. El código LaTeX utilizado es ( e^{i \pi} + 1 = 0 ), que es la famosa identidad de Euler.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># svg = open('1.svg', 'w')
# svg.write(out['svg'])
# svg.close()
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
¿Qué estoy explorando en todo esto?

```python
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
</code></pre></div></div>

<p>Aquí, cuando se analiza el código fuente de <code class="language-plaintext highlighter-rouge">latex</code> y se encuentran <code class="language-plaintext highlighter-rouge">FLP</code>, <code class="language-plaintext highlighter-rouge">Fig</code>, <code class="language-plaintext highlighter-rouge">eps</code>, el proceso de conversión falla.</p>

<p>Por ejemplo, en <code class="language-plaintext highlighter-rouge">HTML</code>, hay un script como este:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"math/tex"</span> <span class="na">id=</span><span class="s">"MathJax-Element-11"</span><span class="nt">&gt;</span><span class="err">\</span><span class="nx">FLPF</span><span class="err">\</span><span class="nx">cdot</span><span class="err">\</span><span class="nx">FLPv</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>Análisis obtenido:</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\FLPF\cdot\FLPv</span>
</code></pre></div></div>

<p><em>Nota: La expresión en LaTeX no se traduce, ya que es un código matemático que debe permanecer en su forma original para mantener su significado y funcionalidad.</em></p>

<p>Cuando ocurre un error al convertir en el código, es decir, cuando <code class="language-plaintext highlighter-rouge">latex2svg.py</code> falla, aquí se utiliza el programa <code class="language-plaintext highlighter-rouge">latex</code> para realizar la conversión.</p>

<p><code class="language-plaintext highlighter-rouge">code.tex</code>:</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt,preview]</span><span class="p">{</span>standalone<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="na">[utf8x]</span><span class="p">{</span>inputenc<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsfonts<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amssymb<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>newtxtext<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[libertine]</span><span class="p">{</span>newtxmath<span class="p">}</span>
</code></pre></div></div>

<p>\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```shell
$latex code.tex
! Secuencia de control no definida.
l.13     \FLPF
              \cdot\FLPv
?
</code></pre></div></div>

<p>¿Cuál es exactamente el problema? Más tarde me di cuenta de este fragmento de código en el <code class="language-plaintext highlighter-rouge">html</code>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/x-mathjax-config;executed=true"</span><span class="nt">&gt;</span>
      <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
        <span class="na">TeX</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">Macros</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">FLPvec</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">boldsymbol{#1}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="na">Figvec</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">mathbf{#1}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="na">FLPC</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{C}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FLPF</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{F}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FLPa</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{a}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FLPb</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{b}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FLPr</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{r}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FLPs</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{s}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FLPv</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{v}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">ddt</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">frac{d#1}{d#2}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="na">epsO</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">epsilon_0</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="na">FigC</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">Figvec{C}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>Esto indica que al renderizar la página, se han configurado macros para <code class="language-plaintext highlighter-rouge">MathJax</code>. Por lo tanto, también deberíamos agregarlas en nuestro código fuente de conversión de <code class="language-plaintext highlighter-rouge">latex</code>. Vamos a añadirlas.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt,preview]</span><span class="p">{</span>standalone<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="na">[utf8x]</span><span class="p">{</span>inputenc<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsfonts<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amssymb<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>newtxtext<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[libertine]</span><span class="p">{</span>newtxmath<span class="p">}</span>
</code></pre></div></div>

<p>\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Así es como debe ser.

![fv1](assets/images/feynman/fv1.png)

### Análisis del Código

Echemos un vistazo al código final.

```python
import subprocess
from bs4 import BeautifulSoup
from latex2svg import latex2svg
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
    <span class="n">previews</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="n">cls</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">preview</span> <span class="ow">in</span> <span class="n">previews</span><span class="p">:</span>
        <span class="n">preview</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>
        
<span class="k">def</span> <span class="nf">clean_script</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
    <span class="n">scripts</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scripts</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>    
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="s">'$'</span> <span class="o">+</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span> <span class="o">+</span> <span class="s">'$'</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'label'</span><span class="p">,</span> <span class="s">'tag'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrap</span>
 
<span class="k">def</span> <span class="nf">wrap_svg</span><span class="p">(</span><span class="n">svg</span><span class="p">,</span> <span class="n">equation</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="sa">f</span><span class="s">'&lt;div style="text-align:center;"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">div</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">svg</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'eq_'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'in_'</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>     
        <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">)</span>   
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>   
        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>      
            
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
        <span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div>

<p>Este código define una función <code class="language-plaintext highlighter-rouge">to_svg</code> que convierte expresiones LaTeX en imágenes SVG y las inserta en un documento. Aquí está la traducción al español del código:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'eq_'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'in_'</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>     
        <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">)</span>   
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>   
        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>      
            
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
        <span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div>

<p>Este código define una función <code class="language-plaintext highlighter-rouge">to_svg</code> que convierte expresiones LaTeX en imágenes SVG y las inserta en un documento. La función toma una lista de expresiones LaTeX (<code class="language-plaintext highlighter-rouge">mathjaxs</code>) y un indicador booleano (<code class="language-plaintext highlighter-rouge">equation</code>) que determina si la expresión es una ecuación o no. Luego, genera archivos SVG y los inserta en el documento como imágenes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>    
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html'</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
    <span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'span'</span><span class="p">,</span> <span class="s">'MathJax'</span><span class="p">)</span>
    <span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'div'</span><span class="p">,</span> <span class="s">'MathJax_Display'</span><span class="p">)</span>
    <span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'span'</span><span class="p">,</span> <span class="s">'MathJax_Preview'</span><span class="p">)</span>
    
    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex; mode=display'</span><span class="p">})</span>   
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="n">clean_script</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
    
    <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>    
</code></pre></div></div>

<p>main()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Cuando queremos convertir un libro electrónico completo, podemos probar primero con una página.

```python
    file = open('The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html')
    content = file.read()
</code></pre></div></div>

<p>Aquí se ha descargado una página.</p>

<p><code class="language-plaintext highlighter-rouge">MathJax</code> genera muchos <code class="language-plaintext highlighter-rouge">div</code> y <code class="language-plaintext highlighter-rouge">span</code>. Por ejemplo, <code class="language-plaintext highlighter-rouge">T+U=const</code> se genera de la siguiente manera por MathJax.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>T<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>+<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>U<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>=<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>const<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<p>Estos son bastante molestos y también pueden afectar nuestro texto. Como ya tenemos <code class="language-plaintext highlighter-rouge">svg</code>, no necesitamos estos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
    <span class="n">previews</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="n">cls</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">preview</span> <span class="ow">in</span> <span class="n">previews</span><span class="p">:</span>
        <span class="n">preview</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clean_mathjax(soup, 'span', 'MathJax')
clean_mathjax(soup, 'div', 'MathJax_Display')
clean_mathjax(soup, 'span', 'MathJax_Preview') ```
</code></pre></div></div>

<p>Elimínalos todos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex; mode=display'</span><span class="p">})</span>   
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Observa que aquí se dividen en dos tipos de <code class="language-plaintext highlighter-rouge">script</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code>m(dv/dt)=F
</code></pre></div></div>

<p><em>Nota: La ecuación es una expresión matemática y no requiere traducción, ya que es universal en el ámbito de la física.</em></p>

<p>Esto es en formato incrustado.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{equation}</span>
<span class="k">\underset</span><span class="p">{</span><span class="k">\text</span><span class="p">{</span>E.C.<span class="p">}}{</span><span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2<span class="p">}</span>+
<span class="k">\underset</span><span class="p">{</span><span class="k">\text</span><span class="p">{</span>E.P.<span class="p">}}{</span><span class="k">\vphantom</span><span class="p">{</span><span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}}</span>mgh<span class="p">}</span>=<span class="k">\text</span><span class="p">{</span>const<span class="p">}</span>,<span class="k">\notag</span>
</code></pre></div></div>

<p>Esto está en forma de párrafo.</p>

<p>Cuando se utiliza la forma incrustada, la conversión debe incluir <code class="language-plaintext highlighter-rouge">$</code> o <code class="language-plaintext highlighter-rouge">[]</code> alrededor de la expresión. De lo contrario, podría ocurrir un error.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\begin{preview}</span>
<span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2
<span class="nt">\end{preview}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">!</span> Falta <span class="nv">$ </span>insertado.
&lt;texto insertado&gt;
                <span class="err">$</span>
l.26 <span class="se">\t</span>frac<span class="o">{</span>1<span class="o">}{</span>2<span class="o">}</span>
                 <span class="nb">mv</span>^2
</code></pre></div></div>

<p>Debe cambiarse a esto:</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\begin{preview}</span>
<span class="p">$</span><span class="nv">\tfrac</span><span class="p">{</span><span class="m">1</span><span class="p">}{</span><span class="m">2</span><span class="p">}</span><span class="nb">mv</span><span class="p">^</span><span class="m">2</span><span class="p">$</span>
<span class="nt">\end{preview}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<p>A continuación, veamos cómo convertir <code class="language-plaintext highlighter-rouge">latex</code> a <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'eq_'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'in_'</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tree svgs
svgs
├── eq_0.svg
├── eq_1.svg
├── in_0.svg
</code></pre></div></div>

<p>Así es como se guarda un <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="s">'$'</span> <span class="o">+</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span> <span class="o">+</span> <span class="s">'$'</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'label'</span><span class="p">,</span> <span class="s">'tag'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrap</span>
</code></pre></div></div>

<p>Aquí vamos a hacer algunos ajustes al código fuente de <code class="language-plaintext highlighter-rouge">latex</code>. Nota que <code class="language-plaintext highlighter-rouge">label</code> se ha cambiado a <code class="language-plaintext highlighter-rouge">tag</code>.</p>

<p><img src="assets/images/feynman/tag.png" alt="etiqueta" /></p>

<p>Observa el <code class="language-plaintext highlighter-rouge">(Eq:I:13:14)</code> a la derecha. Si se trata de una <code class="language-plaintext highlighter-rouge">label</code>, no se ha analizado correctamente. Esto mostrará <code class="language-plaintext highlighter-rouge">(1)</code>. Aquí se utiliza <code class="language-plaintext highlighter-rouge">tag</code> para representarlo temporalmente, sin profundizar más por ahora.</p>

<p>Luego se procede a llamar a <code class="language-plaintext highlighter-rouge">latex2svg.py</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>   
        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>    
</code></pre></div></div>

<p>El código anterior no necesita traducción, ya que es un bloque de código en Python y los nombres de las funciones y excepciones deben permanecer en inglés. Sin embargo, si necesitas una explicación en español, aquí está:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Inicializa un diccionario vacío
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>  <span class="c1"># Intenta convertir LaTeX a SVG
</span>        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>  <span class="c1"># Si hay un error, lo lanza
</span></code></pre></div></div>

<p>Mira <code class="language-plaintext highlighter-rouge">latex2svg.py</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Ejecutar LaTeX y crear archivo DVI
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'latex_cmd'</span><span class="p">]</span><span class="o">+</span><span class="s">' code.tex'</span><span class="p">),</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">check_returncode</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'latex no encontrado'</span><span class="p">)</span>
</code></pre></div></div>

<p>Aquí se está llamando al comando <code class="language-plaintext highlighter-rouge">latex</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> % latex <span class="nt">--help</span>
Uso: pdftex <span class="o">[</span>OPCIÓN]... <span class="o">[</span>NOMBRE_TEX[.tex]] <span class="o">[</span>COMANDOS]
   o: pdftex <span class="o">[</span>OPCIÓN]... <span class="se">\P</span>RIMERA_LÍNEA
   o: pdftex <span class="o">[</span>OPCIÓN]... &amp;FMT ARGS
  Ejecuta pdfTeX en NOMBRE_TEX, generalmente creando NOMBRE_TEX.pdf.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'dvisvgm_cmd'</span><span class="p">]</span><span class="o">+</span><span class="s">' code.dvi'</span><span class="p">),</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">check_returncode</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'dvisvgm no encontrado'</span><span class="p">)</span>
</code></pre></div></div>

<p>Aquí se está llamando al comando <code class="language-plaintext highlighter-rouge">dvisvgm</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% dvisvgm
dvisvgm 2.9.1
</code></pre></div></div>

<p>Este programa convierte archivos DVI, creados por TeX/LaTeX, así como archivos EPS y PDF, al formato de gráficos vectoriales escalables basado en XML, SVG.</p>

<p>Uso: dvisvgm [opciones] archivo_dvi
       dvisvgm –eps [opciones] archivo_eps
       dvisvgm –pdf [opciones] archivo_pdf</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
¿Dónde se escriben las macros personalizadas de `latex` mencionadas anteriormente? Aquí hay que modificar el archivo `latex2svg.py`. Cambia el `default_preamble`.

```python
default_preamble = r"""
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}

\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
"""
</code></pre></div></div>

<p>Después de la conversión exitosa, se escribe en el archivo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Continúa.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>
</code></pre></div></div>

<p>Aquí se construye una etiqueta <code class="language-plaintext highlighter-rouge">img</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_svg</span><span class="p">(</span><span class="n">svg</span><span class="p">,</span> <span class="n">equation</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="sa">f</span><span class="s">'&lt;div style="text-align:center;"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">div</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">svg</span>
      
<span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
</code></pre></div></div>

<p>Si es un <code class="language-plaintext highlighter-rouge">latex</code> de un solo párrafo, entonces envuélvelo en un <code class="language-plaintext highlighter-rouge">div</code> y centra el contenido.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div></div>

<p>Aquí se añaden las etiquetas <code class="language-plaintext highlighter-rouge">div</code> o <code class="language-plaintext highlighter-rouge">img</code> después del <code class="language-plaintext highlighter-rouge">script</code> original.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">limpiar_script</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
    <span class="n">scripts</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scripts</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>    
        
<span class="n">limpiar_script</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
</code></pre></div></div>

<p>Después de reemplazar todos los <code class="language-plaintext highlighter-rouge">latex</code> con <code class="language-plaintext highlighter-rouge">svg</code>, ya no necesitas el <code class="language-plaintext highlighter-rouge">script</code>. Elimínalos para que todo quede más limpio.</p>

<p>Finalmente, escribe el <code class="language-plaintext highlighter-rouge">html</code> modificado en un archivo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>    
</code></pre></div></div>

<p>Luego, utiliza la herramienta <code class="language-plaintext highlighter-rouge">pandoc</code> para convertirlo a <code class="language-plaintext highlighter-rouge">epub</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc <span class="nt">-s</span> <span class="nt">-r</span> html out.html <span class="nt">-o</span> feynman.epub
</code></pre></div></div>

<p>Esto abrirá un hermoso libro electrónico.</p>

<p>¿Por qué no incrustar directamente la etiqueta <code class="language-plaintext highlighter-rouge">svg</code> y usar <code class="language-plaintext highlighter-rouge">img</code> para importarla? Es decir, escribir así:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;&lt;/p&gt;</span>
<span class="nt">&lt;svg&gt;&lt;/svg&gt;</span>
<span class="nt">&lt;p&gt;&lt;/p&gt;</span>
</code></pre></div></div>

<p>Hay un <code class="language-plaintext highlighter-rouge">bug</code> muy extraño. Cuando hay muchos archivos <code class="language-plaintext highlighter-rouge">svg</code>, ocurre algo como esto.</p>

<p><img src="/assets/images/feynman/svg_p1.png" alt="svg_p1" style="zoom:40%;" /></p>

<p>Luego descubrí que podía usar <code class="language-plaintext highlighter-rouge">img</code> para incluirlo. No estoy seguro de por qué funciona de esta manera. Cuando saqué este único <code class="language-plaintext highlighter-rouge">svg</code> y lo abrí en el navegador, no hubo problemas. Parece que el error ocurre cuando el navegador intenta renderizar muchos <code class="language-plaintext highlighter-rouge">svg</code> a la vez.</p>

<h3 id="finalmente">Finalmente</h3>

<p>En cuanto a cómo convertir <code class="language-plaintext highlighter-rouge">epub</code> a <code class="language-plaintext highlighter-rouge">mobi</code>, puedes usar la herramienta oficial de <code class="language-plaintext highlighter-rouge">Kindle</code>, <code class="language-plaintext highlighter-rouge">Kindle Previewer 3</code>. Ten en cuenta que esto es solo un capítulo.</p>

<p>El código del proyecto se encuentra en <a href="https://github.com/lzwjava/feynman-lectures-mobi">feynman-lectures-mobi@lzwjava</a>.</p>

<p>¿Cómo capturar y organizar todas las páginas en un libro electrónico? Lo explicaré más adelante. Pero este capítulo de las Lecciones de Física de Feynman ya es suficiente para leer. Bien, tomemos nuestro Kindle y comencemos a leer.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-es" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
