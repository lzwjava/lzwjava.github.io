<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>بناء روبوت قصصي مدعوم بالذكاء الاصطناعي</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>بناء روبوت قصصي مدعوم بالذكاء الاصطناعي | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="بناء روبوت قصصي مدعوم بالذكاء الاصطناعي" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="ar" />
<meta name="description" content="تمت كتابة هذه المدونة بمساعدة ChatGPT-4." />
<meta property="og:description" content="تمت كتابة هذه المدونة بمساعدة ChatGPT-4." />
<link rel="canonical" href="https://lzwjava.github.io/bot-ar" />
<meta property="og:url" content="https://lzwjava.github.io/bot-ar" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="بناء روبوت قصصي مدعوم بالذكاء الاصطناعي" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2024-07-07T00:00:00+08:00","datePublished":"2024-07-07T00:00:00+08:00","description":"تمت كتابة هذه المدونة بمساعدة ChatGPT-4.","headline":"بناء روبوت قصصي مدعوم بالذكاء الاصطناعي","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/bot-ar"},"url":"https://lzwjava.github.io/bot-ar"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=ffda97d4808a9138a707f600964214581be04981">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=ffda97d4808a9138a707f600964214581be04981" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       بناء روبوت قصصي مدعوم بالذكاء الاصطناعي | أصلي، ترجم بواسطة AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/ar/2024-07-07-bot-ar.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsar2024-07-07-bot-ar.md</span> -->
      

      <!-- <span>2024-07-07-bot-ar.md</span> -->

      
        

        
          
          <a href="#" class="button">2024.07</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/bot-en" >English</option>
        <option value="/bot-zh" >中文</option>
        <option value="/bot-ja" >日本語</option>
        <option value="/bot-es" >Español</option>
        <option value="/bot-hi" >हिंदी</option>
        <option value="/bot-fr" >Français</option>
        <option value="/bot-de" >Deutsch</option>
        <option value="/bot-ar" selected>العربية</option>
        <option value="/bot-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p><em>تمت كتابة هذه المدونة بمساعدة ChatGPT-4.</em></p>

<hr />

<h3 id="جدول-المحتويات">جدول المحتويات</h3>

<ul>
  <li><a href="#introduction">مقدمة</a></li>
  <li><a href="#project-architecture">هندسة المشروع</a>
    <ul>
      <li><a href="#backend">الواجهة الخلفية (Backend)</a>
        <ul>
          <li><a href="#flask-application-setup">إعداد تطبيق Flask</a></li>
          <li><a href="#logging-and-monitoring">التسجيل والمراقبة</a></li>
          <li><a href="#request-handling">معالجة الطلبات</a></li>
        </ul>
      </li>
      <li><a href="#frontend">الواجهة الأمامية (Frontend)</a>
        <ul>
          <li><a href="#react-components">مكونات React</a></li>
          <li><a href="#api-integration">تكامل API</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#deployment">النشر</a>
    <ul>
      <li><a href="#deployment-script">نص النشر</a></li>
      <li><a href="#elasticsearch-configuration">تهيئة ElasticSearch</a></li>
      <li><a href="#kibana-configuration">تهيئة Kibana</a></li>
      <li><a href="#logstash-configuration">تهيئة Logstash</a></li>
    </ul>
  </li>
  <li><a href="#nginx-configuration-and-lets-encrypt-ssl-certificate">تهيئة Nginx وشهادة SSL من Let’s Encrypt</a>
    <ul>
      <li><a href="#define-a-map-to-handle-the-allowed-origins">تحديد خريطة للتعامل مع الأصول المسموح بها</a></li>
      <li><a href="#redirect-http-to-https">إعادة توجيه HTTP إلى HTTPS</a></li>
      <li><a href="#main-site-configuration-for-examplecom">تهيئة الموقع الرئيسي لـ <code class="language-plaintext highlighter-rouge">example.com</code></a></li>
      <li><a href="#api-configuration-for-apiexamplecom">تهيئة API لـ <code class="language-plaintext highlighter-rouge">api.example.com</code></a></li>
    </ul>
  </li>
  <li><a href="#conclusion">الخاتمة</a></li>
</ul>

<hr />

<h3 id="مقدمة">مقدمة</h3>

<p>توفر هذه المدونة دليلًا شاملًا حول بنية وتنفيذ تطبيق روبوت القصص المدعوم بالذكاء الاصطناعي. يتضمن المشروع إنشاء قصص مخصصة باستخدام واجهة ويب. نستخدم Python وFlask وReact للتطوير ونقوم بالنشر على AWS. بالإضافة إلى ذلك، نستخدم Prometheus للرصد وElasticSearch وKibana وLogstash لإدارة السجلات. يتم إدارة DNS من خلال GoDaddy وCloudflare، مع استخدام Nginx كبوابة لإدارة شهادات SSL ورؤوس الطلبات.</p>

<h3 id="هندسة-المشروع">هندسة المشروع</h3>

<h4 id="الواجهة-الخلفية-backend">الواجهة الخلفية (Backend)</h4>

<p>تم بناء الجزء الخلفي (backend) للمشروع باستخدام Flask، وهو إطار عمل خفيف الوزن لتطبيقات الويب يعتمد على WSGI في لغة Python. يتولى الجزء الخلفي معالجة طلبات API، وإدارة قاعدة البيانات، وتسجيل أنشطة التطبيق، والتكامل مع Prometheus لأغراض المراقبة.</p>

<p>إليك تفصيلًا لمكونات الواجهة الخلفية:</p>

<ol>
  <li>إعداد تطبيق Flask:
    <ul>
      <li>يتم تهيئة تطبيق Flask وتكوينه لاستخدام العديد من الإضافات مثل Flask-CORS للتعامل مع مشاركة الموارد عبر المصادر (Cross-Origin Resource Sharing) وFlask-Migrate لإدارة ترحيل قواعد البيانات.</li>
      <li>يتم تهيئة مسارات التطبيق، وتمكين CORS للسماح بطلبات عبر المصادر.</li>
      <li>يتم تهيئة قاعدة البيانات مع إعدادات افتراضية، وإعداد مسجل مخصص لتنسيق إدخالات السجلات لـ Logstash.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
 <span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span>
 <span class="kn">from</span> <span class="nn">.routes</span> <span class="kn">import</span> <span class="n">initialize_routes</span>
 <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">insert_default_config</span>
 <span class="kn">from</span> <span class="nn">flask_migrate</span> <span class="kn">import</span> <span class="n">Migrate</span>
 <span class="kn">import</span> <span class="nn">logging</span>
 <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">RotatingFileHandler</span>
 <span class="kn">from</span> <span class="nn">prometheus_client</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">generate_latest</span><span class="p">,</span> <span class="n">Gauge</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'api.config.BaseConfig'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">initialize_routes</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>تسجيل الأحداث والمراقبة:
    <ul>
      <li>يستخدم التطبيق <code class="language-plaintext highlighter-rouge">RotatingFileHandler</code> لإدارة ملفات السجلات وتنسيقها باستخدام مُنسق مخصص.</li>
      <li>تم دمج مقاييس Prometheus في التطبيق لتتبع عدد الطلبات وزمن الاستجابة.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">REQUEST_COUNT</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s">'flask_app_request_count'</span><span class="p">,</span> <span class="s">'إجمالي عدد الطلبات لتطبيق Flask'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">,</span> <span class="s">'http_status'</span><span class="p">])</span>
<span class="n">REQUEST_LATENCY</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s">'flask_app_request_latency_seconds'</span><span class="p">,</span> <span class="s">'زمن استجابة الطلب'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setup_loggers</span><span class="p">():</span>
    <span class="n">logstash_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span><span class="s">'app.log'</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logstash_formatter</span> <span class="o">=</span> <span class="n">CustomLogstashFormatter</span><span class="p">()</span>
    <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logstash_formatter</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">root_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">root_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
</code></pre></div></div>

<p>تم تعيين <code class="language-plaintext highlighter-rouge">root_logger</code> للحصول على المسجل الأساسي باستخدام <code class="language-plaintext highlighter-rouge">logging.getLogger()</code>. ثم تم تعيين مستوى التسجيل إلى <code class="language-plaintext highlighter-rouge">DEBUG</code> باستخدام <code class="language-plaintext highlighter-rouge">setLevel(logging.DEBUG)</code>. أخيرًا، تمت إضافة معالج <code class="language-plaintext highlighter-rouge">logstash_handler</code> إلى المسجل الأساسي باستخدام <code class="language-plaintext highlighter-rouge">addHandler(logstash_handler)</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
<span class="n">werkzeug_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'werkzeug'</span><span class="p">)</span>
<span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setup_loggers</span><span class="p">()</span>
</code></pre></div></div>

<ol>
  <li>معالجة الطلبات:
    <ul>
      <li>التطبيق يقوم بتسجيل المقاييس قبل وبعد كل طلب، مع إنشاء معرف تتبع (Trace ID) لمراقبة تدفق الطلب.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_trace_id</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
    <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">before_request</span>
<span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="n">request</span><span class="p">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">trace_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'X-Trace-Id'</span><span class="p">,</span> <span class="n">generate_trace_id</span><span class="p">())</span>
    <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
</code></pre></div></div>

<p>ترجمة الكود إلى العربية:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">before_request</span>
<span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="n">request</span><span class="p">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">trace_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'X-Trace-Id'</span><span class="p">,</span> <span class="n">generate_trace_id</span><span class="p">())</span>
    <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
</code></pre></div></div>

<p>في هذا الكود، يتم تنفيذ الدالة <code class="language-plaintext highlighter-rouge">before_request</code> قبل كل طلب يتم إرساله إلى التطبيق. يتم تسجيل وقت بدء الطلب باستخدام <code class="language-plaintext highlighter-rouge">request.start_time = time.time()</code>. ثم يتم استخراج <code class="language-plaintext highlighter-rouge">trace_id</code> من رأس الطلب (<code class="language-plaintext highlighter-rouge">request.headers.get('X-Trace-Id')</code>)، وإذا لم يتم العثور على <code class="language-plaintext highlighter-rouge">trace_id</code> في الرأس، يتم إنشاؤه باستخدام الدالة <code class="language-plaintext highlighter-rouge">generate_trace_id()</code>. أخيرًا، يتم تخزين <code class="language-plaintext highlighter-rouge">trace_id</code> في الكائن <code class="language-plaintext highlighter-rouge">g</code> الذي يمكن الوصول إليه في جميع أنحاء التطبيق.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">after_request</span>
<span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Trace-Id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span>
    <span class="n">request_latency</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'start_time'</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">REQUEST_COUNT</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="n">http_status</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">).</span><span class="n">inc</span><span class="p">()</span>
    <span class="n">REQUEST_LATENCY</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">).</span><span class="nb">set</span><span class="p">(</span><span class="n">request_latency</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<h4 id="الواجهة-الأمامية-frontend">الواجهة الأمامية (Frontend)</h4>

<p>تم بناء واجهة المشروع باستخدام React، وهي مكتبة JavaScript لبناء واجهات المستخدم. تتفاعل مع واجهة برمجة التطبيقات (API) الخلفية لإدارة نصوص القصص وتوفر واجهة مستخدم تفاعلية لإنشاء وإدارة القصص المخصصة.</p>

<ol>
  <li>مكونات React:
    <ul>
      <li>المكون الرئيسي يتعامل مع إدخال المستخدم لطلبات القصص ويتفاعل مع واجهة برمجة التطبيقات (API) الخلفية لإدارة هذه القصص.</li>
    </ul>
  </li>
</ol>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ToastContainer</span><span class="p">,</span> <span class="nx">toast</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-toastify</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">react-toastify/dist/ReactToastify.css</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">apiFetch</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./api</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">prompts</span><span class="p">,</span> <span class="nx">setPrompts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([]);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">newPrompt</span><span class="p">,</span> <span class="nx">setNewPrompt</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span> <span class="nx">setIsLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">fetchPrompts</span><span class="p">();</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fetchPrompts</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">prompts</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
      <span class="nx">setPrompts</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">فشل في جلب البيانات</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">حدث خطأ أثناء جلب البيانات</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">addPrompt</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">newPrompt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toast</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">محتوى الـ Prompt لا يمكن أن يكون فارغًا</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">prompts</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">content</span><span class="p">:</span> <span class="nx">newPrompt</span> <span class="p">}),</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">fetchPrompts</span><span class="p">();</span>
      <span class="nx">setNewPrompt</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="dl">'</span><span class="s1">تمت إضافة الـ Prompt بنجاح</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">فشل في إضافة الـ Prompt</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">حدث خطأ أثناء إضافة الـ Prompt</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">deletePrompt</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">promptId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="s2">`prompts/</span><span class="p">${</span><span class="nx">promptId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">fetchPrompts</span><span class="p">();</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="dl">'</span><span class="s1">تم حذف الـ Prompt بنجاح</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">فشل في حذف الـ Prompt</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">حدث خطأ أثناء محاولة حذف الـ Prompt</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">app</span><span class="dl">"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">روبوت</span> <span class="nx">القصص</span> <span class="nx">المدعوم</span> <span class="nx">بالذكاء</span> <span class="nx">الاصطناعي</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span>
              <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">newPrompt</span><span class="p">}</span>
              <span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setNewPrompt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
              <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">مطالبة جديدة</span><span class="dl">"</span>
            <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">addPrompt</span><span class="p">}</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">إضافة</span> <span class="nx">مطالبة</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="p">{</span><span class="nx">isLoading</span> <span class="p">?</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">جار</span> <span class="nx">التحميل</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>          <span class="p">)</span> <span class="p">:</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
              <span class="p">{</span><span class="nx">prompts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">prompt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
                  <span class="p">{</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>
                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">deletePrompt</span><span class="p">(</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">حذف</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>              <span class="p">))}</span>
            <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>          <span class="p">)}</span>
          <span class="o">&lt;</span><span class="nx">ToastContainer</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
    <span class="s2">```

2. تكامل API:
    - يتفاعل الواجهة الأمامية مع واجهة برمجة التطبيقات (API) الخلفية باستخدام طلبات fetch لإدارة نصوص القصص.

```</span><span class="nx">javascript</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">apiFetch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">`https://api.yourdomain.com/</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="النشر">النشر</h3>

<p>تم نشر المشروع على AWS، مع إدارة DNS تتم من خلال GoDaddy وCloudflare. يتم استخدام Nginx كبوابة لإدارة شهادات SSL وترويسات الطلبات. نستخدم Prometheus للرصد وElasticSearch وKibana وLogstash لإدارة السجلات.</p>

<ol>
  <li>سكريبت النشر:
    <ul>
      <li>نستخدم Fabric لأتمتة مهام النشر مثل إعداد المجلدات المحلية والبعيدة، ومزامنة الملفات، وضبط الأذونات.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">task</span>
 <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">Connection</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server_dir</span> <span class="o">=</span> <span class="s">'/home/project/server'</span>
<span class="n">web_tmp_dir</span> <span class="o">=</span> <span class="s">'/home/project/server/tmp'</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">task</span>
    <span class="k">def</span> <span class="nf">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s">'test -d </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'mkdir -p </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 755 </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 777 </span><span class="si">{</span><span class="n">web_tmp_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<p>ترجمة:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">task</span>
    <span class="k">def</span> <span class="nf">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s">'test -d </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'mkdir -p </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 755 </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 777 </span><span class="si">{</span><span class="n">web_tmp_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<p>ملاحظة: تم الحفاظ على الكود كما هو لأنه يحتوي على أوامر وأسماء متغيرات بالإنجليزية، والتي لا يتم ترجمتها عادةً في سياق البرمجة.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">task</span>
    <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">install</span><span class="o">=</span><span class="s">'false'</span><span class="p">):</span>
        <span class="n">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">pem_file</span> <span class="o">=</span> <span class="s">'./aws-keypair.pem'</span>
        <span class="n">rsync_command</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s">'rsync -avz --exclude="api/db.sqlite3" '</span>
                         <span class="sa">f</span><span class="s">'-e "ssh -i </span><span class="si">{</span><span class="n">pem_file</span><span class="si">}</span><span class="s">" --rsync-path="sudo rsync" '</span>
                         <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">tmp_dir</span><span class="si">}</span><span class="s">/ </span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">user</span><span class="si">}</span><span class="s">@</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
        <span class="n">c</span><span class="p">.</span><span class="n">local</span><span class="p">(</span><span class="n">rsync_command</span><span class="p">)</span>
        <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى اللغة العربية مع الحفاظ على الأسماء الإنجليزية كما هي.</p>

<ol>
  <li>تهيئة ElasticSearch:
    <ul>
      <li>يتضمن إعداد ElasticSearch تهيئات لإعدادات الكتلة (cluster)، العقدة (node)، والشبكة.</li>
    </ul>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cluster.name</span><span class="pi">:</span> <span class="s">my-application</span>
<span class="na">node.name</span><span class="pi">:</span> <span class="s">node-1</span>
<span class="na">path.data</span><span class="pi">:</span> <span class="s">/var/lib/elasticsearch</span>
<span class="na">path.logs</span><span class="pi">:</span> <span class="s">/var/log/elasticsearch</span>
<span class="na">network.host</span><span class="pi">:</span> <span class="s">0.0.0.0</span>
<span class="na">http.port</span><span class="pi">:</span> <span class="m">9200</span>
<span class="na">discovery.seed_hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">]</span>
<span class="na">cluster.initial_master_nodes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">node-1"</span><span class="pi">]</span>
</code></pre></div></div>

<ol>
  <li>تكوين Kibana:
    <ul>
      <li>يتضمن إعداد Kibana تكوينات لخادم (server) ومضيفات ElasticSearch.</li>
    </ul>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server.port</span><span class="pi">:</span> <span class="m">5601</span>
<span class="na">server.host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span>
<span class="na">elasticsearch.hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">http://localhost:9200"</span><span class="pi">]</span>
</code></pre></div></div>

<ol>
  <li>تكوين Logstash:
    <ul>
      <li>يتم تكوين Logstash لقراءة ملفات السجلات، وتحليلها، وإخراج السجلات المحللة إلى ElasticSearch.</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> input {
   file {
     path =&gt; "/home/project/server/app.log"
     start_position =&gt; "beginning"
     sincedb_path =&gt; "/dev/null"
   }
 }
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    filter {
      json {
        source =&gt; "message"
      }
    }
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    مرشح {
      json {
        مصدر =&gt; "الرسالة"
      }
    }
</code></pre></div></div>

<p>```output {
      elasticsearch {
        hosts =&gt; [“http://localhost:9200”]
        index =&gt; “flask-logs-%{+YYYY.MM.dd}”
      }
    }</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### تكوين Nginx وشهادة SSL من Let's Encrypt

لضمان الاتصال الآمن، نستخدم Nginx كخادم وكيل عكسي وLet's Encrypt للحصول على شهادات SSL. فيما يلي تكوين Nginx لإعادة توجيه HTTP إلى HTTPS وإعداد شهادات SSL.

```nginx
server {
    listen 80;
    server_name example.com;

    # إعادة توجيه جميع طلبات HTTP إلى HTTPS
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name example.com;

    # مسار شهادة SSL
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    # إعدادات SSL الموصى بها
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # الموقع الذي تريد تقديمه
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre></div></div>

<p>في هذا التكوين:</p>
<ul>
  <li>يتم إعادة توجيه جميع طلبات HTTP إلى HTTPS باستخدام <code class="language-plaintext highlighter-rouge">return 301</code>.</li>
  <li>يتم تعيين شهادة SSL ومفتاحها باستخدام <code class="language-plaintext highlighter-rouge">ssl_certificate</code> و <code class="language-plaintext highlighter-rouge">ssl_certificate_key</code>.</li>
  <li>يتم استخدام إعدادات SSL الموصى بها لضمان الأمان.</li>
  <li>يتم تمرير الطلبات إلى خادم محلي يعمل على المنفذ 3000 باستخدام <code class="language-plaintext highlighter-rouge">proxy_pass</code>.</li>
</ul>

<ol>
  <li>قم بتعريف خريطة (map) للتعامل مع الأصول المسموح بها:</li>
</ol>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">map</span> <span class="nv">$http_origin</span> <span class="nv">$cors_origin</span> <span class="p">{</span>
        <span class="kn">default</span> <span class="s">"https://example.com"</span><span class="p">;</span>
        <span class="kn">"http://localhost:3000"</span> <span class="s">"http://localhost:3000"</span><span class="p">;</span>
        <span class="kn">"https://example.com"</span> <span class="s">"https://example.com"</span><span class="p">;</span>
        <span class="kn">"https://www.example.com"</span> <span class="s">"https://www.example.com"</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>
    <p>إعادة توجيه HTTP إلى HTTPS:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">server</span> <span class="p">{</span>
     <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
     <span class="kn">server_name</span> <span class="s">example.com</span> <span class="s">api.example.com</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        return 301 https://$host$request_uri;
    }
    ```

3. التكوين الرئيسي للموقع لـ `example.com`:

    ```nginx
    server {
        listen 443 ssl;
        server_name example.com;
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
        <span class="k">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
        <span class="k">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">root</span> <span class="n">/home/project/web</span><span class="p">;</span>
        <span class="k">index</span> <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span> <span class="s">default.html</span> <span class="s">default.htm</span> <span class="s">default.php</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
            <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
            <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>ملاحظة: الكود أعلاه هو تكوين لخادم Nginx، ولا يحتاج إلى ترجمة حيث أنه مكتوب بلغة التكوين الخاصة بـ Nginx.</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> <span class="p">{</span>
            <span class="kn">expires</span> <span class="s">30d</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> <span class="p">{</span>
            <span class="kn">expires</span> <span class="s">30d</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>في هذا الكود، يتم تحديد موقع (location) لملفات الصور والفيديو (مثل gif، jpg، jpeg، png، bmp، swf) وتعيين صلاحية التخزين المؤقت (expires) لمدة 30 يومًا.</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(js|css)?$</span> <span class="p">{</span>
            <span class="kn">expires</span> <span class="s">12h</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(js|css)?$</span> <span class="p">{</span>
            <span class="kn">expires</span> <span class="s">12h</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>في هذا الكود، يتم تعيين صلاحية (expires) لمدة 12 ساعة لجميع ملفات JavaScript وCSS التي يتم طلبها من الخادم. هذا يعني أن المتصفح سيخزن هذه الملفات في ذاكرة التخزين المؤقت (cache) لمدة 12 ساعة قبل أن يحتاج إلى طلبها مرة أخرى من الخادم.</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">error_page</span> <span class="mi">404</span> <span class="n">/index.html</span><span class="p">;</span>
    <span class="err">}</span>
    <span class="k">```</span>

<span class="mi">4</span><span class="s">.</span> <span class="s">تهيئة</span> <span class="s">API</span> <span class="s">لـ</span> <span class="s">`api.example.com`:</span>

    <span class="s">```nginx</span>
    <span class="s">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
        <span class="kn">server_name</span> <span class="s">api.example.com</span><span class="p">;</span>
    <span class="kn">```</span>

        <span class="s">ssl_certificate</span> <span class="n">/etc/letsencrypt/live/example.com-0001/fullchain.pem</span><span class="p">;</span>
        <span class="kn">ssl_certificate_key</span> <span class="n">/etc/letsencrypt/live/example.com-0001/privkey.pem</span><span class="p">;</span>

<span class="kn">```nginx</span>
        <span class="s">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
        <span class="kn">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
        <span class="kn">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">location</span> <span class="n">/</span> <span class="p">{</span>
            <span class="c1"># مسح أي رؤوس Access-Control موجودة مسبقًا</span>
            <span class="kn">more_clear_headers</span> <span class="s">'Access-Control-Allow-Origin'</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># التعامل مع طلبات CORS المسبقة (preflight)</span>
<span class="k">if</span> <span class="s">(</span><span class="nv">$request_method</span> <span class="p">=</span> <span class="s">'OPTIONS')</span> <span class="p">{</span>
    <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Origin'</span> <span class="nv">$cors_origin</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Methods'</span> <span class="s">'GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">PUT,</span> <span class="s">DELETE'</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Headers'</span> <span class="s">'Origin,</span> <span class="s">Content-Type,</span> <span class="s">Accept,</span> <span class="s">Authorization,</span> <span class="s">X-Client-Info,</span> <span class="s">X-Trace-Id,</span> <span class="s">X-Requested-With,</span> <span class="s">X-HTTP-Method-Override,</span> <span class="s">DNT,</span> <span class="s">Keep-Alive,</span> <span class="s">User-Agent,</span> <span class="s">If-Modified-Since,</span> <span class="s">Cache-Control,</span> <span class="s">Content-Range,</span> <span class="s">Range'</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">'Access-Control-Max-Age'</span> <span class="mi">3600</span><span class="p">;</span>
    <span class="kn">return</span> <span class="mi">204</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">add_header</span> <span class="s">'Access-Control-Allow-Origin'</span> <span class="nv">$cors_origin</span> <span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span> <span class="s">'Access-Control-Allow-Methods'</span> <span class="s">'GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">PUT,</span> <span class="s">DELETE'</span> <span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span> <span class="s">'Access-Control-Allow-Headers'</span> <span class="s">'Origin,</span> <span class="s">Content-Type,</span> <span class="s">Accept,</span> <span class="s">Authorization,</span> <span class="s">X-Client-Info,</span> <span class="s">X-Trace-Id,</span> <span class="s">X-Requested-With,</span> <span class="s">X-HTTP-Method-Override,</span> <span class="s">DNT,</span> <span class="s">Keep-Alive,</span> <span class="s">User-Agent,</span> <span class="s">If-Modified-Since,</span> <span class="s">Cache-Control,</span> <span class="s">Content-Range,</span> <span class="s">Range'</span> <span class="s">always</span><span class="p">;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">nginx
            proxy_pass http://127.0.0.1:5000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 600s;
            proxy_send_timeout 600s;
            proxy_read_timeout 600s;
            send_timeout 600s;
        }
    }
   </code></p>

<h3 id="الخلاصة">الخلاصة</h3>

<p>يعرض هذا المشروع بنية قوية لتطبيق بوت قصصي مدعوم بالذكاء الاصطناعي، مستخدمًا ممارسات وأدوات تطوير ويب حديثة. تم بناء الواجهة الخلفية باستخدام Flask، مما يضمن معالجة فعالة للطلبات والتكامل مع خدمات مختلفة للتسجيل والمراقبة. توفر الواجهة الأمامية، المبنية باستخدام React، واجهة مستخدم تفاعلية لإدارة محفزات القصص. من خلال الاستفادة من AWS للنشر، وNginx للاتصال الآمن، ومجموعة ELK لإدارة السجلات، نضمن قابلية التوسع والموثوقية والقابلية للصيانة. يوضح هذا الإعداد الشامل قوة الجمع بين التقنيات الحديثة لتقديم تجربة مستخدم سلسة.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-ar" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
