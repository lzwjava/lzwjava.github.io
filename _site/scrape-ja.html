<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>ウェブサイトの内容をスクレイピングする</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ウェブサイトの内容をスクレイピングする | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="ウェブサイトの内容をスクレイピングする" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="ja" />
<meta name="description" content="既に多くの既存ツールがウェブサイトのコンテンツをスクレイピングするために利用可能です。しかし、それらを使用するだけでは、背後にあるプロセスを深く理解することはできません。仕事で複雑なサイトや特殊なサイトに遭遇した場合、これらのツールでは望む結果が得られないこともあります。私たちは、それらをよりよく学び、より効果的に活用するために、自ら「車輪を再発明」する必要があるのです。" />
<meta property="og:description" content="既に多くの既存ツールがウェブサイトのコンテンツをスクレイピングするために利用可能です。しかし、それらを使用するだけでは、背後にあるプロセスを深く理解することはできません。仕事で複雑なサイトや特殊なサイトに遭遇した場合、これらのツールでは望む結果が得られないこともあります。私たちは、それらをよりよく学び、より効果的に活用するために、自ら「車輪を再発明」する必要があるのです。" />
<link rel="canonical" href="https://lzwjava.github.io/scrape-ja" />
<meta property="og:url" content="https://lzwjava.github.io/scrape-ja" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-17T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ウェブサイトの内容をスクレイピングする" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2021-03-17T00:00:00+08:00","datePublished":"2021-03-17T00:00:00+08:00","description":"既に多くの既存ツールがウェブサイトのコンテンツをスクレイピングするために利用可能です。しかし、それらを使用するだけでは、背後にあるプロセスを深く理解することはできません。仕事で複雑なサイトや特殊なサイトに遭遇した場合、これらのツールでは望む結果が得られないこともあります。私たちは、それらをよりよく学び、より効果的に活用するために、自ら「車輪を再発明」する必要があるのです。","headline":"ウェブサイトの内容をスクレイピングする","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/scrape-ja"},"url":"https://lzwjava.github.io/scrape-ja"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=962b777daf6d8db7fe4da33104f089e34ca85de3">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=962b777daf6d8db7fe4da33104f089e34ca85de3" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       ウェブサイトの内容をスクレイピングする | オリジナル、AI翻訳
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/ja/2021-03-17-scrape-ja.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsja2021-03-17-scrape-ja.md</span> -->
      

      <!-- <span>2021-03-17-scrape-ja.md</span> -->

      
        

        
          
          <a href="#" class="button">2021.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/scrape-en" >English</option>
        <option value="/scrape-zh" >中文</option>
        <option value="/scrape-ja" selected>日本語</option>
        <option value="/scrape-es" >Español</option>
        <option value="/scrape-hi" >हिंदी</option>
        <option value="/scrape-fr" >Français</option>
        <option value="/scrape-de" >Deutsch</option>
        <option value="/scrape-ar" >العربية</option>
        <option value="/scrape-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>既に多くの既存ツールがウェブサイトのコンテンツをスクレイピングするために利用可能です。しかし、それらを使用するだけでは、背後にあるプロセスを深く理解することはできません。仕事で複雑なサイトや特殊なサイトに遭遇した場合、これらのツールでは望む結果が得られないこともあります。私たちは、それらをよりよく学び、より効果的に活用するために、自ら「車輪を再発明」する必要があるのです。</p>

<p>また、既存のツールも見てみましょう。</p>

<h2 id="データマイナー">データマイナー</h2>

<p><img src="assets/images/scrape/miner.png" alt="miner" /></p>

<p><code class="language-plaintext highlighter-rouge">Data Miner</code>は、Chrome上の非常に便利な拡張機能です。リンクやコンテンツを簡単にスクレイピングするのに役立ちます。</p>

<h2 id="getbook">getbook</h2>

<p><code class="language-plaintext highlighter-rouge">getbook</code>は、電子書籍を作成するための非常に便利なツールです。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">getbook</span><span class="w">
</span></code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"本のタイトル"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"著者名"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"本の説明"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ja"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"plugin1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"plugin2"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"book"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello World"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Armin"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"chapters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://lucumr.pocoo.org/2018/7/13/python/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"http://lucumr.pocoo.org/2017/6/5/diversity-in-technology"</span><span class="p">,</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getbook <span class="nt">-f</span> ./book.json <span class="nt">--mobi</span>
</code></pre></div></div>

<p>このコマンドは、指定された<code class="language-plaintext highlighter-rouge">book.json</code>ファイルから書籍を取得し、Mobi形式で出力するものです。</p>

<p>これにより、いくつかのリンクを電子書籍として簡単にまとめることができます。<code class="language-plaintext highlighter-rouge">Data Miner</code>と<code class="language-plaintext highlighter-rouge">getbook</code>を使用することで、一つはリンクをクロールし、もう一つはリンクを電子書籍に変換するため、電子書籍の作成が非常に便利になります。</p>

<h2 id="ファインマン物理学講義">ファインマン物理学講義</h2>

<p><img src="assets/images/scrape/fl.png" alt="fl" /></p>

<p>「プロジェクト実践：ファインマン物理学講義のウェブページを電子書籍にする」の章では、<code class="language-plaintext highlighter-rouge">mathjax</code>でレンダリングされた<code class="language-plaintext highlighter-rouge">html</code>ウェブページを電子書籍にする方法を学びました。ここでは、このプロジェクトを続けて、すべてのウェブページを取得する方法を見ていきます。ファインマン物理学講義は全3巻です。上の画像は第1巻の目次です。</p>

<blockquote>
  <p>http.client — HTTPプロトコルクライアント</p>

  <p>ソースコード: Lib/http/client.py</p>

  <p>このモジュールは、HTTPおよびHTTPSプロトコルのクライアント側を実装するクラスを定義しています。通常、直接使用されることはありません — <code class="language-plaintext highlighter-rouge">urllib.request</code> モジュールがHTTPおよびHTTPSを使用するURLを処理するためにこれを使用します。</p>

  <p>参考: より高レベルのHTTPクライアントインターフェースには、Requestsパッケージが推奨されます。</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">requests</code>はより高レベルのインターフェースであることがわかります。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://api.github.com/user'</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">'user'</span><span class="p">,</span> <span class="s">'pass'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
</code></pre></div></div>

<p>main()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```shell
401
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://github.com'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>main()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```html
200
&lt;html&gt;
  ...
&lt;/html&gt;
</code></pre></div></div>

<p>上記のコードブロックは、HTMLの基本的な構造を示しています。<code class="language-plaintext highlighter-rouge">200</code>はHTTPステータスコードで、リクエストが成功したことを示します。<code class="language-plaintext highlighter-rouge">&lt;html&gt;</code>タグはHTMLドキュメントのルート要素であり、その中に他のすべての要素が含まれます。<code class="language-plaintext highlighter-rouge">...</code>の部分には、実際のHTMLコンテンツが入ります。</p>

<p>試してみたところ、<code class="language-plaintext highlighter-rouge">requests</code>のインターフェースが使えることが確認できました。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toc-chapter"</span> <span class="na">id=</span><span class="s">"C03"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"triangle"</span><span class="nt">&gt;</span>
         â¶
        <span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"chapterlink"</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3)"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
          第3章.
         <span class="nt">&lt;/span&gt;</span>
         物理学と他の科学との関係
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sections"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,1)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-1
          <span class="nt">&lt;/span&gt;</span>
          序論
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,2)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-2
          <span class="nt">&lt;/span&gt;</span>
          化学
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,3)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-3
          <span class="nt">&lt;/span&gt;</span>
          生物学
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,4)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-4
          <span class="nt">&lt;/span&gt;</span>
          天文学
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,5)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-5
          <span class="nt">&lt;/span&gt;</span>
          地質学
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,6)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-6
          <span class="nt">&lt;/span&gt;</span>
          心理学
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,7)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-7
          <span class="nt">&lt;/span&gt;</span>
          どうしてそうなったのか？
         <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
       <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>これは目次ページ内の第三章节の<code class="language-plaintext highlighter-rouge">html</code>コードです。ここから各章节のリンクを取得したいと考えています。<code class="language-plaintext highlighter-rouge">&lt;a href="javascript:Goto(1,3,7)"&gt;</code>とあるように、これは<code class="language-plaintext highlighter-rouge">javascript</code>のリンクです。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.feynmanlectures.caltech.edu/I_03.html
</code></pre></div></div>

<p>次に、各章のパスが非常に規則的であることに気づきました。<code class="language-plaintext highlighter-rouge">I_03.html</code>は、第1巻の第3章を表しています。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chapter</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">chapter</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">'chapter </span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">chapter_str</span> <span class="o">=</span> <span class="s">'{:02d}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://www.feynmanlectures.caltech.edu/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'scraping </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">'lxml'</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>このコードは、指定された章番号に基づいてFeynman Lecturesのウェブページをスクレイピングし、その内容をHTMLファイルとして保存する関数です。以下にその動作を説明します。</p>

<ol>
  <li><strong>章番号のチェック</strong>: 章番号が1から52の範囲内にあるかどうかを確認します。範囲外の場合は例外を発生させます。</li>
  <li><strong>URLの生成</strong>: 章番号を2桁の文字列に変換し、Feynman Lecturesの該当する章のURLを生成します。</li>
  <li><strong>ウェブページの取得</strong>: <code class="language-plaintext highlighter-rouge">requests</code>ライブラリを使用して、生成したURLからウェブページの内容を取得します。</li>
  <li><strong>ステータスコードの確認</strong>: 取得したウェブページのステータスコードが200（成功）でない場合、例外を発生させます。</li>
  <li><strong>HTMLの解析</strong>: <code class="language-plaintext highlighter-rouge">BeautifulSoup</code>を使用して、取得したHTMLを解析します。</li>
  <li><strong>ファイルへの保存</strong>: 解析したHTMLを整形して、指定されたパスにHTMLファイルとして保存します。</li>
</ol>

<p>この関数を使用することで、指定された章の内容を簡単に取得し、ローカルに保存することができます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
        
<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>続いて、スクレイピングのコードについて書いていきます。ここでは<code class="language-plaintext highlighter-rouge">Process</code>を使用しています。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    raise RuntimeError<span class="o">(</span><span class="s1">'''
RuntimeError: 
        現在のプロセスのブートストラップフェーズが完了する前に、
        新しいプロセスの開始が試みられました。
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    これはおそらく、子プロセスを開始するために fork を使用しておらず、
    メインモジュールで適切なイディオムを使用するのを忘れていることを意味します:
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">freeze_support</span><span class="p">()</span>
    <span class="p">...</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    プログラムが実行ファイルを生成するためにフリーズされる予定がない場合、
    "freeze_support()" の行は省略できます。 ```
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">):</span>        
        <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div></div>

<p>このコードは、Pythonの<code class="language-plaintext highlighter-rouge">multiprocessing</code>モジュールを使用して、52個のプロセスを並列に実行するものです。各プロセスは<code class="language-plaintext highlighter-rouge">scrape</code>関数を実行し、引数として<code class="language-plaintext highlighter-rouge">i+1</code>を渡します。最後に<code class="language-plaintext highlighter-rouge">p.join()</code>を呼び出すことで、すべてのプロセスが終了するのを待ちます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time: '</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>    
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scraping https://www.feynmanlectures.caltech.edu/I_01.html
scraping https://www.feynmanlectures.caltech.edu/I_04.html
...
scraping https://www.feynmanlectures.caltech.edu/I_51.html
scraping https://www.feynmanlectures.caltech.edu/I_52.html
時間:  9.144841699秒
</code></pre></div></div>

<p><img src="assets/images/scrape/fig.png" alt="図" /></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"figure"</span> <span class="na">id=</span><span class="s">"Ch1-F1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"img/FLP_I/f01-01/f01-01_tc_big.svgz"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"caption empty"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
          図1–1
         <span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">timeit</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chapter</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">chapter</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">'chapter </span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">chapter_str</span> <span class="o">=</span> <span class="s">'{:02d}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://www.feynmanlectures.caltech.edu/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'scraping </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">'lxml'</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>このコードは、指定された章番号に基づいて、Feynman Lecturesのウェブページをスクレイピングし、その内容をHTMLファイルとして保存する関数です。以下にその動作を説明します。</p>

<ol>
  <li><strong>引数のチェック</strong>: <code class="language-plaintext highlighter-rouge">chapter</code>が1から52の範囲外の場合、例外を発生させます。</li>
  <li><strong>URLの生成</strong>: 章番号を2桁の文字列に変換し、それに基づいてURLを生成します。</li>
  <li><strong>ウェブページの取得</strong>: <code class="language-plaintext highlighter-rouge">requests</code>ライブラリを使用して、指定されたURLからウェブページの内容を取得します。</li>
  <li><strong>ステータスコードの確認</strong>: レスポンスのステータスコードが200（成功）でない場合、例外を発生させます。</li>
  <li><strong>HTMLの解析</strong>: <code class="language-plaintext highlighter-rouge">BeautifulSoup</code>を使用して、取得したHTMLを解析します。</li>
  <li><strong>ファイルへの保存</strong>: 解析したHTMLを整形して、指定されたファイル名で保存します。</li>
</ol>

<p>この関数を使用することで、指定された章の内容を簡単に取得し、ローカルに保存することができます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time: '</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>    
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>リンクを確認してください。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">imgs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre></div></div>

<p>このコードは、BeautifulSoupを使ってHTMLからすべての画像タグ(<code class="language-plaintext highlighter-rouge">&lt;img&gt;</code>)を検索し、それぞれの画像タグを出力するものです。<code class="language-plaintext highlighter-rouge">soup.find_all('img')</code>は、HTMLドキュメント内のすべての<code class="language-plaintext highlighter-rouge">&lt;img&gt;</code>タグをリストとして返します。その後、<code class="language-plaintext highlighter-rouge">for</code>ループを使って各画像タグを順番に出力しています。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.feynmanlectures.caltech.edu/I_01.html をスクレイピング中
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"TwitLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"FBLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"MailLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"MobileLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"DarkModeLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"DesktopLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"img/camera.svg"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"img/FLP_I/f01-00/f01-00.jpg"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-01/f01-01_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-02/f01-02_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-03/f01-03_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-04/f01-04_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-05/f01-05_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-06/f01-06_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"first"</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-07/f01-07_tc_iPad_big_a.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"last"</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-07/f01-07_tc_iPad_big_b.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-08/f01-08_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-09/f01-09_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-10/f01-10_tc_big.svgz"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>https://www.feynmanlectures.caltech.edu/img/FLP_I/f01-01/f01-01_tc_big.svgz</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>禁止されています
</code></pre></div></div>

<p>このリソースにアクセスする権限がありません。</p>

<p>Apache/2.4.38 (Debian) サーバー at www.feynmanlectures.caltech.edu Port 443</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```shell
% pip install selenium
Collecting selenium
  Using cached selenium-3.141.0-py2.py3-none-any.whl (904 kB)
Requirement already satisfied: urllib3 in /usr/local/lib/python3.9/site-packages (from selenium) (1.24.2)
Installing collected packages: selenium
Successfully installed selenium-3.141.0
</code></pre></div></div>

<p>上記のコマンドは、Pythonのパッケージ管理ツールである<code class="language-plaintext highlighter-rouge">pip</code>を使用して、Seleniumライブラリをインストールするプロセスを示しています。Seleniumは、ウェブブラウザの自動化に広く使用されるツールです。このコマンドを実行すると、Seleniumの最新バージョンがダウンロードされ、システムにインストールされます。<code class="language-plaintext highlighter-rouge">urllib3</code>という依存パッケージが既にインストールされている場合、そのパッケージは再インストールされません。最後に、Seleniumが正常にインストールされたことが表示されます。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CHROME_DRIVER_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/dev-env/chromedriver
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">CHROME_DRIVER_HOME</span><span class="k">}</span><span class="s2">"</span>
</code></pre></div></div>

<p>このコードは、シェル環境でChromeDriverのパスを設定するためのものです。<code class="language-plaintext highlighter-rouge">CHROME_DRIVER_HOME</code>という環境変数にChromeDriverのインストールディレクトリを指定し、そのディレクトリを<code class="language-plaintext highlighter-rouge">PATH</code>に追加しています。これにより、ターミナルから<code class="language-plaintext highlighter-rouge">chromedriver</code>コマンドを直接実行できるようになります。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% chromedriver <span class="nt">-h</span>
使用方法: chromedriver <span class="o">[</span>オプション]
</code></pre></div></div>

<p>オプション
  –port=PORT                     リッスンするポート
  –adb-port=PORT                 adbサーバーのポート
  –log-path=FILE                 サーバーログを標準エラー出力ではなくファイルに書き込み、ログレベルをINFOに上げる
  –log-level=LEVEL               ログレベルを設定: ALL, DEBUG, INFO, WARNING, SEVERE, OFF
  –verbose                       詳細にログを記録する（–log-level=ALL と同等）
  –silent                        何もログに記録しない（–log-level=OFF と同等）
  –append-log                    ログファイルを上書きせずに追記する
  –replayable                    （実験的）詳細にログを記録し、長い文字列を切り詰めないようにして、ログを再生できるようにする
  –version                       バージョン番号を表示して終了する
  –url-base                      コマンドのベースURLパスプレフィックス、例: wd/url
  –readable-timestamp            ログに読みやすいタイムスタンプを追加する
  –enable-chrome-logs            ブラウザからのログを表示する（他のログオプションを上書き）
  –allowed-ips                   ChromeDriverに接続を許可するリモートIPアドレスのカンマ区切り許可リスト</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># コードブロックの開始を示すマークダウン記法
# ここにPythonコードを記述します
</span><span class="k">print</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.expected_conditions</span> <span class="kn">import</span> <span class="n">presence_of_element_located</span>
</code></pre></div></div>

<p>このコードは、Seleniumを使用してウェブブラウザを自動化するための基本的なインポート文です。以下に各インポートの説明を示します：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">webdriver</code>: Seleniumのコアモジュールで、ブラウザのインスタンスを作成し操作するために使用されます。</li>
  <li><code class="language-plaintext highlighter-rouge">By</code>: 要素を検索するためのメソッドを提供します（例: <code class="language-plaintext highlighter-rouge">By.ID</code>, <code class="language-plaintext highlighter-rouge">By.NAME</code>, <code class="language-plaintext highlighter-rouge">By.CLASS_NAME</code> など）。</li>
  <li><code class="language-plaintext highlighter-rouge">Keys</code>: キーボード操作をシミュレートするためのキー（例: <code class="language-plaintext highlighter-rouge">Keys.ENTER</code>, <code class="language-plaintext highlighter-rouge">Keys.TAB</code> など）を提供します。</li>
  <li><code class="language-plaintext highlighter-rouge">WebDriverWait</code>: 特定の条件が満たされるまで待機するためのユーティリティを提供します。</li>
  <li><code class="language-plaintext highlighter-rouge">presence_of_element_located</code>: 指定された要素がDOMに存在するかどうかを確認するための条件を提供します。</li>
</ul>

<p>これらのインポートを使用して、ウェブページの要素を操作し、自動化されたテストやスクレイピングを行うことができます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span> <span class="k">as</span> <span class="n">driver</span><span class="p">:</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://google.com/ncr"</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s">"q"</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"cheese"</span> <span class="o">+</span> <span class="n">Keys</span><span class="p">.</span><span class="n">RETURN</span><span class="p">)</span>
    <span class="n">first_result</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">"h3&gt;div"</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">first_result</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">"textContent"</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># このコードブロックはPythonのコードを示しています。
# ここにPythonのコードを書くことができます。
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.expected_conditions</span> <span class="kn">import</span> <span class="n">presence_of_element_located</span>
<span class="kn">import</span> <span class="nn">urllib</span>
</code></pre></div></div>

<p>このコードは、Seleniumを使用してウェブブラウザを自動化し、ウェブページ上の要素を操作するための基本的なインポート文です。以下に各インポートの説明を示します：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">webdriver</code>: Seleniumのコアモジュールで、ブラウザのインスタンスを作成し、操作するために使用されます。</li>
  <li><code class="language-plaintext highlighter-rouge">By</code>: 要素を検索するための戦略（例: ID、クラス名、CSSセレクタなど）を提供します。</li>
  <li><code class="language-plaintext highlighter-rouge">Keys</code>: キーボード操作（例: Enterキー、Tabキーなど）をシミュレートするために使用されます。</li>
  <li><code class="language-plaintext highlighter-rouge">WebDriverWait</code>: 特定の条件が満たされるまで待機するためのユーティリティです。</li>
  <li><code class="language-plaintext highlighter-rouge">presence_of_element_located</code>: 指定された要素がDOMに存在するかどうかを確認するための条件です。</li>
  <li><code class="language-plaintext highlighter-rouge">urllib</code>: URLを操作するための標準ライブラリです（このコードでは使用されていませんが、インポートされています）。</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://www.feynmanlectures.caltech.edu/I_01.html"</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s">"img"</span><span class="p">)</span>
    <span class="c1"># print(dir(elements[0]))
</span>    <span class="k">print</span><span class="p">(</span><span class="n">driver</span><span class="p">.</span><span class="n">page_source</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="c1"># src = element.get_attribute('src')
</span>        <span class="n">element</span><span class="p">.</span><span class="n">screenshot</span><span class="p">(</span><span class="sa">f</span><span class="s">'images/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">.png'</span><span class="p">)</span>        
        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>                
    <span class="n">driver</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">img_path</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">'./chapters/</span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">/img'</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">img_name</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">splits</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">last</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">download_images</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">,</span> <span class="n">chapter</span><span class="p">):</span>        
    <span class="n">path</span> <span class="o">=</span> <span class="n">img_path</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>    
        
    <span class="n">elements</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s">"img"</span><span class="p">)</span>    
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">'src'</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">img_name</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="n">element</span><span class="p">.</span><span class="n">screenshot</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">.png'</span><span class="p">)</span>
</code></pre></div></div>

<p>このコードは、指定された章の画像をダウンロードするための関数です。以下にその動作を説明します。</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">path = img_path(chapter)</code>：指定された章に対応する画像の保存先パスを取得します。</li>
  <li><code class="language-plaintext highlighter-rouge">Path(path).mkdir(parents=True, exist_ok=True)</code>：保存先ディレクトリが存在しない場合、親ディレクトリも含めて作成します。</li>
  <li><code class="language-plaintext highlighter-rouge">elements = driver.find_elements(By.TAG_NAME, "img")</code>：ウェブページ内のすべての<code class="language-plaintext highlighter-rouge">&lt;img&gt;</code>タグを取得します。</li>
  <li><code class="language-plaintext highlighter-rouge">for element in elements:</code>：各画像要素に対して以下の処理を行います。
    <ul>
      <li><code class="language-plaintext highlighter-rouge">src = element.get_attribute('src')</code>：画像のソースURLを取得します。</li>
      <li><code class="language-plaintext highlighter-rouge">name = img_name(src)</code>：ソースURLから画像の名前を生成します。</li>
      <li><code class="language-plaintext highlighter-rouge">element.screenshot(f'{path}/{name}.png')</code>：画像をスクリーンショットとして保存します。</li>
    </ul>
  </li>
</ol>

<p>この関数を使用することで、指定された章の画像を自動的にダウンロードし、指定されたパスに保存することができます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USER_AGENT</span> <span class="o">=</span> <span class="s">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Safari/605.1.15'</span>
</code></pre></div></div>

<p>このコードは、ウェブスクレイピングやAPIリクエストを行う際に使用されるユーザーエージェント文字列を定義しています。この特定のユーザーエージェントは、Mac OS X 10.15.6上で動作するSafari 14.0.3を模倣しています。これにより、ウェブサーバーに対して、リクエストがMacのSafariブラウザから来ているように見せることができます。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chapter</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">chapter</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">'chapter </span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">chapter_str</span> <span class="o">=</span> <span class="s">'{:02d}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://www.feynmanlectures.caltech.edu/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">page_source</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">page_source</span>        
    <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">'</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'scraping </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
        
    <span class="n">download_images</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">chapter_str</span><span class="p">)</span>
        
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page_source</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">'lxml'</span><span class="p">)</span>        
    <span class="n">imgs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">'src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span> <span class="ow">or</span> <span class="s">'data-src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="s">''</span>
            <span class="k">if</span> <span class="s">'src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s">'data-src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'data-src'</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'data-src'</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">img_name</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
            <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'img/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">.png'</span>                
    
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">driver</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>このコードは、指定された章番号に基づいてFeynman Lecturesのウェブページをスクレイピングし、画像をダウンロードしてHTMLファイルを保存する関数です。以下にその動作を説明します。</p>

<ol>
  <li><strong>章番号のチェック</strong>: 章番号が1から52の範囲内にあるかどうかを確認します。範囲外の場合は例外を発生させます。</li>
  <li><strong>URLの生成</strong>: 指定された章番号に基づいて、Feynman Lecturesの該当する章のURLを生成します。</li>
  <li><strong>WebDriverの起動</strong>: ChromeのWebDriverを起動し、生成したURLにアクセスします。</li>
  <li><strong>ページソースの取得</strong>: アクセスしたページのHTMLソースを取得します。</li>
  <li><strong>ディレクトリの作成</strong>: 章ごとのディレクトリを作成します。既に存在する場合は何もしません。</li>
  <li><strong>画像のダウンロード</strong>: ページ内の画像をダウンロードします。</li>
  <li><strong>HTMLの解析と修正</strong>: BeautifulSoupを使用してHTMLを解析し、画像の<code class="language-plaintext highlighter-rouge">src</code>属性を修正します。<code class="language-plaintext highlighter-rouge">data-src</code>属性がある場合は、それを<code class="language-plaintext highlighter-rouge">src</code>に置き換えます。</li>
  <li><strong>HTMLファイルの保存</strong>: 修正したHTMLをファイルとして保存します。</li>
  <li><strong>WebDriverの終了</strong>: WebDriverを閉じて、リソースを解放します。</li>
</ol>

<p>この関数を使用することで、指定された章の内容をローカルに保存し、オフラインで閲覧することが可能になります。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time: '</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>    
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>スクレイピング中 https://www.feynmanlectures.caltech.edu/I_01.html
スクレイピング中 https://www.feynmanlectures.caltech.edu/I_02.html
時間:  21.478510914999998
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> errpipe_read, errpipe_write <span class="o">=</span> os.pipe<span class="o">()</span>
OSError: <span class="o">[</span>Errno 24] 開いているファイルが多すぎます
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> % <span class="nb">ulimit </span>a
<span class="nb">ulimit</span>: 無効な数値: a
lzw@lzwjava feynman-lectures-mobi % <span class="nb">ulimit</span> <span class="nt">-a</span>
<span class="nt">-t</span>: CPU時間（秒）                  無制限
<span class="nt">-f</span>: ファイルサイズ（ブロック）      無制限
<span class="nt">-d</span>: データセグメントサイズ（キロバイト） 無制限
<span class="nt">-s</span>: スタックサイズ（キロバイト）     8192
<span class="nt">-c</span>: コアファイルサイズ（ブロック）   0
<span class="nt">-v</span>: アドレス空間（キロバイト）       無制限
<span class="nt">-l</span>: メモリにロックされたサイズ（キロバイト） 無制限
<span class="nt">-u</span>: プロセス数                      2784
<span class="nt">-n</span>: ファイルディスクリプタ数         256
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12
download_images
12
mathjax2svg
latexs 128
make_svg 0
insert_svg 0
make_svg 1
insert_svg 1
make_svg 2
insert_svg 2
make_svg 3
insert_svg 3
convert
</code></pre></div></div>

<p>このコードブロックは、特定のタスクを実行するためのシェルスクリプトの一部のようです。各コマンドは、画像のダウンロード、MathJaxからSVGへの変換、LaTeXの処理、SVGの生成と挿入、そして最終的な変換を行うためのステップを示しています。具体的な内容や目的は、このコードが属するプロジェクトやコンテキストに依存します。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12
download_images
12
mathjax2svg
latexs 0
latexs 0
convert
Time:  11.369145162
</code></pre></div></div>

<p>（注：上記のコードブロックは、特定のコマンドやプロセスの実行結果を示すものであり、翻訳の必要はありません。そのままの形で使用してください。）</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% <span class="nb">grep</span> <span class="nt">--include</span><span class="o">=</span><span class="se">\*</span>.html <span class="nt">-r</span> <span class="s1">'\$'</span> <span class="k">*</span>
43/I_43.html:長い時間 <span class="nv">$T$ </span>の間に、一定の数 <span class="nv">$N$ </span>の衝突があるとします。もし私たちが
43/I_43.html:衝突の数は時間 <span class="nv">$T$ </span>に比例します。私たちは
43/I_43.html:比例定数を <span class="nv">$1</span>/<span class="se">\t</span>au<span class="nv">$ </span>と書きました。ここで
43/I_43.html:<span class="nv">$\</span>tau<span class="nv">$ </span>は時間の次元を持つ定数です。この定数 <span class="nv">$\</span>tau<span class="nv">$ </span>は
43/I_43.html:60回の衝突があるとすると、<span class="nv">$\</span>tau<span class="nv">$ </span>は1分です。私たちは
43/I_43.html:<span class="nv">$\</span>tau<span class="nv">$（</span>1分）が
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>エラー	E21018: ファイルの内容を解析中に、改良されたMobiドメインの作成に失敗しました。内容：&lt;In earlier chapters <span class="o">&gt;</span> ファイル： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/c-49.xhtml 行： 969
警告	W28001: Kindleリーダーは、コンテンツ内で指定されたCSSスタイルをサポートしていません。CSSプロパティを削除中： <span class="s1">'max-width'</span> ファイル： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/stylesheet.css
警告	W29004: 強制的に閉じられた開いているタグ： &lt;span amzn-src-id<span class="o">=</span><span class="s2">"985"</span><span class="o">&gt;</span> ファイル： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/c-4.xhtml     行： 0000102
警告	W29004: 強制的に閉じられた開いているタグ： &lt;p amzn-src-id<span class="o">=</span><span class="s2">"975"</span><span class="o">&gt;</span> ファイル： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/c-4.xhtml     行： 0000102
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>警告	W14001: ハイパーリンクに問題があり、未解決です:  /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/97c9cb4d-35f7-4920-81eb-4705325c482f/cTemp/mTemp/mobi-pvawPN/OEBPS/c-1.xhtml#Ch1-F1			
警告	W14001: ハイパーリンクに問題があり、未解決です:  /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/97c9cb4d-35f7-4920-81eb-4705325c482f/cTemp/mTemp/mobi-pvawPN/OEBPS/c-1.xhtml#Ch1-F2			
警告	W14001: ハイパーリンクに問題があり、未解決です:  /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/97c9cb4d-35f7-4920-81eb-4705325c482f/cTemp/mTemp/mobi-pvawPN/OEBPS/c-1.xhtml#Ch1-F3			
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"disabled"</span> <span class="na">href=</span><span class="s">"#Ch1-F1"</span><span class="nt">&gt;</span>
          1–1
<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<p>このHTMLコードは、<code class="language-plaintext highlighter-rouge">disabled</code>クラスが適用された<code class="language-plaintext highlighter-rouge">span</code>要素を含んでいます。この要素は、リンク先として<code class="language-plaintext highlighter-rouge">#Ch1-F1</code>を指定していますが、<code class="language-plaintext highlighter-rouge">disabled</code>クラスが適用されているため、リンクとして機能しない可能性があります。<code class="language-plaintext highlighter-rouge">1–1</code>というテキストが表示されますが、クリックしても何も起こらないか、またはリンクが無効化されている状態です。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'OEBPS/84b8b4179175f097be1180a10089107be75d7d85.svg'</span> を 1264x1011 にラスタライズ中
<span class="s1">'OEBPS/23a4df37f269c8ed43f54753eb838b29cff538a1.svg'</span> を 1264x259 にラスタライズ中
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"runpy.py"</span>, line 194, <span class="k">in </span>_run_module_as_main
  File <span class="s2">"runpy.py"</span>, line 87, <span class="k">in </span>_run_code
  File <span class="s2">"site.py"</span>, line 39, <span class="k">in</span> &lt;module&gt;
  File <span class="s2">"site.py"</span>, line 35, <span class="k">in </span>main
  File <span class="s2">"calibre/utils/ipc/worker.py"</span>, line 216, <span class="k">in </span>main
  File <span class="s2">"calibre/gui2/convert/gui_conversion.py"</span>, line 41, <span class="k">in </span>gui_convert_override
  File <span class="s2">"calibre/gui2/convert/gui_conversion.py"</span>, line 28, <span class="k">in </span>gui_convert
  File <span class="s2">"calibre/ebooks/conversion/plumber.py"</span>, line 1274, <span class="k">in </span>run
  File <span class="s2">"calibre/ebooks/conversion/plugins/mobi_output.py"</span>, line 214, <span class="k">in </span>convert
  File <span class="s2">"calibre/ebooks/conversion/plugins/mobi_output.py"</span>, line 237, <span class="k">in </span>write_mobi
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 55, <span class="k">in </span>__call__
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 142, <span class="k">in </span>rasterize_spine
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 152, <span class="k">in </span>rasterize_item
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 185, <span class="k">in </span>rasterize_external
  File <span class="s2">"calibre/ebooks/oeb/base.py"</span>, line 1092, <span class="k">in </span>bytes_representation
  File <span class="s2">"calibre/ebooks/oeb/base.py"</span>, line 432, <span class="k">in </span>serialize
TypeError: <span class="s1">'NoneType'</span> オブジェクトをバイトに変換できません
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% kindlepreviewer feynman-lectures-on-physics-volumn-1.epub <span class="nt">-convert</span>
指定された引数を確認しています。
前処理を進行中です。
1/1 の本を処理中です。
本が警告付きで変換されました！: /Users/lzw/projects/feynman-lectures-mobi/feynman-lectures-on-physics-volumn-1.epub
後処理を進行中です。
出力/ログファイルを /Users/lzw/projects/feynman-lectures-mobi/output に書き込んでいます。
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>マニフェストのクリーンアップ中...
マニフェストから未使用のファイルを削除中...
AZW3出力を作成中...
リソースをシリアライズ中...
ページの区切りやフローの制限に基づいてマークアップを分割中（該当する場合）...
KF8出力を作成中
	KF8マークアップを生成中...
タグテーブルにaidがなく、チャンクサイズが大きすぎます。それでも追加します。
タグテーブルにaidがなく、チャンクサイズが大きすぎます。それでも追加します。
タグテーブルにaidがなく、チャンクサイズが大きすぎます。それでも追加します。
	マークアップを圧縮中...
	インデックスを作成中...
</code></pre></div></div>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-ja" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
