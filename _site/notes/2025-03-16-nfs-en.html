<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Setting Up an NFS Server for Media Sharing on Ubuntu</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Setting Up an NFS Server for Media Sharing on Ubuntu | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Setting Up an NFS Server for Media Sharing on Ubuntu" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-03-16-nfs-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-03-16-nfs-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Setting Up an NFS Server for Media Sharing on Ubuntu" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Setting Up an NFS Server for Media Sharing on Ubuntu","url":"https://lzwjava.github.io/notes/2025-03-16-nfs-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=b02927194c03e0ffa5c9c53c506e757265427e0f">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=b02927194c03e0ffa5c9c53c506e757265427e0f" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Setting Up an NFS Server for Media Sharing on Ubuntu | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-03-16-nfs-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-03-16-nfs-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/nfs-en" selected>English</option>
        <option value="/nfs-zh" >中文</option>
        <option value="/nfs-ja" >日本語</option>
        <option value="/nfs-es" >Español</option>
        <option value="/nfs-hi" >हिंदी</option>
        <option value="/nfs-fr" >Français</option>
        <option value="/nfs-de" >Deutsch</option>
        <option value="/nfs-ar" >العربية</option>
        <option value="/nfs-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>To set up an NFS (Network File System) server on Ubuntu to serve media files, follow these detailed steps. This guide assumes you want to share a directory containing media files (e.g., videos, music) over your network securely and efficiently.</p>

<hr />

<h3 id="step-1-install-the-nfs-server-software">Step 1: Install the NFS Server Software</h3>
<p>First, you need to install the NFS server package on your Ubuntu system.</p>

<ol>
  <li>Update the package list to ensure you get the latest versions:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
</code></pre></div>    </div>
  </li>
  <li>Install the <code class="language-plaintext highlighter-rouge">nfs-kernel-server</code> package, which provides the NFS server functionality:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>nfs-kernel-server
</code></pre></div>    </div>
  </li>
</ol>

<p>This installs the necessary software to run an NFS server.</p>

<hr />

<h3 id="step-2-create-and-configure-the-media-directory">Step 2: Create and Configure the Media Directory</h3>
<p>You need a directory to store your media files and configure it for sharing.</p>

<ol>
  <li>Create a directory to hold your media files (e.g., <code class="language-plaintext highlighter-rouge">/media/share</code>):
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir</span> <span class="nt">-p</span> /media/share
</code></pre></div>    </div>
  </li>
  <li>Set the ownership to your user account (replace <code class="language-plaintext highlighter-rouge">$USER</code> with your actual username if needed):
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chown</span> <span class="nv">$USER</span>:<span class="nv">$USER</span> /media/share
</code></pre></div>    </div>
  </li>
  <li>Adjust permissions to allow access. For media files that are primarily read-only for clients, you can set:
    <ul>
      <li>Directories: <code class="language-plaintext highlighter-rouge">755</code> (read and execute for others)</li>
      <li>Files: <code class="language-plaintext highlighter-rouge">644</code> (read for others)
However, for simplicity, apply <code class="language-plaintext highlighter-rouge">755</code> recursively if you don’t need fine-grained control:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chmod</span> <span class="nt">-R</span> 755 /media/share
</code></pre></div>        </div>
      </li>
      <li><strong>Note</strong>: Media files don’t need to be executable, but <code class="language-plaintext highlighter-rouge">755</code> on files won’t harm NFS functionality since execution happens locally on the client.</li>
    </ul>
  </li>
  <li>Place your media files in <code class="language-plaintext highlighter-rouge">/media/share</code> (e.g., copy videos or music into this directory).</li>
</ol>

<hr />

<h3 id="step-3-configure-nfs-exports">Step 3: Configure NFS Exports</h3>
<p>The NFS server uses the <code class="language-plaintext highlighter-rouge">/etc/exports</code> file to define which directories to share and who can access them.</p>

<ol>
  <li>Open the exports file with a text editor:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/exports
</code></pre></div>    </div>
  </li>
  <li>Add a line to share <code class="language-plaintext highlighter-rouge">/media/share</code>. The syntax is:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/path/to/directory client(options)
</code></pre></div>    </div>
    <ul>
      <li><strong>Example 1</strong>: Share with a specific client IP (e.g., <code class="language-plaintext highlighter-rouge">192.168.1.100</code>) with read-write access:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/media/share 192.168.1.100(rw,sync,no_subtree_check)
</code></pre></div>        </div>
      </li>
      <li><strong>Example 2</strong>: Share with all devices on your subnet (e.g., <code class="language-plaintext highlighter-rouge">192.168.1.0/24</code>) with read-only access:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/media/share 192.168.1.0/24(ro,sync,no_subtree_check)
</code></pre></div>        </div>
      </li>
      <li><strong>Example 3</strong>: Share with any device (less secure, use cautiously):
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/media/share *(rw,sync,no_subtree_check)
</code></pre></div>        </div>
      </li>
    </ul>

    <p><strong>Options Explained</strong>:</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">rw</code>: Read-write access (use <code class="language-plaintext highlighter-rouge">ro</code> for read-only if preferred for media streaming).</li>
      <li><code class="language-plaintext highlighter-rouge">sync</code>: Ensures data is written to disk before confirming operations (safer but slower; use <code class="language-plaintext highlighter-rouge">async</code> for performance at the risk of data loss in crashes).</li>
      <li><code class="language-plaintext highlighter-rouge">no_subtree_check</code>: Improves performance by disabling subtree checking (recommended for most setups).</li>
    </ul>
  </li>
  <li>Save the file (<code class="language-plaintext highlighter-rouge">Ctrl+O</code>, then <code class="language-plaintext highlighter-rouge">Enter</code> in nano) and exit (<code class="language-plaintext highlighter-rouge">Ctrl+X</code>).</li>
</ol>

<hr />

<h3 id="step-4-apply-the-nfs-configuration">Step 4: Apply the NFS Configuration</h3>
<p>After editing the exports file, update the NFS server to reflect your changes.</p>

<ol>
  <li>Export the shares:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>exportfs <span class="nt">-a</span>
</code></pre></div>    </div>
  </li>
  <li>Restart the NFS server to apply the configuration:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl restart nfs-kernel-server
</code></pre></div>    </div>
  </li>
  <li>Verify the service is running:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl status nfs-kernel-server
</code></pre></div>    </div>
    <ul>
      <li>Look for “active (running)” in the output.</li>
    </ul>
  </li>
  <li>Check the exported directories:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>exportfs <span class="nt">-v</span>
</code></pre></div>    </div>
    <ul>
      <li>This should list <code class="language-plaintext highlighter-rouge">/media/share</code> with the options you specified.</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="step-5-configure-the-firewall">Step 5: Configure the Firewall</h3>
<p>NFS uses specific ports, and you need to ensure your firewall allows traffic to them. Ubuntu often uses UFW (Uncomplicated Firewall).</p>

<ol>
  <li><strong>Default NFS Ports</strong>:
    <ul>
      <li>NFS: 2049 (TCP/UDP)</li>
      <li>RPC: 111 (TCP/UDP)</li>
      <li>Other services (mountd, statd, lockd): Dynamic by default, but can be set to static ports.</li>
    </ul>
  </li>
  <li>For simplicity, allow the essential ports with dynamic settings (if you don’t set static ports):
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw allow 2049
<span class="nb">sudo </span>ufw allow 111
</code></pre></div>    </div>
    <ul>
      <li><strong>Note</strong>: This may not cover all NFS traffic if mountd, statd, or lockd use random ports.</li>
    </ul>
  </li>
  <li><strong>Optional: Set Static Ports for Better Control</strong> (recommended for precise firewall rules):
    <ul>
      <li>Edit <code class="language-plaintext highlighter-rouge">/etc/default/nfs-kernel-server</code>:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/default/nfs-kernel-server
</code></pre></div>        </div>
        <p>Add or modify:</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RPCMOUNTDOPTS="-p 4001"
</code></pre></div>        </div>
      </li>
      <li>Edit <code class="language-plaintext highlighter-rouge">/etc/default/nfs-common</code>:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/default/nfs-common
</code></pre></div>        </div>
        <p>Add or modify:</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>STATDOPTS="-p 4002"
</code></pre></div>        </div>
      </li>
      <li>Create <code class="language-plaintext highlighter-rouge">/etc/modprobe.d/nfs.conf</code> for lockd:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/modprobe.d/nfs.conf
</code></pre></div>        </div>
        <p>Add:</p>
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>options lockd nlm_udp_port=4003 nlm_tcp_port=4003
</code></pre></div>        </div>
      </li>
      <li>Restart the NFS server:
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl restart nfs-kernel-server
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Allow the static ports in UFW:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw allow 2049/tcp
<span class="nb">sudo </span>ufw allow 2049/udp
<span class="nb">sudo </span>ufw allow 111/tcp
<span class="nb">sudo </span>ufw allow 111/udp
<span class="nb">sudo </span>ufw allow 4001/tcp
<span class="nb">sudo </span>ufw allow 4001/udp
<span class="nb">sudo </span>ufw allow 4002/tcp
<span class="nb">sudo </span>ufw allow 4002/udp
<span class="nb">sudo </span>ufw allow 4003/tcp
<span class="nb">sudo </span>ufw allow 4003/udp
</code></pre></div>    </div>
  </li>
  <li>Enable UFW if it’s not already active:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw <span class="nb">enable</span>
</code></pre></div>    </div>
  </li>
</ol>

<hr />

<h3 id="step-6-verify-the-setup">Step 6: Verify the Setup</h3>
<p>Ensure the NFS server is working correctly.</p>

<ol>
  <li>Check exported shares from the server:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>showmount <span class="nt">-e</span> localhost
</code></pre></div>    </div>
    <ul>
      <li>You should see <code class="language-plaintext highlighter-rouge">/media/share</code> listed with the correct clients/options.</li>
    </ul>
  </li>
  <li>Verify listening ports:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ss <span class="nt">-tuln</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"2049|111|4001|4002|4003"</span>
</code></pre></div>    </div>
    <ul>
      <li>Confirm these ports are open and bound to the NFS services.</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="step-7-test-from-a-client-optional">Step 7: Test from a Client (Optional)</h3>
<p>On a client machine (e.g., another Ubuntu system), test mounting the share:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>mount <span class="nt">-t</span> nfs &lt;server_ip&gt;:/media/share /mnt
</code></pre></div></div>
<ul>
  <li>Replace <code class="language-plaintext highlighter-rouge">&lt;server_ip&gt;</code> with your NFS server’s IP address.</li>
  <li>Ensure <code class="language-plaintext highlighter-rouge">/mnt</code> exists (<code class="language-plaintext highlighter-rouge">sudo mkdir /mnt</code> if needed).</li>
  <li>Access <code class="language-plaintext highlighter-rouge">/mnt</code> to verify you can see and play the media files.</li>
</ul>

<hr />

<h3 id="additional-notes-for-media-files">Additional Notes for Media Files</h3>
<ul>
  <li><strong>Read-Only Access</strong>: If clients only need to stream media, use <code class="language-plaintext highlighter-rouge">ro</code> in <code class="language-plaintext highlighter-rouge">/etc/exports</code> to prevent modifications.</li>
  <li><strong>Permissions</strong>: Ensure media files are readable by clients. UID/GID mismatches between server and client can cause access issues; adjust file permissions or use NFS options like <code class="language-plaintext highlighter-rouge">all_squash</code> if needed (advanced).</li>
  <li><strong>Performance</strong>: For large media files, the default <code class="language-plaintext highlighter-rouge">sync</code> option is safe but slower. Test with <code class="language-plaintext highlighter-rouge">async</code> if performance is a priority and data loss risk is acceptable.</li>
  <li><strong>NFS Version</strong>: Ubuntu defaults to NFSv4, which is suitable for media serving. No additional configuration is typically needed unless supporting older clients (NFSv3).</li>
</ul>

<hr />

<h3 id="summary-of-commands">Summary of Commands</h3>
<p>Here’s a quick reference for the basic setup (without static ports):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>nfs-kernel-server
<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /media/share
<span class="nb">sudo chown</span> <span class="nv">$USER</span>:<span class="nv">$USER</span> /media/share
<span class="nb">sudo chmod</span> <span class="nt">-R</span> 755 /media/share
<span class="nb">echo</span> <span class="s2">"/media/share *(rw,sync,no_subtree_check)"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/exports
<span class="nb">sudo </span>exportfs <span class="nt">-a</span>
<span class="nb">sudo </span>systemctl restart nfs-kernel-server
<span class="nb">sudo </span>ufw allow 2049
<span class="nb">sudo </span>ufw allow 111
</code></pre></div></div>

<p>With this setup, your Ubuntu NFS server should be ready to serve media files over the network. Adjust IP addresses, permissions, and firewall rules based on your security and network requirements.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
