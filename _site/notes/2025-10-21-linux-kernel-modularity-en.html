<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Linux Kernel Modularity Explained</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Linux Kernel Modularity Explained | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Linux Kernel Modularity Explained" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-10-21-linux-kernel-modularity-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-10-21-linux-kernel-modularity-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Linux Kernel Modularity Explained" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Linux Kernel Modularity Explained","url":"https://lzwjava.github.io/notes/2025-10-21-linux-kernel-modularity-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=f6baf247c54f974dca0737a3862ae8612e3e7bef">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=f6baf247c54f974dca0737a3862ae8612e3e7bef" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Linux Kernel Modularity Explained | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-10-21-linux-kernel-modularity-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-10-21-linux-kernel-modularity-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/linux-kernel-modularity-en" selected>English</option>
        <option value="/linux-kernel-modularity-zh" >中文</option>
        <option value="/linux-kernel-modularity-ja" >日本語</option>
        <option value="/linux-kernel-modularity-es" >Español</option>
        <option value="/linux-kernel-modularity-hi" >हिंदी</option>
        <option value="/linux-kernel-modularity-fr" >Français</option>
        <option value="/linux-kernel-modularity-de" >Deutsch</option>
        <option value="/linux-kernel-modularity-ar" >العربية</option>
        <option value="/linux-kernel-modularity-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="understanding-modularity-in-linux">Understanding Modularity in Linux</h3>

<p>Modularity in Linux primarily refers to the design of the Linux kernel, which is fundamentally <strong>monolithic</strong> (all core components run in a single address space for efficiency) but achieves modularity through <strong>loadable kernel modules (LKMs)</strong>. This allows you to dynamically add or remove kernel features—like device drivers, filesystems, or network protocols—at runtime without rebooting or recompiling the entire kernel. It’s a hybrid approach that balances performance with flexibility, making Linux highly adaptable for different hardware and use cases.</p>

<p>Think of it like LEGO blocks: The kernel is the base structure, but you can snap on (load) or remove (unload) pieces as needed, keeping the system lean and customizable. Most device drivers in Linux are implemented this way, which is why Linux can support vast hardware ecosystems without bloating the core kernel.</p>

<h4 id="why-modularity-matters">Why Modularity Matters</h4>
<ul>
  <li><strong>Flexibility</strong>: Load only what’s needed (e.g., a Wi-Fi driver when connecting to a network).</li>
  <li><strong>Efficiency</strong>: Reduces memory footprint by avoiding permanent inclusion of unused code.</li>
  <li><strong>Maintainability</strong>: Easier to update or debug individual components without touching the whole system.</li>
  <li><strong>Stability</strong>: Faults in one module are somewhat isolated, though not as strictly as in microkernels (like those in MINIX).</li>
</ul>

<p>This design has helped Linux endure for decades, as you mentioned in our earlier chat—it’s easier to evolve than a rigid monolith.</p>

<h4 id="how-kernel-modules-work">How Kernel Modules Work</h4>
<p>Kernel modules are compiled object files (<code class="language-plaintext highlighter-rouge">.ko</code> extension) written in C, using kernel headers and the kbuild system. They must match your kernel version (check with <code class="language-plaintext highlighter-rouge">uname -r</code>).</p>

<p>A basic module includes:</p>
<ul>
  <li><strong>Initialization</strong>: A function marked with <code class="language-plaintext highlighter-rouge">module_init()</code> that runs on load (e.g., registering a driver).</li>
  <li><strong>Cleanup</strong>: A function marked with <code class="language-plaintext highlighter-rouge">module_exit()</code> that runs on unload (e.g., freeing resources).</li>
  <li>Metadata: Macros like <code class="language-plaintext highlighter-rouge">MODULE_LICENSE("GPL")</code> for licensing and authorship.</li>
</ul>

<p>Here’s a simple example module (<code class="language-plaintext highlighter-rouge">hello.c</code>) that prints messages:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;linux/kernel.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">"A simple hello module"</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">"You"</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">"GPL"</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">hello_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">"Hello, Linux modularity!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// Success</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">hello_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">"Goodbye from the module!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">hello_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">hello_exit</span><span class="p">);</span>
</code></pre></div></div>

<p>To compile it (requires kernel headers installed, e.g., via <code class="language-plaintext highlighter-rouge">apt install linux-headers-$(uname -r)</code> on Debian-based systems):</p>
<ul>
  <li>Create a <code class="language-plaintext highlighter-rouge">Makefile</code>:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>obj-m += hello.o
KDIR := /lib/modules/$(shell uname -r)/build
all:
    make -C $(KDIR) M=$(PWD) modules
clean:
    make -C $(KDIR) M=$(PWD) clean
</code></pre></div>    </div>
  </li>
  <li>Run <code class="language-plaintext highlighter-rouge">make</code> to generate <code class="language-plaintext highlighter-rouge">hello.ko</code>.</li>
  <li>Load with <code class="language-plaintext highlighter-rouge">sudo insmod hello.ko</code> (or <code class="language-plaintext highlighter-rouge">sudo modprobe hello</code> for dependency handling).</li>
  <li>Check logs: <code class="language-plaintext highlighter-rouge">dmesg | tail</code> (you’ll see the “Hello” message).</li>
  <li>Unload: <code class="language-plaintext highlighter-rouge">sudo rmmod hello</code> (see “Goodbye” in <code class="language-plaintext highlighter-rouge">dmesg</code>).</li>
</ul>

<p>Messages from <code class="language-plaintext highlighter-rouge">printk</code> go to the kernel ring buffer (<code class="language-plaintext highlighter-rouge">dmesg</code>) or <code class="language-plaintext highlighter-rouge">/var/log/kern.log</code>.</p>

<h4 id="managing-modules-in-practice">Managing Modules in Practice</h4>
<p>Use these commands (from the <code class="language-plaintext highlighter-rouge">kmod</code> package; install if needed: <code class="language-plaintext highlighter-rouge">sudo yum install kmod</code> on RHEL or <code class="language-plaintext highlighter-rouge">sudo apt install kmod</code> on Ubuntu).</p>

<table>
  <thead>
    <tr>
      <th>Action</th>
      <th>Command</th>
      <th>Description/Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>List loaded modules</strong></td>
      <td><code class="language-plaintext highlighter-rouge">lsmod</code></td>
      <td>Shows name, size, usage count, and dependencies.<br />Example: <code class="language-plaintext highlighter-rouge">lsmod \| grep bluetooth</code> (filters for Bluetooth modules).</td>
    </tr>
    <tr>
      <td><strong>Module info</strong></td>
      <td><code class="language-plaintext highlighter-rouge">modinfo &lt;name&gt;</code></td>
      <td>Details like version, description.<br />Example: <code class="language-plaintext highlighter-rouge">modinfo e1000e</code> (for Intel network driver).</td>
    </tr>
    <tr>
      <td><strong>Load module</strong></td>
      <td><code class="language-plaintext highlighter-rouge">sudo modprobe &lt;name&gt;</code></td>
      <td>Loads with dependencies (preferred over <code class="language-plaintext highlighter-rouge">insmod</code>, which needs full path).<br />Example: <code class="language-plaintext highlighter-rouge">sudo modprobe serio_raw</code> (raw serial input).</td>
    </tr>
    <tr>
      <td><strong>Unload module</strong></td>
      <td><code class="language-plaintext highlighter-rouge">sudo modprobe -r &lt;name&gt;</code></td>
      <td>Unloads with dependencies (unload dependents first if needed).<br />Example: <code class="language-plaintext highlighter-rouge">sudo modprobe -r serio_raw</code>. Check usage with <code class="language-plaintext highlighter-rouge">lsmod</code>.</td>
    </tr>
    <tr>
      <td><strong>Auto-generate deps</strong></td>
      <td><code class="language-plaintext highlighter-rouge">sudo depmod -a</code></td>
      <td>Updates <code class="language-plaintext highlighter-rouge">/lib/modules/$(uname -r)/modules.dep</code> for modprobe.</td>
    </tr>
  </tbody>
</table>

<p>Modules live in <code class="language-plaintext highlighter-rouge">/lib/modules/$(uname -r)/kernel/</code>. Avoid unloading in-use modules (e.g., active drivers) to prevent crashes.</p>

<h4 id="making-modules-persistent">Making Modules Persistent</h4>
<p>Changes aren’t permanent across reboots:</p>
<ul>
  <li><strong>Load at boot</strong>: Add to <code class="language-plaintext highlighter-rouge">/etc/modules-load.d/myfile.conf</code> (one module per line).<br />Example: <code class="language-plaintext highlighter-rouge">echo "hello" \| sudo tee /etc/modules-load.d/hello.conf</code>.</li>
  <li><strong>Blacklist (prevent loading)</strong>: Add to <code class="language-plaintext highlighter-rouge">/etc/modprobe.d/blacklist.conf</code>.<br />Example:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>blacklist bad_module
install bad_module /bin/false
</code></pre></div>    </div>
    <p>Then regenerate initramfs: <code class="language-plaintext highlighter-rouge">sudo dracut -f</code> and reboot.</p>
  </li>
</ul>

<h4 id="common-pitfalls-and-tips">Common Pitfalls and Tips</h4>
<ul>
  <li><strong>Version mismatch</strong>: Modules must match your kernel—recompile after updates.</li>
  <li><strong>Dependencies</strong>: <code class="language-plaintext highlighter-rouge">modprobe</code> handles them; check with <code class="language-plaintext highlighter-rouge">modinfo --depends &lt;name&gt;</code>.</li>
  <li><strong>Debugging</strong>: Use <code class="language-plaintext highlighter-rouge">pr_debug</code> for verbose logs (enable with <code class="language-plaintext highlighter-rouge">echo 8 &gt; /proc/sys/kernel/printk</code>).</li>
  <li>Start experimenting in a VM to avoid bricking your system.</li>
</ul>

<p>This setup is why Linux feels “modular” in practice—it’s not a full microkernel, but the module system mimics one for extensibility. For hands-on, try loading a real driver like <code class="language-plaintext highlighter-rouge">vfat</code> for FAT filesystems.</p>

<p><a href="https://linux-kernel-labs.github.io/refs/heads/master/labs/kernel_modules.html">KERNEL Modules Lab Documentation</a><br />
<a href="https://medium.com/@arashjafariwork/understanding-kernel-modules-enhancing-flexibility-in-operating-systems-ed348807ed7b">Understanding Kernel Modules on Medium</a><br />
<a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/kernel_administration_guide/chap-documentation-kernel_administration_guide-working_with_kernel_modules">Red Hat Kernel Administration Guide</a></p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    
      <p class="model">x-ai/grok-4-fast</p>
    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
