<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>GitHub OAuth Device Code Flow</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>GitHub OAuth Device Code Flow | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="GitHub OAuth Device Code Flow" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-05-03-github-oauth-device-code-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-05-03-github-oauth-device-code-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="GitHub OAuth Device Code Flow" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"GitHub OAuth Device Code Flow","url":"https://lzwjava.github.io/notes/2025-05-03-github-oauth-device-code-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=e3f8a3b2822a869ea18d55684a5843a037662ef9">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=e3f8a3b2822a869ea18d55684a5843a037662ef9" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       GitHub OAuth Device Code Flow | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-05-03-github-oauth-device-code-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-05-03-github-oauth-device-code-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/github-oauth-device-code-en" selected>English</option>
        <option value="/github-oauth-device-code-zh" >中文</option>
        <option value="/github-oauth-device-code-ja" >日本語</option>
        <option value="/github-oauth-device-code-es" >Español</option>
        <option value="/github-oauth-device-code-hi" >हिंदी</option>
        <option value="/github-oauth-device-code-fr" >Français</option>
        <option value="/github-oauth-device-code-de" >Deutsch</option>
        <option value="/github-oauth-device-code-ar" >العربية</option>
        <option value="/github-oauth-device-code-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="overview">Overview</h3>

<p>This JavaScript code implements the OAuth 2.0 Device Authorization Grant flow (also known as the Device Code grant) to authenticate with GitHub and obtain an access token. The flow is typically used for headless applications (e.g., CLI tools or embedded systems) where the user can’t interact directly with a web browser to approve the authentication.</p>

<p>In this specific case, it appears to be mimicking requests from the GitHub Copilot plugin (e.g., for Neovim or Vim), using headers that spoof a Copilot client to potentially integrate with or access GitHub’s authentication system. The goal is to generate an access token that could be used for GitHub API calls requiring user authentication, such as reading user info (per the <code class="language-plaintext highlighter-rouge">scope: "read:user"</code>).</p>

<p>The code runs as a Node.js script, using <code class="language-plaintext highlighter-rouge">fetch</code> for HTTP requests and <code class="language-plaintext highlighter-rouge">process</code> for environment variables. It assumes Node.js has <code class="language-plaintext highlighter-rouge">fetch</code> available (as in newer versions or via a polyfill). If successful, it polls GitHub’s servers until the user authorizes the request or it times out.</p>

<p><strong>Important Notes:</strong></p>
<ul>
  <li>This code requires setting an environment variable <code class="language-plaintext highlighter-rouge">MY_COPILOT_CLIENT_ID</code>, likely a GitHub OAuth App client ID registered for GitHub Copilot.</li>
  <li>It handles errors minimally—e.g., if fetching fails, it logs and continues or exits.</li>
  <li>Security-wise, storing or logging access tokens is risky (they grant API access). This code prints the full token object directly to the console, which could be a privacy/security issue in real usage. Access tokens should be handled securely (e.g., stored encrypted and rotated).</li>
  <li>The flow involves user interaction: The user must visit a URL and enter a code on GitHub’s site to authorize.</li>
  <li>This isn’t “official” GitHub documentation code; it seems reverse-engineered from GitHub Copilot’s behavior. Use APIs responsibly and per GitHub’s terms of service.</li>
</ul>

<h3 id="step-by-step-breakdown">Step-by-Step Breakdown</h3>

<h4 id="1-environment-check">1. Environment Check</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">clientId</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MY_COPILOT_CLIENT_ID</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">clientId</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">MY_COPILOT_CLIENT_ID is not set</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>Retrieves the <code class="language-plaintext highlighter-rouge">MY_COPILOT_CLIENT_ID</code> from environment variables (e.g., set via <code class="language-plaintext highlighter-rouge">export MY_COPILOT_CLIENT_ID=your_client_id</code> in your shell).</li>
  <li>If not set, it logs an error and exits the script (process code 1 indicates failure).</li>
  <li>This client ID is from a registered GitHub OAuth App (needed for OAuth flows).</li>
</ul>

<h4 id="2-common-headers-setup">2. Common Headers Setup</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">commonHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">();</span>
<span class="nx">commonHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">accept</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">commonHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">editor-version</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Neovim/0.6.1</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">commonHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">editor-plugin-version</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">copilot.vim/1.16.0</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">commonHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">commonHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">user-agent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">GithubCopilot/1.155.0</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">commonHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">accept-encoding</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">gzip,deflate,b</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>
<ul>
  <li>Creates a <code class="language-plaintext highlighter-rouge">Headers</code> object with key-value pairs for HTTP requests.</li>
  <li>These headers make the requests look like they’re from the GitHub Copilot Vim plugin (version 1.16.0 for Neovim 0.6.1). This is likely to spoof the user-agent and mimic Copilot’s API calls, which might be required or helpful for GitHub to accept the requests.</li>
  <li><code class="language-plaintext highlighter-rouge">"accept": "application/json"</code>: Expects JSON responses.</li>
  <li><code class="language-plaintext highlighter-rouge">"content-type": "application/json"</code>: Sends JSON in request bodies.</li>
  <li><code class="language-plaintext highlighter-rouge">"accept-encoding"</code>: Allows gzip/deflate compression to save bandwidth.</li>
</ul>

<h4 id="3-getdevicecode-function">3. <code class="language-plaintext highlighter-rouge">getDeviceCode()</code> Function</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">getDeviceCode</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">client_id</span><span class="dl">"</span><span class="p">:</span> <span class="nx">clientId</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">scope</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">read:user</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">requestOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">commonHeaders</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">raw</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">https://github.com/login/device/code</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">requestOptions</span><span class="p">,</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li><strong>Purpose</strong>: Initiates the Device Code flow by requesting a device code from GitHub.</li>
  <li>Constructs a JSON payload with:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">client_id</code>: The OAuth client ID (for authentication of your app).</li>
      <li><code class="language-plaintext highlighter-rouge">scope</code>: <code class="language-plaintext highlighter-rouge">"read:user"</code>—limits the token to read basic user profile info (e.g., username, email via GitHub API). This is a minimal scope.</li>
    </ul>
  </li>
  <li>Makes a POST request to <code class="language-plaintext highlighter-rouge">https://github.com/login/device/code</code> (GitHub’s OAuth device code endpoint).</li>
  <li>Parses the JSON response (expected fields: <code class="language-plaintext highlighter-rouge">device_code</code>, <code class="language-plaintext highlighter-rouge">user_code</code>, <code class="language-plaintext highlighter-rouge">verification_uri</code>, <code class="language-plaintext highlighter-rouge">expires_in</code>—not shown in code, but standard for this flow).</li>
  <li>On error (e.g., network issues), logs it but continues (could return <code class="language-plaintext highlighter-rouge">undefined</code>).</li>
  <li>Returns the parsed JSON data object from GitHub.</li>
</ul>

<h4 id="4-getaccesstokendevicecode-string-function">4. <code class="language-plaintext highlighter-rouge">getAccessToken(deviceCode: string)</code> Function</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">getAccessToken</span><span class="p">(</span><span class="nx">deviceCode</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">client_id</span><span class="dl">"</span><span class="p">:</span> <span class="nx">clientId</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">device_code</span><span class="dl">"</span><span class="p">:</span> <span class="nx">deviceCode</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">grant_type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">urn:ietf:params:oauth:grant-type:device_code</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="kd">const</span> <span class="nx">requestOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="nx">commonHeaders</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">raw</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">https://github.com/login/oauth/access_token</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">requestOptions</span><span class="p">,</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li><strong>Purpose</strong>: Polls GitHub to exchange the device code for an access token once the user authorizes it.</li>
  <li>Takes the <code class="language-plaintext highlighter-rouge">device_code</code> from the previous step.</li>
  <li>Constructs JSON with:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">client_id</code>: Same as before.</li>
      <li><code class="language-plaintext highlighter-rouge">device_code</code>: The unique code identifying this device/auth attempt.</li>
      <li><code class="language-plaintext highlighter-rouge">grant_type</code>: Specifies this is a Device Code grant (standard OAuth2 URN).</li>
    </ul>
  </li>
  <li>Makes a POST request to <code class="language-plaintext highlighter-rouge">https://github.com/login/oauth/access_token</code>.</li>
  <li>Returns the parsed JSON response, which could be:
    <ul>
      <li>On success: <code class="language-plaintext highlighter-rouge">{ access_token: "...", token_type: "bearer", scope: "read:user" }</code>.</li>
      <li>On pending/error: <code class="language-plaintext highlighter-rouge">{ error: "...", error_description: "..." }</code> (e.g., “authorization_pending” or “slow_down”).</li>
    </ul>
  </li>
  <li>Errors (e.g., fetch failures) are logged but not explicitly handled, so the caller must check the return value.</li>
</ul>

<h4 id="5-main-execution-immediately-invoked-async-function">5. Main Execution (Immediately Invoked Async Function)</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">device_code</span><span class="p">,</span> <span class="nx">user_code</span><span class="p">,</span> <span class="nx">verification_uri</span><span class="p">,</span> <span class="nx">expires_in</span> <span class="p">}</span> <span class="o">=</span>
    <span class="k">await</span> <span class="nx">getDeviceCode</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`enter user code:\n</span><span class="p">${</span><span class="nx">user_code</span><span class="p">}</span><span class="s2">\n</span><span class="p">${</span><span class="nx">verification_uri</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`Expires in </span><span class="p">${</span><span class="nx">expires_in</span><span class="p">}</span><span class="s2"> seconds`</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">await</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">5000</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">accessToken</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getAccessToken</span><span class="p">(</span><span class="nx">device_code</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">accessToken</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">accessToken</span><span class="p">.</span><span class="nx">error_description</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">accessToken</span><span class="p">.</span><span class="nx">access_token</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`access token:\n</span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">accessToken</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span>
</code></pre></div></div>
<ul>
  <li><strong>Overall Flow</strong>: Orchestrates the full OAuth 2.0 Device Code grant.</li>
  <li>Calls <code class="language-plaintext highlighter-rouge">getDeviceCode()</code> and destructures the response into variables (assumes it succeeds and has these properties).</li>
  <li>Logs instructions for the user:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">user_code</code>: A short alphanumeric code (e.g., “ABCD-EFGH”).</li>
      <li><code class="language-plaintext highlighter-rouge">verification_uri</code>: Usually <code class="language-plaintext highlighter-rouge">https://github.com/login/device</code>, where the user authenticates.</li>
      <li><code class="language-plaintext highlighter-rouge">expires_in</code>: Time in seconds until the code expires (e.g., 900 for 15 minutes).</li>
    </ul>
  </li>
  <li>The user must visit the URL, sign in to GitHub, and enter the user code to authorize the app.</li>
  <li>Enters an infinite loop to poll for the token:
    <ul>
      <li>Waits 5 seconds between attempts (polling interval; GitHub recommends slow_down for too-frequent requests).</li>
      <li>Calls <code class="language-plaintext highlighter-rouge">getAccessToken(device_code)</code>.</li>
      <li>If the response has an <code class="language-plaintext highlighter-rouge">error</code>: Logs it (e.g., keep waiting if “authorization_pending”).</li>
      <li>If it has <code class="language-plaintext highlighter-rouge">access_token</code>: Logs the full token object (formatted with indentation) and exits the loop.</li>
    </ul>
  </li>
  <li><strong>Edge Cases/Issues</strong>:
    <ul>
      <li>If <code class="language-plaintext highlighter-rouge">getDeviceCode()</code> fails, destructuring might error (code doesn’t check for this).</li>
      <li>No loop timeout—keeps polling indefinitely unless the access token is received or the script crashes.</li>
      <li>Logging the access token to console exposes it; in production, you’d save it securely (e.g., to a file or database).</li>
    </ul>
  </li>
</ul>

<h3 id="how-it-works-end-to-end">How It Works End-to-End</h3>
<ol>
  <li><strong>Step 1: Request Device Code</strong> → Script gets a temporary code from GitHub.</li>
  <li><strong>Step 2: User Authorization</strong> → User visits GitHub and enters the code to grant permission.</li>
  <li><strong>Step 3: Poll for Token</strong> → Script keeps asking GitHub until the token is issued.</li>
  <li><strong>Result</strong>: An access token for the specified scope (e.g., read user data via GitHub API).</li>
</ol>

<p>This is a simulation of how tools like GitHub CLI might work, adapted for Copilot. For official GitHub OAuth docs, refer to https://docs.github.com/en/developers/apps/building-oauth-apps/authorizing-oauth-apps#device-flow. If you’re building something similar, ensure compliance with OAuth standards and GitHub’s policies. If you have questions about modifying or running this, let me know!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    
      <p class="model">x-ai/grok-code-fast-1</p>
    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
