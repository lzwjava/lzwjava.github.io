<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Avoiding Docker Daemon Proxy Loops</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Avoiding Docker Daemon Proxy Loops | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Avoiding Docker Daemon Proxy Loops" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-10-04-docker-proxy-loops-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-10-04-docker-proxy-loops-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Avoiding Docker Daemon Proxy Loops" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Avoiding Docker Daemon Proxy Loops","url":"https://lzwjava.github.io/notes/2025-10-04-docker-proxy-loops-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=6d4d9b1160a90f16b87b2fdeb6fa9c55d4725a21">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=6d4d9b1160a90f16b87b2fdeb6fa9c55d4725a21" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Avoiding Docker Daemon Proxy Loops | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-10-04-docker-proxy-loops-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-10-04-docker-proxy-loops-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/docker-proxy-loops-en" selected>English</option>
        <option value="/docker-proxy-loops-zh" >中文</option>
        <option value="/docker-proxy-loops-ja" >日本語</option>
        <option value="/docker-proxy-loops-es" >Español</option>
        <option value="/docker-proxy-loops-hi" >हिंदी</option>
        <option value="/docker-proxy-loops-fr" >Français</option>
        <option value="/docker-proxy-loops-de" >Deutsch</option>
        <option value="/docker-proxy-loops-ar" >العربية</option>
        <option value="/docker-proxy-loops-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="why-no-proxy-localhost127001local-is-crucial-in-dockers-daemonjson">Why <code class="language-plaintext highlighter-rouge">"no-proxy": "localhost,127.0.0.1,.local"</code> is Crucial in Docker’s <code class="language-plaintext highlighter-rouge">daemon.json</code></h3>

<p>When you configure Docker’s daemon with proxy settings like <code class="language-plaintext highlighter-rouge">"http-proxy": "http://localhost:7890"</code> (common for tools like Clash running locally), the daemon applies these rules to <strong>all</strong> outgoing network traffic by default. This includes connections to external registries (e.g., <code class="language-plaintext highlighter-rouge">registry-1.docker.io</code> for pulling images like <code class="language-plaintext highlighter-rouge">hello-world</code>).</p>

<p>However, without the <code class="language-plaintext highlighter-rouge">no-proxy</code> directive, Docker daemon also tries to route <strong>local connections</strong>—such as the initial TCP handshake to your proxy server itself at <code class="language-plaintext highlighter-rouge">localhost:7890</code>—through the same proxy. This creates a classic <strong>proxy loop</strong>:</p>

<ol>
  <li>Docker needs to fetch an image from <code class="language-plaintext highlighter-rouge">registry-1.docker.io</code>.</li>
  <li>It attempts to connect via the proxy at <code class="language-plaintext highlighter-rouge">localhost:7890</code>.</li>
  <li>But to reach <code class="language-plaintext highlighter-rouge">localhost:7890</code>, the proxy settings kick in again, forcing Docker to… connect via the proxy at <code class="language-plaintext highlighter-rouge">localhost:7890</code>.</li>
  <li>This infinite recursion fails at the TCP level because the proxy can’t proxy a connection to itself (it leads to a self-referential loop with no resolution).</li>
  <li>The connection aborts unexpectedly, resulting in the <code class="language-plaintext highlighter-rouge">proxyconnect tcp: EOF</code> error (EOF means “end of file,” signaling a premature closure during the proxy negotiation/handshake).</li>
</ol>

<p>Adding <code class="language-plaintext highlighter-rouge">"no-proxy": "localhost,127.0.0.1,.local"</code> explicitly tells the daemon to <strong>bypass the proxy</strong> for traffic destined to:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">localhost</code> (your machine’s loopback hostname),</li>
  <li><code class="language-plaintext highlighter-rouge">127.0.0.1</code> (IPv4 loopback address),</li>
  <li><code class="language-plaintext highlighter-rouge">.local</code> domains (common for mDNS/local network resolution).</li>
</ul>

<p>This allows Docker to connect <strong>directly</strong> to the proxy server on localhost without looping through itself. Once connected, the proxy can then handle the external request to the Docker registry properly (e.g., via HTTP CONNECT for HTTPS traffic).</p>

<p>In short: It prevents the daemon from “proxying the proxy,” ensuring local proxy access works while still routing internet-bound traffic (like image pulls) through it.</p>

<p>If your setup involves other local services (e.g., internal registries or containers communicating locally), extending <code class="language-plaintext highlighter-rouge">no-proxy</code> with those domains/IPs can prevent similar issues.</p>

<p><a href="https://docs.docker.com/engine/daemon/proxy/">Docker Daemon Proxy Configuration</a><br />
<a href="https://forums.docker.com/t/proxy-settings-for-the-docker-daemon/132089">Docker Proxy Settings Forum Discussion</a><br />
<a href="https://www.datacamp.com/tutorial/docker-proxy">Docker Proxy Guide for Corporate Firewalls</a></p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    
      <p class="model">x-ai/grok-4-fast</p>
    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
