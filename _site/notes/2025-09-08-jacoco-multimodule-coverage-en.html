<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>JaCoCo Multi-Module Coverage Reporting Strategy</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>JaCoCo Multi-Module Coverage Reporting Strategy | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="JaCoCo Multi-Module Coverage Reporting Strategy" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-09-08-jacoco-multimodule-coverage-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-09-08-jacoco-multimodule-coverage-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-08T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="JaCoCo Multi-Module Coverage Reporting Strategy" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2025-09-08T00:00:00+08:00","datePublished":"2025-09-08T00:00:00+08:00","description":"李智维","headline":"JaCoCo Multi-Module Coverage Reporting Strategy","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/notes/2025-09-08-jacoco-multimodule-coverage-en"},"url":"https://lzwjava.github.io/notes/2025-09-08-jacoco-multimodule-coverage-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=9e347f3d5cf7fea6b22da80e13c2ebb0a54f87d3">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=9e347f3d5cf7fea6b22da80e13c2ebb0a54f87d3" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       JaCoCo Multi-Module Coverage Reporting Strategy | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-09-08-jacoco-multimodule-coverage-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-09-08-jacoco-multimodule-coverage-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.09</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/jacoco-multimodule-coverage-en" selected>English</option>
        <option value="/jacoco-multimodule-coverage-zh" >中文</option>
        <option value="/jacoco-multimodule-coverage-ja" >日本語</option>
        <option value="/jacoco-multimodule-coverage-es" >Español</option>
        <option value="/jacoco-multimodule-coverage-hi" >हिंदी</option>
        <option value="/jacoco-multimodule-coverage-fr" >Français</option>
        <option value="/jacoco-multimodule-coverage-de" >Deutsch</option>
        <option value="/jacoco-multimodule-coverage-ar" >العربية</option>
        <option value="/jacoco-multimodule-coverage-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Of course. Your analysis is spot on, especially regarding the complexities of JaCoCo with external integration tests. Running the build twice is definitely not ideal.</p>

<p>The strategy you’re looking for involves centralizing the test execution and then aggregating the results. You’re very close, and the <code class="language-plaintext highlighter-rouge">aggregate</code> goal is indeed the right tool, but it needs to be applied in a specific way for this scenario.</p>

<p>Here’s the recommended strategy: <strong>Generate one coverage file (<code class="language-plaintext highlighter-rouge">.exec</code>) in your web application module, and then use a separate, dedicated reporting module to create a single, aggregated report for all relevant modules.</strong></p>

<p>This approach is clean, scalable, and avoids redundant builds.</p>

<hr />

<h2 id="the-core-concept">The Core Concept</h2>

<p>When your <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> application runs on Jetty with the JaCoCo agent, the agent instruments <strong>all classes loaded by the application’s classloader</strong>. This includes classes from <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> itself <em>and</em> all its dependencies, like <code class="language-plaintext highlighter-rouge">PlaygroundUtils.jar</code>.</p>

<p>Therefore, the single <code class="language-plaintext highlighter-rouge">jacoco-it.exec</code> file generated during the <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> build already contains the coverage data for <strong>both modules</strong>. The challenge is simply to point the JaCoCo reporting tool to the source code of all the modules it needs to build the final HTML report.</p>

<hr />

<h2 id="a-scalable-strategy-in-4-steps">A Scalable Strategy in 4 Steps</h2>

<p>Here is a step-by-step guide to refactor your project for clean, aggregated coverage reporting.</p>

<h3 id="step-1-create-a-dedicated-reporting-module">Step 1: Create a Dedicated Reporting Module</h3>

<p>First, create a new module exclusively for aggregation. This is a Maven best practice that keeps concerns separate.</p>

<ol>
  <li>In your root <code class="language-plaintext highlighter-rouge">pom.xml</code> (<code class="language-plaintext highlighter-rouge">PlaygroundLib</code>), add the new module:
    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;modules&gt;</span>
    <span class="nt">&lt;module&gt;</span>PlaygroundUtils<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;module&gt;</span>PlaygroundWeb<span class="nt">&lt;/module&gt;</span>
    <span class="nt">&lt;module&gt;</span>PlaygroundReports<span class="nt">&lt;/module&gt;</span> <span class="nt">&lt;/modules&gt;</span>
</code></pre></div>    </div>
  </li>
  <li>Create a new directory <code class="language-plaintext highlighter-rouge">PlaygroundReports</code> at the root with its own <code class="language-plaintext highlighter-rouge">pom.xml</code>.</li>
</ol>

<p>Your new project structure will look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── PlaygroundReports
│   └── pom.xml
├── PlaygroundUtils
│   └── pom.xml
├── PlaygroundWeb
│   └── pom.xml
└── pom.xml
</code></pre></div></div>

<h3 id="step-2-configure-the-reporting-modules-pomxml">Step 2: Configure the Reporting Module’s <code class="language-plaintext highlighter-rouge">pom.xml</code></h3>

<p>This new <code class="language-plaintext highlighter-rouge">pom.xml</code> is where the magic happens. It will depend on all the modules you want in the report and will run the <code class="language-plaintext highlighter-rouge">report-aggregate</code> goal.</p>

<p><strong><code class="language-plaintext highlighter-rouge">PlaygroundReports/pom.xml</code>:</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.lzw<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>PlaygroundLib<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>PlaygroundReports<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;name&gt;</span>PlaygroundReports<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.lzw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>PlaygroundWeb<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.lzw<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>PlaygroundUtils<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.jacoco<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>jacoco-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>aggregate-report<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;phase&gt;</span>verify<span class="nt">&lt;/phase&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>report-aggregate<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                        <span class="nt">&lt;configuration&gt;</span>
                            <span class="nt">&lt;dataFiles&gt;</span>
                                <span class="nt">&lt;dataFile&gt;</span>${project.basedir}/../PlaygroundWeb/target/jacoco-it.exec<span class="nt">&lt;/dataFile&gt;</span>
                            <span class="nt">&lt;/dataFiles&gt;</span>
                            <span class="nt">&lt;outputDirectory&gt;</span>${project.reporting.outputDirectory}/jacoco-aggregate<span class="nt">&lt;/outputDirectory&gt;</span>
                        <span class="nt">&lt;/configuration&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<h3 id="step-3-simplify-the-playgroundweb-module">Step 3: Simplify the <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> Module</h3>

<p>Your <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> module is now only responsible for <strong>generating the coverage data</strong>, not for reporting on it. You can remove the <code class="language-plaintext highlighter-rouge">jacoco:report</code> execution from its <code class="language-plaintext highlighter-rouge">pom.xml</code>.</p>

<p><strong><code class="language-plaintext highlighter-rouge">PlaygroundWeb/pom.xml</code> (changes only):</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jacoco<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jacoco-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>prepare-agent<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>prepare-agent<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;propertyName&gt;</span>jacoco.it.agent<span class="nt">&lt;/propertyName&gt;</span>
                <span class="nt">&lt;destFile&gt;</span>${project.build.directory}/jacoco-it.exec<span class="nt">&lt;/destFile&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>

<span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.eclipse.jetty<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jetty-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>start-jetty<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>pre-integration-test<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>start<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;daemon&gt;</span>true<span class="nt">&lt;/daemon&gt;</span>
                <span class="nt">&lt;jvmArgs&gt;</span>
                    ${jacoco.it.agent}
                <span class="nt">&lt;/jvmArgs&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></div>

<p><em>Note</em>: I’ve slightly modified the <code class="language-plaintext highlighter-rouge">prepare-agent</code> configuration to use a property (<code class="language-plaintext highlighter-rouge">jacoco.it.agent</code>) and then reference that in the <code class="language-plaintext highlighter-rouge">jetty-maven-plugin</code>. This is a robust way to pass the agent string. The previous configuration in your <code class="language-plaintext highlighter-rouge">pom.xml</code> was also fine, but this makes the intent clearer.</p>

<h3 id="step-4-clean-up-playgroundutils">Step 4: Clean Up <code class="language-plaintext highlighter-rouge">PlaygroundUtils</code></h3>

<p>The <code class="language-plaintext highlighter-rouge">PlaygroundUtils</code> module needs no JaCoCo plugin configuration for integration tests. Its code is covered via <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code>, and the reporting is handled by <code class="language-plaintext highlighter-rouge">PlaygroundReports</code>. You can remove any JaCoCo-related properties or plugins from its <code class="language-plaintext highlighter-rouge">pom.xml</code>.</p>

<hr />

<h2 id="how-this-solves-the-problem">How This Solves the Problem</h2>

<ol>
  <li><strong>Single Build:</strong> You run <code class="language-plaintext highlighter-rouge">mvn clean verify</code> from the root directory just once.</li>
  <li><strong>Correct Lifecycle:</strong>
    <ul>
      <li>Maven builds <code class="language-plaintext highlighter-rouge">PlaygroundUtils</code>.</li>
      <li>Maven builds <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code>, starts Jetty with the JaCoCo agent, runs your Python tests (which hit code in both modules), stops Jetty, and produces <code class="language-plaintext highlighter-rouge">PlaygroundWeb/target/jacoco-it.exec</code>.</li>
      <li>Maven builds <code class="language-plaintext highlighter-rouge">PlaygroundReports</code>. In the <code class="language-plaintext highlighter-rouge">verify</code> phase, the <code class="language-plaintext highlighter-rouge">report-aggregate</code> goal runs. It finds the <code class="language-plaintext highlighter-rouge">.exec</code> file from <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> and, because of the dependencies, it knows where to find the source code for both <code class="language-plaintext highlighter-rouge">PlaygroundWeb</code> and <code class="language-plaintext highlighter-rouge">PlaygroundUtils</code>.</li>
      <li>It generates a <strong>single, unified HTML report</strong> with coverage for both modules.</li>
    </ul>
  </li>
  <li><strong>Scalability:</strong> If you add ten more library modules, you just add them as dependencies to the <code class="language-plaintext highlighter-rouge">PlaygroundReports/pom.xml</code>. The core logic doesn’t change. This is the clean, scalable solution you were looking for.</li>
</ol>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
