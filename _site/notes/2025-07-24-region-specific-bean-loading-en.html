<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Dynamic Region-Specific Beans</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Dynamic Region-Specific Beans | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Dynamic Region-Specific Beans" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-07-24-region-specific-bean-loading-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-07-24-region-specific-bean-loading-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Dynamic Region-Specific Beans" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Dynamic Region-Specific Beans","url":"https://lzwjava.github.io/notes/2025-07-24-region-specific-bean-loading-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=6abe6a018eea3cef89c772d1cb9ad7fd80a750ed">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=6abe6a018eea3cef89c772d1cb9ad7fd80a750ed" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Dynamic Region-Specific Beans | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-07-24-region-specific-bean-loading-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-07-24-region-specific-bean-loading-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/region-specific-bean-loading-en" selected>English</option>
        <option value="/region-specific-bean-loading-zh" >中文</option>
        <option value="/region-specific-bean-loading-ja" >日本語</option>
        <option value="/region-specific-bean-loading-es" >Español</option>
        <option value="/region-specific-bean-loading-hi" >हिंदी</option>
        <option value="/region-specific-bean-loading-fr" >Français</option>
        <option value="/region-specific-bean-loading-de" >Deutsch</option>
        <option value="/region-specific-bean-loading-ar" >العربية</option>
        <option value="/region-specific-bean-loading-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="understanding-the-requirement">Understanding the Requirement</h3>

<p>It sounds like you’re building a Spring Boot/Java Spring application that needs to support multiple regions (or “nationalities”) such as Singapore (SG), Hong Kong (HK), and Taiwan (TW). You want to load or inject different beans dynamically, particularly for a <code class="language-plaintext highlighter-rouge">CoreController</code> class, using features like <code class="language-plaintext highlighter-rouge">@Autowired</code> and bean management.</p>

<p>This is a common scenario for <strong>multi-tenancy</strong> or <strong>region-specific configurations</strong>, where behavior (e.g., services, configurations, or controllers) varies by region. In Spring, you can’t easily switch entire controller classes at runtime, but you can:</p>

<ol>
  <li>Use <strong>Spring Profiles</strong> for environment-specific bean loading (e.g., separate deployments or activations for each region). This is compile-time or startup-time.</li>
  <li>Use <strong>runtime selection</strong> with the Strategy Pattern, where you inject multiple beans (e.g., via a Map) and select the right one based on a request parameter, header, or context (e.g., user’s region).</li>
</ol>

<p>Since you mentioned “multiple nationality development” and examples like SG/HK/TW, I’ll assume this needs to handle multiple regions in a single application instance (runtime switching). If it’s separate deployments per region, profiles are simpler.</p>

<p>I’ll explain both approaches with code examples. We’ll assume <code class="language-plaintext highlighter-rouge">CoreController</code> depends on a region-specific service (e.g., <code class="language-plaintext highlighter-rouge">CoreService</code> interface with implementations for each region). This way, the controller stays the same, but its behavior changes via injected beans.</p>

<h3 id="approach-1-using-spring-profiles-for-region-specific-bean-loading-startup-time">Approach 1: Using Spring Profiles for Region-Specific Bean Loading (Startup-Time)</h3>

<p>This is ideal if you deploy separate instances per region (e.g., via environment variables or application properties). Beans are loaded conditionally based on the active profile.</p>

<h4 id="step-1-define-the-interface-and-implementations">Step 1: Define the Interface and Implementations</h4>
<p>Create an interface for the region-specific logic:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Implementations for each region:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SgCoreService.java</span>
<span class="nd">@Service</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"sg"</span><span class="o">)</span>  <span class="c1">// Only load this bean if 'sg' profile is active</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SgCoreService</span> <span class="kd">implements</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Welcome from Singapore!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// HkCoreService.java</span>
<span class="nd">@Service</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"hk"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HkCoreService</span> <span class="kd">implements</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Welcome from Hong Kong!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// TwCoreService.java</span>
<span class="nd">@Service</span>
<span class="nd">@Profile</span><span class="o">(</span><span class="s">"tw"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwCoreService</span> <span class="kd">implements</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Welcome from Taiwan!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="step-2-autowire-in-corecontroller">Step 2: Autowire in CoreController</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoreController</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CoreService</span> <span class="n">coreService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">CoreController</span><span class="o">(</span><span class="nc">CoreService</span> <span class="n">coreService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">coreService</span> <span class="o">=</span> <span class="n">coreService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/message"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">coreService</span><span class="o">.</span><span class="na">getRegionMessage</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="step-3-activate-profiles">Step 3: Activate Profiles</h4>
<ul>
  <li>In <code class="language-plaintext highlighter-rouge">application.properties</code> or via command line:
    <ul>
      <li>Run with <code class="language-plaintext highlighter-rouge">--spring.profiles.active=sg</code> for Singapore beans.</li>
      <li>This ensures only the <code class="language-plaintext highlighter-rouge">SgCoreService</code> bean is created and autowired.</li>
    </ul>
  </li>
  <li>For custom conditions beyond profiles, use <code class="language-plaintext highlighter-rouge">@ConditionalOnProperty</code> (e.g., <code class="language-plaintext highlighter-rouge">@ConditionalOnProperty(name = "app.region", havingValue = "sg")</code>).</li>
</ul>

<p>This approach is simple but requires restarting or separate apps per region. Not suitable for handling all regions in one runtime instance.</p>

<h3 id="approach-2-runtime-bean-selection-with-autowired-map-strategy-pattern">Approach 2: Runtime Bean Selection with @Autowired Map (Strategy Pattern)</h3>

<p>For a single application handling multiple regions dynamically (e.g., based on HTTP request headers like <code class="language-plaintext highlighter-rouge">X-Region: sg</code>), use a Map of beans. Spring can autowire all implementations into a Map&lt;String, CoreService&gt;, where the key is the bean name.</p>

<h4 id="step-1-define-the-interface-and-implementations-1">Step 1: Define the Interface and Implementations</h4>
<p>Same as above, but without <code class="language-plaintext highlighter-rouge">@Profile</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// SgCoreService.java</span>
<span class="nd">@Service</span><span class="o">(</span><span class="s">"sgCoreService"</span><span class="o">)</span>  <span class="c1">// Explicit bean name for Map key</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SgCoreService</span> <span class="kd">implements</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Welcome from Singapore!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// HkCoreService.java</span>
<span class="nd">@Service</span><span class="o">(</span><span class="s">"hkCoreService"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HkCoreService</span> <span class="kd">implements</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Welcome from Hong Kong!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// TwCoreService.java</span>
<span class="nd">@Service</span><span class="o">(</span><span class="s">"twCoreService"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwCoreService</span> <span class="kd">implements</span> <span class="nc">CoreService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getRegionMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Welcome from Taiwan!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="step-2-autowire-a-map-in-corecontroller">Step 2: Autowire a Map in CoreController</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoreController</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">CoreService</span><span class="o">&gt;</span> <span class="n">coreServices</span><span class="o">;</span>

    <span class="nd">@Autowired</span>  <span class="c1">// Spring auto-populates the map with all CoreService beans, keyed by bean name</span>
    <span class="kd">public</span> <span class="nf">CoreController</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">CoreService</span><span class="o">&gt;</span> <span class="n">coreServices</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">coreServices</span> <span class="o">=</span> <span class="n">coreServices</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/message"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMessage</span><span class="o">(</span><span class="nd">@RequestHeader</span><span class="o">(</span><span class="s">"X-Region"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">region</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// Or use @RequestParam if it's a query param</span>
        <span class="nc">CoreService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">coreServices</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">region</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">()</span> <span class="o">+</span> <span class="s">"CoreService"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">service</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Unsupported region: "</span> <span class="o">+</span> <span class="n">region</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">getRegionMessage</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Here, <code class="language-plaintext highlighter-rouge">@Autowired</code> on the Map injects all <code class="language-plaintext highlighter-rouge">CoreService</code> implementations automatically.</li>
  <li>Bean names must match your key logic (e.g., “sgCoreService”).</li>
  <li>For selection: Use a request header/param to determine the region. This makes it dynamic per request.</li>
</ul>

<h4 id="optional-using-qualifier-for-specific-injection">Optional: Using @Qualifier for Specific Injection</h4>
<p>If you want to inject a specific bean manually:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoreController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"sgCoreService"</span><span class="o">)</span>  <span class="c1">// Injects only the SG bean</span>
    <span class="kd">private</span> <span class="nc">CoreService</span> <span class="n">sgCoreService</span><span class="o">;</span>

    <span class="c1">// ... similarly for others</span>
<span class="o">}</span>
</code></pre></div></div>
<p>But this isn’t dynamic; use the Map for runtime switching.</p>

<h4 id="step-3-configuration-and-best-practices">Step 3: Configuration and Best Practices</h4>
<ul>
  <li>In your Spring Boot main class: <code class="language-plaintext highlighter-rouge">@SpringBootApplication</code> is sufficient; Spring scans for <code class="language-plaintext highlighter-rouge">@Service</code> beans.</li>
  <li>Handle defaults: Add a fallback service if no region matches.</li>
  <li>For more complex conditions, use <code class="language-plaintext highlighter-rouge">@ConditionalOnExpression</code> or custom <code class="language-plaintext highlighter-rouge">@Conditional</code> annotations on beans.</li>
  <li>Thread safety: Since controllers are singleton by default, the Map is safe as long as services are stateless.</li>
  <li>Testing: Use <code class="language-plaintext highlighter-rouge">@SpringBootTest</code> with mock requests to test different regions.</li>
</ul>

<h3 id="which-approach-to-choose">Which Approach to Choose?</h3>
<ul>
  <li>Use <strong>Profiles</strong> if regions are separated by deployment/environment (e.g., different servers for SG/HK/TW).</li>
  <li>Use <strong>Map/Strategy</strong> for a unified app handling all regions at runtime (more flexible for microservices).</li>
</ul>

<p>If this doesn’t match your exact setup (e.g., if <code class="language-plaintext highlighter-rouge">CoreController</code> itself needs to be different per region), you could use multiple controllers with <code class="language-plaintext highlighter-rouge">@RequestMapping</code> conditions or a factory to create controllers dynamically—but that’s rarer and more complex.</p>

<p>If you provide more details (e.g., how the region is determined), I can refine this!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
