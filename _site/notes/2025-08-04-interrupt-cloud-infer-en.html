<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Interrupts Don't Cancel Cloud Inference</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Interrupts Don’t Cancel Cloud Inference | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Interrupts Don’t Cancel Cloud Inference" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-08-04-interrupt-cloud-infer-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-08-04-interrupt-cloud-infer-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Interrupts Don’t Cancel Cloud Inference" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Interrupts Don’t Cancel Cloud Inference","url":"https://lzwjava.github.io/notes/2025-08-04-interrupt-cloud-infer-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=e88d2591eb3e058e0107f1f1bf434db102619b18">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=e88d2591eb3e058e0107f1f1bf434db102619b18" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Interrupts Don't Cancel Cloud Inference | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-08-04-interrupt-cloud-infer-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-08-04-interrupt-cloud-infer-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.09</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/interrupt-cloud-infer-en" selected>English</option>
        <option value="/interrupt-cloud-infer-zh" >中文</option>
        <option value="/interrupt-cloud-infer-ja" >日本語</option>
        <option value="/interrupt-cloud-infer-es" >Español</option>
        <option value="/interrupt-cloud-infer-hi" >हिंदी</option>
        <option value="/interrupt-cloud-infer-fr" >Français</option>
        <option value="/interrupt-cloud-infer-de" >Deutsch</option>
        <option value="/interrupt-cloud-infer-ar" >العربية</option>
        <option value="/interrupt-cloud-infer-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>When you interrupt (e.g. with Ctrl-C) your Python script while it’s waiting on the <code class="language-plaintext highlighter-rouge">generate_images()</code> call, here’s roughly what happens:</p>

<ol>
  <li>
    <p><strong>Client-side behavior</strong>
– As soon as you kill the Python process, the underlying HTTP/gRPC connection is torn down.
– The GenAI client library will typically catch the broken pipe or connection‐reset and raise an exception (which you’ll see in your script).</p>
  </li>
  <li>
    <p><strong>What happens on Google’s side</strong>
– By the time you cancel, your request has already reached Google’s inference service and been enqueued (or already begun running).
– Most cloud inference endpoints do <strong>not</strong> automatically cancel work just because the client disappeared. They’ll continue running your image‐generation job to completion (consuming GPU/TPU and incurring billing), even though there’s no live connection to return the result.
– Once the job finishes, the generated image is discarded—there’s no callback to you unless you’ve set up a long-running operation or webhook.</p>
  </li>
  <li>
    <p><strong>How Nginx (or another proxy) factors in</strong>
– If there’s an Nginx reverse-proxy in front of the inference service, its default behavior is to watch the client connection. As soon as the client aborts, Nginx closes its upstream connection to the inference process (sending a FIN/RST).
– The upstream process then sees a broken socket when it eventually tries to write the response. At that point it may log an I/O error, but—crucially—it does <strong>not</strong> rewind and stop the computation you asked for; it simply can’t deliver the bytes.
– You can tweak Nginx’s <code class="language-plaintext highlighter-rouge">proxy_ignore_client_abort</code> directive—if you set it to <code class="language-plaintext highlighter-rouge">on</code>, Nginx will keep the upstream connection alive even after the client disconnects (which can let you fully finish writing logs or other cleanup).</p>
  </li>
  <li>
    <p><strong>Key takeaways for your script</strong></p>

    <ul>
      <li><strong>Interrupts don’t “undeploy”</strong> or cancel the model on Google’s servers—you’ll still be billed for the full inference.</li>
      <li>
        <p>If you need cancellable inference, you’d have to use a different pattern: for example,</p>

        <ol>
          <li>Submit a non-blocking batch or long-running operation,</li>
          <li>Poll its status or cancel it explicitly via a separate API call.</li>
        </ol>
      </li>
    </ul>
  </li>
</ol>

<p>So in short: killing your script at 5 s stops your local wait and closes the socket, but Google’s inference still runs to completion on their hardware (and Nginx or similar will simply drop the response back to nowhere once it’s ready).</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
