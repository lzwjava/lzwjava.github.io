<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>CuPy Error with Python 3.13</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>CuPy Error with Python 3.13 | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="CuPy Error with Python 3.13" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-06-29-python-313-issue-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-06-29-python-313-issue-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CuPy Error with Python 3.13" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"CuPy Error with Python 3.13","url":"https://lzwjava.github.io/notes/2025-06-29-python-313-issue-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=118fdf0ba15fd2035462674ad1a22500f3527f0d">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=118fdf0ba15fd2035462674ad1a22500f3527f0d" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       CuPy Error with Python 3.13 | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-06-29-python-313-issue-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-06-29-python-313-issue-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/python-313-issue-en" selected>English</option>
        <option value="/python-313-issue-zh" >中文</option>
        <option value="/python-313-issue-ja" >日本語</option>
        <option value="/python-313-issue-es" >Español</option>
        <option value="/python-313-issue-hi" >हिंदी</option>
        <option value="/python-313-issue-fr" >Français</option>
        <option value="/python-313-issue-de" >Deutsch</option>
        <option value="/python-313-issue-ar" >العربية</option>
        <option value="/python-313-issue-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="problem-description">Problem Description</h3>

<p>You’re encountering an <code class="language-plaintext highlighter-rouge">AttributeError</code> when running a Python script that imports the CuPy library for GPU computations. The error occurs during the <code class="language-plaintext highlighter-rouge">import cupy as cp</code> statement, preventing the script from executing. The traceback points to an issue within CuPy’s internal code, specifically in <code class="language-plaintext highlighter-rouge">cupy/cuda/device.pyx</code> at line 105, where a <code class="language-plaintext highlighter-rouge">memoize</code> decorator attempts to modify the <code class="language-plaintext highlighter-rouge">__name__</code> attribute of a built-in function or method. The error message is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AttributeError: attribute '__name__' of 'builtin_function_or_method' objects is not writable
</code></pre></div></div>

<p>This issue appears to be related to your use of Python 3.13, which may introduce compatibility problems with the version of CuPy you have installed.</p>

<h3 id="cause-of-the-error">Cause of the Error</h3>

<p>The error arises because:</p>

<ul>
  <li><strong>CuPy’s <code class="language-plaintext highlighter-rouge">memoize</code> Decorator</strong>: CuPy uses a <code class="language-plaintext highlighter-rouge">memoize</code> decorator to cache function results for performance optimization. This decorator relies on Python’s <code class="language-plaintext highlighter-rouge">functools.update_wrapper</code> to copy attributes (like <code class="language-plaintext highlighter-rouge">__name__</code>) from the original function to the wrapper function.</li>
  <li><strong>Built-in Functions</strong>: In Python, built-in functions (implemented in C) have a read-only <code class="language-plaintext highlighter-rouge">__name__</code> attribute. When <code class="language-plaintext highlighter-rouge">update_wrapper</code> tries to set this attribute, it fails with an <code class="language-plaintext highlighter-rouge">AttributeError</code>.</li>
  <li><strong>Python 3.13 Compatibility</strong>: The specific function being memoized in CuPy’s <code class="language-plaintext highlighter-rouge">device.pyx</code> is likely a built-in function, and Python 3.13 may enforce stricter rules or handle built-ins differently than previous versions, exposing this issue.</li>
</ul>

<p>Since the error occurs during the import of CuPy, it’s a systemic issue tied to the library’s initialization rather than your script’s logic.</p>

<h3 id="recommended-solution">Recommended Solution</h3>

<p>The simplest and most practical fix is to run your script with an earlier version of Python where CuPy is known to be compatible, such as Python 3.11 or 3.12. This avoids the compatibility issue with Python 3.13 without requiring modifications to CuPy’s source code or complex workarounds.</p>

<h4 id="why-this-works">Why This Works</h4>

<ul>
  <li><strong>Compatibility</strong>: CuPy versions up to the latest releases (e.g., v11) are tested and supported on Python versions like 3.11 and 3.12, where this specific error does not occur.</li>
  <li><strong>No Code Changes</strong>: Your script, which benchmarks GPU sorting with CuPy, can run as-is in an earlier Python environment, ensuring the benchmark’s integrity.</li>
  <li><strong>Ease of Implementation</strong>: Switching Python versions is straightforward using virtual environments or tools like <code class="language-plaintext highlighter-rouge">conda</code>.</li>
</ul>

<h3 id="step-by-step-fix">Step-by-Step Fix</h3>

<p>Here’s how to resolve the issue:</p>

<h4 id="option-1-using-virtualenv">Option 1: Using <code class="language-plaintext highlighter-rouge">virtualenv</code></h4>

<ol>
  <li><strong>Install Python 3.11 or 3.12</strong>
    <ul>
      <li>Ensure Python 3.11 or 3.12 is installed on your system (e.g., via your package manager or official Python website).</li>
    </ul>
  </li>
  <li><strong>Create a Virtual Environment</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virtualenv <span class="nt">-p</span> python3.11 venv
</code></pre></div>    </div>
    <p>This creates a virtual environment named <code class="language-plaintext highlighter-rouge">venv</code> using Python 3.11. Replace <code class="language-plaintext highlighter-rouge">python3.11</code> with <code class="language-plaintext highlighter-rouge">python3.12</code> if preferred.</p>
  </li>
  <li><strong>Activate the Virtual Environment</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source </span>venv/bin/activate
</code></pre></div>    </div>
  </li>
  <li><strong>Install CuPy</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>cupy
</code></pre></div>    </div>
    <p>This installs the latest compatible version of CuPy for Python 3.11.</p>
  </li>
  <li><strong>Run Your Script</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python scripts/benchmark/cudamark.py
</code></pre></div>    </div>
    <p>Your script should now execute without the <code class="language-plaintext highlighter-rouge">AttributeError</code>.</p>
  </li>
  <li><strong>Deactivate (When Done)</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deactivate
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="option-2-using-conda">Option 2: Using <code class="language-plaintext highlighter-rouge">conda</code></h4>

<ol>
  <li><strong>Create a Conda Environment</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create <span class="nt">-n</span> cudabench <span class="nv">python</span><span class="o">=</span>3.11
</code></pre></div>    </div>
    <p>This creates an environment named <code class="language-plaintext highlighter-rouge">cudabench</code> with Python 3.11. Use <code class="language-plaintext highlighter-rouge">python=3.12</code> if you prefer Python 3.12.</p>
  </li>
  <li><strong>Activate the Environment</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda activate cudabench
</code></pre></div>    </div>
  </li>
  <li><strong>Install CuPy</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>cupy
</code></pre></div>    </div>
  </li>
  <li><strong>Run Your Script</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python scripts/benchmark/cudamark.py
</code></pre></div>    </div>
  </li>
  <li><strong>Deactivate (When Done)</strong>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda deactivate
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="verifying-the-fix">Verifying the Fix</h3>

<p>After setting up the environment and running the script, you should see output similar to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CPU cores: &lt;your_cpu_cores&gt;
Threads: 1, Time taken: X.XXXX seconds
Threads: 2, Time taken: X.XXXX seconds
...
ThreadCount,TimeTakenSeconds
1,X.XXXXXX
2,X.XXXXXX
...
</code></pre></div></div>

<p>If the script runs without the <code class="language-plaintext highlighter-rouge">AttributeError</code>, the fix is successful.</p>

<h3 id="additional-notes">Additional Notes</h3>

<ul>
  <li><strong>Thread Counts in Your Script</strong>: Your script iterates over thread counts (<code class="language-plaintext highlighter-rouge">1, 2, 4, 8, 16, 32, 64, 128</code>), but the <code class="language-plaintext highlighter-rouge">parallel_sort_gpu</code> function uses CuPy’s GPU-based sorting (<code class="language-plaintext highlighter-rouge">cp.sort</code>), which doesn’t directly utilize CPU threads. The thread count loop may not affect GPU sorting performance as expected. If this is intentional for future modifications (e.g., adding CPU threading), it’s fine; otherwise, you might simplify the benchmark to focus solely on GPU performance.</li>
  <li><strong>CuPy Version</strong>: If you suspect an outdated CuPy version, ensure you’re installing the latest by running <code class="language-plaintext highlighter-rouge">pip install cupy --upgrade</code>. However, the primary issue here is Python 3.13 compatibility, not the CuPy version alone.</li>
  <li><strong>Long-Term Solution</strong>: If you must use Python 3.13, consider checking CuPy’s GitHub repository or issue tracker for updates supporting Python 3.13 (as of June 2025, this might be available). Alternatively, you could fork CuPy and patch the <code class="language-plaintext highlighter-rouge">memoize</code> decorator to handle built-in functions, but this is more complex and unnecessary for a benchmark.</li>
</ul>

<p>By using Python 3.11 or 3.12, you can reliably run your GPU benchmark without encountering this error.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
