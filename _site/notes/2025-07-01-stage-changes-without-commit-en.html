<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Stage Changes in Pre-Commit Hook</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Stage Changes in Pre-Commit Hook | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Stage Changes in Pre-Commit Hook" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-07-01-stage-changes-without-commit-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-07-01-stage-changes-without-commit-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Stage Changes in Pre-Commit Hook" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Stage Changes in Pre-Commit Hook","url":"https://lzwjava.github.io/notes/2025-07-01-stage-changes-without-commit-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=956e76582f38f8dff9432f02e88a54c05d87b69e">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=956e76582f38f8dff9432f02e88a54c05d87b69e" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Stage Changes in Pre-Commit Hook | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-07-01-stage-changes-without-commit-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-07-01-stage-changes-without-commit-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.09</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/stage-changes-without-commit-en" selected>English</option>
        <option value="/stage-changes-without-commit-zh" >中文</option>
        <option value="/stage-changes-without-commit-ja" >日本語</option>
        <option value="/stage-changes-without-commit-es" >Español</option>
        <option value="/stage-changes-without-commit-hi" >हिंदी</option>
        <option value="/stage-changes-without-commit-fr" >Français</option>
        <option value="/stage-changes-without-commit-de" >Deutsch</option>
        <option value="/stage-changes-without-commit-ar" >العربية</option>
        <option value="/stage-changes-without-commit-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>To integrate the changes from the <code class="language-plaintext highlighter-rouge">update_notes_link.py</code> script into the current commit (instead of creating a separate commit) during a pre-commit hook, you’ll need to modify the hook to stage the updated files without committing them separately. This way, the changes from the Python script will be included in the user’s commit. Below, I’ll provide a revised pre-commit hook script that achieves this.</p>

<h3 id="key-changes">Key Changes</h3>
<ul>
  <li><strong>No Separate Commit</strong>: Instead of running <code class="language-plaintext highlighter-rouge">git commit</code> in the hook, the script will only stage the updated files (<code class="language-plaintext highlighter-rouge">git add</code>) so they’re included in the user’s commit.</li>
  <li><strong>Preserve User’s Commit Message</strong>: The hook won’t create a new commit, ensuring the user’s original commit message is used.</li>
  <li><strong>Error Handling</strong>: If the Python script fails, the hook will exit with a non-zero status to prevent the commit.</li>
</ul>

<h3 id="pre-commit-hook-script">Pre-Commit Hook Script</h3>

<p>Here’s the updated pre-commit hook script that stages changes without creating a separate commit:</p>

<pre><code class="language-x-shellscript">#!/bin/bash

# Run the update_notes_link.py script and capture its output
OUTPUT=$(python scripts/generate/update_notes_link.py 2&gt;&amp;1)
EXIT_CODE=$?

# Check if the Python script executed successfully
if [ $EXIT_CODE -ne 0 ]; then
    echo "Error: update_notes_link.py failed with exit code $EXIT_CODE"
    echo "$OUTPUT"
    exit 1
fi

# Check if the specific file was updated
if echo "$OUTPUT" | grep -q "Updated original/2025-01-11-notes-en.md"; then
    echo "Notes links updated, staging changes for the current commit."

    # Stage the relevant files
    git add original/2025-01-11-notes-en.md
    git add _posts/en/*.md

    # Verify that files were staged
    if ! git diff --cached --quiet; then
        echo "Changes staged successfully."
    else
        echo "No changes to stage."
    fi
else
    echo "No updates to original/2025-01-11-notes-en.md, no additional files staged."
fi

# Exit with success to allow the commit to proceed
exit 0
</code></pre>

<h3 id="explanation-of-the-script">Explanation of the Script</h3>

<ul>
  <li><strong>Shebang (<code class="language-plaintext highlighter-rouge">#!/bin/bash</code>)</strong>: Ensures the script runs in a Bash shell.</li>
  <li><strong>Run Python Script</strong>: Executes <code class="language-plaintext highlighter-rouge">python scripts/generate/update_notes_link.py</code> and captures its output and exit code.</li>
  <li><strong>Error Handling</strong>: Checks the exit code (<code class="language-plaintext highlighter-rouge">$EXIT_CODE</code>) of the Python script. If it’s non-zero, the hook fails, prints the error, and stops the commit.</li>
  <li><strong>Check Output</strong>: Uses <code class="language-plaintext highlighter-rouge">grep</code> to check if the output indicates <code class="language-plaintext highlighter-rouge">original/2025-01-11-notes-en.md</code> was updated.</li>
  <li><strong>Stage Files</strong>: Runs <code class="language-plaintext highlighter-rouge">git add</code> on the specified files (<code class="language-plaintext highlighter-rouge">original/2025-01-11-notes-en.md</code> and <code class="language-plaintext highlighter-rouge">_posts/en/*.md</code>) to include them in the user’s commit.</li>
  <li><strong>No Commit</strong>: Skips <code class="language-plaintext highlighter-rouge">git commit</code>, allowing the user’s <code class="language-plaintext highlighter-rouge">git commit</code> command to include the staged changes with their original commit message.</li>
  <li><strong>Feedback</strong>: Prints messages to inform the user whether changes were staged.</li>
  <li><strong>Exit Code</strong>: Exits with <code class="language-plaintext highlighter-rouge">0</code> to allow the commit to proceed, unless the Python script fails.</li>
</ul>

<h3 id="setting-up-the-hook">Setting Up the Hook</h3>

<ol>
  <li><strong>Create the Hook</strong>:
    <ul>
      <li>Place the script in <code class="language-plaintext highlighter-rouge">.git/hooks/pre-commit</code> in your repository.</li>
    </ul>
  </li>
  <li><strong>Make It Executable</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x .git/hooks/pre-commit
</code></pre></div>    </div>
  </li>
  <li><strong>Test the Hook</strong>:
    <ul>
      <li>Modify a file or ensure the Python script will update <code class="language-plaintext highlighter-rouge">original/2025-01-11-notes-en.md</code>.</li>
      <li>Run <code class="language-plaintext highlighter-rouge">git commit -m "Your commit message"</code>.</li>
      <li>Verify that the updated files are included in the commit by checking <code class="language-plaintext highlighter-rouge">git diff --cached</code> before committing or <code class="language-plaintext highlighter-rouge">git show</code> after committing.</li>
    </ul>
  </li>
</ol>

<h3 id="using-the-pre-commit-framework-optional">Using the <code class="language-plaintext highlighter-rouge">pre-commit</code> Framework (Optional)</h3>

<p>If you prefer using the <code class="language-plaintext highlighter-rouge">pre-commit</code> framework, you can define the same logic in a <code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code> file. This approach is more portable and allows you to specify which files trigger the hook.</p>

<ol>
  <li><strong>Install pre-commit</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pre-commit
</code></pre></div>    </div>
  </li>
  <li><strong>Create <code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code></strong>:</li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">repos</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">repo</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">hooks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">update-notes-links</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Update Notes Links</span>
    <span class="na">entry</span><span class="pi">:</span> <span class="s">bash -c '</span>
      <span class="s">OUTPUT=$(python scripts/generate/update_notes_link.py 2&gt;&amp;1);</span>
      <span class="s">EXIT_CODE=$?;</span>
      <span class="s">if [ $EXIT_CODE -ne 0 ]; then</span>
        <span class="s">echo "Error</span><span class="err">:</span> <span class="s">update_notes_link.py failed with exit code $EXIT_CODE";</span>
        <span class="s">echo "$OUTPUT";</span>
        <span class="s">exit 1;</span>
      <span class="s">fi;</span>
      <span class="s">if echo "$OUTPUT" | grep -q "Updated original/2025-01-11-notes-en.md"; then</span>
        <span class="s">echo "Notes links updated, staging changes for the current commit.";</span>
        <span class="s">git add original/2025-01-11-notes-en.md;</span>
        <span class="s">git add _posts/en/*.md;</span>
        <span class="s">if ! git diff --cached --quiet; then</span>
          <span class="s">echo "Changes staged successfully.";</span>
        <span class="s">else</span>
          <span class="s">echo "No changes to stage.";</span>
        <span class="s">fi;</span>
      <span class="s">else</span>
        <span class="s">echo "No updates to original/2025-01-11-notes-en.md, no additional files staged.";</span>
      <span class="s">fi'</span>
    <span class="na">language</span><span class="pi">:</span> <span class="s">script</span>
    <span class="na">files</span><span class="pi">:</span> <span class="s">^(original/2025-01-11-notes-en\.md|_posts/en/.*\.md)$</span>
    <span class="na">stages</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">commit</span><span class="pi">]</span>
</code></pre></div></div>

<ol>
  <li><strong>Install the Hook</strong>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-commit <span class="nb">install</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Test the Hook</strong>:
    <ul>
      <li>Commit changes to files matching the <code class="language-plaintext highlighter-rouge">files</code> regex (e.g., <code class="language-plaintext highlighter-rouge">original/2025-01-11-notes-en.md</code> or <code class="language-plaintext highlighter-rouge">_posts/en/*.md</code>).</li>
      <li>Verify that the hook runs, stages changes if applicable, and includes them in your commit.</li>
    </ul>
  </li>
</ol>

<h3 id="key-differences-from-original-github-actions">Key Differences from Original GitHub Actions</h3>

<ul>
  <li><strong>No Separate Commit</strong>: Unlike the GitHub Actions workflow, which created a new commit, this hook stages changes for the user’s current commit.</li>
  <li><strong>No Push</strong>: The hook doesn’t push changes, as pre-commit hooks run locally before the commit is finalized. The user must run <code class="language-plaintext highlighter-rouge">git push</code> manually.</li>
  <li><strong>Error Handling</strong>: The hook checks the Python script’s exit code to ensure it doesn’t silently fail.</li>
  <li><strong>No Git User Config</strong>: The script omits <code class="language-plaintext highlighter-rouge">git config user.name</code> and <code class="language-plaintext highlighter-rouge">user.email</code> since the user’s Git configuration will be used for the commit.</li>
</ul>

<h3 id="notes">Notes</h3>

<ul>
  <li><strong>Python Script</strong>: Ensure <code class="language-plaintext highlighter-rouge">scripts/generate/update_notes_link.py</code> exists and is executable locally. If it relies on environment variables or dependencies, make sure they’re available.</li>
  <li><strong>File Paths</strong>: Verify that the paths <code class="language-plaintext highlighter-rouge">original/2025-01-11-notes-en.md</code> and <code class="language-plaintext highlighter-rouge">_posts/en/*.md</code> match your repository structure.</li>
  <li><strong>Hook Failure</strong>: If the Python script fails, the hook will prevent the commit, ensuring no partial updates are staged.</li>
  <li><strong>Testing</strong>: Test with <code class="language-plaintext highlighter-rouge">git commit</code> to confirm that changes are staged and included in the commit without creating an extra commit. Use <code class="language-plaintext highlighter-rouge">git show</code> to inspect the commit contents.</li>
</ul>

<h3 id="verification">Verification</h3>

<p>To verify:</p>
<ol>
  <li>Modify a file or ensure the Python script updates <code class="language-plaintext highlighter-rouge">original/2025-01-11-notes-en.md</code>.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">git commit -m "Test commit"</code>.</li>
  <li>Check <code class="language-plaintext highlighter-rouge">git show</code> to confirm that the updated files are included in the commit with your original message.</li>
  <li>Ensure no additional commits are created (e.g., no <code class="language-plaintext highlighter-rouge">chore(notes): Update notes links</code> commit).</li>
</ol>

<p>If you need further tweaks, such as handling specific error cases or adding more files to stage, let me know!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
