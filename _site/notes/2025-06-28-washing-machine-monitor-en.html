<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Smart Washing Machine Monitor with Arduino and Telegram Alerts</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Smart Washing Machine Monitor with Arduino and Telegram Alerts | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Smart Washing Machine Monitor with Arduino and Telegram Alerts" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-06-28-washing-machine-monitor-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-06-28-washing-machine-monitor-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Smart Washing Machine Monitor with Arduino and Telegram Alerts" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Smart Washing Machine Monitor with Arduino and Telegram Alerts","url":"https://lzwjava.github.io/notes/2025-06-28-washing-machine-monitor-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=70c64d1589e5c949034eb40b4fa94ed9b0f22cc0">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=70c64d1589e5c949034eb40b4fa94ed9b0f22cc0" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Smart Washing Machine Monitor with Arduino and Telegram Alerts | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-06-28-washing-machine-monitor-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-06-28-washing-machine-monitor-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.09</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/washing-machine-monitor-en" selected>English</option>
        <option value="/washing-machine-monitor-zh" >中文</option>
        <option value="/washing-machine-monitor-ja" >日本語</option>
        <option value="/washing-machine-monitor-es" >Español</option>
        <option value="/washing-machine-monitor-hi" >हिंदी</option>
        <option value="/washing-machine-monitor-fr" >Français</option>
        <option value="/washing-machine-monitor-de" >Deutsch</option>
        <option value="/washing-machine-monitor-ar" >العربية</option>
        <option value="/washing-machine-monitor-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>To create a system that detects when your Maytag MHW8630HW washing machine stops (using its panel light as an indicator) and notifies you via a Telegram bot to hang up your clothes, you can use an Arduino with a camera module to monitor the machine’s status. Below is a detailed guide on the tech stack, hardware setup, algorithm, and implementation steps.</p>

<hr />

<h3 id="tech-stack">Tech Stack</h3>
<h4 id="hardware">Hardware</h4>
<ol>
  <li><strong>Arduino Board</strong>:
    <ul>
      <li><strong>ESP32-CAM</strong> (recommended) – Combines a microcontroller with a built-in OV2640 camera and Wi-Fi capability, perfect for image processing and Telegram integration.</li>
      <li>Alternative: Arduino Uno + separate camera module (e.g., OV7670) and ESP8266 for Wi-Fi, but this is more complex to set up.</li>
    </ul>
  </li>
  <li><strong>Camera Module</strong>:
    <ul>
      <li>OV2640 (included with ESP32-CAM) – 2MP camera sufficient for detecting the panel light.</li>
    </ul>
  </li>
  <li><strong>Light Sensor (Optional)</strong>:
    <ul>
      <li>Photoresistor (LDR) or TSL2561 – To supplement camera-based light detection for redundancy or simpler setups.</li>
    </ul>
  </li>
  <li><strong>Power Supply</strong>:
    <ul>
      <li>5V USB power adapter or battery pack for the ESP32-CAM.</li>
    </ul>
  </li>
  <li><strong>Mounting</strong>:
    <ul>
      <li>Small enclosure or 3D-printed case to hold the ESP32-CAM, with a clear view of the washing machine’s control panel.</li>
    </ul>
  </li>
  <li><strong>Wi-Fi Router</strong>:
    <ul>
      <li>For the ESP32-CAM to connect to the internet and communicate with the Telegram bot.</li>
    </ul>
  </li>
</ol>

<h4 id="software">Software</h4>
<ol>
  <li><strong>Arduino IDE</strong>:
    <ul>
      <li>For programming the ESP32-CAM.</li>
    </ul>
  </li>
  <li><strong>Libraries</strong>:
    <ul>
      <li><strong>Universal Arduino Telegram Bot Library</strong> by Brian Lough – For Telegram bot integration.</li>
      <li><strong>ArduinoJson</strong> – To handle JSON data for Telegram API communication.</li>
      <li><strong>ESP32-CAM Camera Libraries</strong> – Built-in libraries for capturing and processing images.</li>
    </ul>
  </li>
  <li><strong>Telegram Bot</strong>:
    <ul>
      <li>Use BotFather on Telegram to create a bot and obtain a bot token and chat ID.</li>
    </ul>
  </li>
  <li><strong>Programming Language</strong>:
    <ul>
      <li>C++ (Arduino sketch).</li>
    </ul>
  </li>
  <li><strong>Optional Tools</strong>:
    <ul>
      <li>OpenCV (Python) for prototyping image processing algorithms on a computer before porting to Arduino (simplified for ESP32-CAM).</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="algorithm-for-detecting-washing-machine-status">Algorithm for Detecting Washing Machine Status</h3>
<p>Since the Maytag MHW8630HW has a panel light that indicates when the machine is on, you can use the camera to detect this light. The algorithm will process images to determine if the light is on or off, indicating the machine’s status.</p>

<h4 id="detection-algorithm">Detection Algorithm</h4>
<ol>
  <li><strong>Image Capture</strong>:
    <ul>
      <li>Periodically capture images of the washing machine’s control panel using the ESP32-CAM.</li>
    </ul>
  </li>
  <li><strong>Region of Interest (ROI) Selection</strong>:
    <ul>
      <li>Define a specific area in the image where the panel light is located (e.g., a rectangular region around the power indicator).</li>
    </ul>
  </li>
  <li><strong>Image Processing</strong>:
    <ul>
      <li><strong>Grayscale Conversion</strong>: Convert the captured image to grayscale to simplify processing.</li>
      <li><strong>Thresholding</strong>: Apply a brightness threshold to detect the presence of the light. The panel light will produce a bright spot when on, compared to a darker area when off.</li>
      <li><strong>Pixel Intensity Analysis</strong>: Calculate the average pixel intensity in the ROI. A high intensity indicates the light is on, while a low intensity indicates it’s off.</li>
    </ul>
  </li>
  <li><strong>State Machine</strong>:
    <ul>
      <li>Track the machine’s state (ON or OFF) based on consecutive readings.</li>
      <li>If the light is detected as ON for several cycles, assume the machine is running.</li>
      <li>If the light transitions to OFF and remains off for a set period (e.g., 5 minutes), assume the wash cycle is complete.</li>
    </ul>
  </li>
  <li><strong>Debouncing</strong>:
    <ul>
      <li>Implement a delay (e.g., 5 minutes) to confirm the machine has stopped, avoiding false notifications during pauses in the wash cycle (e.g., soaking or filling).</li>
    </ul>
  </li>
  <li><strong>Notification</strong>:
    <ul>
      <li>When the machine is confirmed stopped, send a Telegram message (e.g., “Washing machine stopped! Time to hang up clothes.”).</li>
    </ul>
  </li>
</ol>

<h4 id="why-not-use-more-complex-algorithms">Why Not Use More Complex Algorithms?</h4>
<ul>
  <li>Advanced algorithms like machine learning (e.g., CNNs for object detection) are overkill for this task and resource-intensive for the ESP32-CAM’s limited processing power.</li>
  <li>Simple thresholding is sufficient since the panel light is a clear binary indicator (ON/OFF).</li>
</ul>

<hr />

<h3 id="implementation-guide">Implementation Guide</h3>
<h4 id="step-1-set-up-the-telegram-bot">Step 1: Set Up the Telegram Bot</h4>
<ol>
  <li><strong>Create a Telegram Bot</strong>:
    <ul>
      <li>Open Telegram, search for <strong>@BotFather</strong>, and start a chat.</li>
      <li>Send <code class="language-plaintext highlighter-rouge">/newbot</code>, name your bot (e.g., “WasherBot”), and get the <strong>Bot Token</strong>.</li>
      <li>Send <code class="language-plaintext highlighter-rouge">/start</code> to your bot and get your <strong>Chat ID</strong> using a service like <code class="language-plaintext highlighter-rouge">@GetIDsBot</code> or by checking incoming messages in your code.</li>
    </ul>
  </li>
  <li><strong>Install Telegram on Your Phone</strong>:
    <ul>
      <li>Ensure you can receive messages from your bot.</li>
    </ul>
  </li>
</ol>

<h4 id="step-2-hardware-setup">Step 2: Hardware Setup</h4>
<ol>
  <li><strong>Position the ESP32-CAM</strong>:
    <ul>
      <li>Mount the ESP32-CAM in a small enclosure or with adhesive tape, facing the washing machine’s control panel.</li>
      <li>Ensure the camera has a clear view of the panel light (test with a sample photo).</li>
      <li>Secure the setup to avoid movement, as this could affect ROI consistency.</li>
    </ul>
  </li>
  <li><strong>Power the ESP32-CAM</strong>:
    <ul>
      <li>Connect a 5V USB power adapter or battery pack to the ESP32-CAM’s 5V pin.</li>
      <li>Ensure a stable power source, as the camera and Wi-Fi consume significant power.</li>
    </ul>
  </li>
  <li><strong>Optional Light Sensor</strong>:
    <ul>
      <li>If using a photoresistor, connect it to an analog pin on the ESP32-CAM (e.g., GPIO 4) with a voltage divider circuit (e.g., 10kΩ resistor to ground).</li>
    </ul>
  </li>
</ol>

<h4 id="step-3-software-setup">Step 3: Software Setup</h4>
<ol>
  <li><strong>Install Arduino IDE</strong>:
    <ul>
      <li>Download and install the Arduino IDE from <a href="https://www.arduino.cc/en/software">arduino.cc</a>.</li>
    </ul>
  </li>
  <li><strong>Add ESP32 Board Support</strong>:
    <ul>
      <li>In Arduino IDE, go to <strong>File &gt; Preferences</strong>, add the following URL to Additional Boards Manager URLs:
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/espressif/arduino-esp32/master/package_esp32_index.json
</code></pre></div>        </div>
      </li>
      <li>Go to <strong>Tools &gt; Board &gt; Boards Manager</strong>, search for “ESP32,” and install the ESP32 package.</li>
    </ul>
  </li>
  <li><strong>Install Libraries</strong>:
    <ul>
      <li>Install <strong>Universal Arduino Telegram Bot Library</strong>:
        <ul>
          <li>Download from <a href="https://github.com/witnessmenow/Universal-Arduino-Telegram-Bot">GitHub</a> and add via <strong>Sketch &gt; Include Library &gt; Add .ZIP Library</strong>.</li>
        </ul>
      </li>
      <li>Install <strong>ArduinoJson</strong>:
        <ul>
          <li>Go to <strong>Sketch &gt; Include Library &gt; Manage Libraries</strong>, search for “ArduinoJson,” and install version 6.x.x.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Configure Wi-Fi</strong>:
    <ul>
      <li>Ensure your ESP32-CAM can connect to your home Wi-Fi network (2.4GHz, as 5GHz is not supported).</li>
    </ul>
  </li>
</ol>

<h4 id="step-4-write-the-arduino-code">Step 4: Write the Arduino Code</h4>
<p>Below is a sample Arduino sketch for the ESP32-CAM to detect the panel light and send Telegram notifications. This code assumes you’ve identified the ROI coordinates for the panel light.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;WiFi.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;UniversalTelegramBot.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;ArduinoJson.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"esp_camera.h"</span><span class="cp">
</span>
<span class="c1">// Wi-Fi credentials</span>
<span class="cp">#define WIFI_SSID "your_wifi_ssid"
#define WIFI_PASSWORD "your_wifi_password"
</span>
<span class="c1">// Telegram Bot credentials</span>
<span class="cp">#define BOT_TOKEN "your_bot_token"
#define CHAT_ID "your_chat_id"
</span>
<span class="c1">// Camera configuration (for ESP32-CAM)</span>
<span class="cp">#define PWDN_GPIO_NUM 32
#define RESET_GPIO_NUM -1
#define XCLK_GPIO_NUM 0
#define SIOD_GPIO_NUM 26
#define SIOC_GPIO_NUM 27
#define Y9_GPIO_NUM 35
#define Y8_GPIO_NUM 34
#define Y7_GPIO_NUM 39
#define Y6_GPIO_NUM 36
#define Y5_GPIO_NUM 21
#define Y4_GPIO_NUM 19
#define Y3_GPIO_NUM 18
#define Y2_GPIO_NUM 5
#define VSYNC_GPIO_NUM 25
#define HREF_GPIO_NUM 23
#define PCLK_GPIO_NUM 22
</span>
<span class="n">WiFiClientSecure</span> <span class="n">client</span><span class="p">;</span>
<span class="n">UniversalTelegramBot</span> <span class="nf">bot</span><span class="p">(</span><span class="n">BOT_TOKEN</span><span class="p">,</span> <span class="n">client</span><span class="p">);</span>

<span class="cp">#define ROI_X 100 // Adjust based on camera view (x-coordinate of ROI)
#define ROI_Y 100 // y-coordinate of ROI
#define ROI_WIDTH 50 // Width of ROI
#define ROI_HEIGHT 50 // Height of ROI
#define THRESHOLD 150 // Brightness threshold (0-255)
#define STOP_DELAY 300000 // 5 minutes in milliseconds
</span>
<span class="kt">bool</span> <span class="n">machineRunning</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">lastOnTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>

  <span class="c1">// Initialize camera</span>
  <span class="n">camera_config_t</span> <span class="n">config</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">ledc_channel</span> <span class="o">=</span> <span class="n">LEDC_CHANNEL_0</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">ledc_timer</span> <span class="o">=</span> <span class="n">LEDC_TIMER_0</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d0</span> <span class="o">=</span> <span class="n">Y2_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d1</span> <span class="o">=</span> <span class="n">Y3_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d2</span> <span class="o">=</span> <span class="n">Y4_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d3</span> <span class="o">=</span> <span class="n">Y5_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d4</span> <span class="o">=</span> <span class="n">Y6_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d5</span> <span class="o">=</span> <span class="n">Y7_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d6</span> <span class="o">=</span> <span class="n">Y8_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_d7</span> <span class="o">=</span> <span class="n">Y9_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_xclk</span> <span class="o">=</span> <span class="n">XCLK_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_pclk</span> <span class="o">=</span> <span class="n">PCLK_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_vsync</span> <span class="o">=</span> <span class="n">VSYNC_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_href</span> <span class="o">=</span> <span class="n">HREF_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_sscb_sda</span> <span class="o">=</span> <span class="n">SIOD_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_sscb_scl</span> <span class="o">=</span> <span class="n">SIOC_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_pwdn</span> <span class="o">=</span> <span class="n">PWDN_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pin_reset</span> <span class="o">=</span> <span class="n">RESET_GPIO_NUM</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">xclk_freq_hz</span> <span class="o">=</span> <span class="mi">20000000</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">pixel_format</span> <span class="o">=</span> <span class="n">PIXFORMAT_GRAYSCALE</span><span class="p">;</span> <span class="c1">// Grayscale for simplicity</span>
  <span class="n">config</span><span class="p">.</span><span class="n">frame_size</span> <span class="o">=</span> <span class="n">FRAMESIZE_QVGA</span><span class="p">;</span> <span class="c1">// 320x240</span>
  <span class="n">config</span><span class="p">.</span><span class="n">jpeg_quality</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
  <span class="n">config</span><span class="p">.</span><span class="n">fb_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">esp_err_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">esp_camera_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="n">ESP_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Camera init failed with error 0x%x"</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Connect to Wi-Fi</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">WIFI_SSID</span><span class="p">,</span> <span class="n">WIFI_PASSWORD</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"WiFi connected"</span><span class="p">);</span>

  <span class="c1">// Configure Telegram client</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setInsecure</span><span class="p">();</span> <span class="c1">// For simplicity; consider proper SSL in production</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Capture image</span>
  <span class="n">camera_fb_t</span> <span class="o">*</span><span class="n">fb</span> <span class="o">=</span> <span class="n">esp_camera_framebuffer_get</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fb</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Camera capture failed"</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Calculate average brightness in ROI</span>
  <span class="kt">uint32_t</span> <span class="n">totalBrightness</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">pixelCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ROI_Y</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">ROI_Y</span> <span class="o">+</span> <span class="n">ROI_HEIGHT</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ROI_X</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">ROI_X</span> <span class="o">+</span> <span class="n">ROI_WIDTH</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">fb</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">fb</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">totalBrightness</span> <span class="o">+=</span> <span class="n">fb</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">fb</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">+</span> <span class="n">x</span><span class="p">];</span>
        <span class="n">pixelCount</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">esp_camera_framebuffer_return</span><span class="p">(</span><span class="n">fb</span><span class="p">);</span>

  <span class="kt">float</span> <span class="n">avgBrightness</span> <span class="o">=</span> <span class="n">pixelCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">totalBrightness</span> <span class="o">/</span> <span class="n">pixelCount</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// State machine</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">avgBrightness</span> <span class="o">&gt;</span> <span class="n">THRESHOLD</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">machineRunning</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">machineRunning</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Machine is ON"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">lastOnTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">machineRunning</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastOnTime</span> <span class="o">&gt;</span> <span class="n">STOP_DELAY</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">machineRunning</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Machine stopped"</span><span class="p">);</span>
      <span class="n">bot</span><span class="p">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="n">CHAT_ID</span><span class="p">,</span> <span class="s">"Washing machine stopped! Time to hang up clothes."</span><span class="p">,</span> <span class="s">""</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span> <span class="c1">// Check every 10 seconds</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="step-5-customize-the-code">Step 5: Customize the Code</h4>
<ol>
  <li><strong>Update Credentials</strong>:
    <ul>
      <li>Replace <code class="language-plaintext highlighter-rouge">your_wifi_ssid</code>, <code class="language-plaintext highlighter-rouge">your_wifi_password</code>, <code class="language-plaintext highlighter-rouge">your_bot_token</code>, and <code class="language-plaintext highlighter-rouge">your_chat_id</code> with your actual values.</li>
    </ul>
  </li>
  <li><strong>Tune ROI and Threshold</strong>:
    <ul>
      <li>Capture a test image using the ESP32-CAM (modify the code to save an image to an SD card or stream it).</li>
      <li>Determine the ROI coordinates (<code class="language-plaintext highlighter-rouge">ROI_X</code>, <code class="language-plaintext highlighter-rouge">ROI_Y</code>, <code class="language-plaintext highlighter-rouge">ROI_WIDTH</code>, <code class="language-plaintext highlighter-rouge">ROI_HEIGHT</code>) by analyzing the image to focus on the panel light.</li>
      <li>Adjust <code class="language-plaintext highlighter-rouge">THRESHOLD</code> based on test images (e.g., brighter when ON, darker when OFF).</li>
    </ul>
  </li>
  <li><strong>Adjust <code class="language-plaintext highlighter-rouge">STOP_DELAY</code></strong>:
    <ul>
      <li>Set to 300000 (5 minutes) to avoid false notifications during cycle pauses.</li>
    </ul>
  </li>
</ol>

<h4 id="step-6-test-and-deploy">Step 6: Test and Deploy</h4>
<ol>
  <li><strong>Upload the Code</strong>:
    <ul>
      <li>Connect the ESP32-CAM to your computer via a USB-to-serial adapter (e.g., FTDI module).</li>
      <li>Select <strong>ESP32 Wrover Module</strong> in Arduino IDE and upload the sketch.</li>
    </ul>
  </li>
  <li><strong>Test the System</strong>:
    <ul>
      <li>Start the washing machine and monitor the Serial Monitor for state changes.</li>
      <li>Verify Telegram notifications when the machine stops.</li>
    </ul>
  </li>
  <li><strong>Fine-Tune</strong>:
    <ul>
      <li>Adjust ROI, threshold, or delay if false positives/negatives occur.</li>
    </ul>
  </li>
  <li><strong>Permanent Installation</strong>:
    <ul>
      <li>Secure the ESP32-CAM in its enclosure and ensure a stable power supply.</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="alternative-approach-light-sensor">Alternative Approach: Light Sensor</h3>
<p>If camera-based detection is too complex or unreliable (e.g., due to ambient light), use a photoresistor:</p>
<ul>
  <li><strong>Setup</strong>: Attach a photoresistor to the panel light (e.g., with tape) and connect it to an analog pin.</li>
  <li><strong>Code Modification</strong>: Replace image processing with analog readings:
    <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">lightValue</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span> <span class="c1">// Photoresistor on GPIO 4</span>
<span class="k">if</span> <span class="p">(</span><span class="n">lightValue</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Adjust threshold</span>
  <span class="n">machineRunning</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="n">lastOnTime</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">machineRunning</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastOnTime</span> <span class="o">&gt;</span> <span class="n">STOP_DELAY</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">machineRunning</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">bot</span><span class="p">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="n">CHAT_ID</span><span class="p">,</span> <span class="s">"Washing machine stopped! Time to hang up clothes."</span><span class="p">,</span> <span class="s">""</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Pros</strong>: Simpler, less resource-intensive.</li>
  <li><strong>Cons</strong>: Requires physical attachment to the light, less flexible.</li>
</ul>

<hr />

<h3 id="notes">Notes</h3>
<ul>
  <li><strong>Power Consumption</strong>: The ESP32-CAM consumes significant power when using the camera and Wi-Fi. Ensure a reliable power source.</li>
  <li><strong>Ambient Light</strong>: Camera-based detection may be affected by room lighting. Test in various conditions or use a light sensor for robustness.</li>
  <li><strong>Security</strong>: The sample code uses <code class="language-plaintext highlighter-rouge">setInsecure()</code> for simplicity. For production, configure proper SSL certificates for Telegram communication.</li>
  <li><strong>References</strong>: This approach is inspired by projects like the ESP32-CAM Telegram security system and laundry monitors using vibration sensors, adapted for light-based detection.<a href="https://www.instructables.com/Home-Security-System-Using-ESP32-CAM-and-Telegram-/"></a><a href="https://www.instructables.com/Arduino-Washer-Dryer-Alert-Push-Notification-to-Ph/"></a></li>
</ul>

<hr />

<h3 id="troubleshooting">Troubleshooting</h3>
<ul>
  <li><strong>Camera Fails to Initialize</strong>: Check wiring, ensure sufficient power, and verify camera configuration.</li>
  <li><strong>Wi-Fi Connection Issues</strong>: Confirm 2.4GHz Wi-Fi and correct credentials.</li>
  <li><strong>No Telegram Messages</strong>: Verify bot token and chat ID, check Serial Monitor for errors.</li>
  <li><strong>False Notifications</strong>: Adjust <code class="language-plaintext highlighter-rouge">THRESHOLD</code> or <code class="language-plaintext highlighter-rouge">STOP_DELAY</code> to account for cycle pauses.</li>
</ul>

<p>This solution leverages the ESP32-CAM’s capabilities for a cost-effective, non-invasive way to monitor your washing machine and notify you via Telegram. Let me know if you need help with specific steps or debugging!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
