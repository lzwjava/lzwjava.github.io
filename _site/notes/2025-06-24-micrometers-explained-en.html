<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Guide to Micrometers: Tools and Observability</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Guide to Micrometers: Tools and Observability | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Guide to Micrometers: Tools and Observability" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-06-24-micrometers-explained-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-06-24-micrometers-explained-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Guide to Micrometers: Tools and Observability" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Guide to Micrometers: Tools and Observability","url":"https://lzwjava.github.io/notes/2025-06-24-micrometers-explained-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=e8544ebb8cd270e46ba5d6942d874dd40bd87619">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=e8544ebb8cd270e46ba5d6942d874dd40bd87619" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Guide to Micrometers: Tools and Observability | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-06-24-micrometers-explained-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-06-24-micrometers-explained-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/micrometers-explained-en" selected>English</option>
        <option value="/micrometers-explained-zh" >中文</option>
        <option value="/micrometers-explained-ja" >日本語</option>
        <option value="/micrometers-explained-es" >Español</option>
        <option value="/micrometers-explained-hi" >हिंदी</option>
        <option value="/micrometers-explained-fr" >Français</option>
        <option value="/micrometers-explained-de" >Deutsch</option>
        <option value="/micrometers-explained-ar" >العربية</option>
        <option value="/micrometers-explained-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>This comprehensive guide covers two distinct topics: <strong>Micrometers (the measuring tool)</strong> and <strong>Micrometer (the observability facade for Java applications, particularly Spring Boot), focusing on tracing solutions.</strong></p>

<p>Let’s break them down:</p>

<hr />

<h2 id="part-1-comprehensive-guide-about-micrometers-measuring-tool">Part 1: Comprehensive Guide about Micrometers (Measuring Tool)</h2>

<p>A micrometer, often called a micrometer screw gauge, is a precision measuring instrument used to obtain highly accurate measurements of small distances, typically in the range of thousandths of an inch or hundredths of a millimeter. It’s widely used in engineering, machining, manufacturing, and scientific fields where precise dimensions are critical.</p>

<h3 id="1-what-is-a-micrometer">1. What is a Micrometer?</h3>

<p>At its core, a micrometer utilizes a precisely machined screw mechanism to translate rotational motion into linear movement. This allows for fine adjustments and accurate readings of an object’s dimensions by clamping it between a stationary anvil and a movable spindle.</p>

<h3 id="2-key-components-of-a-micrometer">2. Key Components of a Micrometer:</h3>

<ul>
  <li><strong>Frame:</strong> The C-shaped main body that holds all other components. It provides stability and needs to be handled carefully to avoid thermal expansion errors.</li>
  <li><strong>Anvil:</strong> The stationary measuring face against which the object is placed.</li>
  <li><strong>Spindle:</strong> The movable measuring face that moves towards or away from the anvil when the thimble is rotated.</li>
  <li><strong>Sleeve (or Barrel):</strong> The fixed part of the micrometer that houses the main linear scale, displaying whole numbers and half increments (e.g., in inches or millimeters).</li>
  <li><strong>Thimble:</strong> The rotating part that moves the spindle and has a finely graduated scale for more precise readings.</li>
  <li><strong>Ratchet Stop:</strong> Located at the end of the thimble, it ensures consistent measuring pressure by slipping when the correct force is applied, preventing overtightening and distortion of the workpiece.</li>
  <li><strong>Lock Nut (or Lock Lever):</strong> Used to lock the spindle in place once a measurement has been taken, preventing accidental movement and preserving the reading.</li>
</ul>

<h3 id="3-types-of-micrometers">3. Types of Micrometers:</h3>

<p>Micrometers come in various types, each designed for specific measurement tasks:</p>

<ul>
  <li><strong>Outside Micrometer (External Micrometer):</strong> The most common type, used for measuring external dimensions like the diameter of a shaft or the thickness of a plate.</li>
  <li><strong>Inside Micrometer (Internal Micrometer):</strong> Used for measuring internal dimensions, such as the diameter of a bore or hole. They often have different designs, like tubular or jaw-type micrometers.</li>
  <li><strong>Depth Micrometer:</strong> Used to measure the depth of holes, slots, or steps.</li>
  <li><strong>Screw Thread Micrometer:</strong> Designed to measure the pitch diameter of screw threads.</li>
  <li><strong>Ball Micrometer:</strong> Features ball-shaped anvils/spindles for measuring the thickness of curved surfaces or specific features like tube walls.</li>
  <li><strong>Disk Micrometer:</strong> Has flat, disc-shaped measuring faces for measuring thin materials, paper, or gear teeth.</li>
  <li><strong>Digital Micrometer:</strong> Features an electronic display for direct digital readings, eliminating parallax error and making readings easier.</li>
  <li><strong>Analog Micrometer:</strong> Requires manual reading of scales on the sleeve and thimble.</li>
  <li><strong>Vernier Micrometer:</strong> Includes an additional vernier scale for even higher precision, allowing readings beyond the thimble’s main graduations.</li>
</ul>

<h3 id="4-how-to-read-a-micrometer-analogimperial-example">4. How to Read a Micrometer (Analog/Imperial Example):</h3>

<p>While specific readings vary between imperial (inches) and metric (millimeters) and analog/digital, the general principle for analog micrometers is:</p>

<ol>
  <li><strong>Read the Sleeve Scale (Main Scale):</strong>
    <ul>
      <li><strong>Whole Inches:</strong> Note the largest whole inch mark visible.</li>
      <li><strong>Tenths of an Inch (0.100”):</strong> Each numbered line on the sleeve represents 0.100 inches.</li>
      <li><strong>Twenty-five Thousandths (0.025”):</strong> Each unnumbered line between the tenths marks represents 0.025 inches.</li>
    </ul>
  </li>
  <li><strong>Read the Thimble Scale:</strong>
    <ul>
      <li>The thimble has 25 graduations, with each mark representing 0.001 inches.</li>
      <li>Read the line on the thimble that aligns with the index line on the sleeve.</li>
    </ul>
  </li>
  <li><strong>Combine the Readings:</strong> Add the values from the sleeve (whole inches, tenths, and twenty-five thousandths) and the thimble (thousandths) to get the final measurement.</li>
</ol>

<p><strong>Example (Imperial):</strong></p>

<ul>
  <li>Sleeve:
    <ul>
      <li>Say you see “1” (for 1.000”)</li>
      <li>Then 3 lines after the “1” (3 x 0.100” = 0.300”)</li>
      <li>And 2 lines below the main line (2 x 0.025” = 0.050”)</li>
      <li>Total from Sleeve: 1.000 + 0.300 + 0.050 = 1.350”</li>
    </ul>
  </li>
  <li>Thimble:
    <ul>
      <li>The 15th mark on the thimble aligns with the index line (0.015”)</li>
    </ul>
  </li>
  <li><strong>Total Reading:</strong> 1.350” + 0.015” = <strong>1.365”</strong></li>
</ul>

<h3 id="5-proper-usage-and-best-practices">5. Proper Usage and Best Practices:</h3>

<ul>
  <li><strong>Cleanliness:</strong> Always ensure the measuring faces (anvil and spindle) are clean and free of dust, oil, or debris.</li>
  <li><strong>Zeroing:</strong> Before use, always “zero” the micrometer. Close the measuring faces gently using the ratchet stop until they touch. The reading should be 0.000 (or the starting range, e.g., 25-50mm). If not, adjust the micrometer for zero error. Digital micrometers usually have a reset button.</li>
  <li><strong>Temperature:</strong> Handle the micrometer by its insulated frame or wear gloves, as body heat can cause thermal expansion and affect accuracy, especially for larger micrometers. Allow both the tool and the object to reach room temperature.</li>
  <li><strong>Consistent Pressure:</strong> Always use the ratchet stop to apply consistent and appropriate measuring pressure. Overtightening can distort the object or the micrometer.</li>
  <li><strong>Object Positioning:</strong> Position the object squarely between the anvil and spindle to avoid skewed readings.</li>
  <li><strong>Multiple Measurements:</strong> For critical dimensions, take several measurements at different points on the object to account for variations.</li>
  <li><strong>Storage:</strong> Store micrometers in their protective cases to prevent damage.</li>
  <li><strong>Calibration:</strong> Regularly check and calibrate micrometers against known standards (e.g., gauge blocks) to ensure their accuracy.</li>
</ul>

<hr />

<h2 id="part-2-micrometer-as-a-tracing-solution-for-spring-java-projects">Part 2: Micrometer as a Tracing Solution for Spring Java Projects</h2>

<p>In the context of Spring Java projects, “Micrometer” refers to an <strong>application observability facade</strong> that provides a vendor-neutral API for instrumenting JVM-based applications. It allows you to collect and export various telemetry data, including metrics, logging, and <strong>distributed tracing</strong>.</p>

<p>Micrometer Tracing is the successor to Spring Cloud Sleuth and is designed to provide insight into complex distributed systems by tracking requests across multiple services.</p>

<h3 id="1-what-is-distributed-tracing">1. What is Distributed Tracing?</h3>

<p>In a microservices architecture, a single user request often traverses multiple services. Distributed tracing allows you to:</p>

<ul>
  <li><strong>Track the flow:</strong> See the complete path a request takes through your system.</li>
  <li><strong>Identify bottlenecks:</strong> Pinpoint which service or operation is causing latency.</li>
  <li><strong>Understand dependencies:</strong> Visualize the interactions between different services.</li>
  <li><strong>Simplify debugging:</strong> Correlate logs with specific requests, making troubleshooting much easier.</li>
</ul>

<p>A distributed trace is composed of <strong>spans</strong>. A <strong>span</strong> represents a single operation or unit of work within a trace (e.g., an HTTP request to a service, a database query, a method execution). Spans have a unique ID, a start and end time, and can include tags (key-value pairs) and events for additional metadata. Spans are organized hierarchically, with parent-child relationships, forming a trace.</p>

<h3 id="2-micrometer-tracing-in-spring-boot-3x">2. Micrometer Tracing in Spring Boot 3.x+</h3>

<p>Spring Boot 3.x+ deeply integrates with Micrometer’s Observation API and Micrometer Tracing, making it significantly easier to implement distributed tracing.</p>

<h4 id="21-core-concepts">2.1. Core Concepts:</h4>

<ul>
  <li><strong>Observation API:</strong> Micrometer’s unified API for instrumenting your code, capable of producing metrics, traces, and logs from a single instrumentation point.</li>
  <li><strong>Micrometer Tracing:</strong> A facade over popular tracer libraries like OpenTelemetry and OpenZipkin Brave. It handles the lifecycle of spans, context propagation, and reporting to tracing backends.</li>
  <li><strong>Tracer Bridges:</strong> Micrometer Tracing provides “bridges” to connect its API to specific tracing implementations (e.g., <code class="language-plaintext highlighter-rouge">micrometer-tracing-bridge-otel</code> for OpenTelemetry, <code class="language-plaintext highlighter-rouge">micrometer-tracing-bridge-brave</code> for OpenZipkin Brave).</li>
  <li><strong>Reporters/Exporters:</strong> These components send the collected trace data to a tracing backend (e.g., Zipkin, Jaeger, Grafana Tempo).</li>
</ul>

<h4 id="22-setting-up-micrometer-tracing-in-a-spring-boot-java-project">2.2. Setting Up Micrometer Tracing in a Spring Boot Java Project:</h4>

<p>Here’s a step-by-step guide:</p>

<p><strong>Step 1: Add Dependencies</strong></p>

<p>You need <code class="language-plaintext highlighter-rouge">spring-boot-starter-actuator</code> for observability features, a Micrometer Tracing bridge, and a reporter/exporter for your chosen tracing backend.</p>

<p><strong>Example with OpenTelemetry and Zipkin (common choice):</strong></p>

<p>In your <code class="language-plaintext highlighter-rouge">pom.xml</code> (Maven):</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>micrometer-observation<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.micrometer<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>micrometer-tracing-bridge-otel<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.opentelemetry<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>opentelemetry-exporter-zipkin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-webflux<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p><strong>Step 2: Configure Tracing Properties</strong></p>

<p>In <code class="language-plaintext highlighter-rouge">application.properties</code> or <code class="language-plaintext highlighter-rouge">application.yml</code>, you can configure tracing behavior.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Enable tracing (usually true by default with actuator and tracing dependencies)
</span><span class="py">management.tracing.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="c"># Configure sampling probability (1.0 = 100% of requests are traced)
# Default is often 0.1 (10%), set to 1.0 for development/testing
</span><span class="py">management.tracing.sampling.probability</span><span class="p">=</span><span class="s">1.0</span>

<span class="c"># Configure Zipkin base URL (if using Zipkin)
</span><span class="py">spring.zipkin.base-url</span><span class="p">=</span><span class="s">http://localhost:9411</span>
</code></pre></div></div>

<p><strong>Step 3: Run a Tracing Backend (e.g., Zipkin)</strong></p>

<p>You need a tracing server to collect and visualize your traces. Zipkin is a popular choice for local development.</p>

<p>You can run Zipkin via Docker:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 9411:9411 openzipkin/zipkin
</code></pre></div></div>

<p>Once running, you can access the Zipkin UI at <code class="language-plaintext highlighter-rouge">http://localhost:9411</code>.</p>

<p><strong>Step 4: Automatic Instrumentation (Spring Boot Magic!)</strong></p>

<p>For many common components in Spring Boot (like <code class="language-plaintext highlighter-rouge">RestController</code> endpoints, <code class="language-plaintext highlighter-rouge">RestTemplate</code>, <code class="language-plaintext highlighter-rouge">WebClient</code>, <code class="language-plaintext highlighter-rouge">JdbcTemplate</code>, Kafka listeners/producers, etc.), Micrometer Tracing provides <strong>automatic instrumentation</strong>. This means you often don’t need to write any explicit tracing code for basic request tracing to work.</p>

<p>Spring Boot ensures that:</p>

<ul>
  <li>Incoming HTTP requests automatically create a new trace or continue an existing one if trace headers are present.</li>
  <li>Outgoing requests made with auto-configured <code class="language-plaintext highlighter-rouge">RestTemplateBuilder</code>, <code class="language-plaintext highlighter-rouge">RestClient.Builder</code>, or <code class="language-plaintext highlighter-rouge">WebClient.Builder</code> propagate the trace context to downstream services.</li>
  <li>Log statements automatically include <code class="language-plaintext highlighter-rouge">traceId</code> and <code class="language-plaintext highlighter-rouge">spanId</code> (if you configure your logging pattern).</li>
</ul>

<p><strong>Example Logging Pattern (in <code class="language-plaintext highlighter-rouge">application.properties</code>):</strong></p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">logging.pattern.level</span><span class="p">=</span><span class="s">%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}] %c{1.}:%M:%L - %m%n</span>
</code></pre></div></div>

<p>This pattern will inject the <code class="language-plaintext highlighter-rouge">traceId</code> and <code class="language-plaintext highlighter-rouge">spanId</code> into your log lines, making it easy to correlate logs with a specific trace.</p>

<p><strong>Step 5: Manual Instrumentation (for custom logic)</strong></p>

<p>While auto-instrumentation covers a lot, you’ll often want to trace specific business logic or critical operations within your application. You can do this using:</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">@Observed</code> Annotation (Recommended for Spring Boot 3.x+):</strong>
This annotation is part of the Micrometer Observation API and is the preferred way to create observations (which can produce both metrics and traces).</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io.micrometer.observation.annotation.Observed</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>

    <span class="nd">@Observed</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"myService.processData"</span><span class="o">,</span> <span class="n">contextualName</span> <span class="o">=</span> <span class="s">"processing-data"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">processData</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ... your business logic ...</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Processing data: "</span> <span class="o">+</span> <span class="n">input</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"Processed: "</span> <span class="o">+</span> <span class="n">input</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>The <code class="language-plaintext highlighter-rouge">name</code> attribute defines the name for the observation (which becomes the metric name and trace span name). <code class="language-plaintext highlighter-rouge">contextualName</code> provides a more human-readable name for the span in tracing tools.</p>
  </li>
  <li>
    <p><strong>Programmatic API (for more control):</strong>
You can directly use the <code class="language-plaintext highlighter-rouge">ObservationRegistry</code> and <code class="language-plaintext highlighter-rouge">Tracer</code> beans provided by Spring Boot.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io.micrometer.observation.Observation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.micrometer.observation.ObservationRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnotherService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ObservationRegistry</span> <span class="n">observationRegistry</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AnotherService</span><span class="o">(</span><span class="nc">ObservationRegistry</span> <span class="n">observationRegistry</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">observationRegistry</span> <span class="o">=</span> <span class="n">observationRegistry</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">performComplexOperation</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Observation</span><span class="o">.</span><span class="na">createNotStarted</span><span class="o">(</span><span class="s">"complex.operation"</span><span class="o">,</span> <span class="n">observationRegistry</span><span class="o">)</span>
                <span class="o">.</span><span class="na">lowCardinalityKeyValue</span><span class="o">(</span><span class="s">"operation.id"</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="c1">// Add a tag</span>
                <span class="o">.</span><span class="na">observe</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="c1">// ... complex logic here ...</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span> <span class="c1">// Simulate work</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="s">"Completed complex operation for "</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
                <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>Here, <code class="language-plaintext highlighter-rouge">observe()</code> wraps the code block, and <code class="language-plaintext highlighter-rouge">lowCardinalityKeyValue</code> adds a tag to the span.</p>
  </li>
</ul>

<h3 id="3-distributed-tracing-in-microservices">3. Distributed Tracing in Microservices:</h3>

<p>When you have multiple Spring Boot services, Micrometer Tracing facilitates context propagation automatically for <code class="language-plaintext highlighter-rouge">RestTemplate</code>, <code class="language-plaintext highlighter-rouge">WebClient</code>, and other instrumented clients. This means that the <code class="language-plaintext highlighter-rouge">traceId</code> and <code class="language-plaintext highlighter-rouge">spanId</code> are passed in HTTP headers between services (e.g., <code class="language-plaintext highlighter-rouge">traceparent</code> header for W3C Trace Context).</p>

<p>When a request comes into a downstream service, Micrometer Tracing detects these headers and continues the existing trace, creating new spans that are children of the parent span from the calling service. This forms the complete end-to-end trace.</p>

<h3 id="4-visualizing-traces">4. Visualizing Traces:</h3>

<p>Once your application is instrumented and sending traces to a backend like Zipkin (or Jaeger, Lightstep, etc.), you can:</p>

<ol>
  <li><strong>Access the UI:</strong> Go to the tracing backend’s web UI (e.g., <code class="language-plaintext highlighter-rouge">http://localhost:9411</code> for Zipkin).</li>
  <li><strong>Find Traces:</strong> Use filters (service name, span name, trace ID) to find specific traces.</li>
  <li><strong>Analyze Trace Details:</strong> Click on a trace to see its timeline, individual spans, their durations, tags, and events.</li>
  <li><strong>Dependency Graph:</strong> Most tracing backends can visualize the service dependencies based on the collected traces.</li>
</ol>

<h3 id="5-best-practices-for-micrometer-tracing">5. Best Practices for Micrometer Tracing:</h3>

<ul>
  <li><strong>Name Your Spans Meaningfully:</strong> Use clear, concise, and low-cardinality names for your spans (e.g., “userService.getUser”, “productService.updateStock”). Avoid including highly dynamic data in span names.</li>
  <li><strong>Use Tags for Detail (High Cardinality Data):</strong> Instead of putting dynamic data in span names, use tags (key-value pairs) for additional context. For example, <code class="language-plaintext highlighter-rouge">userId</code>, <code class="language-plaintext highlighter-rouge">orderId</code>, <code class="language-plaintext highlighter-rouge">customerType</code>. Be mindful of <strong>high cardinality</strong> tags, as they can significantly increase storage costs and query times in your tracing backend. Use them judiciously.</li>
  <li><strong>Keep Spans Granular but Not Excessive:</strong> Create spans for significant operations, but avoid creating too many tiny spans, as this can add overhead. Aim for a balance that provides sufficient visibility without overwhelming the system.</li>
  <li><strong>Propagate Context:</strong> Ensure that trace context is properly propagated across service boundaries. Spring Boot’s auto-configuration handles this for common scenarios, but be aware when using custom clients or asynchronous operations.</li>
  <li><strong>Sampling:</strong> For high-traffic production environments, consider using sampling strategies to reduce the volume of trace data sent to your backend. Spring Boot allows configuring <code class="language-plaintext highlighter-rouge">management.tracing.sampling.probability</code>.</li>
  <li><strong>Correlate Logs:</strong> Leverage the <code class="language-plaintext highlighter-rouge">traceId</code> and <code class="language-plaintext highlighter-rouge">spanId</code> injected into logs for easier debugging and correlation of application behavior with specific requests.</li>
  <li><strong>Monitor Your Tracing Backend:</strong> Ensure your tracing backend (e.g., Zipkin server) has sufficient resources to handle the incoming trace volume.</li>
  <li><strong>Integrate with Other Observability Tools:</strong> Tracing is one part of observability. Combine it with metrics (also via Micrometer) and structured logging for a holistic view of your application’s health and performance.</li>
</ul>

<p>By following these guidelines, you can effectively leverage Micrometer Tracing to gain deep insights into your Spring Boot applications, especially in distributed environments.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
