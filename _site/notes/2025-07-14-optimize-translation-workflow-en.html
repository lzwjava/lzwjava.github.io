<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Optimize Translation with Paragraph Hashing</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Optimize Translation with Paragraph Hashing | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Optimize Translation with Paragraph Hashing" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-07-14-optimize-translation-workflow-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-07-14-optimize-translation-workflow-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Optimize Translation with Paragraph Hashing" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Optimize Translation with Paragraph Hashing","url":"https://lzwjava.github.io/notes/2025-07-14-optimize-translation-workflow-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=572352b679d5ba2aede00216e28f6d7a3e93683d">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=572352b679d5ba2aede00216e28f6d7a3e93683d" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Optimize Translation with Paragraph Hashing | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-07-14-optimize-translation-workflow-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-07-14-optimize-translation-workflow-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/optimize-translation-workflow-en" selected>English</option>
        <option value="/optimize-translation-workflow-zh" >中文</option>
        <option value="/optimize-translation-workflow-ja" >日本語</option>
        <option value="/optimize-translation-workflow-es" >Español</option>
        <option value="/optimize-translation-workflow-hi" >हिंदी</option>
        <option value="/optimize-translation-workflow-fr" >Français</option>
        <option value="/optimize-translation-workflow-de" >Deutsch</option>
        <option value="/optimize-translation-workflow-ar" >العربية</option>
        <option value="/optimize-translation-workflow-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="thoughts-on-optimizing-your-translation-workflow">Thoughts on Optimizing Your Translation Workflow</h3>

<p>Your goal is clear: minimize AI token usage for translating Jekyll blog posts (written in Markdown) into 8 languages by only re-translating changed or new paragraphs, while caching unchanged ones. You want to stick with Markdown for editing, avoid databases/JSON/YAML for core content, and handle special elements like code blocks (which shouldn’t be translated). A paragraph-based approach makes sense because it aligns with how you write and edit—translations can be more contextually accurate at that level than sentences.</p>

<p>Key challenges:</p>
<ul>
  <li><strong>Identifying changes</strong>: Without version control diffs, you need a way to detect what’s new/changed/unchanged. Hashing paragraphs (e.g., using SHA-256 on normalized English text) is efficient and stateless—no need for storing full old versions.</li>
  <li><strong>Handling Markdown structure</strong>: You can’t just split on <code class="language-plaintext highlighter-rouge">\n\n</code> because code blocks, headers, lists, or other syntax could break things. A simple regex-based splitter might work for basic posts, but a lightweight Markdown parser is better to preserve structure and skip non-translatable parts.</li>
  <li><strong>Caching</strong>: Keep it file-based and simple (e.g., a JSON file or directory of files) to avoid databases. Cache per-paragraph-hash, per-language.</li>
  <li><strong>Token savings</strong>: For long posts, this could cut usage by 80-90% on minor edits, as only affected paragraphs hit the AI API.</li>
  <li><strong>Edge cases</strong>: Added/deleted paragraphs (handle by hashing anew); minor tweaks (e.g., typo fixes) will trigger re-translation unless you normalize whitespace/punctuation; code blocks or inline code must be excluded; if paragraphs reorder, hashes won’t match, but that’s fine if you treat them as “new.”</li>
  <li><strong>Integration</strong>: Run this as a pre-build script in your Jekyll workflow (e.g., via a bash script or Git hook). No need for Jekyll plugins if you generate translated Markdown files separately.</li>
</ul>

<p>This is preferable over sentence-level (less accurate context for AI) or full-post (no savings). YAML/JSON would indeed be cumbersome for writing ideas—stick to Markdown.</p>

<h3 id="proposed-best-way-paragraph-hashing-with-caching-and-markdown-aware-parsing">Proposed Best Way: Paragraph-Hashing with Caching and Markdown-Aware Parsing</h3>

<p>Use a Python script to:</p>
<ol>
  <li>Parse the English Markdown into “translatable units” (paragraphs, excluding code blocks, headers if desired, etc.).</li>
  <li>Hash each unit’s English text (normalized, e.g., strip extra whitespace).</li>
  <li>Check a file-based cache for existing translations by hash/language.</li>
  <li>Translate missing ones via your AI tool (e.g., DeepSeek/Mistral API).</li>
  <li>Cache new translations.</li>
  <li>Reassemble translated Markdown files, preserving non-translatable parts.</li>
</ol>

<p><strong>Why this is best</strong>:</p>
<ul>
  <li><strong>Simple and low-overhead</strong>: No DB, just files. Runs locally/offline except for AI calls.</li>
  <li><strong>Flexible</strong>: Handles code blocks by skipping them. Extendable to other Markdown elements (e.g., don’t translate headers if they’re short).</li>
  <li><strong>Cost-effective</strong>: Only pays for new/changed paragraphs. For a 10-paragraph post, editing one saves ~90% tokens.</li>
  <li><strong>Maintainable</strong>: Edit English Markdown naturally; script handles the rest.</li>
  <li><strong>Tools needed</strong>: Python (you likely have it). Libraries: <code class="language-plaintext highlighter-rouge">hashlib</code> (built-in for hashing), <code class="language-plaintext highlighter-rouge">markdown</code> or <code class="language-plaintext highlighter-rouge">mistune</code> for parsing (if needed; start simple with regex for your “no special syntax” case).</li>
</ul>

<h4 id="step-by-step-implementation">Step-by-Step Implementation</h4>

<ol>
  <li><strong>Setup</strong>:
    <ul>
      <li>Create a <code class="language-plaintext highlighter-rouge">translations_cache.json</code> file (or a directory like <code class="language-plaintext highlighter-rouge">cache/</code> with hash.json files for scalability).</li>
      <li>Structure: <code class="language-plaintext highlighter-rouge">{ "hash1": { "fr": "translated text", "es": "...", ... }, "hash2": { ... } }</code></li>
      <li>Store this in your blog repo (git-ignore if sensitive) or a separate dir.</li>
      <li>List your 8 languages in the script (e.g., [‘fr’, ‘es’, ‘de’, …]).</li>
    </ul>
  </li>
  <li><strong>Parsing Markdown</strong>:
    <ul>
      <li>For simple cases (paragraphs + code blocks): Use line-by-line processing to detect fenced code blocks (``````` or <code class="language-plaintext highlighter-rouge">~~~</code>) and indented code (&gt;3 spaces).</li>
      <li>Collect “paragraphs” as blocks of consecutive non-code, non-blank lines.</li>
      <li>Better: Use Python’s <code class="language-plaintext highlighter-rouge">markdown</code> library to convert to HTML, then extract text, but that’s lossy for reassembly. Instead, use <code class="language-plaintext highlighter-rouge">mistune</code> (a fast Markdown parser) to get an AST (abstract syntax tree), which lets you traverse and modify translatable nodes (e.g., ‘paragraph’ nodes).</li>
      <li>Install <code class="language-plaintext highlighter-rouge">mistune</code> if needed (but your env has basics; assume you can pip it locally).</li>
    </ul>
  </li>
  <li><strong>Hashing</strong>:
    <ul>
      <li>Normalize: <code class="language-plaintext highlighter-rouge">text.strip().lower()</code> or just <code class="language-plaintext highlighter-rouge">.strip()</code> to ignore whitespace changes if desired (but that might miss intentional edits).</li>
      <li>Hash: <code class="language-plaintext highlighter-rouge">hashlib.sha256(normalized.encode()).hexdigest()</code></li>
    </ul>
  </li>
  <li><strong>Translation</strong>:
    <ul>
      <li>Use your AI API wrapper (e.g., for DeepSeek: send prompt like “Translate this paragraph to French: {text}”).</li>
      <li>Batch if possible, but since paragraphs are small, sequential is fine.</li>
    </ul>
  </li>
  <li><strong>Reassembly</strong>:
    <ul>
      <li>Rebuild the Markdown by replacing translatable blocks with cached/new translations, keeping code/headers intact.</li>
    </ul>
  </li>
  <li><strong>Script Execution</strong>:
    <ul>
      <li>Run: <code class="language-plaintext highlighter-rouge">python translate_blog.py path/to/english.md</code></li>
      <li>Outputs: <code class="language-plaintext highlighter-rouge">path/to/fr.md</code>, <code class="language-plaintext highlighter-rouge">path/to/es.md</code>, etc.</li>
      <li>For Jekyll: Place these in <code class="language-plaintext highlighter-rouge">_posts/</code> with lang prefixes, or use a multilingual plugin like <code class="language-plaintext highlighter-rouge">jekyll-polyglot</code> to handle.</li>
    </ul>
  </li>
</ol>

<h4 id="sample-python-script">Sample Python Script</h4>

<p>Here’s a basic version using line-by-line parsing (no external libs beyond built-ins). It assumes simple Markdown: paragraphs separated by blank lines, fenced code blocks. Upgrade to <code class="language-plaintext highlighter-rouge">mistune</code> for complex syntax.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c1"># Assume you have an AI translate function; replace with your DeepSeek/Mistral API call
</span><span class="k">def</span> <span class="nf">ai_translate</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lang</span><span class="p">):</span>
    <span class="c1"># Placeholder: return API call result
</span>    <span class="k">return</span> <span class="sa">f</span><span class="s">"Translated to </span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s">"</span>  <span class="c1"># Replace with real API
</span>
<span class="n">CACHE_FILE</span> <span class="o">=</span> <span class="s">'translations_cache.json'</span>
<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'fr'</span><span class="p">,</span> <span class="s">'es'</span><span class="p">,</span> <span class="s">'de'</span><span class="p">,</span> <span class="s">'it'</span><span class="p">,</span> <span class="s">'pt'</span><span class="p">,</span> <span class="s">'zh'</span><span class="p">,</span> <span class="s">'ja'</span><span class="p">,</span> <span class="s">'ko'</span><span class="p">]</span>  <span class="c1"># Your 8 languages
</span>
<span class="k">def</span> <span class="nf">load_cache</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">save_cache</span><span class="p">(</span><span class="n">cache</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">compute_hash</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Customize normalization
</span>    <span class="k">return</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">normalized</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">parse_markdown</span><span class="p">(</span><span class="n">md_text</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">md_text</span><span class="p">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_block</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_code</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">startswith</span><span class="p">(</span><span class="s">'```'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">startswith</span><span class="p">(</span><span class="s">'~~~'</span><span class="p">):</span>
            <span class="n">in_code</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">in_code</span>
            <span class="k">if</span> <span class="n">current_block</span><span class="p">:</span>
                <span class="n">blocks</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="s">'text'</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_block</span><span class="p">)))</span>
                <span class="n">current_block</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">blocks</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="s">'code'</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">in_code</span><span class="p">:</span>
            <span class="n">blocks</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="s">'code'</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>  <span class="c1"># Non-blank
</span>                <span class="n">current_block</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_block</span><span class="p">:</span>
                    <span class="n">blocks</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="s">'text'</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_block</span><span class="p">)))</span>
                    <span class="n">current_block</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">current_block</span><span class="p">:</span>
        <span class="n">blocks</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="s">'text'</span><span class="p">,</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_block</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">blocks</span>

<span class="k">def</span> <span class="nf">translate_post</span><span class="p">(</span><span class="n">english_md_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">english_md_path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">md_text</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="n">blocks</span> <span class="o">=</span> <span class="n">parse_markdown</span><span class="p">(</span><span class="n">md_text</span><span class="p">)</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">load_cache</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">:</span>
        <span class="n">translated_blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">block_type</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">block_type</span> <span class="o">==</span> <span class="s">'code'</span><span class="p">:</span>
                <span class="n">translated_blocks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># text
</span>                <span class="n">h</span> <span class="o">=</span> <span class="n">compute_hash</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
                    <span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">]:</span>
                    <span class="n">translation</span> <span class="o">=</span> <span class="n">ai_translate</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
                    <span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">translation</span>
                <span class="n">translated_blocks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cache</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="n">lang</span><span class="p">])</span>
        
        <span class="c1"># Reassemble with newlines
</span>        <span class="n">translated_md</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">translated_blocks</span><span class="p">)</span>  <span class="c1"># Adjust for Markdown formatting
</span>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">english_md_path</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.md'</span><span class="p">,</span> <span class="sa">f</span><span class="s">'_</span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s">.md'</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">translated_md</span><span class="p">)</span>
    
    <span class="n">save_cache</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Translations updated."</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Usage: python script.py path/to/english.md"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">translate_post</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>

<p><strong>How to use</strong>:</p>
<ul>
  <li>Replace <code class="language-plaintext highlighter-rouge">ai_translate</code> with your API logic.</li>
  <li>Run on your post file after edits.</li>
  <li>For headers/lists: Extend <code class="language-plaintext highlighter-rouge">parse_markdown</code> to detect (e.g., lines starting with <code class="language-plaintext highlighter-rouge">#</code> or <code class="language-plaintext highlighter-rouge">-</code> as separate blocks).</li>
  <li>If posts have images/links: They stay unchanged since they’re in text blocks.</li>
  <li>Normalization tip: If you want to ignore minor punctuation changes, use regex to strip them before hashing.</li>
</ul>

<h4 id="enhancements">Enhancements</h4>
<ul>
  <li><strong>Git integration</strong>: Use <code class="language-plaintext highlighter-rouge">git diff</code> to pre-identify changed lines, but hashing is simpler.</li>
  <li><strong>Batch translation</strong>: If API supports, send multiple new paragraphs at once.</li>
  <li><strong>Error handling</strong>: Retry failed API calls; validate translations.</li>
  <li><strong>Advanced parsing</strong>: Pip <code class="language-plaintext highlighter-rouge">mistune</code> and use its renderer to customize (e.g., skip ‘code_block’ nodes).</li>
  <li><strong>Testing</strong>: Hash collisions are rare with SHA-256; test on sample posts.</li>
</ul>

<p>This should save you tokens without complicating your workflow. If your Markdown is more complex, start with this and iterate. Let me know if you need tweaks or help with the API integration!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
