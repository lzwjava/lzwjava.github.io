<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>qBittorrent File Verification: SHA-1 Hashing</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>qBittorrent File Verification: SHA-1 Hashing | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="qBittorrent File Verification: SHA-1 Hashing" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-03-16-qbittorrent-sha1-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-03-16-qbittorrent-sha1-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="qBittorrent File Verification: SHA-1 Hashing" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"qBittorrent File Verification: SHA-1 Hashing","url":"https://lzwjava.github.io/notes/2025-03-16-qbittorrent-sha1-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=a5a04c3c98e1a28882c6e06c111ede2f52d60d5c">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=a5a04c3c98e1a28882c6e06c111ede2f52d60d5c" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       qBittorrent File Verification: SHA-1 Hashing | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-03-16-qbittorrent-sha1-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-03-16-qbittorrent-sha1-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/qbittorrent-sha1-en" selected>English</option>
        <option value="/qbittorrent-sha1-zh" >中文</option>
        <option value="/qbittorrent-sha1-ja" >日本語</option>
        <option value="/qbittorrent-sha1-es" >Español</option>
        <option value="/qbittorrent-sha1-hi" >हिंदी</option>
        <option value="/qbittorrent-sha1-fr" >Français</option>
        <option value="/qbittorrent-sha1-de" >Deutsch</option>
        <option value="/qbittorrent-sha1-ar" >العربية</option>
        <option value="/qbittorrent-sha1-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>When you move file locations in qBittorrent and it checks the files again before seeding, it’s ensuring that the files in the new location are the same as the ones it was originally working with. This verification is critical in torrenting to prevent sharing incorrect or corrupted data. Here’s how the process works and what algorithm it uses:</p>

<h3 id="how-qbittorrent-verifies-files">How qBittorrent Verifies Files</h3>
<p>qBittorrent doesn’t simply trust that the moved files are correct—it checks their integrity by comparing them to information stored in the torrent file. In torrenting, data is split into smaller chunks called <strong>pieces</strong>, and each piece has a unique hash value. These hashes are included in the torrent file and act as a fingerprint for each piece of data. When you move files to a new location, qBittorrent uses these piece hashes to confirm that the files haven’t changed.</p>

<p>The process can be broken down into these steps:</p>

<ol>
  <li><strong>Specify the New Location</strong>: You tell qBittorrent where the files are now located by setting the new file path.</li>
  <li><strong>Map Files to the Torrent</strong>: qBittorrent matches the files in the new location to the files listed in the torrent, typically using file names and sizes (since this info is in the torrent file).</li>
  <li><strong>Verify Piece Hashes</strong>: qBittorrent reads the data from the new files piece by piece, calculates a hash for each piece, and compares it to the corresponding hash stored in the torrent file.</li>
  <li><strong>Confirm Integrity</strong>: If all the calculated hashes match the torrent’s hashes, the files are confirmed to be identical, and qBittorrent can resume seeding. If any piece’s hash doesn’t match, that piece is flagged as incomplete or missing, and qBittorrent may need to redownload it.</li>
</ol>

<h3 id="what-algorithm-does-it-use">What Algorithm Does It Use?</h3>
<p>qBittorrent doesn’t use a full-file checksum (like MD5 or SHA-256 for the entire file), as that would be slow and inefficient, especially for large files. Instead, it relies on the <strong>piece hashes</strong> defined by the BitTorrent protocol. The algorithm used for these piece hashes is <strong>SHA-1</strong>, a widely used cryptographic hash function. Each piece of data (which could be a few kilobytes to a few megabytes, depending on the torrent) is hashed with SHA-1, and those hashes are what qBittorrent checks against.</p>

<p>Using piece hashes instead of a full-file checksum has two big advantages:</p>
<ul>
  <li><strong>Efficiency</strong>: Checking smaller pieces is faster than hashing an entire file.</li>
  <li><strong>Granularity</strong>: If something’s wrong, qBittorrent can pinpoint exactly which pieces need fixing, rather than rejecting the whole file.</li>
</ul>

<h3 id="why-this-matters">Why This Matters</h3>
<p>This hash-based verification ensures that the data you’re seeding from the new location matches what other peers expect, maintaining the integrity of the torrent swarm. Without this check, moving files could lead to sharing corrupted or mismatched data, which would disrupt the torrenting process.</p>

<p>In short, when you move file locations in qBittorrent, it rechecks the files by computing <strong>SHA-1 hashes</strong> of each piece and comparing them to the hashes in the torrent file. That’s how it confirms everything’s correct before seeding resumes.</p>

<hr />

<p>To demonstrate how qBittorrent verifies file integrity using piece hashes (specifically SHA-1 hashes) when moving file locations, here’s a simple Python script. qBittorrent, following the BitTorrent protocol, splits files into pieces, computes SHA-1 hashes for each piece, and uses these hashes to ensure the file’s content remains unchanged, regardless of its location. This script simulates that process by creating a sample file, computing its piece hashes, verifying an identical copy, and then showing how modification causes verification to fail.</p>

<h3 id="explanation">Explanation</h3>
<ul>
  <li><strong>Piece Hashes</strong>: The script splits a file into fixed-size pieces (e.g., 10 bytes) and computes SHA-1 hashes for each piece, mimicking how a torrent file stores these hashes.</li>
  <li><strong>Verification</strong>: It checks if a file’s computed hashes match the expected hashes, ensuring integrity.</li>
  <li><strong>Simulation</strong>: It creates a file, copies it (simulating a move), verifies it, then modifies the copy and verifies again to show how changes are detected.</li>
</ul>

<p>Here’s the script with comments for clarity:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">compute_piece_hashes</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">piece_size</span><span class="p">):</span>
    <span class="s">"""Compute SHA-1 hashes for each piece of the file."""</span>
    <span class="n">hashes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">piece</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">piece_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">piece</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">hash_obj</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span>
            <span class="n">hashes</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">hash_obj</span><span class="p">.</span><span class="n">hexdigest</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">hashes</span>

<span class="k">def</span> <span class="nf">verify_file_integrity</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">piece_size</span><span class="p">,</span> <span class="n">expected_hashes</span><span class="p">):</span>
    <span class="s">"""Verify the file's integrity by comparing piece hashes."""</span>
    <span class="n">current_hashes</span> <span class="o">=</span> <span class="n">compute_piece_hashes</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">piece_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_hashes</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_hashes</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">current</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">current_hashes</span><span class="p">,</span> <span class="n">expected_hashes</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">!=</span> <span class="n">expected</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="c1"># Create a sample file with known content
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file1.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"Hello, this is a test file."</span><span class="p">)</span>

<span class="n">piece_size</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># bytes, small for demonstration
</span>
<span class="c1"># Compute expected hashes from file1.txt (simulates torrent hashes)
</span><span class="n">expected_hashes</span> <span class="o">=</span> <span class="n">compute_piece_hashes</span><span class="p">(</span><span class="s">'file1.txt'</span><span class="p">,</span> <span class="n">piece_size</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Expected hashes:"</span><span class="p">,</span> <span class="p">[</span><span class="n">h</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">expected_hashes</span><span class="p">])</span>  <span class="c1"># Show first 8 chars for readability
</span>
<span class="c1"># Copy file1.txt to file2.txt to simulate moving the file
</span><span class="n">shutil</span><span class="p">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s">'file1.txt'</span><span class="p">,</span> <span class="s">'file2.txt'</span><span class="p">)</span>

<span class="c1"># Verify file2.txt against expected hashes (should pass)
</span><span class="n">is_valid</span> <span class="o">=</span> <span class="n">verify_file_integrity</span><span class="p">(</span><span class="s">'file2.txt'</span><span class="p">,</span> <span class="n">piece_size</span><span class="p">,</span> <span class="n">expected_hashes</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Verification of file2.txt (unchanged):"</span><span class="p">,</span> <span class="s">"Valid"</span> <span class="k">if</span> <span class="n">is_valid</span> <span class="k">else</span> <span class="s">"Invalid"</span><span class="p">)</span>

<span class="c1"># Modify file2.txt to simulate corruption or change
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file2.txt'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">" Modified"</span><span class="p">)</span>

<span class="c1"># Verify again (should fail due to changed content)
</span><span class="n">is_valid</span> <span class="o">=</span> <span class="n">verify_file_integrity</span><span class="p">(</span><span class="s">'file2.txt'</span><span class="p">,</span> <span class="n">piece_size</span><span class="p">,</span> <span class="n">expected_hashes</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Verification of file2.txt (modified):"</span><span class="p">,</span> <span class="s">"Valid"</span> <span class="k">if</span> <span class="n">is_valid</span> <span class="k">else</span> <span class="s">"Invalid"</span><span class="p">)</span>

<span class="c1"># Clean up the created files
</span><span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'file1.txt'</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'file2.txt'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="how-it-works">How It Works</h3>
<ol>
  <li><strong>File Creation</strong>: Writes “Hello, this is a test file.” (25 bytes) to <code class="language-plaintext highlighter-rouge">file1.txt</code>.</li>
  <li><strong>Hash Computation</strong>: Splits <code class="language-plaintext highlighter-rouge">file1.txt</code> into pieces of 10 bytes each (e.g., “Hello, thi”, “s is a tes”, “t file.”), computes SHA-1 hashes, and stores them as <code class="language-plaintext highlighter-rouge">expected_hashes</code>.</li>
  <li><strong>Simulate Move</strong>: Copies <code class="language-plaintext highlighter-rouge">file1.txt</code> to <code class="language-plaintext highlighter-rouge">file2.txt</code>, representing a file moved to a new location.</li>
  <li><strong>Initial Verification</strong>: Checks <code class="language-plaintext highlighter-rouge">file2.txt</code> against <code class="language-plaintext highlighter-rouge">expected_hashes</code>. Since the content is identical, it prints “Valid”.</li>
  <li><strong>Modification</strong>: Appends “ Modified” to <code class="language-plaintext highlighter-rouge">file2.txt</code>, altering its content and size (now 34 bytes, split into 4 pieces).</li>
  <li><strong>Second Verification</strong>: Checks the modified <code class="language-plaintext highlighter-rouge">file2.txt</code>. The number of pieces or their hashes differ, so it prints “Invalid”.</li>
  <li><strong>Cleanup</strong>: Deletes the temporary files.</li>
</ol>

<h3 id="output-example">Output Example</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Expected hashes: ['dffd6021', 'a2b3c4d5', 'e6f789ab']  # Example hash prefixes
Verification of file2.txt (unchanged): Valid
Verification of file2.txt (modified): Invalid
</code></pre></div></div>
<p>(Actual hash values will vary but follow this pattern.)</p>

<p>This script illustrates how qBittorrent ensures file integrity by comparing piece hashes, detecting any changes even after a file is moved, making it a simple yet effective demonstration of the process.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
