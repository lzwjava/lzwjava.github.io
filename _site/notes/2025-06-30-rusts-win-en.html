<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Discord's Rust Performance Boost</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Discord’s Rust Performance Boost | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Discord’s Rust Performance Boost" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-06-30-rusts-win-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-06-30-rusts-win-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Discord’s Rust Performance Boost" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Discord’s Rust Performance Boost","url":"https://lzwjava.github.io/notes/2025-06-30-rusts-win-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=956e76582f38f8dff9432f02e88a54c05d87b69e">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=956e76582f38f8dff9432f02e88a54c05d87b69e" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Discord's Rust Performance Boost | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-06-30-rusts-win-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-06-30-rusts-win-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.09</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/rusts-win-en" selected>English</option>
        <option value="/rusts-win-zh" >中文</option>
        <option value="/rusts-win-ja" >日本語</option>
        <option value="/rusts-win-es" >Español</option>
        <option value="/rusts-win-hi" >हिंदी</option>
        <option value="/rusts-win-fr" >Français</option>
        <option value="/rusts-win-de" >Deutsch</option>
        <option value="/rusts-win-ar" >العربية</option>
        <option value="/rusts-win-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Discord’s adoption of Rust was driven by performance bottlenecks in their Go-based “Read States” service, which tracks user message reads across channels. The switch to Rust delivered significant latency improvements, eliminated garbage collection spikes, and showcased Rust’s strengths in memory management and concurrency. Here’s a detailed breakdown:</p>

<hr />

<h3 id="why-discord-switched-to-rust"><strong>Why Discord Switched to Rust</strong></h3>
<ol>
  <li><strong>Garbage Collection (GC) Issues in Go</strong>
    <ul>
      <li>Discord’s Go service experienced latency spikes every ~2 minutes due to Go’s conservative, non-generational GC, which <em>had to scan the entire LRU cache</em> (containing millions of objects) even with minimal garbage production .</li>
      <li>Tuning Go’s GC (e.g., adjusting cache size) either failed to resolve spikes or worsened 99th-percentile latency .</li>
    </ul>
  </li>
  <li><strong>Rust’s Memory Management</strong>
    <ul>
      <li>Rust’s ownership model <em>immediately frees memory</em> upon eviction from the LRU cache, avoiding GC-induced pauses. This deterministic approach eliminated latency spikes .</li>
      <li>No runtime GC overhead meant consistent performance under high load (hundreds of thousands of updates/sec) .</li>
    </ul>
  </li>
  <li><strong>Performance Optimization</strong>
    <ul>
      <li>Even a naive Rust implementation matched Go’s performance. Further optimizations (e.g., using <code class="language-plaintext highlighter-rouge">BTreeMap</code> instead of <code class="language-plaintext highlighter-rouge">HashMap</code>, reducing memory copies) <em>lowered CPU usage by 70%</em> and cut average response times to microseconds .</li>
    </ul>
  </li>
  <li><strong>Ecosystem and Async Support</strong>
    <ul>
      <li>Discord embraced Rust’s nightly async features early (later stabilized), enabling efficient networked services without GC trade-offs .</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="results-of-the-switch"><strong>Results of the Switch</strong></h3>
<ul>
  <li><strong>Latency</strong>: Eliminated 2-minute GC spikes, achieving sub-millisecond response times .</li>
  <li><strong>Resource Efficiency</strong>: Reduced CPU and memory usage, allowing cache capacity to scale to 8 million read states without performance degradation .</li>
  <li><strong>Reliability</strong>: Fewer runtime bugs due to Rust’s compile-time safety checks .</li>
</ul>

<hr />

<h3 id="advantages-of-rust-for-discord"><strong>Advantages of Rust for Discord</strong></h3>
<ol>
  <li><strong>Performance</strong>
    <ul>
      <li>Predictable low latency, ideal for real-time services .</li>
      <li>Fine-grained memory control outperforms GC-dependent languages .</li>
    </ul>
  </li>
  <li><strong>Safety</strong>
    <ul>
      <li>Ownership model prevents memory leaks, null pointers, and data races .</li>
      <li>Concurrency safety without manual synchronization .</li>
    </ul>
  </li>
  <li><strong>Modern Tooling</strong>
    <ul>
      <li>Cargo (package manager) and rich generics reduced boilerplate vs. Go .</li>
    </ul>
  </li>
  <li><strong>Ecosystem Growth</strong>
    <ul>
      <li>Upgrades (e.g., Tokio async runtime) delivered free performance gains .</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="disadvantages--challenges"><strong>Disadvantages &amp; Challenges</strong></h3>
<ol>
  <li><strong>Learning Curve</strong>
    <ul>
      <li>Rust’s ownership and lifetimes require upfront investment .</li>
    </ul>
  </li>
  <li><strong>Early Async Limitations</strong>
    <ul>
      <li>Initial reliance on unstable nightly features posed maintenance risks .</li>
    </ul>
  </li>
  <li><strong>Smaller Ecosystem</strong>
    <ul>
      <li>Fewer libraries compared to Go or C++, though growing rapidly .</li>
    </ul>
  </li>
</ol>

<hr />

<h3 id="key-takeaways"><strong>Key Takeaways</strong></h3>
<p>Discord’s success with Rust highlights its fit for <em>latency-sensitive, high-scale services</em> where GC pauses are unacceptable. While the transition required overcoming Rust’s steep learning curve, the payoff included <strong>faster performance, lower resource usage, and fewer runtime errors</strong> . For teams prioritizing long-term maintainability and performance, Rust offers compelling advantages over GC-reliant languages like Go.</p>

<p>For deeper technical insights, refer to Discord’s <a href="https://discord.com/blog/why-discord-is-switching-from-go-to-rust">original blog post</a> .</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
