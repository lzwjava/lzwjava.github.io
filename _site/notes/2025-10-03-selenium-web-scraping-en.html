<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Selenium Web Scraping Code Explanation</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Selenium Web Scraping Code Explanation | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Selenium Web Scraping Code Explanation" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-10-03-selenium-web-scraping-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-10-03-selenium-web-scraping-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Selenium Web Scraping Code Explanation" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Selenium Web Scraping Code Explanation","url":"https://lzwjava.github.io/notes/2025-10-03-selenium-web-scraping-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=e8544ebb8cd270e46ba5d6942d874dd40bd87619">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=e8544ebb8cd270e46ba5d6942d874dd40bd87619" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Selenium Web Scraping Code Explanation | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-10-03-selenium-web-scraping-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-10-03-selenium-web-scraping-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/selenium-web-scraping-en" selected>English</option>
        <option value="/selenium-web-scraping-zh" >中文</option>
        <option value="/selenium-web-scraping-ja" >日本語</option>
        <option value="/selenium-web-scraping-es" >Español</option>
        <option value="/selenium-web-scraping-hi" >हिंदी</option>
        <option value="/selenium-web-scraping-fr" >Français</option>
        <option value="/selenium-web-scraping-de" >Deutsch</option>
        <option value="/selenium-web-scraping-ar" >العربية</option>
        <option value="/selenium-web-scraping-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="explanation-of-selenium-api-usage-in-the-provided-code">Explanation of Selenium API Usage in the Provided Code</h3>

<p>This Python script uses the <strong>Selenium WebDriver</strong> library to automate a web browser (specifically Chrome) for interacting with a website (likely a data/trade portal at <code class="language-plaintext highlighter-rouge">https://xxdata.com/index.aspx</code>). The goal appears to be web scraping: logging in, searching for trade/order data (using a HS code like ‘8449’), navigating through paginated results, clicking on details, extracting structured data from HTML tables, and storing it in a SQLite database (<code class="language-plaintext highlighter-rouge">data.db</code>).</p>

<p>Selenium is used here for <strong>browser automation</strong>, allowing the script to mimic human interactions like typing, clicking, scrolling, and waiting for page loads—something that’s hard or impossible with simple HTTP requests (e.g., due to JavaScript-heavy pages, iframes, or dynamic content). It handles dynamic web elements, sessions, and multi-window/iframe switching, which are common in modern web apps.</p>

<p>I’ll break it down <strong>section by section</strong>, highlighting key Selenium APIs, their purpose, and how they’re used. Note: Some methods in the code (e.g., <code class="language-plaintext highlighter-rouge">find_element_by_css_selector</code>) are from older Selenium versions (pre-4.0) and are deprecated. In modern Selenium (4+), you’d use <code class="language-plaintext highlighter-rouge">find_element(By.CSS_SELECTOR, ...)</code> instead, but the functionality is the same. The script also imports necessary modules for waits, exceptions, and element handling.</p>

<h4 id="1-imports-and-setup-selenium-initialization">1. <strong>Imports and Setup (Selenium Initialization)</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
   <span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.webdriver</span> <span class="kn">import</span> <span class="n">WebDriver</span>
   <span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
   <span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span><span class="p">,</span> <span class="n">ElementClickInterceptedException</span><span class="p">,</span> <span class="n">StaleElementReferenceException</span>
   <span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
   <span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
   <span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
   <span class="kn">from</span> <span class="nn">selenium.webdriver.remote.webelement</span> <span class="kn">import</span> <span class="n">WebElement</span>
</code></pre></div></div>
<ul>
  <li><strong>Purpose</strong>: These import core Selenium components:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">webdriver</code>: Main module for controlling the browser.</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriver</code>: Type hint for the browser instance (ensures type safety).</li>
      <li><code class="language-plaintext highlighter-rouge">Keys</code>: For simulating keyboard inputs (e.g., Page Up).</li>
      <li>Exceptions: Handle common errors like timeouts or stale elements (elements that change after a page refresh).</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriverWait</code> and <code class="language-plaintext highlighter-rouge">EC</code> (Expected Conditions): For explicit waits—polling until an element meets a condition (e.g., present on page).</li>
      <li><code class="language-plaintext highlighter-rouge">By</code>: Locator strategies (e.g., CSS selector, ID, tag name) to find elements.</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement</code>: Represents HTML elements for interaction.</li>
    </ul>
  </li>
</ul>

<p>In <code class="language-plaintext highlighter-rouge">run()</code> function:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
   <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--start-maximized"</span><span class="p">)</span>  <span class="c1"># Opens browser in full screen.
</span>   <span class="n">options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--log-level=3'</span><span class="p">)</span>      <span class="c1"># Suppresses console logs for cleaner output.
</span>   <span class="n">browser</span><span class="p">:</span> <span class="n">WebDriver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">executable_path</span><span class="o">=</span><span class="s">"./chromedriver"</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</code></pre></div></div>
<ul>
  <li><strong>Selenium API Used</strong>: <code class="language-plaintext highlighter-rouge">webdriver.Chrome(options=...)</code>
    <ul>
      <li>Initializes a Chrome browser instance using a local <code class="language-plaintext highlighter-rouge">chromedriver</code> executable (must be in the script’s directory).</li>
      <li><code class="language-plaintext highlighter-rouge">ChromeOptions</code>: Customizes the browser session (e.g., headless mode could be added with <code class="language-plaintext highlighter-rouge">options.add_argument("--headless")</code> for background running).</li>
      <li>This creates a live, controllable browser window. Selenium acts as a bridge between Python and the browser’s DevTools protocol.</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://xxdata.com/index.aspx'</span><span class="p">)</span>
</code></pre></div></div>
<ul>
  <li><strong>Selenium API Used</strong>: <code class="language-plaintext highlighter-rouge">WebDriver.get(url)</code>
    <ul>
      <li>Navigates to the starting URL, loading the page like a user typing it in the address bar.</li>
    </ul>
  </li>
</ul>

<h4 id="2-login-process">2. <strong>Login Process</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">input_username</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'input[name=username]'</span><span class="p">)</span>
   <span class="n">input_username</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span>
   <span class="n">input_password</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'input[name=password]'</span><span class="p">)</span>
   <span class="n">input_password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'password'</span><span class="p">)</span>
   <span class="n">btn_login</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'div.login-check'</span><span class="p">)</span>
   <span class="n">btn_login</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.find_element_by_css_selector(css)</code> (deprecated; modern: <code class="language-plaintext highlighter-rouge">find_element(By.CSS_SELECTOR, css)</code>): Locates a single HTML element using a CSS selector (e.g., by attribute like <code class="language-plaintext highlighter-rouge">name="username"</code>). Returns a <code class="language-plaintext highlighter-rouge">WebElement</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement.send_keys(text)</code>: Simulates typing into an input field (e.g., username/password).</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement.click()</code>: Simulates a mouse click on a button or link.</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Automates form submission. Without Selenium, you’d need to reverse-engineer POST requests, but this handles JavaScript validation or dynamic forms seamlessly. Credentials are hardcoded (insecure in production—use env vars).</li>
</ul>

<p>After login:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">wait_element</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="s">'div.dsh_01'</span><span class="p">)</span>
</code></pre></div></div>
<ul>
  <li>Calls a custom <code class="language-plaintext highlighter-rouge">wait_element</code> function (explained below) to pause until the dashboard loads.</li>
</ul>

<h4 id="3-navigation-and-search">3. <strong>Navigation and Search</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">trade_div</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'div.dsh_01'</span><span class="p">)</span>
   <span class="n">trade_div</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
   <span class="n">wait_element</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="s">'a.teq_icon'</span><span class="p">)</span>
   <span class="n">teq</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'a.teq_icon'</span><span class="p">)</span>
   <span class="n">teq</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
   <span class="n">wait_element</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="s">'div.panel-body'</span><span class="p">)</span>
   <span class="n">iframe</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'div.panel-body &gt; iframe'</span><span class="p">)</span>
   <span class="n">iframe_id</span> <span class="o">=</span> <span class="n">iframe</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">'id'</span><span class="p">)</span>
   <span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">iframe_id</span><span class="p">)</span>
</code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">find_element_by_css_selector</code>: Locates navigation elements (e.g., dashboard div, icon link).</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement.click()</code>: Clicks to navigate (e.g., to a “trade” section).</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement.get_attribute('id')</code>: Retrieves an HTML attribute (here, iframe’s ID).</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.switch_to.frame(frame_id)</code>: Switches the driver context to an <code class="language-plaintext highlighter-rouge">&lt;iframe&gt;</code> (common in apps for embedding content). Without this, elements inside the iframe are inaccessible.</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Handles multi-step navigation and embedded content. Iframes isolate DOMs, so switching is essential for scraping inner pages.</li>
</ul>

<p>Search process:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">input_search</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'_easyui_textbox_input7'</span><span class="p">)</span>  <span class="c1"># Uses ID locator.
</span>   <span class="n">input_search</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'8449'</span><span class="p">)</span>
   <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
   <span class="n">enter</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'a#btnOk &gt; div.enter-bt'</span><span class="p">)</span>
   <span class="n">enter</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">find_element_by_id(id)</code> (deprecated; modern: <code class="language-plaintext highlighter-rouge">find_element(By.ID, id)</code>): Locates by HTML <code class="language-plaintext highlighter-rouge">id</code> attribute.</li>
      <li><code class="language-plaintext highlighter-rouge">send_keys</code>: Types the search query (HS code for products).</li>
      <li><code class="language-plaintext highlighter-rouge">time.sleep(10)</code>: Implicit wait (crude; better to use explicit waits).</li>
      <li><code class="language-plaintext highlighter-rouge">click()</code>: Submits the search.</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Simulates user search. The <code class="language-plaintext highlighter-rouge">time.sleep</code> pauses for AJAX/JavaScript to load results.</li>
</ul>

<h4 id="4-pagination-and-result-processing">4. <strong>Pagination and Result Processing</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">result_count_span</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'span#ResultCount'</span><span class="p">)</span>
   <span class="n">page</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">result_count_span</span><span class="p">.</span><span class="n">text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># Calculates total pages (20 results/page).
</span>   <span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">page</span> <span class="o">=</span> <span class="n">page</span> <span class="o">-</span> <span class="n">skip</span>

   <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
       <span class="n">input_page</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'input.laypage_skip'</span><span class="p">)</span>
       <span class="n">input_page</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">skip</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
       <span class="n">btn_confirm</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'button.laypage_btn'</span><span class="p">)</span>
       <span class="n">btn_confirm</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
       <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

       <span class="n">locates</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s">'div.rownumber-bt'</span><span class="p">)</span>  <span class="c1"># Multiple elements.
</span>       <span class="k">print</span><span class="p">(</span><span class="s">'page '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="s">' size: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">locates</span><span class="p">)))</span>
       <span class="k">for</span> <span class="n">locate</span> <span class="ow">in</span> <span class="n">locates</span><span class="p">:</span>
           <span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">"arguments[0].scrollIntoView();"</span><span class="p">,</span> <span class="n">locate</span><span class="p">)</span>  <span class="c1"># JavaScript scroll.
</span>           <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
           <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_tag_name</span><span class="p">(</span><span class="s">'html'</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">PAGE_UP</span><span class="p">)</span>  <span class="c1"># Keyboard scroll.
</span>           <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
           <span class="k">try</span><span class="p">:</span>
               <span class="n">locate</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
           <span class="k">except</span> <span class="n">ElementClickInterceptedException</span><span class="p">:</span>
               <span class="k">print</span><span class="p">(</span><span class="s">'ElementClickInterceptedException'</span><span class="p">)</span>
               <span class="k">continue</span>
           <span class="k">except</span> <span class="n">StaleElementReferenceException</span><span class="p">:</span>
               <span class="k">print</span><span class="p">(</span><span class="s">'StaleElementReferenceException'</span><span class="p">)</span>
               <span class="k">continue</span>
           <span class="c1"># ... (more below)
</span></code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">find_element_by_css_selector</code>: Gets result count from a span.</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement.text</code>: Extracts visible text from an element (e.g., count like “100”).</li>
      <li><code class="language-plaintext highlighter-rouge">find_elements_by_css_selector</code> (plural; deprecated: <code class="language-plaintext highlighter-rouge">find_elements(By.CSS_SELECTOR, ...)</code>): Finds multiple elements (e.g., row links on a page). Returns a list of <code class="language-plaintext highlighter-rouge">WebElement</code>s.</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.execute_script(js_code, *args)</code>: Runs custom JavaScript in the browser (here, scrolls an element into view to avoid click issues).</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.find_element_by_tag_name('html').send_keys(Keys.PAGE_UP)</code>: Simulates keyboard scrolling (using <code class="language-plaintext highlighter-rouge">Keys</code> enum).</li>
      <li>Exceptions: Catches click failures (e.g., overlay blocks click) or stale elements (DOM refreshed, invalidating references—common in dynamic UIs).</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Automates pagination by typing page numbers and clicking “go.” For each result row (<code class="language-plaintext highlighter-rouge">div.rownumber-bt</code>), it scrolls to ensure visibility, then clicks to open details in a new window. This handles lazy-loaded or infinite-scroll-like behavior.</li>
</ul>

<h4 id="5-windowiframe-switching-and-data-extraction">5. <strong>Window/Iframe Switching and Data Extraction</strong></h4>
<p>Continuing from the loop:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   <span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Switch to new tab/window.
</span>   <span class="n">wait_element</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="s">'div#content'</span><span class="p">)</span>
   <span class="k">try</span><span class="p">:</span>
       <span class="n">save_page</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
   <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
       <span class="k">print</span><span class="p">(</span><span class="s">'IndexError'</span><span class="p">)</span>
       <span class="k">continue</span>
   <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Closes the detail window.
</span>   <span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Back to main window.
</span>   <span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">iframe_id</span><span class="p">)</span>  <span class="c1"># Back to iframe context.
</span></code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.window_handles</code>: List of open window/tab IDs.</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.switch_to.window(handle)</code>: Switches focus to a specific window (index 0 = main, 1 = new tab opened by click).</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriver.close()</code>: Closes the current window.</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Clicks open details in new tabs, so it switches contexts to scrape them, then returns. This is crucial for multi-tab apps.</li>
</ul>

<h4 id="6-data-extraction-in-save_pagebrowser-webdriver-function">6. <strong>Data Extraction in <code class="language-plaintext highlighter-rouge">save_page(browser: WebDriver)</code> Function</strong></h4>
<p>This is the core scraping logic:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">ts</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s">'table'</span><span class="p">)</span>  <span class="c1"># All tables on the page.
</span>   <span class="n">t0</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">tds0</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="n">find_elements_by_tag_name</span><span class="p">(</span><span class="s">'td'</span><span class="p">)</span>  <span class="c1"># TD cells in first table.
</span>   <span class="n">order_number</span> <span class="o">=</span> <span class="n">tds0</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">text</span>  <span class="c1"># Extracts text from specific cells.
</span>   <span class="c1"># ... (similar for other tables: t1, t2, etc.)
</span></code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">find_elements_by_css_selector('table')</code> / <code class="language-plaintext highlighter-rouge">find_elements_by_tag_name('td')</code> (deprecated: use <code class="language-plaintext highlighter-rouge">By.TAG_NAME</code>): Finds all <code class="language-plaintext highlighter-rouge">&lt;table&gt;</code>s and their <code class="language-plaintext highlighter-rouge">&lt;td&gt;</code> cells.</li>
      <li><code class="language-plaintext highlighter-rouge">WebElement.text</code>: Pulls text content from cells (e.g., order number, importer name).</li>
      <li>Custom <code class="language-plaintext highlighter-rouge">tds_to_text(tds: list[WebElement])</code>: Concatenates text from paired <code class="language-plaintext highlighter-rouge">&lt;td&gt;</code>s (e.g., label + value).</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Parses the page’s DOM structure (tables with order/importer/exporter details). It handles variable table counts (e.g., if <code class="language-plaintext highlighter-rouge">len(ts) == 8</code>, extra tables exist). Data is then inserted into SQLite (non-Selenium part).</li>
</ul>

<p>Conditional logic extracts fields like <code class="language-plaintext highlighter-rouge">order_number</code>, <code class="language-plaintext highlighter-rouge">importer</code>, <code class="language-plaintext highlighter-rouge">exporter</code>, etc., based on table indices—assuming a fixed layout.</p>

<h4 id="7-waits-and-error-handling-wait_element-function">7. <strong>Waits and Error Handling (<code class="language-plaintext highlighter-rouge">wait_element</code> Function)</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">def</span> <span class="nf">wait_element</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">css</span><span class="p">):</span>
       <span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span>
       <span class="k">try</span><span class="p">:</span>
           <span class="n">element_present</span> <span class="o">=</span> <span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">css</span><span class="p">))</span>
           <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">timeout</span><span class="p">).</span><span class="n">until</span><span class="p">(</span><span class="n">element_present</span><span class="p">)</span>
       <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
           <span class="k">print</span><span class="p">(</span><span class="s">'Timed out waiting for page to load'</span><span class="p">)</span>
</code></pre></div></div>
<ul>
  <li><strong>Selenium APIs Used</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">expected_conditions.presence_of_element_located(locator)</code>: Waits for an element to exist in the DOM (not necessarily visible).</li>
      <li><code class="language-plaintext highlighter-rouge">WebDriverWait(driver, timeout).until(condition)</code>: Polls every 0.5s up to 30s for the condition.</li>
      <li><code class="language-plaintext highlighter-rouge">TimeoutException</code>: Raised if wait fails.</li>
    </ul>
  </li>
  <li><strong>How Selenium is Used</strong>: Prevents race conditions (e.g., clicking before page loads). Better than <code class="language-plaintext highlighter-rouge">time.sleep</code> as it’s element-specific and efficient.</li>
</ul>

<h4 id="8-cleanup">8. <strong>Cleanup</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Long pause (debugging?).
</span>   <span class="n">browser</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>    <span class="c1"># Closes browser and ends session.
</span></code></pre></div></div>
<ul>
  <li><strong>Selenium API Used</strong>: <code class="language-plaintext highlighter-rouge">WebDriver.quit()</code>: Terminates the driver, closes all windows, and releases resources.</li>
</ul>

<h4 id="overall-how-selenium-fits-in">Overall How Selenium Fits In</h4>
<ul>
  <li><strong>Automation Flow</strong>: Selenium launches a real browser, loads pages, interacts via DOM queries (locators like CSS/ID), and handles dynamic behaviors (JS execution, waits, switches). It’s ideal for SPAs or protected sites with sessions/cookies.</li>
  <li><strong>Strengths Here</strong>: Handles login state, iframes, new tabs, and scrolling—scraping tools like BeautifulSoup/Requests couldn’t do this alone.</li>
  <li><strong>Limitations/Issues in Code</strong>:
    <ul>
      <li>Deprecated locators: Update to <code class="language-plaintext highlighter-rouge">By</code> for future-proofing.</li>
      <li>Hardcoded sleeps: Replace more with waits to speed up/reduce flakiness.</li>
      <li>Exceptions: Good handling, but could retry on StaleElement.</li>
      <li>Ethics/Legality: Scraping may violate terms; add user-agent headers or proxies to mimic humans.</li>
      <li>Performance: Runs headful (visible browser); make headless for production.</li>
    </ul>
  </li>
  <li><strong>Running It</strong>: Requires ChromeDriver (download from Selenium site, match Chrome version). Install Selenium via <code class="language-plaintext highlighter-rouge">pip install selenium</code>.</li>
</ul>

<p>If you have questions about specific parts, modernizing the code, or debugging, let me know!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    
      <p class="model">x-ai/grok-4-fast</p>
    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
