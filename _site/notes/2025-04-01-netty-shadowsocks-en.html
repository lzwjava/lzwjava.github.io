<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Building a Shadowsocks Client with Netty</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Building a Shadowsocks Client with Netty | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Building a Shadowsocks Client with Netty" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-04-01-netty-shadowsocks-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-04-01-netty-shadowsocks-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Building a Shadowsocks Client with Netty" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Building a Shadowsocks Client with Netty","url":"https://lzwjava.github.io/notes/2025-04-01-netty-shadowsocks-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=a767bf1a47c3a4f8af4d08a079a77fcc75eb3aca">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=a767bf1a47c3a4f8af4d08a079a77fcc75eb3aca" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Building a Shadowsocks Client with Netty | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-04-01-netty-shadowsocks-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-04-01-netty-shadowsocks-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/netty-shadowsocks-en" selected>English</option>
        <option value="/netty-shadowsocks-zh" >中文</option>
        <option value="/netty-shadowsocks-ja" >日本語</option>
        <option value="/netty-shadowsocks-es" >Español</option>
        <option value="/netty-shadowsocks-hi" >हिंदी</option>
        <option value="/netty-shadowsocks-fr" >Français</option>
        <option value="/netty-shadowsocks-de" >Deutsch</option>
        <option value="/netty-shadowsocks-ar" >العربية</option>
        <option value="/netty-shadowsocks-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Building a Shadowsocks client like Clash or the original Shadowsocks client using Netty involves understanding the Shadowsocks protocol and leveraging Netty’s asynchronous, event-driven network application framework. Here’s a breakdown of the steps and key concepts involved:</p>

<p><strong>1. Understanding the Shadowsocks Protocol</strong></p>

<p>Before diving into Netty, you need to thoroughly understand the Shadowsocks protocol. At a high level, it involves:</p>

<ul>
  <li><strong>Connection Establishment:</strong> A client initiates a connection to a Shadowsocks server.</li>
  <li><strong>Authentication and Method Negotiation:</strong> The client sends the chosen encryption method and password to the server for authentication.</li>
  <li><strong>Address Encoding:</strong> The client sends the target address (IP address and port) of the actual destination server in a specific encoded format.</li>
  <li><strong>Data Forwarding:</strong> After successful authentication and address encoding, all subsequent data exchanged between the client and the Shadowsocks server is encrypted/decrypted using the agreed-upon method.</li>
</ul>

<p><strong>Key aspects of the protocol you’ll need to implement:</strong></p>

<ul>
  <li><strong>Method and Password Handling:</strong> Storing and sending the chosen encryption method (e.g., <code class="language-plaintext highlighter-rouge">aes-256-cfb</code>, <code class="language-plaintext highlighter-rouge">chacha20-ietf-poly1305</code>) and the password.</li>
  <li><strong>Address Encoding:</strong> Encoding the target address into a specific format (type byte, address, port). The type byte indicates whether the address is an IPv4 address (0x01), an IPv6 address (0x04), or a hostname (0x03).</li>
  <li><strong>Encryption and Decryption:</strong> Implementing the chosen encryption and decryption algorithms. Libraries like <code class="language-plaintext highlighter-rouge">PyCryptodome</code> (Python) or <code class="language-plaintext highlighter-rouge">Bouncy Castle</code> (Java) can be helpful for this.</li>
  <li><strong>TCP Forwarding:</strong> Establishing a local TCP server that listens for connections from applications and forwards the traffic through the Shadowsocks tunnel.</li>
</ul>

<p><strong>2. Setting up a Netty Project</strong></p>

<p>First, you’ll need to include the Netty dependency in your project (e.g., using Maven or Gradle for a Java project).</p>

<p><strong>3. Core Netty Components for a Proxy Client</strong></p>

<p>You’ll primarily use the following Netty components:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">Bootstrap</code>:</strong> Used to configure and start the client-side application.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">EventLoopGroup</code>:</strong> Manages the event loops that handle I/O operations for the client. You’ll typically use <code class="language-plaintext highlighter-rouge">NioEventLoopGroup</code> for non-blocking I/O.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">Channel</code>:</strong> Represents a network connection.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">ChannelPipeline</code>:</strong> A chain of <code class="language-plaintext highlighter-rouge">ChannelHandler</code>s that process inbound and outbound events and data.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">ChannelHandler</code>:</strong> Interfaces that you implement to handle specific events and data transformations. You’ll create custom handlers for the Shadowsocks protocol.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">ByteBuf</code>:</strong> Netty’s buffer for handling binary data.</li>
</ul>

<p><strong>4. Implementing the Shadowsocks Protocol with Netty Handlers</strong></p>

<p>You’ll need to create several custom <code class="language-plaintext highlighter-rouge">ChannelHandler</code>s within your <code class="language-plaintext highlighter-rouge">ChannelPipeline</code> to implement the Shadowsocks logic. Here’s a possible structure:</p>

<ul>
  <li><strong>Local Proxy Server Handler (<code class="language-plaintext highlighter-rouge">ChannelInboundHandlerAdapter</code>):</strong>
    <ul>
      <li>This handler will run on a local server socket that your applications will connect to (e.g., <code class="language-plaintext highlighter-rouge">localhost:1080</code>).</li>
      <li>When a new connection comes in from a local application, this handler will:
        <ul>
          <li>Establish a connection to the remote Shadowsocks server.</li>
          <li>Forward the initial connection request (target address) to the Shadowsocks server after encoding it according to the protocol.</li>
          <li>Manage the flow of data between the local application and the Shadowsocks server.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Shadowsocks Client Encoder (<code class="language-plaintext highlighter-rouge">ChannelOutboundHandlerAdapter</code>):</strong>
    <ul>
      <li>This handler will be responsible for encoding the data being sent to the Shadowsocks server.</li>
      <li>It will:
        <ul>
          <li>Encode the target address according to the Shadowsocks protocol (type, address, port).</li>
          <li>Encrypt the data using the chosen encryption method.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Shadowsocks Client Decoder (<code class="language-plaintext highlighter-rouge">ChannelInboundHandlerAdapter</code>):</strong>
    <ul>
      <li>This handler will be responsible for decoding the data received from the Shadowsocks server.</li>
      <li>It will:
        <ul>
          <li>Decrypt the received data.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Remote Server Forwarding Handler (<code class="language-plaintext highlighter-rouge">ChannelInboundHandlerAdapter</code>):</strong>
    <ul>
      <li>This handler will be invoked when data is received from the remote Shadowsocks server.</li>
      <li>It will forward the decrypted data back to the original local application.</li>
    </ul>
  </li>
</ul>

<p><strong>5. Example Structure of the Netty Pipeline</strong></p>

<p>Here’s a simplified example of how your <code class="language-plaintext highlighter-rouge">ChannelPipeline</code> might look for the connection to the Shadowsocks server:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShadowsocksClientInitializer</span> <span class="kd">extends</span> <span class="nc">ChannelInitializer</span><span class="o">&lt;</span><span class="nc">SocketChannel</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">serverAddress</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">serverPort</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">method</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ShadowsocksClientInitializer</span><span class="o">(</span><span class="nc">String</span> <span class="n">serverAddress</span><span class="o">,</span> <span class="kt">int</span> <span class="n">serverPort</span><span class="o">,</span> <span class="nc">String</span> <span class="n">method</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">serverAddress</span> <span class="o">=</span> <span class="n">serverAddress</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">serverPort</span> <span class="o">=</span> <span class="n">serverPort</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initChannel</span><span class="o">(</span><span class="nc">SocketChannel</span> <span class="n">ch</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">ChannelPipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="na">pipeline</span><span class="o">();</span>

        <span class="c1">// Outbound handlers (data going to the Shadowsocks server)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="s">"encoder"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ShadowsocksClientEncoder</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">password</span><span class="o">));</span>

        <span class="c1">// Inbound handlers (data coming from the Shadowsocks server)</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="s">"decoder"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ShadowsocksClientDecoder</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">password</span><span class="o">));</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="s">"remoteForwarder"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">RemoteServerForwardingHandler</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>And for the local proxy server:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LocalProxyInitializer</span> <span class="kd">extends</span> <span class="nc">ChannelInitializer</span><span class="o">&lt;</span><span class="nc">SocketChannel</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">shadowsocksServerAddress</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">shadowsocksServerPort</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">method</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">LocalProxyInitializer</span><span class="o">(</span><span class="nc">String</span> <span class="n">shadowsocksServerAddress</span><span class="o">,</span> <span class="kt">int</span> <span class="n">shadowsocksServerPort</span><span class="o">,</span> <span class="nc">String</span> <span class="n">method</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">shadowsocksServerAddress</span> <span class="o">=</span> <span class="n">shadowsocksServerAddress</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">shadowsocksServerPort</span> <span class="o">=</span> <span class="n">shadowsocksServerPort</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initChannel</span><span class="o">(</span><span class="nc">SocketChannel</span> <span class="n">ch</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">ChannelPipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="na">pipeline</span><span class="o">();</span>

        <span class="c1">// Handler to initiate connection to the Shadowsocks server and forward data</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="s">"localProxyHandler"</span><span class="o">,</span>
                <span class="k">new</span> <span class="nf">LocalProxyHandler</span><span class="o">(</span><span class="n">shadowsocksServerAddress</span><span class="o">,</span> <span class="n">shadowsocksServerPort</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">password</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>6. Key Implementation Details</strong></p>

<ul>
  <li><strong>Encryption/Decryption Implementation:</strong> You’ll need to implement the chosen encryption and decryption algorithms within your <code class="language-plaintext highlighter-rouge">ShadowsocksClientEncoder</code> and <code class="language-plaintext highlighter-rouge">ShadowsocksClientDecoder</code>. This will likely involve using external libraries. Be careful with key derivation and initialization vectors if required by the chosen method.</li>
  <li><strong>Address Encoding in <code class="language-plaintext highlighter-rouge">LocalProxyHandler</code>:</strong> When the <code class="language-plaintext highlighter-rouge">LocalProxyHandler</code> receives the initial connection request from the local application, it needs to extract the target address and port and encode them into the Shadowsocks format before sending them to the Shadowsocks server.</li>
  <li><strong>Connecting to the Shadowsocks Server in <code class="language-plaintext highlighter-rouge">LocalProxyHandler</code>:</strong> The <code class="language-plaintext highlighter-rouge">LocalProxyHandler</code> will use a separate Netty <code class="language-plaintext highlighter-rouge">Bootstrap</code> to establish a connection to the configured Shadowsocks server.</li>
  <li><strong>Data Forwarding:</strong> Once the connection to the Shadowsocks server is established, the handlers need to efficiently forward data between the local application’s connection and the Shadowsocks server’s connection. You’ll likely need to manage the <code class="language-plaintext highlighter-rouge">Channel</code> objects for both connections.</li>
  <li><strong>Error Handling:</strong> Implement proper error handling for network issues, protocol errors, and encryption/decryption failures.</li>
  <li><strong>Concurrency:</strong> Netty handles concurrency efficiently with its event loop model. Ensure your handlers are designed to be thread-safe if you need to share state.</li>
</ul>

<p><strong>7. Starting the Proxy Client</strong></p>

<p>You’ll need to create a main class to start both the local proxy server (listening for local connections) and potentially handle configuration.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShadowsocksClient</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">localPort</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">serverAddress</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">serverPort</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">method</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ShadowsocksClient</span><span class="o">(</span><span class="kt">int</span> <span class="n">localPort</span><span class="o">,</span> <span class="nc">String</span> <span class="n">serverAddress</span><span class="o">,</span> <span class="kt">int</span> <span class="n">serverPort</span><span class="o">,</span> <span class="nc">String</span> <span class="n">method</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">localPort</span> <span class="o">=</span> <span class="n">localPort</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">serverAddress</span> <span class="o">=</span> <span class="n">serverAddress</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">serverPort</span> <span class="o">=</span> <span class="n">serverPort</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">EventLoopGroup</span> <span class="n">bossGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NioEventLoopGroup</span><span class="o">();</span>
        <span class="nc">EventLoopGroup</span> <span class="n">workerGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NioEventLoopGroup</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">ServerBootstrap</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerBootstrap</span><span class="o">();</span>
            <span class="n">b</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">bossGroup</span><span class="o">,</span> <span class="n">workerGroup</span><span class="o">)</span>
             <span class="o">.</span><span class="na">channel</span><span class="o">(</span><span class="nc">NioServerSocketChannel</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
             <span class="o">.</span><span class="na">childHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">LocalProxyInitializer</span><span class="o">(</span><span class="n">serverAddress</span><span class="o">,</span> <span class="n">serverPort</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">password</span><span class="o">))</span>
             <span class="o">.</span><span class="na">option</span><span class="o">(</span><span class="nc">ChannelOption</span><span class="o">.</span><span class="na">SO_BACKLOG</span><span class="o">,</span> <span class="mi">128</span><span class="o">)</span>
             <span class="o">.</span><span class="na">childOption</span><span class="o">(</span><span class="nc">ChannelOption</span><span class="o">.</span><span class="na">SO_KEEPALIVE</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

            <span class="nc">ChannelFuture</span> <span class="n">f</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">localPort</span><span class="o">).</span><span class="na">sync</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Shadowsocks client started on port: "</span> <span class="o">+</span> <span class="n">localPort</span><span class="o">);</span>
            <span class="n">f</span><span class="o">.</span><span class="na">channel</span><span class="o">().</span><span class="na">closeFuture</span><span class="o">().</span><span class="na">sync</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">workerGroup</span><span class="o">.</span><span class="na">shutdownGracefully</span><span class="o">();</span>
            <span class="n">bossGroup</span><span class="o">.</span><span class="na">shutdownGracefully</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// Replace with your configuration</span>
        <span class="kt">int</span> <span class="n">localPort</span> <span class="o">=</span> <span class="mi">1080</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">serverAddress</span> <span class="o">=</span> <span class="s">"your_server_ip"</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">serverPort</span> <span class="o">=</span> <span class="mi">8388</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">method</span> <span class="o">=</span> <span class="s">"aes-256-cfb"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"your_password"</span><span class="o">;</span>

        <span class="k">new</span> <span class="nf">ShadowsocksClient</span><span class="o">(</span><span class="n">localPort</span><span class="o">,</span> <span class="n">serverAddress</span><span class="o">,</span> <span class="n">serverPort</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">password</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>8. Advanced Considerations (Like Clash)</strong></p>

<p>To build a client like Clash, you’d need to consider more advanced features:</p>

<ul>
  <li><strong>Multiple Proxy Protocols:</strong> Clash supports various proxy protocols (Shadowsocks, SOCKS5, HTTP). You’d need to add handlers for each protocol.</li>
  <li><strong>Rule-Based Routing:</strong> Clash allows you to define rules to route traffic based on domain, IP address, GEOIP, etc. This would involve implementing a rule engine within your client.</li>
  <li><strong>Configuration Management:</strong> Clash uses YAML configuration files. You’d need to implement a way to load and parse such configurations.</li>
  <li><strong>DNS Handling:</strong> Clash often intercepts DNS requests and routes them through the proxy. You’d need to implement DNS interception and forwarding.</li>
  <li><strong>UDP Support:</strong> Shadowsocks also supports UDP forwarding. You’d need to implement UDP handling using Netty’s UDP capabilities.</li>
  <li><strong>Plugins and Extensions:</strong> Clash has a plugin system. Implementing such a system would add significant complexity.</li>
</ul>

<p><strong>In summary, building a basic Shadowsocks client with Netty involves:</strong></p>

<ol>
  <li>Understanding the Shadowsocks protocol.</li>
  <li>Setting up a Netty project.</li>
  <li>Creating custom <code class="language-plaintext highlighter-rouge">ChannelHandler</code>s for encoding, decoding, and forwarding data.</li>
  <li>Implementing the encryption and decryption logic.</li>
  <li>Starting a local server to accept connections from applications.</li>
  <li>Connecting to the remote Shadowsocks server.</li>
</ol>

<p>Building a more feature-rich client like Clash requires a much deeper understanding of networking, proxy protocols, and more complex software architecture. Start with a basic Shadowsocks implementation and gradually add features as needed. Remember to consult the official Shadowsocks documentation and Netty examples for more detailed information.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
