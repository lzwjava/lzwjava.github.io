<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Go GC Pauses: Cloudflare vs TiDB</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Go GC Pauses: Cloudflare vs TiDB | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Go GC Pauses: Cloudflare vs TiDB" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-06-30-gc-pauses-impact-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-06-30-gc-pauses-impact-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Go GC Pauses: Cloudflare vs TiDB" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Go GC Pauses: Cloudflare vs TiDB","url":"https://lzwjava.github.io/notes/2025-06-30-gc-pauses-impact-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=c5d028b9ab02583d6ad538650af0548d5ed7a574">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=c5d028b9ab02583d6ad538650af0548d5ed7a574" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Go GC Pauses: Cloudflare vs TiDB | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-06-30-gc-pauses-impact-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-06-30-gc-pauses-impact-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.10</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/gc-pauses-impact-en" selected>English</option>
        <option value="/gc-pauses-impact-zh" >中文</option>
        <option value="/gc-pauses-impact-ja" >日本語</option>
        <option value="/gc-pauses-impact-es" >Español</option>
        <option value="/gc-pauses-impact-hi" >हिंदी</option>
        <option value="/gc-pauses-impact-fr" >Français</option>
        <option value="/gc-pauses-impact-de" >Deutsch</option>
        <option value="/gc-pauses-impact-ar" >العربية</option>
        <option value="/gc-pauses-impact-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Yes, Go’s garbage collector (GC) pauses can impact both Cloudflare’s services and TiDB database, as both leverage Go heavily in their architecture. However, the nature and impact of these pauses, and how they are mitigated, differ.</p>

<p>Here’s a breakdown:</p>

<p><strong>Go’s GC and its Characteristics:</strong></p>

<ul>
  <li><strong>Mark-Sweep GC:</strong> Go uses a concurrent, tri-color mark-sweep garbage collector. This means that most of the GC work (marking live objects) happens concurrently with the application’s execution.</li>
  <li><strong>Stop-the-World (STW) Pauses:</strong> While concurrent, Go’s GC still requires brief “stop-the-world” (STW) pauses. These pauses occur in specific phases (like the initial “mark” setup and the final “mark termination” and “sweep termination” phases) where the application’s goroutines are halted to ensure memory consistency. The goal of the Go runtime engineers is to minimize these STW durations, typically keeping them in the microsecond range.</li>
  <li><strong>Factors influencing GC:</strong> The frequency and duration of GC pauses are influenced by:
    <ul>
      <li><strong>Allocation rate:</strong> How quickly the application allocates new memory.</li>
      <li><strong>Heap size:</strong> The total amount of memory managed by the Go runtime.</li>
      <li><strong><code class="language-plaintext highlighter-rouge">GOGC</code>:</strong> A parameter that controls the garbage collection target percentage (default 100%). A lower <code class="language-plaintext highlighter-rouge">GOGC</code> means more frequent GCs.</li>
      <li><strong><code class="language-plaintext highlighter-rouge">GOMEMLIMIT</code>:</strong> A new parameter (Go 1.19+) that sets an upper bound on the target heap size, helping to prevent OOMs and manage memory more predictably.</li>
    </ul>
  </li>
</ul>

<p><strong>Impact on Cloudflare:</strong></p>

<p>Cloudflare uses Go extensively for many of its critical services, including DNS infrastructure, SSL handling, load testing, and more. For a high-performance, low-latency system like Cloudflare, even microsecond pauses can be significant.</p>

<ul>
  <li><strong>Latency-sensitive services:</strong> Services handling high request rates (like DNS or proxying) are very sensitive to latency spikes. GC pauses, even if short, can contribute to these spikes, affecting user experience.</li>
  <li><strong>Memory-intensive applications:</strong> Some Cloudflare services might be memory-intensive, leading to more frequent GC cycles if not tuned properly.</li>
  <li><strong>Mitigation at Cloudflare:</strong> Cloudflare engineers actively work on:
    <ul>
      <li><strong>Tuning <code class="language-plaintext highlighter-rouge">GOGC</code> and <code class="language-plaintext highlighter-rouge">GOMEMLIMIT</code>:</strong> They experiment with these parameters to balance memory usage and GC frequency.</li>
      <li><strong>Profiling and optimizing code:</strong> Identifying and reducing unnecessary memory allocations in their Go code.</li>
      <li><strong>Profile-Guided Optimizations (PGO):</strong> Cloudflare has seen significant CPU savings (and thus likely reduced GC pressure) by leveraging Go’s PGO feature.</li>
      <li><strong>Architectural considerations:</strong> Designing services to be resilient to short pauses, potentially by having enough redundancy or by processing requests in a way that minimizes the impact of a single goroutine’s pause.</li>
    </ul>
  </li>
</ul>

<p><strong>Impact on TiDB Database:</strong></p>

<p>TiDB is a distributed SQL database built by PingCAP, with its SQL layer (<code class="language-plaintext highlighter-rouge">tidb-server</code>) primarily written in Go. As a database, it has different performance characteristics and requirements compared to a proxy service.</p>

<ul>
  <li><strong>Database-specific GC:</strong> TiDB has its own garbage collection mechanisms for MVCC (Multi-Version Concurrency Control) data (cleaning up old data versions in TiKV, its storage engine). This is distinct from Go’s runtime GC, though the TiDB “coordinator” (written in Go) initiates and manages this.</li>
  <li><strong>Go Runtime GC in TiDB:</strong> The Go GC <em>does</em> impact TiDB because <code class="language-plaintext highlighter-rouge">tidb-server</code> processes SQL requests, manages memory for query plans, results, and other runtime data.
    <ul>
      <li><strong>Latency jitter:</strong> Frequent STW pauses can lead to latency spikes in query execution, affecting database responsiveness.</li>
      <li><strong>CPU overhead:</strong> GC activity consumes CPU resources, which could otherwise be used for processing queries.</li>
      <li><strong>Adaptive GC triggering:</strong> TiDB proactively triggers Go GC when memory usage reaches a certain threshold (configurable via <code class="language-plaintext highlighter-rouge">tidb_server_memory_limit</code> and <code class="language-plaintext highlighter-rouge">tidb_server_memory_limit_gc_trigger</code>). It also uses an adaptive strategy for <code class="language-plaintext highlighter-rouge">tidb_server_memory_limit_gc_trigger</code> to avoid excessively frequent GCs.</li>
    </ul>
  </li>
  <li><strong>Monitoring and Tuning:</strong> PingCAP provides extensive monitoring tools (like the TiDB Runtime Dashboard) to observe Go GC behavior (GC frequency, duration, STW latency, CPU time spent on GC) and allows users to configure <code class="language-plaintext highlighter-rouge">GOGC</code> and <code class="language-plaintext highlighter-rouge">GOMEMLIMIT</code> to optimize performance.</li>
  <li><strong>Ongoing efforts:</strong> PingCAP engineers are continuously working on optimizing TiDB’s Go memory management and GC behavior to minimize its impact on performance and stability.</li>
</ul>

<p><strong>In summary:</strong></p>

<p>Both Cloudflare and TiDB, being high-performance systems relying on Go, are susceptible to the impacts of Go’s GC pauses. While Go’s GC is highly optimized for short STW durations, at scale, these pauses can contribute to latency spikes and CPU overhead. Both companies actively monitor, tune, and optimize their Go applications and infrastructure to mitigate these effects, leveraging Go’s runtime parameters and their own specific architectural designs.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
