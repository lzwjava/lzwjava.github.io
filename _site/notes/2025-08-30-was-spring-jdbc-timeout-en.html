<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>WAS Spring JDBC Timeout Triage Guide</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>WAS Spring JDBC Timeout Triage Guide | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="WAS Spring JDBC Timeout Triage Guide" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/notes/2025-08-30-was-spring-jdbc-timeout-en" />
<meta property="og:url" content="https://lzwjava.github.io/notes/2025-08-30-was-spring-jdbc-timeout-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="WAS Spring JDBC Timeout Triage Guide" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"WAS Spring JDBC Timeout Triage Guide","url":"https://lzwjava.github.io/notes/2025-08-30-was-spring-jdbc-timeout-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=11033b6f3e08897d0bdf7947d313a963e5400739">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=11033b6f3e08897d0bdf7947d313a963e5400739" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       WAS Spring JDBC Timeout Triage Guide | Generated by AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="notes/2025-08-30-was-spring-jdbc-timeout-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>notes2025-08-30-was-spring-jdbc-timeout-en.md</span> -->
      

      <!-- <span></span> -->

      
        <a href="#" class="button">2025.09</a>
      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/was-spring-jdbc-timeout-en" selected>English</option>
        <option value="/was-spring-jdbc-timeout-zh" >中文</option>
        <option value="/was-spring-jdbc-timeout-ja" >日本語</option>
        <option value="/was-spring-jdbc-timeout-es" >Español</option>
        <option value="/was-spring-jdbc-timeout-hi" >हिंदी</option>
        <option value="/was-spring-jdbc-timeout-fr" >Français</option>
        <option value="/was-spring-jdbc-timeout-de" >Deutsch</option>
        <option value="/was-spring-jdbc-timeout-ar" >العربية</option>
        <option value="/was-spring-jdbc-timeout-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Here’s the mental model and a quick triage playbook.</p>

<h1 id="how-it-works-was--spring--jdbc">How it works (WAS + Spring + JDBC)</h1>

<ol>
  <li>
    <p><strong>DataSource lives in WAS</strong></p>

    <ul>
      <li>You define a JDBC Provider and a <strong>DataSource</strong> (usually <code class="language-plaintext highlighter-rouge">XA</code> for global tx, or non-XA) in the WAS admin console.</li>
      <li>WAS manages the <strong>JCA connection pool</strong> and hands out JDBC Connections.</li>
    </ul>
  </li>
  <li>
    <p><strong>Spring gets the DataSource via JNDI</strong></p>

    <ul>
      <li>
        <p>Your Spring app looks up the server’s DataSource (e.g., <code class="language-plaintext highlighter-rouge">java:comp/env/jdbc/MyDS</code>) and wraps it:</p>

        <ul>
          <li>Plain JDBC: <code class="language-plaintext highlighter-rouge">JdbcTemplate</code> uses that DataSource.</li>
          <li>JPA/Hibernate: the <code class="language-plaintext highlighter-rouge">EntityManagerFactory</code> uses it.</li>
        </ul>
      </li>
      <li>
        <p>Transactions are typically <strong>container JTA</strong> (<code class="language-plaintext highlighter-rouge">WebSphereUowTransactionManager</code> or standard JTA). Spring’s <code class="language-plaintext highlighter-rouge">@Transactional</code> joins the container tx.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Call path</strong></p>

    <ul>
      <li>Web request → WebContainer thread → Spring service → tx begins (JTA) → <code class="language-plaintext highlighter-rouge">DataSource.getConnection()</code> from <strong>WAS pool</strong> → SQL via driver → DB.</li>
      <li>Timeouts can fire at multiple layers (Spring, JPA, WAS pool, JTA tx, JDBC driver/DB, network).</li>
    </ul>
  </li>
</ol>

<h1 id="when-a-timeout-happens--identify-which-kind">When a timeout happens — identify which kind</h1>

<p>Think in four buckets. The message/stack usually tells you which.</p>

<ol>
  <li>
    <p><strong>Connection acquisition timeout</strong>
Symptom: waiting for a pooled connection.
Look for messages about pool exhaustion or <code class="language-plaintext highlighter-rouge">J2CA0086W / J2CA0030E</code>.
Typical knobs: <em>Maximum Connections</em>, <em>Connection Timeout</em>, <em>Aged Timeout</em>, <em>Purge Policy</em>.</p>
  </li>
  <li>
    <p><strong>Transaction timeout (JTA)</strong>
Symptom: <code class="language-plaintext highlighter-rouge">WTRN</code>/<code class="language-plaintext highlighter-rouge">Transaction</code> messages; exception like <em>“Transaction timed out after xxx seconds”</em>.
Typical knob: <strong>Total transaction lifetime timeout</strong>. Can kill long DB ops even if DB is still working.</p>
  </li>
  <li>
    <p><strong>Query/statement timeout</strong>
Symptom: <code class="language-plaintext highlighter-rouge">java.sql.SQLTimeoutException</code>, Hibernate/JPA “query timeout”, or Spring <code class="language-plaintext highlighter-rouge">QueryTimeoutException</code>.
Knobs:</p>

    <ul>
      <li>Spring: <code class="language-plaintext highlighter-rouge">JdbcTemplate.setQueryTimeout(...)</code>, Hibernate <code class="language-plaintext highlighter-rouge">javax.persistence.query.timeout</code> / <code class="language-plaintext highlighter-rouge">hibernate.jdbc.timeout</code>.</li>
      <li>WAS DataSource custom properties (DB2 examples): <code class="language-plaintext highlighter-rouge">queryTimeout</code>, <code class="language-plaintext highlighter-rouge">queryTimeoutInterruptProcessingMode</code>.</li>
      <li>Driver/DB-side statement timeout.</li>
    </ul>
  </li>
  <li>
    <p><strong>Socket/read timeout / network</strong>
Symptom: after some idle time during a long fetch; low-level <code class="language-plaintext highlighter-rouge">SocketTimeoutException</code> or vendor code.
Knobs: driver <code class="language-plaintext highlighter-rouge">loginTimeout</code>/<code class="language-plaintext highlighter-rouge">socketTimeout</code>, firewall/NAT idles, DB keepalives.</p>
  </li>
</ol>

<h1 id="where-to-check-by-layer">Where to check (by layer)</h1>

<p><strong>WAS Admin Console paths (traditional WAS)</strong></p>

<ul>
  <li>
    <p>JDBC Provider / DataSource:
Resources → JDBC → Data sources → <em>YourDS</em> →</p>

    <ul>
      <li><em>Connection pool properties</em>: <strong>Connection timeout</strong>, <strong>Maximum connections</strong>, <strong>Reap time</strong>, <strong>Unused timeout</strong>, <strong>Aged timeout</strong>, <strong>Purge policy</strong>.</li>
      <li><em>Custom properties</em>: vendor-specific (e.g., DB2 <code class="language-plaintext highlighter-rouge">queryTimeout</code>, <code class="language-plaintext highlighter-rouge">currentSQLID</code>, <code class="language-plaintext highlighter-rouge">blockingReadConnectionTimeout</code>, <code class="language-plaintext highlighter-rouge">queryTimeoutInterruptProcessingMode</code>).</li>
      <li><em>JAAS – J2C</em> if auth aliases matter.</li>
    </ul>
  </li>
  <li>Transactions:
Application servers → <em>server1</em> → Container Settings → <strong>Container Services → Transaction Service</strong> → <strong>Total transaction lifetime timeout</strong>, <strong>Maximum transaction timeout</strong>.</li>
  <li>WebContainer:
Thread pool size (if requests pile up).</li>
</ul>

<p><strong>Logs &amp; traces</strong></p>

<ul>
  <li>
    <p>Traditional WAS: <code class="language-plaintext highlighter-rouge">&lt;profile_root&gt;/logs/&lt;server&gt;/SystemOut.log</code> and <code class="language-plaintext highlighter-rouge">SystemErr.log</code>.
Key components: <code class="language-plaintext highlighter-rouge">RRA</code> (resource adapters), <code class="language-plaintext highlighter-rouge">JDBC</code>, <code class="language-plaintext highlighter-rouge">ConnectionPool</code>, <code class="language-plaintext highlighter-rouge">WTRN</code> (transactions).
Enable trace (concise starter):</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RRA=all:WTRN=all:Transaction=all:JDBC=all:ConnectionPool=all
</code></pre></div>    </div>

    <p>Look for:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">J2CA0086W</code>, <code class="language-plaintext highlighter-rouge">J2CA0114W</code> (pool/connection issues)</li>
      <li><code class="language-plaintext highlighter-rouge">WTRN0037W</code>, <code class="language-plaintext highlighter-rouge">WTRN0124I</code> (tx timeouts/rollbacks)</li>
      <li><code class="language-plaintext highlighter-rouge">DSRA</code>/<code class="language-plaintext highlighter-rouge">SQL</code> exceptions with vendor SQL codes.</li>
    </ul>
  </li>
  <li>
    <p>Liberty: <code class="language-plaintext highlighter-rouge">messages.log</code> under <code class="language-plaintext highlighter-rouge">wlp/usr/servers/&lt;server&gt;/logs/</code>.</p>
  </li>
</ul>

<p><strong>PMI / Monitoring</strong></p>

<ul>
  <li>
    <p>Enable <strong>PMI</strong> for JDBC Connection Pools and Transaction metrics. Watch:</p>

    <ul>
      <li>Pool size, in-use count, waiters, wait time, timeouts.</li>
      <li>Transaction timeouts/rollback counts.</li>
    </ul>
  </li>
</ul>

<p><strong>Spring/JPA app logs</strong></p>

<ul>
  <li>Turn on SQL + timing in your app (<code class="language-plaintext highlighter-rouge">org.hibernate.SQL</code>, <code class="language-plaintext highlighter-rouge">org.hibernate.type</code>, Spring JDBC debug) to correlate durations vs. timeouts.</li>
</ul>

<p><strong>Database &amp; driver</strong></p>

<ul>
  <li>DB2: <code class="language-plaintext highlighter-rouge">db2diag.log</code>, <code class="language-plaintext highlighter-rouge">MON_GET_PKG_CACHE_STMT</code>, activity event monitors, statement-level timeouts.</li>
  <li>Driver properties in the WAS DataSource or <code class="language-plaintext highlighter-rouge">DriverManager</code> if you’re not using container DS (not typical on WAS).</li>
</ul>

<p><strong>Network</strong></p>

<ul>
  <li>Middleboxes with idle timeouts. OS keepalive / driver keepalive settings.</li>
</ul>

<h1 id="quick-triage-flow">Quick triage flow</h1>

<ol>
  <li>
    <p><strong>Classify the timeout</strong></p>

    <ul>
      <li><em>Connection wait?</em> Look for <code class="language-plaintext highlighter-rouge">J2CA</code> pool warnings. If yes, increase <strong>Maximum connections</strong>, fix leak, tune pool, set <strong>Purge Policy = EntirePool</strong> for poison events.</li>
      <li><em>Tx timeout?</em> <code class="language-plaintext highlighter-rouge">WTRN</code> messages. Increase <strong>Total transaction lifetime timeout</strong> or reduce work per tx; avoid wrapping huge batch jobs in one tx.</li>
      <li><em>Query timeout?</em> <code class="language-plaintext highlighter-rouge">SQLTimeoutException</code> or Spring/Hibernate <code class="language-plaintext highlighter-rouge">QueryTimeout</code>. Align <strong>Spring/Hibernate</strong> timeouts with <strong>WAS DS</strong> and <strong>DB</strong> timeouts; avoid conflicting settings.</li>
      <li><em>Socket/read timeout?</em> Network/driver messages. Check driver’s <code class="language-plaintext highlighter-rouge">socketTimeout</code>/<code class="language-plaintext highlighter-rouge">loginTimeout</code>, DB keepalives, and firewalls.</li>
    </ul>
  </li>
  <li>
    <p><strong>Correlate timings</strong></p>

    <ul>
      <li>Compare the failing duration with the configured thresholds (e.g., “fails at ~30s” → find any 30s setting: Spring query timeout 30s? tx lifetime 30s? pool wait 30s?).</li>
    </ul>
  </li>
  <li>
    <p><strong>Check pooling health</strong></p>

    <ul>
      <li>PMI: are <strong>waiters</strong> &gt; 0? Is <strong>in-use</strong> near <strong>max</strong>? Long-running holders? Consider enabling <strong>connection leak detection</strong> (RRA trace shows who took the connection).</li>
    </ul>
  </li>
  <li>
    <p><strong>DB visibility</strong></p>

    <ul>
      <li>Confirm on the DB: was the statement still running? Was it cancelled? Any lock waits? If locks → consider lock timeout vs. statement timeout.</li>
    </ul>
  </li>
</ol>

<h1 id="useful-knobs--gotchas-was--db2-examples">Useful knobs &amp; gotchas (WAS + DB2 examples)</h1>

<ul>
  <li><strong>Total transaction lifetime timeout</strong> (server level) will kill long queries even if you set a higher Spring/Hibernate timeout. Keep these consistent.</li>
  <li><strong>queryTimeoutInterruptProcessingMode</strong> (DataSource custom property for DB2): controls how DB2 should interrupt a timed-out query (cooperative/forceful). Helps avoid threads stuck past timeouts.</li>
  <li><strong>Purge policy</strong>: <code class="language-plaintext highlighter-rouge">EntirePool</code> can recover faster from fatal SQL states (e.g., DB restart) at the cost of a blip.</li>
  <li><strong>Aged/Unused timeout</strong>: retire stale connections to dodge firewall/NAT idles.</li>
  <li><strong>Validation</strong>: enable <strong>validation by SQL</strong> or <strong>validation timeout</strong> so dead connections are detected before use.</li>
  <li><strong>Thread pools</strong>: if WebContainer threads are saturated, <em>symptoms look like timeouts</em>. Ensure WebContainer and Default thread pools are sized appropriately.</li>
</ul>

<h1 id="minimal-spring-wiring-examples">Minimal Spring wiring examples</h1>

<p><strong>JNDI DataSource (XML)</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;jee:jndi-lookup</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">jndi-name=</span><span class="s">"java:comp/env/jdbc/MyDS"</span> <span class="na">expected-type=</span><span class="s">"javax.sql.DataSource"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"txManager"</span> <span class="na">class=</span><span class="s">"org.springframework.transaction.jta.JtaTransactionManager"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">"txManager"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p><strong>JdbcTemplate query timeout (Java)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span> <span class="nc">JdbcTemplate</span> <span class="nf">jdbcTemplate</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">ds</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">JdbcTemplate</span> <span class="n">jt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcTemplate</span><span class="o">(</span><span class="n">ds</span><span class="o">);</span>
  <span class="n">jt</span><span class="o">.</span><span class="na">setQueryTimeout</span><span class="o">(</span><span class="mi">60</span><span class="o">);</span> <span class="c1">// seconds</span>
  <span class="k">return</span> <span class="n">jt</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Hibernate/JPA timeout</strong></p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">javax.persistence.query.timeout</span><span class="p">=</span><span class="s">60000  # ms</span>
<span class="py">hibernate.jdbc.timeout</span><span class="p">=</span><span class="s">60              # seconds</span>
</code></pre></div></div>

<h1 id="what-to-capture-when-you-escalate">What to capture when you escalate</h1>

<ul>
  <li>Exact exception text + stack trace.</li>
  <li>Timestamps: request start, tx begin, query start, error time.</li>
  <li>WAS DS pool config (screenshot or values), Transaction Service timeouts.</li>
  <li>PMI snapshot (pool waiters, in-use, timeout counts).</li>
  <li>DB view of the session/statement at failure time.</li>
  <li>Network topology notes (firewalls, proxies, idle timers).</li>
</ul>

<p>If you paste a specific exception snippet (J2CA/WTRN/SQL state), I can pinpoint the exact layer and the matching setting to adjust.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
