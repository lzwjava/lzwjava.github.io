<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title></title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Zhiwei Li | truth freedom</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Zhiwei Li" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="李智维" />
<meta property="og:description" content="李智维" />
<link rel="canonical" href="https://lzwjava.github.io/node_modules/node-fetch/" />
<meta property="og:url" content="https://lzwjava.github.io/node_modules/node-fetch/" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Zhiwei Li" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Zhiwei Li"},"description":"李智维","headline":"Zhiwei Li","url":"https://lzwjava.github.io/node_modules/node-fetch/"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=6bda53340f677fafef4ed268307a2ed5b112d86d">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=6bda53340f677fafef4ed268307a2ed5b112d86d" defer></script> -->
</head>

<body>
  <header class="page-header" role="banner">
  <!-- Part 1: Avatar -->
  <div class="row compact-row">
    <div class="circular-image">
      <img id="avatarImg" src="/assets/images/avatar.jpg" alt="">
    </div>
    <div class="text-container">
      <h3 class="project-name">Zhiwei Li</h3>
      <h3 class="project-tagline">李智维</h3>
    </div>

    <button id="themeToggleHeader" class="icon-button" aria-label="Toggle Theme">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>

    <button id="devinHeader" class="icon-button" aria-label="Devin"
      onclick="window.location.href='https://deepwiki.com/lzwjava/lzwjava.github.io'">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polygon points="12,2 14.5,3.5 14.5,7.5 12,9 9.5,7.5 9.5,3.5" />
    <polygon points="18,9.5 20.5,11 20.5,15 18,16.5 15.5,15 15.5,11" />
    <polygon points="6,9.5 8.5,11 8.5,15 6,16.5 3.5,15 3.5,11" />
    <polygon points="12,17 14.5,18.5 14.5,22.5 12,24 9.5,22.5 9.5,18.5" />
</svg>
    </button>

    <!-- <button id="searchHeader" class="icon-button" aria-label="Search" onclick="window.location.href='/search-en'">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"></circle>
    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>

    </button> -->

    <button id="githubHeader" class="icon-button" aria-label="GitHub"
      onclick="window.location.href='https://github.com/lzwjava/lzwjava.github.io'">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
</svg>



    </button>

    <!-- <button id="statusHeader" class="icon-button" aria-label="Check Status"
      onclick="window.location.href='/status-page-en'">
    </button> -->

  </div>

  <div class="row">
    <!-- Information-related buttons -->
    <a href="/resume-en" class="btn">📄 <br>Résumé</a>
    <a href="/portfolio-en" class="btn">✨<br> أعمال</a>
    <a href="/notes-en" class="btn">📎 <br>メモ</a>
    <a href="/papers-en" class="btn">🔍 <br>논문</a>
  </div>

  <div class="row">
    <!-- Action-related buttons -->
    <a href="/contact-en" class="btn">👋 <br>哈囉</a>
    <a href="/subscribe-en" class="btn">🔔<br> s'abonner</a>
    <a href="/donate-en" class="btn">💰 <br>Moneta</a>
    <a href="/disclaimer-en" class="btn">📝 <br>नोट्स</a>
  </div>
</header>

<script src="/assets/js/dark-mode.js"></script>


<main id="content" class="main-content" role="main">
  <div align="center">
	<img src="docs/media/Banner.svg" alt="Node Fetch" />
	<br />
	<p>A light-weight module that brings <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a> to Node.js.</p>
	<a href="https://github.com/node-fetch/node-fetch/actions"><img src="https://github.com/node-fetch/node-fetch/workflows/CI/badge.svg?branch=master" alt="Build status" /></a>
	<a href="https://coveralls.io/github/node-fetch/node-fetch"><img src="https://img.shields.io/coveralls/github/node-fetch/node-fetch" alt="Coverage status" /></a>
	<a href="https://packagephobia.now.sh/result?p=node-fetch"><img src="https://badgen.net/packagephobia/install/node-fetch" alt="Current version" /></a>
	<a href="https://www.npmjs.com/package/node-fetch"><img src="https://img.shields.io/npm/v/node-fetch" alt="Install size" /></a>
	<a href="https://github.com/sindresorhus/awesome-nodejs"><img src="https://awesome.re/mentioned-badge.svg" alt="Mentioned in Awesome Node.js" /></a>
	<a href="https://discord.gg/Zxbndcm"><img src="https://img.shields.io/discord/619915844268326952?color=%237289DA&amp;label=Discord" alt="Discord" /></a>
	<br />
	<br />
	<b>Consider supporting us on our Open Collective:</b>
	<br />
	<br />
	<a href="https://opencollective.com/node-fetch"><img src="https://opencollective.com/node-fetch/donate/button.png?color=blue" alt="Open Collective" /></a>
</div>

<hr />

<p><strong>You might be looking for the <a href="https://github.com/node-fetch/node-fetch/tree/2.x#readme">v2 docs</a></strong></p>

<!-- TOC -->

<ul>
  <li><a href="#motivation">Motivation</a></li>
  <li><a href="#features">Features</a></li>
  <li><a href="#difference-from-client-side-fetch">Difference from client-side fetch</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#loading-and-configuring-the-module">Loading and configuring the module</a></li>
  <li><a href="#upgrading">Upgrading</a></li>
  <li><a href="#common-usage">Common Usage</a>
    <ul>
      <li><a href="#plain-text-or-html">Plain text or HTML</a></li>
      <li><a href="#json">JSON</a></li>
      <li><a href="#simple-post">Simple Post</a></li>
      <li><a href="#post-with-json">Post with JSON</a></li>
      <li><a href="#post-with-form-parameters">Post with form parameters</a></li>
      <li><a href="#handling-exceptions">Handling exceptions</a></li>
      <li><a href="#handling-client-and-server-errors">Handling client and server errors</a></li>
      <li><a href="#handling-cookies">Handling cookies</a></li>
    </ul>
  </li>
  <li><a href="#advanced-usage">Advanced Usage</a>
    <ul>
      <li><a href="#streams">Streams</a></li>
      <li><a href="#accessing-headers-and-other-metadata">Accessing Headers and other Metadata</a></li>
      <li><a href="#extract-set-cookie-header">Extract Set-Cookie Header</a></li>
      <li><a href="#post-data-using-a-file">Post data using a file</a></li>
      <li><a href="#request-cancellation-with-abortsignal">Request cancellation with AbortSignal</a></li>
    </ul>
  </li>
  <li><a href="#api">API</a>
    <ul>
      <li><a href="#fetchurl-options">fetch(url[, options])</a></li>
      <li><a href="#options">Options</a>
        <ul>
          <li><a href="#default-headers">Default Headers</a></li>
          <li><a href="#custom-agent">Custom Agent</a></li>
          <li><a href="#custom-highwatermark">Custom highWaterMark</a></li>
          <li><a href="#insecure-http-parser">Insecure HTTP Parser</a></li>
        </ul>
      </li>
      <li><a href="#class-request">Class: Request</a>
        <ul>
          <li><a href="#new-requestinput-options">new Request(input[, options])</a></li>
        </ul>
      </li>
      <li><a href="#class-response">Class: Response</a>
        <ul>
          <li><a href="#new-responsebody-options">new Response([body[, options]])</a></li>
          <li><a href="#responseok">response.ok</a></li>
          <li><a href="#responseredirected">response.redirected</a></li>
          <li><a href="#responsetype">response.type</a></li>
        </ul>
      </li>
      <li><a href="#class-headers">Class: Headers</a>
        <ul>
          <li><a href="#new-headersinit">new Headers([init])</a></li>
        </ul>
      </li>
      <li><a href="#interface-body">Interface: Body</a>
        <ul>
          <li><a href="#bodybody">body.body</a></li>
          <li><a href="#bodybodyused">body.bodyUsed</a></li>
          <li><a href="#bodyarraybuffer">body.arrayBuffer()</a></li>
          <li><a href="#bodyblob">body.blob()</a></li>
          <li><a href="#formdata">body.formData()</a></li>
          <li><a href="#bodyjson">body.json()</a></li>
          <li><a href="#bodytext">body.text()</a></li>
        </ul>
      </li>
      <li><a href="#class-fetcherror">Class: FetchError</a></li>
      <li><a href="#class-aborterror">Class: AbortError</a></li>
    </ul>
  </li>
  <li><a href="#typescript">TypeScript</a></li>
  <li><a href="#acknowledgement">Acknowledgement</a></li>
  <li><a href="#team">Team</a>
              - <a href="#former">Former</a></li>
  <li><a href="#license">License</a></li>
</ul>

<!-- /TOC -->

<h2 id="motivation">Motivation</h2>

<p>Instead of implementing <code class="language-plaintext highlighter-rouge">XMLHttpRequest</code> in Node.js to run browser-specific <a href="https://github.com/github/fetch">Fetch polyfill</a>, why not go from native <code class="language-plaintext highlighter-rouge">http</code> to <code class="language-plaintext highlighter-rouge">fetch</code> API directly? Hence, <code class="language-plaintext highlighter-rouge">node-fetch</code>, minimal code for a <code class="language-plaintext highlighter-rouge">window.fetch</code> compatible API on Node.js runtime.</p>

<p>See Jason Miller’s <a href="https://www.npmjs.com/package/isomorphic-unfetch">isomorphic-unfetch</a> or Leonardo Quixada’s <a href="https://github.com/lquixada/cross-fetch">cross-fetch</a> for isomorphic usage (exports <code class="language-plaintext highlighter-rouge">node-fetch</code> for server-side, <code class="language-plaintext highlighter-rouge">whatwg-fetch</code> for client-side).</p>

<h2 id="features">Features</h2>

<ul>
  <li>Stay consistent with <code class="language-plaintext highlighter-rouge">window.fetch</code> API.</li>
  <li>Make conscious trade-off when following <a href="https://fetch.spec.whatwg.org/">WHATWG fetch spec</a> and <a href="https://streams.spec.whatwg.org/">stream spec</a> implementation details, document known differences.</li>
  <li>Use native promise and async functions.</li>
  <li>Use native Node streams for body, on both request and response.</li>
  <li>Decode content encoding (gzip/deflate/brotli) properly, and convert string output (such as <code class="language-plaintext highlighter-rouge">res.text()</code> and <code class="language-plaintext highlighter-rouge">res.json()</code>) to UTF-8 automatically.</li>
  <li>Useful extensions such as redirect limit, response size limit, <a href="https://github.com/node-fetch/node-fetch/blob/master/docs/ERROR-HANDLING.md">explicit errors</a> for troubleshooting.</li>
</ul>

<h2 id="difference-from-client-side-fetch">Difference from client-side fetch</h2>

<ul>
  <li>See known differences:
    <ul>
      <li><a href="docs/v3-LIMITS.md">As of v3.x</a></li>
      <li><a href="docs/v2-LIMITS.md">As of v2.x</a></li>
    </ul>
  </li>
  <li>If you happen to use a missing feature that <code class="language-plaintext highlighter-rouge">window.fetch</code> offers, feel free to open an issue.</li>
  <li>Pull requests are welcomed too!</li>
</ul>

<h2 id="installation">Installation</h2>

<p>Current stable release (<code class="language-plaintext highlighter-rouge">3.x</code>) requires at least Node.js 12.20.0.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>node-fetch
</code></pre></div></div>

<h2 id="loading-and-configuring-the-module">Loading and configuring the module</h2>

<h3 id="es-modules-esm">ES Modules (ESM)</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="commonjs">CommonJS</h3>

<p><code class="language-plaintext highlighter-rouge">node-fetch</code> from v3 is an ESM-only module - you are not able to import it with <code class="language-plaintext highlighter-rouge">require()</code>.</p>

<p>If you cannot switch to ESM, please use v2 which remains compatible with CommonJS. Critical bug fixes will continue to be published for v2.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>node-fetch@2
</code></pre></div></div>

<p>Alternatively, you can use the async <code class="language-plaintext highlighter-rouge">import()</code> function from CommonJS to load <code class="language-plaintext highlighter-rouge">node-fetch</code> asynchronously:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// mod.cjs</span>
<span class="kd">const</span> <span class="nx">fetch</span> <span class="o">=</span> <span class="p">(...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(({</span><span class="na">default</span><span class="p">:</span> <span class="nx">fetch</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">fetch</span><span class="p">(...</span><span class="nx">args</span><span class="p">));</span>
</code></pre></div></div>

<h3 id="providing-global-access">Providing global access</h3>

<p>To use <code class="language-plaintext highlighter-rouge">fetch()</code> without importing it, you can patch the <code class="language-plaintext highlighter-rouge">global</code> object in node:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// fetch-polyfill.js</span>
<span class="k">import</span> <span class="nx">fetch</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">Blob</span><span class="p">,</span>
  <span class="nx">blobFrom</span><span class="p">,</span>
  <span class="nx">blobFromSync</span><span class="p">,</span>
  <span class="nx">File</span><span class="p">,</span>
  <span class="nx">fileFrom</span><span class="p">,</span>
  <span class="nx">fileFromSync</span><span class="p">,</span>
  <span class="nx">FormData</span><span class="p">,</span>
  <span class="nx">Headers</span><span class="p">,</span>
  <span class="nx">Request</span><span class="p">,</span>
  <span class="nx">Response</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">globalThis</span><span class="p">.</span><span class="nx">fetch</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">globalThis</span><span class="p">.</span><span class="nx">fetch</span> <span class="o">=</span> <span class="nx">fetch</span>
  <span class="nx">globalThis</span><span class="p">.</span><span class="nx">Headers</span> <span class="o">=</span> <span class="nx">Headers</span>
  <span class="nx">globalThis</span><span class="p">.</span><span class="nx">Request</span> <span class="o">=</span> <span class="nx">Request</span>
  <span class="nx">globalThis</span><span class="p">.</span><span class="nx">Response</span> <span class="o">=</span> <span class="nx">Response</span>
<span class="p">}</span>

<span class="c1">// index.js</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">./fetch-polyfill</span><span class="dl">'</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<h2 id="upgrading">Upgrading</h2>

<p>Using an old version of node-fetch? Check out the following files:</p>

<ul>
  <li><a href="docs/v3-UPGRADE-GUIDE.md">2.x to 3.x upgrade guide</a></li>
  <li><a href="docs/v2-UPGRADE-GUIDE.md">1.x to 2.x upgrade guide</a></li>
  <li><a href="https://github.com/node-fetch/node-fetch/releases">Changelog</a></li>
</ul>

<h2 id="common-usage">Common Usage</h2>

<p>NOTE: The documentation below is up-to-date with <code class="language-plaintext highlighter-rouge">3.x</code> releases, if you are using an older version, please check how to <a href="#upgrading">upgrade</a>.</p>

<h3 id="plain-text-or-html">Plain text or HTML</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://github.com/</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="json">JSON</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://api.github.com/users/github</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="simple-post">Simple Post</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/post</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="dl">'</span><span class="s1">a=1</span><span class="dl">'</span><span class="p">});</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="post-with-json">Post with JSON</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="p">{</span><span class="na">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">};</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/post</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
	<span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">),</span>
	<span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">}</span>
<span class="p">});</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="post-with-form-parameters">Post with form parameters</h3>

<p><code class="language-plaintext highlighter-rouge">URLSearchParams</code> is available on the global object in Node.js as of v10.0.0. See <a href="https://nodejs.org/api/url.html#url_class_urlsearchparams">official documentation</a> for more usage methods.</p>

<p>NOTE: The <code class="language-plaintext highlighter-rouge">Content-Type</code> header is only set automatically to <code class="language-plaintext highlighter-rouge">x-www-form-urlencoded</code> when an instance of <code class="language-plaintext highlighter-rouge">URLSearchParams</code> is given as such:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">();</span>
<span class="nx">params</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/post</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">params</span><span class="p">});</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="handling-exceptions">Handling exceptions</h3>

<p>NOTE: 3xx-5xx responses are <em>NOT</em> exceptions, and should be handled in <code class="language-plaintext highlighter-rouge">then()</code>, see the next section.</p>

<p>Wrapping the fetch function into a <code class="language-plaintext highlighter-rouge">try/catch</code> block will catch <em>all</em> exceptions, such as errors originating from node core libraries, like network errors, and operational errors which are instances of FetchError. See the <a href="https://github.com/node-fetch/node-fetch/blob/master/docs/ERROR-HANDLING.md">error handling document</a> for more details.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
	<span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://domain.invalid/</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="handling-client-and-server-errors">Handling client and server errors</h3>

<p>It is common to create a helper function to check that the response contains no client (4xx) or server (5xx) error responses:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">HTTPResponseError</span> <span class="kd">extends</span> <span class="nb">Error</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">super</span><span class="p">(</span><span class="s2">`HTTP Error Response: </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">response</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">checkStatus</span> <span class="o">=</span> <span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// response.status &gt;= 200 &amp;&amp; response.status &lt; 300</span>
		<span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="nx">HTTPResponseError</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/status/400</span><span class="dl">'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
	<span class="nx">checkStatus</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

	<span class="kd">const</span> <span class="nx">errorBody</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Error body: </span><span class="p">${</span><span class="nx">errorBody</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="handling-cookies">Handling cookies</h3>

<p>Cookies are not stored by default. However, cookies can be extracted and passed by manipulating request and response headers. See <a href="#extract-set-cookie-header">Extract Set-Cookie Header</a> for details.</p>

<h2 id="advanced-usage">Advanced Usage</h2>

<h3 id="streams">Streams</h3>

<p>The “Node.js way” is to use streams when possible. You can pipe <code class="language-plaintext highlighter-rouge">res.body</code> to another stream. This example uses <a href="https://nodejs.org/api/stream.html#stream_stream_pipeline_streams_callback">stream.pipeline</a> to attach stream error handlers and wait for the download to complete.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">createWriteStream</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node:fs</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">pipeline</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node:stream</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">promisify</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node:util</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">streamPipeline</span> <span class="o">=</span> <span class="nx">promisify</span><span class="p">(</span><span class="nx">pipeline</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://github.githubassets.com/images/modules/logos_page/Octocat.png</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`unexpected response </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="k">await</span> <span class="nx">streamPipeline</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">createWriteStream</span><span class="p">(</span><span class="dl">'</span><span class="s1">./octocat.png</span><span class="dl">'</span><span class="p">));</span>
</code></pre></div></div>

<p>In Node.js 14 you can also use async iterators to read <code class="language-plaintext highlighter-rouge">body</code>; however, be careful to catch
errors – the longer a response runs, the more likely it is to encounter an error.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/stream/3</span><span class="dl">'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
	<span class="k">for</span> <span class="k">await</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">chunk</span> <span class="k">of</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">()));</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In Node.js 12 you can also use async iterators to read <code class="language-plaintext highlighter-rouge">body</code>; however, async iterators with streams
did not mature until Node.js 14, so you need to do some extra work to ensure you handle errors
directly from the stream and wait on it response to fully close.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">read</span> <span class="o">=</span> <span class="k">async</span> <span class="nx">body</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">error</span><span class="p">;</span>
	<span class="nx">body</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">error</span> <span class="o">=</span> <span class="nx">err</span><span class="p">;</span>
	<span class="p">});</span>

	<span class="k">for</span> <span class="k">await</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">chunk</span> <span class="k">of</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">()));</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">body</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="nx">error</span> <span class="p">?</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">:</span> <span class="nx">resolve</span><span class="p">();</span>
		<span class="p">});</span>
	<span class="p">});</span>
<span class="p">};</span>

<span class="k">try</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/stream/3</span><span class="dl">'</span><span class="p">);</span>
	<span class="k">await</span> <span class="nx">read</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="accessing-headers-and-other-metadata">Accessing Headers and other Metadata</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://github.com/</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">raw</span><span class="p">());</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span><span class="p">));</span>
</code></pre></div></div>

<h3 id="extract-set-cookie-header">Extract Set-Cookie Header</h3>

<p>Unlike browsers, you can access raw <code class="language-plaintext highlighter-rouge">Set-Cookie</code> headers manually using <code class="language-plaintext highlighter-rouge">Headers.raw()</code>. This is a <code class="language-plaintext highlighter-rouge">node-fetch</code> only API.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://example.com</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Returns an array of values, instead of a string of comma-separated values</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">raw</span><span class="p">()[</span><span class="dl">'</span><span class="s1">set-cookie</span><span class="dl">'</span><span class="p">]);</span>
</code></pre></div></div>

<h3 id="post-data-using-a-file">Post data using a file</h3>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">Blob</span><span class="p">,</span>
  <span class="nx">blobFrom</span><span class="p">,</span>
  <span class="nx">blobFromSync</span><span class="p">,</span>
  <span class="nx">File</span><span class="p">,</span>
  <span class="nx">fileFrom</span><span class="p">,</span>
  <span class="nx">fileFromSync</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">mimetype</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">fileFromSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">./input.txt</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mimetype</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://httpbin.org/post</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">blob</span> <span class="p">})</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</code></pre></div></div>

<p>node-fetch comes with a spec-compliant <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a> implementations for posting
multipart/form-data payloads</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span><span class="p">,</span> <span class="p">{</span> <span class="nx">FormData</span><span class="p">,</span> <span class="nx">File</span><span class="p">,</span> <span class="nx">fileFrom</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">httpbin</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://httpbin.org/post</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">binary</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">([</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span> <span class="p">])</span>
<span class="kd">const</span> <span class="nx">abc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">([</span><span class="nx">binary</span><span class="p">],</span> <span class="dl">'</span><span class="s1">abc.txt</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span> <span class="p">})</span>

<span class="nx">formData</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">greeting</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Hello, world!</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">formData</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">file-upload</span><span class="dl">'</span><span class="p">,</span> <span class="nx">abc</span><span class="p">,</span> <span class="dl">'</span><span class="s1">new name.txt</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">httpbin</span><span class="p">,</span> <span class="p">{</span> <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="na">body</span><span class="p">:</span> <span class="nx">formData</span> <span class="p">})</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</code></pre></div></div>

<p>If you for some reason need to post a stream coming from any arbitrary place,
then you can append a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob</a> or a <a href="https://developer.mozilla.org/en-US/docs/Web/API/File">File</a> look-a-like item.</p>

<p>The minimum requirement is that it has:</p>
<ol>
  <li>A <code class="language-plaintext highlighter-rouge">Symbol.toStringTag</code> getter or property that is either <code class="language-plaintext highlighter-rouge">Blob</code> or <code class="language-plaintext highlighter-rouge">File</code></li>
  <li>A known size.</li>
  <li>And either a <code class="language-plaintext highlighter-rouge">stream()</code> method or a <code class="language-plaintext highlighter-rouge">arrayBuffer()</code> method that returns a ArrayBuffer.</li>
</ol>

<p>The <code class="language-plaintext highlighter-rouge">stream()</code> must return any async iterable object as long as it yields Uint8Array (or Buffer)
so Node.Readable streams and whatwg streams works just fine.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">]:</span> <span class="dl">'</span><span class="s1">Blob</span><span class="dl">'</span><span class="p">,</span>
	<span class="na">size</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="o">*</span><span class="nx">stream</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">([</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">])</span>
	<span class="p">},</span>
	<span class="nx">arrayBuffer</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">([</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">]).</span><span class="nx">buffer</span>
	<span class="p">}</span>
<span class="p">},</span> <span class="dl">'</span><span class="s1">abc.txt</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="request-cancellation-with-abortsignal">Request cancellation with AbortSignal</h3>

<p>You may cancel requests with <code class="language-plaintext highlighter-rouge">AbortController</code>. A suggested implementation is <a href="https://www.npmjs.com/package/abort-controller"><code class="language-plaintext highlighter-rouge">abort-controller</code></a>.</p>

<p>An example of timing out a request after 150ms could be achieved as the following:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span><span class="p">,</span> <span class="p">{</span> <span class="nx">AbortError</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// AbortController was added in node v14.17.0 globally</span>
<span class="kd">const</span> <span class="nx">AbortController</span> <span class="o">=</span> <span class="nx">globalThis</span><span class="p">.</span><span class="nx">AbortController</span> <span class="o">||</span> <span class="k">await</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">abort-controller</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AbortController</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
<span class="p">},</span> <span class="mi">150</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://example.com</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">signal</span><span class="p">:</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span><span class="p">});</span>
	<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="k">instanceof</span> <span class="nx">AbortError</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">request was aborted</span><span class="dl">'</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
	<span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>See <a href="https://github.com/node-fetch/node-fetch/blob/master/test/">test cases</a> for more examples.</p>

<h2 id="api">API</h2>

<h3 id="fetchurl-options">fetch(url[, options])</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">url</code> A string representing the URL for fetching</li>
  <li><code class="language-plaintext highlighter-rouge">options</code> <a href="#fetch-options">Options</a> for the HTTP(S) request</li>
  <li>Returns: <code>Promise&lt;[Response](#class-response)&gt;</code></li>
</ul>

<p>Perform an HTTP(S) fetch.</p>

<p><code class="language-plaintext highlighter-rouge">url</code> should be an absolute URL, such as <code class="language-plaintext highlighter-rouge">https://example.com/</code>. A path-relative URL (<code class="language-plaintext highlighter-rouge">/file/under/root</code>) or protocol-relative URL (<code class="language-plaintext highlighter-rouge">//can-be-http-or-https.com/</code>) will result in a rejected <code class="language-plaintext highlighter-rouge">Promise</code>.</p>

<p><a id="fetch-options"></a></p>

<h3 id="options">Options</h3>

<p>The default values are shown after each option key.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
	<span class="c1">// These properties are part of the Fetch Standard</span>
	<span class="nl">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
	<span class="nx">headers</span><span class="p">:</span> <span class="p">{},</span>            <span class="c1">// Request headers. format is the identical to that accepted by the Headers constructor (see below)</span>
	<span class="nx">body</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>             <span class="c1">// Request body. can be null, or a Node.js Readable stream</span>
	<span class="nx">redirect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">follow</span><span class="dl">'</span><span class="p">,</span>     <span class="c1">// Set to `manual` to extract redirect headers, `error` to reject redirect</span>
	<span class="nx">signal</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>           <span class="c1">// Pass an instance of AbortSignal to optionally abort requests</span>

	<span class="c1">// The following properties are node-fetch extensions</span>
	<span class="nx">follow</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>             <span class="c1">// maximum redirect count. 0 to not follow redirect</span>
	<span class="nx">compress</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>         <span class="c1">// support gzip/deflate content encoding. false to disable</span>
	<span class="nx">size</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>                <span class="c1">// maximum response body size in bytes. 0 to disable</span>
	<span class="nx">agent</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>            <span class="c1">// http(s).Agent instance or function that returns an instance (see below)</span>
	<span class="nx">highWaterMark</span><span class="p">:</span> <span class="mi">16384</span><span class="p">,</span>   <span class="c1">// the maximum number of bytes to store in the internal buffer before ceasing to read from the underlying resource.</span>
	<span class="nx">insecureHTTPParser</span><span class="p">:</span> <span class="kc">false</span>	<span class="c1">// Use an insecure HTTP parser that accepts invalid HTTP headers when `true`.</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="default-headers">Default Headers</h4>

<p>If no values are set, the following request headers will be sent automatically:</p>

<table>
  <thead>
    <tr>
      <th>Header</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Accept-Encoding</code></td>
      <td><code class="language-plaintext highlighter-rouge">gzip, deflate, br</code> (when <code class="language-plaintext highlighter-rouge">options.compress === true</code>)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Accept</code></td>
      <td><code class="language-plaintext highlighter-rouge">*/*</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Content-Length</code></td>
      <td><em>(automatically calculated, if possible)</em></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Host</code></td>
      <td><em>(host and port information from the target URI)</em></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Transfer-Encoding</code></td>
      <td><code class="language-plaintext highlighter-rouge">chunked</code> <em>(when <code class="language-plaintext highlighter-rouge">req.body</code> is a stream)</em></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">User-Agent</code></td>
      <td><code class="language-plaintext highlighter-rouge">node-fetch</code></td>
    </tr>
  </tbody>
</table>

<p>Note: when <code class="language-plaintext highlighter-rouge">body</code> is a <code class="language-plaintext highlighter-rouge">Stream</code>, <code class="language-plaintext highlighter-rouge">Content-Length</code> is not set automatically.</p>

<h4 id="custom-agent">Custom Agent</h4>

<p>The <code class="language-plaintext highlighter-rouge">agent</code> option allows you to specify networking related options which are out of the scope of Fetch, including and not limited to the following:</p>

<ul>
  <li>Support self-signed certificate</li>
  <li>Use only IPv4 or IPv6</li>
  <li>Custom DNS Lookup</li>
</ul>

<p>See <a href="https://nodejs.org/api/http.html#http_new_agent_options"><code class="language-plaintext highlighter-rouge">http.Agent</code></a> for more information.</p>

<p>If no agent is specified, the default agent provided by Node.js is used. Note that <a href="https://github.com/nodejs/node/blob/4267b92604ad78584244488e7f7508a690cb80d0/lib/_http_agent.js#L564">this changed in Node.js 19</a> to have <code class="language-plaintext highlighter-rouge">keepalive</code> true by default. If you wish to enable <code class="language-plaintext highlighter-rouge">keepalive</code> in an earlier version of Node.js, you can override the agent as per the following code sample.</p>

<p>In addition, the <code class="language-plaintext highlighter-rouge">agent</code> option accepts a function that returns <code class="language-plaintext highlighter-rouge">http</code>(s)<code class="language-plaintext highlighter-rouge">.Agent</code> instance given current <a href="https://nodejs.org/api/url.html">URL</a>, this is useful during a redirection chain across HTTP and HTTPS protocol.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">http</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node:http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">https</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node:https</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">httpAgent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Agent</span><span class="p">({</span>
	<span class="na">keepAlive</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
<span class="kd">const</span> <span class="nx">httpsAgent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">https</span><span class="p">.</span><span class="nx">Agent</span><span class="p">({</span>
	<span class="na">keepAlive</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">agent</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_parsedURL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">_parsedURL</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">http:</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">httpAgent</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">httpsAgent</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p><a id="custom-highWaterMark"></a></p>

<h4 id="custom-highwatermark">Custom highWaterMark</h4>

<p>Stream on Node.js have a smaller internal buffer size (16kB, aka <code class="language-plaintext highlighter-rouge">highWaterMark</code>) from client-side browsers (&gt;1MB, not consistent across browsers). Because of that, when you are writing an isomorphic app and using <code class="language-plaintext highlighter-rouge">res.clone()</code>, it will hang with large response in Node.</p>

<p>The recommended way to fix this problem is to resolve cloned response in parallel:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://example.com</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">r1</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">text</span><span class="p">()]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</code></pre></div></div>

<p>If for some reason you don’t like the solution above, since <code class="language-plaintext highlighter-rouge">3.x</code> you are able to modify the <code class="language-plaintext highlighter-rouge">highWaterMark</code> option:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://example.com</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="c1">// About 1MB</span>
	<span class="na">highWaterMark</span><span class="p">:</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">res</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">arrayBuffer</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="insecure-http-parser">Insecure HTTP Parser</h4>

<p>Passed through to the <code class="language-plaintext highlighter-rouge">insecureHTTPParser</code> option on http(s).request. See <a href="https://nodejs.org/api/http.html#http_http_request_url_options_callback"><code class="language-plaintext highlighter-rouge">http.request</code></a> for more information.</p>

<h4 id="manual-redirect">Manual Redirect</h4>

<p>The <code class="language-plaintext highlighter-rouge">redirect: 'manual'</code> option for node-fetch is different from the browser &amp; specification, which
results in an <a href="https://fetch.spec.whatwg.org/#concept-filtered-response-opaque-redirect">opaque-redirect filtered response</a>.
node-fetch gives you the typical <a href="https://fetch.spec.whatwg.org/#concept-filtered-response-basic">basic filtered response</a> instead.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">fetch</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://httpbin.org/status/301</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">redirect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">manual</span><span class="dl">'</span> <span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">301</span> <span class="o">||</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">302</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">const</span> <span class="nx">locationURL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">location</span><span class="dl">'</span><span class="p">),</span> <span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
	<span class="kd">const</span> <span class="nx">response2</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">locationURL</span><span class="p">,</span> <span class="p">{</span> <span class="na">redirect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">manual</span><span class="dl">'</span> <span class="p">});</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">response2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a id="class-request"></a></p>

<h3 id="class-request">Class: Request</h3>

<p>An HTTP(S) request containing information about URL, method, headers, and the body. This class implements the <a href="#iface-body">Body</a> interface.</p>

<p>Due to the nature of Node.js, the following properties are not implemented at this moment:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">type</code></li>
  <li><code class="language-plaintext highlighter-rouge">destination</code></li>
  <li><code class="language-plaintext highlighter-rouge">mode</code></li>
  <li><code class="language-plaintext highlighter-rouge">credentials</code></li>
  <li><code class="language-plaintext highlighter-rouge">cache</code></li>
  <li><code class="language-plaintext highlighter-rouge">integrity</code></li>
  <li><code class="language-plaintext highlighter-rouge">keepalive</code></li>
</ul>

<p>The following node-fetch extension properties are provided:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">follow</code></li>
  <li><code class="language-plaintext highlighter-rouge">compress</code></li>
  <li><code class="language-plaintext highlighter-rouge">counter</code></li>
  <li><code class="language-plaintext highlighter-rouge">agent</code></li>
  <li><code class="language-plaintext highlighter-rouge">highWaterMark</code></li>
</ul>

<p>See <a href="#fetch-options">options</a> for exact meaning of these extensions.</p>

<h4 id="new-requestinput-options">new Request(input[, options])</h4>

<p><small><em>(spec-compliant)</em></small></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">input</code> A string representing a URL, or another <code class="language-plaintext highlighter-rouge">Request</code> (which will be cloned)</li>
  <li><code class="language-plaintext highlighter-rouge">options</code> <a href="#fetch-options">Options</a> for the HTTP(S) request</li>
</ul>

<p>Constructs a new <code class="language-plaintext highlighter-rouge">Request</code> object. The constructor is identical to that in the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request">browser</a>.</p>

<p>In most cases, directly <code class="language-plaintext highlighter-rouge">fetch(url, options)</code> is simpler than creating a <code class="language-plaintext highlighter-rouge">Request</code> object.</p>

<p><a id="class-response"></a></p>

<h3 id="class-response">Class: Response</h3>

<p>An HTTP(S) response. This class implements the <a href="#iface-body">Body</a> interface.</p>

<p>The following properties are not implemented in node-fetch at this moment:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">trailer</code></li>
</ul>

<h4 id="new-responsebody-options">new Response([body[, options]])</h4>

<p><small><em>(spec-compliant)</em></small></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">body</code> A <code class="language-plaintext highlighter-rouge">String</code> or <a href="https://nodejs.org/api/stream.html#stream_readable_streams"><code class="language-plaintext highlighter-rouge">Readable</code> stream</a></li>
  <li><code class="language-plaintext highlighter-rouge">options</code> A <a href="https://fetch.spec.whatwg.org/#responseinit"><code class="language-plaintext highlighter-rouge">ResponseInit</code></a> options dictionary</li>
</ul>

<p>Constructs a new <code class="language-plaintext highlighter-rouge">Response</code> object. The constructor is identical to that in the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/Response">browser</a>.</p>

<p>Because Node.js does not implement service workers (for which this class was designed), one rarely has to construct a <code class="language-plaintext highlighter-rouge">Response</code> directly.</p>

<h4 id="responseok">response.ok</h4>

<p><small><em>(spec-compliant)</em></small></p>

<p>Convenience property representing if the request ended normally. Will evaluate to true if the response status was greater than or equal to 200 but smaller than 300.</p>

<h4 id="responseredirected">response.redirected</h4>

<p><small><em>(spec-compliant)</em></small></p>

<p>Convenience property representing if the request has been redirected at least once. Will evaluate to true if the internal redirect counter is greater than 0.</p>

<h4 id="responsetype">response.type</h4>

<p><small><em>(deviation from spec)</em></small></p>

<p>Convenience property representing the response’s type. node-fetch only supports <code class="language-plaintext highlighter-rouge">'default'</code> and <code class="language-plaintext highlighter-rouge">'error'</code> and does not make use of <a href="https://fetch.spec.whatwg.org/#concept-filtered-response">filtered responses</a>.</p>

<p><a id="class-headers"></a></p>

<h3 id="class-headers">Class: Headers</h3>

<p>This class allows manipulating and iterating over a set of HTTP headers. All methods specified in the <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a> are implemented.</p>

<h4 id="new-headersinit">new Headers([init])</h4>

<p><small><em>(spec-compliant)</em></small></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">init</code> Optional argument to pre-fill the <code class="language-plaintext highlighter-rouge">Headers</code> object</li>
</ul>

<p>Construct a new <code class="language-plaintext highlighter-rouge">Headers</code> object. <code class="language-plaintext highlighter-rouge">init</code> can be either <code class="language-plaintext highlighter-rouge">null</code>, a <code class="language-plaintext highlighter-rouge">Headers</code> object, an key-value map object or any iterable object.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example adapted from https://fetch.spec.whatwg.org/#example-headers-class</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">Headers</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="p">{</span>
	<span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/xml</span><span class="dl">'</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span>

<span class="c1">// The above is equivalent to</span>
<span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="p">[[</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/xml</span><span class="dl">'</span><span class="p">]];</span>
<span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span>

<span class="c1">// You can in fact use any iterable objects, like a Map or even another Headers</span>
<span class="kd">const</span> <span class="nx">meta</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
<span class="nx">meta</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/xml</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">copyOfHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(</span><span class="nx">headers</span><span class="p">);</span>
</code></pre></div></div>

<p><a id="iface-body"></a></p>

<h3 id="interface-body">Interface: Body</h3>

<p><code class="language-plaintext highlighter-rouge">Body</code> is an abstract interface with methods that are applicable to both <code class="language-plaintext highlighter-rouge">Request</code> and <code class="language-plaintext highlighter-rouge">Response</code> classes.</p>

<h4 id="bodybody">body.body</h4>

<p><small><em>(deviation from spec)</em></small></p>

<ul>
  <li>Node.js <a href="https://nodejs.org/api/stream.html#stream_readable_streams"><code class="language-plaintext highlighter-rouge">Readable</code> stream</a></li>
</ul>

<p>Data are encapsulated in the <code class="language-plaintext highlighter-rouge">Body</code> object. Note that while the <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a> requires the property to always be a WHATWG <code class="language-plaintext highlighter-rouge">ReadableStream</code>, in node-fetch it is a Node.js <a href="https://nodejs.org/api/stream.html#stream_readable_streams"><code class="language-plaintext highlighter-rouge">Readable</code> stream</a>.</p>

<h4 id="bodybodyused">body.bodyUsed</h4>

<p><small><em>(spec-compliant)</em></small></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Boolean</code></li>
</ul>

<p>A boolean property for if this body has been consumed. Per the specs, a consumed body cannot be used again.</p>

<h4 id="bodyarraybuffer">body.arrayBuffer()</h4>

<h4 id="bodyformdata">body.formData()</h4>

<h4 id="bodyblob">body.blob()</h4>

<h4 id="bodyjson">body.json()</h4>

<h4 id="bodytext">body.text()</h4>

<p><code class="language-plaintext highlighter-rouge">fetch</code> comes with methods to parse <code class="language-plaintext highlighter-rouge">multipart/form-data</code> payloads as well as
<code class="language-plaintext highlighter-rouge">x-www-form-urlencoded</code> bodies using <code class="language-plaintext highlighter-rouge">.formData()</code> this comes from the idea that
Service Worker can intercept such messages before it’s sent to the server to
alter them. This is useful for anybody building a server so you can use it to
parse &amp; consume payloads.</p>

<details>
<summary>Code example</summary>

```js
import http from 'node:http'
import { Response } from 'node-fetch'

http.createServer(async function (req, res) {
  const formData = await new Response(req, {
    headers: req.headers // Pass along the boundary value
  }).formData()
  const allFields = [...formData]

  const file = formData.get('uploaded-files')
  const arrayBuffer = await file.arrayBuffer()
  const text = await file.text()
  const whatwgReadableStream = file.stream()

  // other was to consume the request could be to do:
  const json = await new Response(req).json()
  const text = await new Response(req).text()
  const arrayBuffer = await new Response(req).arrayBuffer()
  const blob = await new Response(req, {
    headers: req.headers // So that `type` inherits `Content-Type`
  }.blob()
})
```

</details>

<p><a id="class-fetcherror"></a></p>

<h3 id="class-fetcherror">Class: FetchError</h3>

<p><small><em>(node-fetch extension)</em></small></p>

<p>An operational error in the fetching process. See <a href="https://github.com/node-fetch/node-fetch/blob/master/docs/ERROR-HANDLING.md">ERROR-HANDLING.md</a> for more info.</p>

<p><a id="class-aborterror"></a></p>

<h3 id="class-aborterror">Class: AbortError</h3>

<p><small><em>(node-fetch extension)</em></small></p>

<p>An Error thrown when the request is aborted in response to an <code class="language-plaintext highlighter-rouge">AbortSignal</code>’s <code class="language-plaintext highlighter-rouge">abort</code> event. It has a <code class="language-plaintext highlighter-rouge">name</code> property of <code class="language-plaintext highlighter-rouge">AbortError</code>. See <a href="https://github.com/node-fetch/node-fetch/blob/master/docs/ERROR-HANDLING.md">ERROR-HANDLING.MD</a> for more info.</p>

<h2 id="typescript">TypeScript</h2>

<p><strong>Since <code class="language-plaintext highlighter-rouge">3.x</code> types are bundled with <code class="language-plaintext highlighter-rouge">node-fetch</code>, so you don’t need to install any additional packages.</strong></p>

<p>For older versions please use the type definitions from <a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save-dev</span> @types/node-fetch@2.x
</code></pre></div></div>

<h2 id="acknowledgement">Acknowledgement</h2>

<p>Thanks to <a href="https://github.com/github/fetch">github/fetch</a> for providing a solid implementation reference.</p>

<h2 id="team">Team</h2>

<table>
  <thead>
    <tr>
      <th><a href="https://github.com/bitinn"><img src="https://github.com/bitinn.png?size=100" alt="David Frank" /></a></th>
      <th><a href="https://github.com/jimmywarting"><img src="https://github.com/jimmywarting.png?size=100" alt="Jimmy Wärting" /></a></th>
      <th><a href="https://github.com/xxczaki"><img src="https://github.com/xxczaki.png?size=100" alt="Antoni Kepinski" /></a></th>
      <th><a href="https://github.com/Richienb"><img src="https://github.com/Richienb.png?size=100" alt="Richie Bendall" /></a></th>
      <th><a href="https://github.com/gr2m"><img src="https://github.com/gr2m.png?size=100" alt="Gregor Martynus" /></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://bitinn.net/">David Frank</a></td>
      <td><a href="https://jimmy.warting.se/">Jimmy Wärting</a></td>
      <td><a href="https://kepinski.ch">Antoni Kepinski</a></td>
      <td><a href="https://www.richie-bendall.ml/">Richie Bendall</a></td>
      <td><a href="https://twitter.com/gr2m">Gregor Martynus</a></td>
    </tr>
  </tbody>
</table>

<h6 id="former">Former</h6>

<ul>
  <li><a href="https://github.com/timothygu">Timothy Gu</a></li>
  <li><a href="https://github.com/jkantr">Jared Kantrowitz</a></li>
</ul>

<h2 id="license">License</h2>

<p><a href="/node_modules/node-fetch/LICENSE.md">MIT</a></p>



</main>


</body>

</html>
