<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Construye un Bot de Historias con Inteligencia Artificial</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Construye un Bot de Historias con Inteligencia Artificial | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Construye un Bot de Historias con Inteligencia Artificial" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="es" />
<meta name="description" content="Esta entrada del blog fue escrita con la asistencia de ChatGPT-4." />
<meta property="og:description" content="Esta entrada del blog fue escrita con la asistencia de ChatGPT-4." />
<link rel="canonical" href="https://lzwjava.github.io/bot-es" />
<meta property="og:url" content="https://lzwjava.github.io/bot-es" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Construye un Bot de Historias con Inteligencia Artificial" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2024-07-07T00:00:00+08:00","datePublished":"2024-07-07T00:00:00+08:00","description":"Esta entrada del blog fue escrita con la asistencia de ChatGPT-4.","headline":"Construye un Bot de Historias con Inteligencia Artificial","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/bot-es"},"url":"https://lzwjava.github.io/bot-es"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=58316338353747a7346919cdefeaf08a73683b98">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=58316338353747a7346919cdefeaf08a73683b98" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Construye un Bot de Historias con Inteligencia Artificial | Original, traducido por IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/es/2024-07-07-bot-es.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postses2024-07-07-bot-es.md</span> -->
      

      <!-- <span>2024-07-07-bot-es.md</span> -->

      
        

        
          
          <a href="#" class="button">2024.07</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/bot-en" >English</option>
        <option value="/bot-zh" >中文</option>
        <option value="/bot-ja" >日本語</option>
        <option value="/bot-es" selected>Español</option>
        <option value="/bot-hi" >हिंदी</option>
        <option value="/bot-fr" >Français</option>
        <option value="/bot-de" >Deutsch</option>
        <option value="/bot-ar" >العربية</option>
        <option value="/bot-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p><em>Esta entrada del blog fue escrita con la asistencia de ChatGPT-4.</em></p>

<hr />

<h3 id="tabla-de-contenidos">Tabla de Contenidos</h3>

<ul>
  <li><a href="#introducción">Introducción</a></li>
  <li><a href="#arquitectura-del-proyecto">Arquitectura del Proyecto</a>
    <ul>
      <li><a href="#backend">Backend</a>
        <ul>
          <li><a href="#configuración-de-la-aplicación-flask">Configuración de la Aplicación Flask</a></li>
          <li><a href="#registro-y-monitoreo">Registro y Monitoreo</a></li>
          <li><a href="#manejo-de-solicitudes">Manejo de Solicitudes</a></li>
        </ul>
      </li>
      <li><a href="#frontend">Frontend</a>
        <ul>
          <li><a href="#componentes-de-react">Componentes de React</a></li>
          <li><a href="#integración-de-api">Integración de API</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#despliegue">Despliegue</a>
    <ul>
      <li><a href="#script-de-despliegue">Script de Despliegue</a></li>
      <li><a href="#configuración-de-elasticsearch">Configuración de ElasticSearch</a></li>
      <li><a href="#configuración-de-kibana">Configuración de Kibana</a></li>
      <li><a href="#configuración-de-logstash">Configuración de Logstash</a></li>
    </ul>
  </li>
  <li><a href="#configuración-de-nginx-y-certificado-ssl-de-lets-encrypt">Configuración de Nginx y Certificado SSL de Let’s Encrypt</a>
    <ul>
      <li><a href="#definir-un-mapa-para-manejar-los-orígenes-permitidos">Definir un mapa para manejar los orígenes permitidos</a></li>
      <li><a href="#redireccionar-http-a-https">Redireccionar HTTP a HTTPS</a></li>
      <li><a href="#configuración-principal-del-sitio-para-examplecom">Configuración principal del sitio para <code class="language-plaintext highlighter-rouge">example.com</code></a></li>
      <li><a href="#configuración-de-api-para-apiexamplecom">Configuración de API para <code class="language-plaintext highlighter-rouge">api.example.com</code></a></li>
    </ul>
  </li>
  <li><a href="#conclusión">Conclusión</a></li>
</ul>

<hr />

<h3 id="introducción">Introducción</h3>

<p>Esta publicación de blog ofrece una guía completa sobre la arquitectura e implementación de una aplicación de bot de historias impulsada por inteligencia artificial. El proyecto implica la generación de historias personalizadas utilizando una interfaz web. Utilizamos Python, Flask y React para el desarrollo y desplegamos en AWS. Además, empleamos Prometheus para la monitorización y ElasticSearch, Kibana y Logstash para la gestión de registros. La gestión de DNS se realiza a través de GoDaddy y Cloudflare, con Nginx actuando como puerta de enlace para la gestión de certificados SSL y cabeceras de solicitud.</p>

<h3 id="arquitectura-del-proyecto">Arquitectura del Proyecto</h3>

<h4 id="backend">Backend</h4>

<p>El backend del proyecto está construido utilizando Flask, un framework ligero de aplicaciones web WSGI en Python. El backend maneja solicitudes de API, gestiona la base de datos, registra las actividades de la aplicación y se integra con Prometheus para la monitorización.</p>

<p>Aquí tienes un desglose de los componentes del backend:</p>

<ol>
  <li>Configuración de la Aplicación Flask:
    <ul>
      <li>La aplicación Flask se inicializa y configura para utilizar varias extensiones como Flask-CORS para manejar el Intercambio de Recursos de Origen Cruzado (CORS) y Flask-Migrate para gestionar las migraciones de la base de datos.</li>
      <li>Se inicializan las rutas de la aplicación y se habilita CORS para permitir solicitudes de origen cruzado.</li>
      <li>La base de datos se inicializa con configuraciones predeterminadas, y se configura un registrador personalizado (logger) para formatear las entradas de registro para Logstash.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
    <span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span>
    <span class="kn">from</span> <span class="nn">.routes</span> <span class="kn">import</span> <span class="n">initialize_routes</span>
    <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">insert_default_config</span>
    <span class="kn">from</span> <span class="nn">flask_migrate</span> <span class="kn">import</span> <span class="n">Migrate</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">RotatingFileHandler</span>
    <span class="kn">from</span> <span class="nn">prometheus_client</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">generate_latest</span><span class="p">,</span> <span class="n">Gauge</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'api.config.BaseConfig'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">db</span><span class="p">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">initialize_routes</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>Registro y Monitoreo:
    <ul>
      <li>La aplicación utiliza <code class="language-plaintext highlighter-rouge">RotatingFileHandler</code> para gestionar archivos de registro y formatea los registros utilizando un formateador personalizado.</li>
      <li>Las métricas de Prometheus están integradas en la aplicación para rastrear el recuento de solicitudes y la latencia.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">REQUEST_COUNT</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s">'flask_app_request_count'</span><span class="p">,</span> <span class="s">'Cantidad total de solicitudes de la aplicación Flask'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">,</span> <span class="s">'http_status'</span><span class="p">])</span>
<span class="n">REQUEST_LATENCY</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s">'flask_app_request_latency_seconds'</span><span class="p">,</span> <span class="s">'Latencia de las solicitudes'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setup_loggers</span><span class="p">():</span>
    <span class="n">logstash_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span><span class="s">'app.log'</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logstash_formatter</span> <span class="o">=</span> <span class="n">CustomLogstashFormatter</span><span class="p">()</span>
    <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logstash_formatter</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">root_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">root_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
<span class="n">werkzeug_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'werkzeug'</span><span class="p">)</span>
<span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setup_loggers()
```
</code></pre></div></div>

<ol>
  <li>Manejo de Solicitudes:
    <ul>
      <li>La aplicación captura métricas antes y después de cada solicitud, generando un ID de seguimiento para rastrear el flujo de la solicitud.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_trace_id</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
    <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">before_request</span>
<span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="n">request</span><span class="p">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">trace_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'X-Trace-Id'</span><span class="p">,</span> <span class="n">generate_trace_id</span><span class="p">())</span>
    <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">after_request</span>
    <span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Trace-Id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span>
        <span class="n">request_latency</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'start_time'</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">REQUEST_COUNT</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="n">http_status</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">).</span><span class="n">inc</span><span class="p">()</span>
        <span class="n">REQUEST_LATENCY</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">).</span><span class="nb">set</span><span class="p">(</span><span class="n">request_latency</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<h4 id="frontend">Frontend</h4>

<p>El frontend del proyecto está construido utilizando React, una biblioteca de JavaScript para construir interfaces de usuario. Interactúa con la API del backend para gestionar los prompts de historias y proporciona una interfaz de usuario interactiva para generar y gestionar historias personalizadas.</p>

<ol>
  <li>Componentes de React:
    <ul>
      <li>El componente principal maneja la entrada del usuario para los prompts de historias e interactúa con la API del backend para gestionar estas historias.</li>
    </ul>
  </li>
</ol>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">ToastContainer</span><span class="p">,</span> <span class="nx">toast</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-toastify</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="dl">'</span><span class="s1">react-toastify/dist/ReactToastify.css</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">apiFetch</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./api</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function App() {
  const [prompts, setPrompts] = useState([]);
  const [newPrompt, setNewPrompt] = useState('');
  const [isLoading, setIsLoading] = useState(false);
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">fetchPrompts</span><span class="p">();</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fetchPrompts</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">prompts</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
      <span class="nx">setPrompts</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error al obtener los prompts</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Ocurrió un error al obtener los prompts</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="kd">const</span> <span class="nx">addPrompt</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">newPrompt</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">toast</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">El contenido del prompt no puede estar vacío</span><span class="dl">'</span><span class="p">);</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">prompts</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">content</span><span class="p">:</span> <span class="nx">newPrompt</span> <span class="p">}),</span>
          <span class="p">});</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fetchPrompts</span><span class="p">();</span>
            <span class="nx">setNewPrompt</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="dl">'</span><span class="s1">Prompt añadido exitosamente</span><span class="dl">'</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error al añadir el prompt</span><span class="dl">'</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Ocurrió un error al añadir el prompt</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
          <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="kd">const</span> <span class="nx">deletePrompt</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">promptId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="s2">`prompts/</span><span class="p">${</span><span class="nx">promptId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">,</span>
          <span class="p">});</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fetchPrompts</span><span class="p">();</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="dl">'</span><span class="s1">Prompt eliminado correctamente</span><span class="dl">'</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error al eliminar el prompt</span><span class="dl">'</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Ocurrió un error al eliminar el prompt</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
          <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">app</span><span class="dl">"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Bot</span> <span class="nx">de</span> <span class="nx">Historias</span> <span class="nx">con</span> <span class="nx">IA</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span>
              <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span>
              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">newPrompt</span><span class="p">}</span>
              <span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setNewPrompt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
              <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Nuevo Prompt</span><span class="dl">"</span>
            <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">addPrompt</span><span class="p">}</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Agregar</span> <span class="nx">Prompt</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="p">{</span><span class="nx">isLoading</span> <span class="p">?</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Cargando</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>          <span class="p">)</span> <span class="p">:</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
              <span class="p">{</span><span class="nx">prompts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">prompt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
                <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
                  <span class="p">{</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">content</span><span class="p">}</span>
                  <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">deletePrompt</span><span class="p">(</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">id</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">Eliminar</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>                <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>              <span class="p">))}</span>
            <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>          <span class="p">)}</span>
          <span class="o">&lt;</span><span class="nx">ToastContainer</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
    <span class="s2">```

2. Integración de API:
    - El frontend interactúa con la API del backend utilizando solicitudes fetch para gestionar los prompts de las historias.

```</span><span class="nx">javascript</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">apiFetch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">`https://api.yourdomain.com/</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="despliegue">Despliegue</h3>

<p>El proyecto está desplegado en AWS, con la gestión de DNS manejada a través de GoDaddy y Cloudflare. Se utiliza Nginx como puerta de enlace para la gestión de certificados SSL y cabeceras de solicitud. Utilizamos Prometheus para la monitorización y ElasticSearch, Kibana y Logstash para la gestión de registros.</p>

<ol>
  <li>Script de Implementación:
    <ul>
      <li>Utilizamos Fabric para automatizar tareas de implementación como la preparación de directorios locales y remotos, la sincronización de archivos y la configuración de permisos.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">task</span>
 <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">Connection</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">server_dir</span> <span class="o">=</span> <span class="s">'/home/project/server'</span>
    <span class="n">web_tmp_dir</span> <span class="o">=</span> <span class="s">'/home/project/server/tmp'</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">task</span>
    <span class="k">def</span> <span class="nf">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s">'test -d </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'mkdir -p </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 755 </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 777 </span><span class="si">{</span><span class="n">web_tmp_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">task</span>
    <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">install</span><span class="o">=</span><span class="s">'false'</span><span class="p">):</span>
        <span class="n">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">pem_file</span> <span class="o">=</span> <span class="s">'./aws-keypair.pem'</span>
        <span class="n">rsync_command</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s">'rsync -avz --exclude="api/db.sqlite3" '</span>
                         <span class="sa">f</span><span class="s">'-e "ssh -i </span><span class="si">{</span><span class="n">pem_file</span><span class="si">}</span><span class="s">" --rsync-path="sudo rsync" '</span>
                         <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">tmp_dir</span><span class="si">}</span><span class="s">/ </span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">user</span><span class="si">}</span><span class="s">@</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
        <span class="n">c</span><span class="p">.</span><span class="n">local</span><span class="p">(</span><span class="n">rsync_command</span><span class="p">)</span>
        <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>Configuración de ElasticSearch:
    <ul>
      <li>La configuración de ElasticSearch incluye ajustes para el clúster, el nodo y las configuraciones de red.</li>
    </ul>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cluster.name</span><span class="pi">:</span> <span class="s">my-application</span>
<span class="na">node.name</span><span class="pi">:</span> <span class="s">node-1</span>
<span class="na">path.data</span><span class="pi">:</span> <span class="s">/var/lib/elasticsearch</span>
<span class="na">path.logs</span><span class="pi">:</span> <span class="s">/var/log/elasticsearch</span>
<span class="na">network.host</span><span class="pi">:</span> <span class="s">0.0.0.0</span>
<span class="na">http.port</span><span class="pi">:</span> <span class="m">9200</span>
<span class="na">discovery.seed_hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">]</span>
<span class="na">cluster.initial_master_nodes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">node-1"</span><span class="pi">]</span>
</code></pre></div></div>

<ol>
  <li>Configuración de Kibana:
    <ul>
      <li>La configuración de Kibana incluye ajustes para el servidor y los hosts de ElasticSearch.</li>
    </ul>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server.port</span><span class="pi">:</span> <span class="m">5601</span>
<span class="na">server.host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span>
<span class="na">elasticsearch.hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">http://localhost:9200"</span><span class="pi">]</span>
</code></pre></div></div>

<ol>
  <li>Configuración de Logstash:
    <ul>
      <li>Logstash está configurado para leer archivos de registro, analizarlos y enviar los registros analizados a ElasticSearch.</li>
    </ul>

    <p>```plaintext
 input {
   file {
     path =&gt; “/home/project/server/app.log”
     start_position =&gt; “beginning”
     sincedb_path =&gt; “/dev/null”
   }
 }</p>

    <p>filter {
   json {
     source =&gt; “message”
   }
 }</p>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="s">output {</span>
      <span class="s">elasticsearch {</span>
        <span class="s">hosts =&gt; ["http://localhost:9200"]</span>
        <span class="s">index =&gt; "flask-logs-%{+YYYY.MM.dd}"</span>
      <span class="s">}</span>
    <span class="s">}</span>
    <span class="s">```</span>

<span class="c1">### Configuración de Nginx y Certificado SSL de Let's Encrypt</span>

<span class="s">Para garantizar una comunicación segura, utilizamos Nginx como proxy inverso y Let's Encrypt para los certificados SSL. A continuación se muestra la configuración de Nginx para manejar la redirección de HTTP a HTTPS y configurar los certificados SSL.</span>

<span class="na">1. Define un mapa para manejar los orígenes permitidos</span><span class="pi">:</span>

<span class="err">```</span><span class="s">nginx</span>
    <span class="s">map $http_origin $cors_origin {</span>
        <span class="s">default "https://example.com";</span>
        <span class="s">"http://localhost:3000" "http://localhost:3000";</span>
        <span class="s">"https://example.com" "https://example.com";</span>
        <span class="s">"https://www.example.com" "https://www.example.com";</span>
    <span class="s">}</span>
    <span class="s">```</span>

<span class="na">2. Redirigir HTTP a HTTPS</span><span class="pi">:</span>

    <span class="err">```</span><span class="s">nginx</span>
    <span class="s">server {</span>
        <span class="s">listen 80;</span>
        <span class="s">server_name example.com api.example.com;</span>
    <span class="s">```</span>

        <span class="s">return 301 https://$host$request_uri;</span>
    <span class="s">}</span>
    <span class="s">```</span>

<span class="na">3. Configuración principal del sitio para `example.com`</span><span class="pi">:</span>

    <span class="err">```</span><span class="s">nginx</span>
    <span class="s">server {</span>
        <span class="s">listen 443 ssl;</span>
        <span class="s">server_name example.com;</span>
    <span class="s">```</span>

<span class="err">```</span><span class="s">nginx</span>
        <span class="s">ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;</span>
        <span class="s">ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
        <span class="k">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
        <span class="k">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root /home/proyecto/web;
    index index.html index.htm index.php default.html default.htm default.php;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
        expires 30d;
    }

    location ~ .*\.(js|css)?$ {
        expires 12h;
    }
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">error_page</span> <span class="mi">404</span> <span class="n">/index.html</span><span class="p">;</span>
    <span class="err">}</span>
    <span class="k">```</span>

<span class="mi">4</span><span class="s">.</span> <span class="s">Configuración</span> <span class="s">de</span> <span class="s">la</span> <span class="s">API</span> <span class="s">para</span> <span class="s">`api.example.com`:</span>

    <span class="s">```nginx</span>
    <span class="s">server</span> <span class="p">{</span>
        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
        <span class="kn">server_name</span> <span class="s">api.example.com</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ssl_certificate /etc/letsencrypt/live/example.com-0001/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com-0001/privkey.pem;
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
        <span class="k">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
        <span class="k">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    location / {
        # Limpiar cualquier encabezado Access-Control preexistente
        more_clear_headers 'Access-Control-Allow-Origin';
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="c1"># Manejar solicitudes de preflight CORS</span>
            <span class="k">if</span> <span class="s">(</span><span class="nv">$request_method</span> <span class="p">=</span> <span class="s">'OPTIONS')</span> <span class="p">{</span>
                <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Origin'</span> <span class="nv">$cors_origin</span><span class="p">;</span>
                <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Methods'</span> <span class="s">'GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">PUT,</span> <span class="s">DELETE'</span><span class="p">;</span>
                <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Headers'</span> <span class="s">'Origin,</span> <span class="s">Content-Type,</span> <span class="s">Accept,</span> <span class="s">Authorization,</span> <span class="s">X-Client-Info,</span> <span class="s">X-Trace-Id,</span> <span class="s">X-Requested-With,</span> <span class="s">X-HTTP-Method-Override,</span> <span class="s">DNT,</span> <span class="s">Keep-Alive,</span> <span class="s">User-Agent,</span> <span class="s">If-Modified-Since,</span> <span class="s">Cache-Control,</span> <span class="s">Content-Range,</span> <span class="s">Range'</span><span class="p">;</span>
                <span class="kn">add_header</span> <span class="s">'Access-Control-Max-Age'</span> <span class="mi">3600</span><span class="p">;</span>
                <span class="kn">return</span> <span class="mi">204</span><span class="p">;</span>
            <span class="p">}</span>
</code></pre></div></div>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">add_header</span> <span class="s">'Access-Control-Allow-Origin'</span> <span class="nv">$cors_origin</span> <span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span> <span class="s">'Access-Control-Allow-Methods'</span> <span class="s">'GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">PUT,</span> <span class="s">DELETE'</span> <span class="s">always</span><span class="p">;</span>
<span class="k">add_header</span> <span class="s">'Access-Control-Allow-Headers'</span> <span class="s">'Origin,</span> <span class="s">Content-Type,</span> <span class="s">Accept,</span> <span class="s">Authorization,</span> <span class="s">X-Client-Info,</span> <span class="s">X-Trace-Id,</span> <span class="s">X-Requested-With,</span> <span class="s">X-HTTP-Method-Override,</span> <span class="s">DNT,</span> <span class="s">Keep-Alive,</span> <span class="s">User-Agent,</span> <span class="s">If-Modified-Since,</span> <span class="s">Cache-Control,</span> <span class="s">Content-Range,</span> <span class="s">Range'</span> <span class="s">always</span><span class="p">;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">nginx
            proxy_pass http://127.0.0.1:5000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 600s;
            proxy_send_timeout 600s;
            proxy_read_timeout 600s;
            send_timeout 600s;
        }
    }
   </code></p>

<h3 id="conclusión">Conclusión</h3>

<p>Este proyecto muestra una arquitectura robusta para una aplicación de bot de historias impulsada por IA, utilizando prácticas y herramientas modernas de desarrollo web. El backend está construido con Flask, asegurando un manejo eficiente de solicitudes y una integración con varios servicios para registro y monitoreo. El frontend, desarrollado con React, proporciona una interfaz de usuario interactiva para gestionar los prompts de historias. Al aprovechar AWS para la implementación, Nginx para la comunicación segura y la pila ELK para la gestión de registros, garantizamos escalabilidad, confiabilidad y mantenibilidad. Esta configuración integral demuestra el poder de combinar tecnologías de vanguardia para ofrecer una experiencia de usuario fluida.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-es" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
