<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>抓取网站内容</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>抓取网站内容 | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="抓取网站内容" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="zh" />
<meta name="description" content="已经有很多现成的工具可以抓取网站的内容。然而如果使用它们，我们没法更好地理解背后的过程。如果在工作中遇到复杂或特别一些的网站，使用它们可能并不能得到想要的结果。我们需要造轮子，为了更好地学习它们和更好地运用它们。" />
<meta property="og:description" content="已经有很多现成的工具可以抓取网站的内容。然而如果使用它们，我们没法更好地理解背后的过程。如果在工作中遇到复杂或特别一些的网站，使用它们可能并不能得到想要的结果。我们需要造轮子，为了更好地学习它们和更好地运用它们。" />
<link rel="canonical" href="https://lzwjava.github.io/scrape-zh" />
<meta property="og:url" content="https://lzwjava.github.io/scrape-zh" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-17T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="抓取网站内容" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2021-03-17T00:00:00+08:00","datePublished":"2021-03-17T00:00:00+08:00","description":"已经有很多现成的工具可以抓取网站的内容。然而如果使用它们，我们没法更好地理解背后的过程。如果在工作中遇到复杂或特别一些的网站，使用它们可能并不能得到想要的结果。我们需要造轮子，为了更好地学习它们和更好地运用它们。","headline":"抓取网站内容","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/scrape-zh"},"url":"https://lzwjava.github.io/scrape-zh"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=c4f59999fbd8fabe43c3a9929e5354be160108d4">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=c4f59999fbd8fabe43c3a9929e5354be160108d4" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       抓取网站内容 | 原创
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/zh/2021-03-17-scrape-zh.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postszh2021-03-17-scrape-zh.md</span> -->
      

      <!-- <span>2021-03-17-scrape-zh.md</span> -->

      
        

        
          
          <a href="#" class="button">2021.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/scrape-en" >English</option>
        <option value="/scrape-zh" selected>中文</option>
        <option value="/scrape-ja" >日本語</option>
        <option value="/scrape-es" >Español</option>
        <option value="/scrape-hi" >हिंदी</option>
        <option value="/scrape-fr" >Français</option>
        <option value="/scrape-de" >Deutsch</option>
        <option value="/scrape-ar" >العربية</option>
        <option value="/scrape-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>已经有很多现成的工具可以抓取网站的内容。然而如果使用它们，我们没法更好地理解背后的过程。如果在工作中遇到复杂或特别一些的网站，使用它们可能并不能得到想要的结果。我们需要造轮子，为了更好地学习它们和更好地运用它们。</p>

<p>也来看看现成的一些工具。</p>

<h2 id="data-miner">Data Miner</h2>

<p><img src="assets/images/scrape/miner.png" alt="miner" /></p>

<p><code class="language-plaintext highlighter-rouge">Data Miner</code>是Chrome上的很方便的一个插件。可以来很方便地抓取链接和内容。</p>

<h2 id="getbook">getbook</h2>

<p><code class="language-plaintext highlighter-rouge">getbook</code>是一个很方便的制作电子书工具。</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">getbook</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">book.json</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"book"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Hello World"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Armin"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"chapters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"http://lucumr.pocoo.org/2018/7/13/python/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"http://lucumr.pocoo.org/2017/6/5/diversity-in-technology"</span><span class="p">,</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getbook <span class="nt">-f</span> ./book.json <span class="nt">--mobi</span>
</code></pre></div></div>

<p>这样就方便地把一些链接做成了电子书。通过使用 <code class="language-plaintext highlighter-rouge">Data Miner</code>和<code class="language-plaintext highlighter-rouge">getbook</code>，一个爬取链接，一个把链接变成电子书，就能很方便制作电子书。</p>

<h2 id="费曼物理讲义">费曼物理讲义</h2>

<p><img src="assets/images/scrape/fl.png" alt="fl" /></p>

<p>在「项目实战：将费曼物理讲义网页做成电子书」章节中，我们学会如何把一个用<code class="language-plaintext highlighter-rouge">mathjax</code>渲染的<code class="language-plaintext highlighter-rouge">html</code>网页做成电子书。这里继续这个项目，来看看如何获取到所有的网页。费曼物理讲义有三卷。上图是第一卷的的目录。</p>

<blockquote>
  <p>http.client — HTTP protocol client</p>

  <p>Source code: Lib/http/client.py</p>

  <p>This module defines classes which implement the client side of the HTTP and HTTPS protocols. It is normally not used directly — the module urllib.request uses it to handle URLs that use HTTP and HTTPS.</p>

  <p>See also: The Requests package is recommended for a higher-level HTTP client interface.</p>
</blockquote>

<p>可见<code class="language-plaintext highlighter-rouge">rquests</code>是更高阶的接口。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://api.github.com/user'</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">'user'</span><span class="p">,</span> <span class="s">'pass'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>    

<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>401
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://github.com'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>200
<span class="nt">&lt;html&gt;</span>
  ...
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>试了试，说明<code class="language-plaintext highlighter-rouge">requests</code>的接口是能用的。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toc-chapter"</span> <span class="na">id=</span><span class="s">"C03"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"triangle"</span><span class="nt">&gt;</span>
         â¶
        <span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"chapterlink"</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3)"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
          Chapter 3.
         <span class="nt">&lt;/span&gt;</span>
         The Relation of Physics to Other Sciences
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"sections"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,1)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-1
          <span class="nt">&lt;/span&gt;</span>
          Introduction
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,2)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-2
          <span class="nt">&lt;/span&gt;</span>
          Chemistry
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,3)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-3
          <span class="nt">&lt;/span&gt;</span>
          Biology
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,4)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-4
          <span class="nt">&lt;/span&gt;</span>
          Astronomy
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,5)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-5
          <span class="nt">&lt;/span&gt;</span>
          Geology
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,6)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-6
          <span class="nt">&lt;/span&gt;</span>
          Psychology
         <span class="nt">&lt;/a&gt;</span>
         <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"javascript:Goto(1,3,7)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
           3-7
          <span class="nt">&lt;/span&gt;</span>
          How did it get that way?
         <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
       <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>这是在目录页面中，第三章节的<code class="language-plaintext highlighter-rouge">html</code>代码。想从这里抓取每一章节的链接。<code class="language-plaintext highlighter-rouge">&lt;a href="javascript:Goto(1,3,7)"&gt;</code>，可见是一个<code class="language-plaintext highlighter-rouge">javascript</code>的超链接。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.feynmanlectures.caltech.edu/I_03.html
</code></pre></div></div>

<p>接着发现，每章节的路径是很有规律的。<code class="language-plaintext highlighter-rouge">I_03.html</code>表示第一卷第三章。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>

<span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chapter</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">chapter</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">'chapter </span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">chapter_str</span> <span class="o">=</span> <span class="s">'{:02d}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://www.feynmanlectures.caltech.edu/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'scraping </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">'lxml'</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
        
<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>来接着写写抓取代码。这里用到了<code class="language-plaintext highlighter-rouge">Process</code>。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    raise RuntimeError<span class="o">(</span><span class="s1">'''
RuntimeError: 
        An attempt has been made to start a new process before the
        current process has finished its bootstrapping phase.

        This probably means that you are not using fork to start your
        child processes and you have forgotten to use the proper idiom
        in the main module:

            if __name__ == '</span>__main__<span class="s1">':
                freeze_support()
                ...

        The "freeze_support()" line can be omitted if the program
        is not going to be frozen to produce an executable.
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">):</span>        
        <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time: '</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> 

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>    
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scraping https://www.feynmanlectures.caltech.edu/I_01.html
scraping https://www.feynmanlectures.caltech.edu/I_04.html
...
scraping https://www.feynmanlectures.caltech.edu/I_51.html
scraping https://www.feynmanlectures.caltech.edu/I_52.html
Time:  9.144841699
</code></pre></div></div>

<p><img src="assets/images/scrape/fig.png" alt="fig" /></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"figure"</span> <span class="na">id=</span><span class="s">"Ch1-F1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"img/FLP_I/f01-01/f01-01_tc_big.svgz"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"caption empty"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"tag"</span><span class="nt">&gt;</span>
          Figure 1â1
         <span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chapter</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">chapter</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">'chapter </span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">chapter_str</span> <span class="o">=</span> <span class="s">'{:02d}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://www.feynmanlectures.caltech.edu/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'scraping </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">'lxml'</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time: '</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> 

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>    
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>看看链接。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">imgs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scraping https://www.feynmanlectures.caltech.edu/I_01.html
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"TwitLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"FBLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"MailLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"MobileLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"DarkModeLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"DesktopLink"</span> <span class="na">src=</span><span class="s">""</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"img/camera.svg"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"img/FLP_I/f01-00/f01-00.jpg"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-01/f01-01_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-02/f01-02_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-03/f01-03_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-04/f01-04_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-05/f01-05_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-06/f01-06_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"first"</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-07/f01-07_tc_iPad_big_a.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"last"</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-07/f01-07_tc_iPad_big_b.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-08/f01-08_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-09/f01-09_tc_big.svgz"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">data-src=</span><span class="s">"img/FLP_I/f01-10/f01-10_tc_big.svgz"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>https://www.feynmanlectures.caltech.edu/img/FLP_I/f01-01/f01-01_tc_big.svgz</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Forbidden

You don<span class="s1">'t have permission to access this resource.

Apache/2.4.38 (Debian) Server at www.feynmanlectures.caltech.edu Port 443
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% pip <span class="nb">install </span>selenium
Collecting selenium
  Using cached selenium-3.141.0-py2.py3-none-any.whl <span class="o">(</span>904 kB<span class="o">)</span>
Requirement already satisfied: urllib3 <span class="k">in</span> /usr/local/lib/python3.9/site-packages <span class="o">(</span>from selenium<span class="o">)</span> <span class="o">(</span>1.24.2<span class="o">)</span>
Installing collected packages: selenium
Successfully installed selenium-3.141.0
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CHROME_DRIVER_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/dev-env/chromedriver
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">CHROME_DRIVER_HOME</span><span class="k">}</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% chromedriver <span class="nt">-h</span>
Usage: chromedriver <span class="o">[</span>OPTIONS]

Options
  <span class="nt">--port</span><span class="o">=</span>PORT                     port to listen on
  <span class="nt">--adb-port</span><span class="o">=</span>PORT                 adb server port
  <span class="nt">--log-path</span><span class="o">=</span>FILE                 write server log to file instead of stderr, increases log level to INFO
  <span class="nt">--log-level</span><span class="o">=</span>LEVEL               <span class="nb">set </span>log level: ALL, DEBUG, INFO, WARNING, SEVERE, OFF
  <span class="nt">--verbose</span>                       log verbosely <span class="o">(</span>equivalent to <span class="nt">--log-level</span><span class="o">=</span>ALL<span class="o">)</span>
  <span class="nt">--silent</span>                        log nothing <span class="o">(</span>equivalent to <span class="nt">--log-level</span><span class="o">=</span>OFF<span class="o">)</span>
  <span class="nt">--append-log</span>                    append log file instead of rewriting
  <span class="nt">--replayable</span>                    <span class="o">(</span>experimental<span class="o">)</span> log verbosely and don<span class="s1">'t truncate long strings so that the log can be replayed.
  --version                       print the version number and exit
  --url-base                      base URL path prefix for commands, e.g. wd/url
  --readable-timestamp            add readable timestamps to log
  --enable-chrome-logs            show logs from the browser (overrides other logging options)
  --allowed-ips                   comma-separated allowlist of remote IP addresses which are allowed to connect to ChromeDriver
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.expected_conditions</span> <span class="kn">import</span> <span class="n">presence_of_element_located</span>

<span class="k">with</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span> <span class="k">as</span> <span class="n">driver</span><span class="p">:</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://google.com/ncr"</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s">"q"</span><span class="p">).</span><span class="n">send_keys</span><span class="p">(</span><span class="s">"cheese"</span> <span class="o">+</span> <span class="n">Keys</span><span class="p">.</span><span class="n">RETURN</span><span class="p">)</span>
    <span class="n">first_result</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">"h3&gt;div"</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">first_result</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">"textContent"</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.expected_conditions</span> <span class="kn">import</span> <span class="n">presence_of_element_located</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://www.feynmanlectures.caltech.edu/I_01.html"</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s">"img"</span><span class="p">)</span>
    <span class="c1"># print(dir(elements[0]))
</span>    <span class="k">print</span><span class="p">(</span><span class="n">driver</span><span class="p">.</span><span class="n">page_source</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="c1"># src = element.get_attribute('src')
</span>        <span class="n">element</span><span class="p">.</span><span class="n">screenshot</span><span class="p">(</span><span class="sa">f</span><span class="s">'images/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">.png'</span><span class="p">)</span>        
        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>                
    <span class="n">driver</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>

<span class="k">def</span> <span class="nf">img_path</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">'./chapters/</span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">/img'</span>

<span class="k">def</span> <span class="nf">img_name</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">splits</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">last</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">name</span>

<span class="k">def</span> <span class="nf">download_images</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">,</span> <span class="n">chapter</span><span class="p">):</span>        
    <span class="n">path</span> <span class="o">=</span> <span class="n">img_path</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>    
        
    <span class="n">elements</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s">"img"</span><span class="p">)</span>    
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">'src'</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">img_name</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="n">element</span><span class="p">.</span><span class="n">screenshot</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">.png'</span><span class="p">)</span>

<span class="n">USER_AGENT</span> <span class="o">=</span> <span class="s">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Safari/605.1.15'</span>

<span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="n">chapter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chapter</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">chapter</span> <span class="o">&gt;</span> <span class="mi">52</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">'chapter </span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">chapter_str</span> <span class="o">=</span> <span class="s">'{:02d}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">chapter</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'https://www.feynmanlectures.caltech.edu/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
    <span class="n">driver</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">page_source</span> <span class="o">=</span> <span class="n">driver</span><span class="p">.</span><span class="n">page_source</span>        
    <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">'</span><span class="p">).</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'scraping </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
        
    <span class="n">download_images</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">chapter_str</span><span class="p">)</span>
        
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page_source</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">'lxml'</span><span class="p">)</span>        
    <span class="n">imgs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">'src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span> <span class="ow">or</span> <span class="s">'data-src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="s">''</span>
            <span class="k">if</span> <span class="s">'src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s">'data-src'</span> <span class="ow">in</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'data-src'</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'data-src'</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">img_name</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
            <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'img/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">.png'</span>                
    
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'./chapters/</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">/I_</span><span class="si">{</span><span class="n">chapter_str</span><span class="si">}</span><span class="s">.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">driver</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">scrape</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time: '</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> 

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>    
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scraping https://www.feynmanlectures.caltech.edu/I_01.html
scraping https://www.feynmanlectures.caltech.edu/I_02.html
Time:  21.478510914999998
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> errpipe_read, errpipe_write <span class="o">=</span> os.pipe<span class="o">()</span>
OSError: <span class="o">[</span>Errno 24] Too many open files
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> % <span class="nb">ulimit </span>a
<span class="nb">ulimit</span>: invalid number: a
lzw@lzwjava feynman-lectures-mobi % <span class="nb">ulimit</span> <span class="nt">-a</span>
<span class="nt">-t</span>: cpu <span class="nb">time</span> <span class="o">(</span>seconds<span class="o">)</span>              unlimited
<span class="nt">-f</span>: file size <span class="o">(</span>blocks<span class="o">)</span>              unlimited
<span class="nt">-d</span>: data seg size <span class="o">(</span>kbytes<span class="o">)</span>          unlimited
<span class="nt">-s</span>: stack size <span class="o">(</span>kbytes<span class="o">)</span>             8192
<span class="nt">-c</span>: core file size <span class="o">(</span>blocks<span class="o">)</span>         0
<span class="nt">-v</span>: address space <span class="o">(</span>kbytes<span class="o">)</span>          unlimited
<span class="nt">-l</span>: locked-in-memory size <span class="o">(</span>kbytes<span class="o">)</span>  unlimited
<span class="nt">-u</span>: processes                       2784
<span class="nt">-n</span>: file descriptors                256
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12
download_images
12
mathjax2svg
latexs 128
make_svg 0
insert_svg 0
make_svg 1
insert_svg 1
make_svg 2
insert_svg 2
make_svg 3
insert_svg 3
convert
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12
download_images
12
mathjax2svg
latexs 0
latexs 0
convert
Time:  11.369145162
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% <span class="nb">grep</span> <span class="nt">--include</span><span class="o">=</span><span class="se">\*</span>.html <span class="nt">-r</span> <span class="s1">'\$'</span> <span class="k">*</span>
43/I_43.html:a long period of <span class="nb">time</span> <span class="nv">$T$,</span> have a certain number, <span class="nv">$N$,</span> of hits. If we
43/I_43.html:number of collisions is proportional to the <span class="nb">time</span> <span class="nv">$T$.</span> We would like to
43/I_43.html:We have written the constant of proportionality as <span class="nv">$1</span>/<span class="se">\t</span>au<span class="nv">$,</span> where
43/I_43.html:<span class="nv">$\</span>tau<span class="nv">$ </span>will have the dimensions of a time. The constant <span class="nv">$\</span>tau<span class="nv">$ </span>is the
43/I_43.html:there are <span class="nv">$60$ </span>collisions<span class="p">;</span> <span class="k">then</span> <span class="nv">$\</span>tau<span class="nv">$ </span>is one minute. We would say
43/I_43.html:that <span class="nv">$\</span>tau<span class="nv">$ </span><span class="o">(</span>one minute<span class="o">)</span> is the
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>错误	E21018: 解析文件中的内容时，创建改进的 Mobi 域名失败。内容：&lt;In earlier chapters <span class="o">&gt;</span> 文件中： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/c-49.xhtml 行： 969
提醒	W28001: Kindle 阅读器不支持内容中指定的 CSS 样式。正在删除 CSS 属性： <span class="s1">'max-width'</span> 文件中： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/stylesheet.css
提醒	W29004: 强制关闭的已打开标签为： &lt;span amzn-src-id<span class="o">=</span><span class="s2">"985"</span><span class="o">&gt;</span> 文件中： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/c-4.xhtml     行： 0000102
提醒	W29004: 强制关闭的已打开标签为： &lt;p amzn-src-id<span class="o">=</span><span class="s2">"975"</span><span class="o">&gt;</span> 文件中： /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/069e0b8a-f12e-4102-aed3-977c0c3c1178/cTemp/mTemp/mobi-GxL1ye/OEBPS/c-4.xhtml     行： 0000102
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>提醒	W14001: 超链接出现问题，尚未解决：  /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/97c9cb4d-35f7-4920-81eb-4705325c482f/cTemp/mTemp/mobi-pvawPN/OEBPS/c-1.xhtml#Ch1-F1			
提醒	W14001: 超链接出现问题，尚未解决：  /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/97c9cb4d-35f7-4920-81eb-4705325c482f/cTemp/mTemp/mobi-pvawPN/OEBPS/c-1.xhtml#Ch1-F2			
提醒	W14001: 超链接出现问题，尚未解决：  /private/var/folders/_3/n3b7dq8x6652drmx6_d3t3bh0000gr/T/97c9cb4d-35f7-4920-81eb-4705325c482f/cTemp/mTemp/mobi-pvawPN/OEBPS/c-1.xhtml#Ch1-F3			
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"disabled"</span> <span class="na">href=</span><span class="s">"#Ch1-F1"</span><span class="nt">&gt;</span>
          1–1
<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rasterizing <span class="s1">'OEBPS/84b8b4179175f097be1180a10089107be75d7d85.svg'</span> to 1264x1011
Rasterizing <span class="s1">'OEBPS/23a4df37f269c8ed43f54753eb838b29cff538a1.svg'</span> to 1264x259
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"runpy.py"</span>, line 194, <span class="k">in </span>_run_module_as_main
  File <span class="s2">"runpy.py"</span>, line 87, <span class="k">in </span>_run_code
  File <span class="s2">"site.py"</span>, line 39, <span class="k">in</span> &lt;module&gt;
  File <span class="s2">"site.py"</span>, line 35, <span class="k">in </span>main
  File <span class="s2">"calibre/utils/ipc/worker.py"</span>, line 216, <span class="k">in </span>main
  File <span class="s2">"calibre/gui2/convert/gui_conversion.py"</span>, line 41, <span class="k">in </span>gui_convert_override
  File <span class="s2">"calibre/gui2/convert/gui_conversion.py"</span>, line 28, <span class="k">in </span>gui_convert
  File <span class="s2">"calibre/ebooks/conversion/plumber.py"</span>, line 1274, <span class="k">in </span>run
  File <span class="s2">"calibre/ebooks/conversion/plugins/mobi_output.py"</span>, line 214, <span class="k">in </span>convert
  File <span class="s2">"calibre/ebooks/conversion/plugins/mobi_output.py"</span>, line 237, <span class="k">in </span>write_mobi
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 55, <span class="k">in </span>__call__
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 142, <span class="k">in </span>rasterize_spine
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 152, <span class="k">in </span>rasterize_item
  File <span class="s2">"calibre/ebooks/oeb/transforms/rasterize.py"</span>, line 185, <span class="k">in </span>rasterize_external
  File <span class="s2">"calibre/ebooks/oeb/base.py"</span>, line 1092, <span class="k">in </span>bytes_representation
  File <span class="s2">"calibre/ebooks/oeb/base.py"</span>, line 432, <span class="k">in </span>serialize
TypeError: cannot convert <span class="s1">'NoneType'</span> object to bytes
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% kindlepreviewer feynman-lectures-on-physics-volumn-1.epub <span class="nt">-convert</span>
Checking specified arguments.
Pre-processing <span class="k">in </span>progress.
Processing 1/1 book<span class="o">(</span>s<span class="o">)</span><span class="nb">.</span>
Book converted with warnings! : /Users/lzw/projects/feynman-lectures-mobi/feynman-lectures-on-physics-volumn-1.epub
Post-processing <span class="k">in </span>progress.
Writing output/log files to /Users/lzw/projects/feynman-lectures-mobi/output
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cleaning up manifest...
Trimming unused files from manifest...
Creating AZW3 Output...
Serializing resources...
Splitting markup on page breaks and flow limits, <span class="k">if </span>any...
Creating KF8 output
	Generating KF8 markup...
Tag table has no aid and a too large chunk size. Adding anyway.
Tag table has no aid and a too large chunk size. Adding anyway.
Tag table has no aid and a too large chunk size. Adding anyway.
	Compressing markup...
	Creating indices...
</code></pre></div></div>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-zh" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
