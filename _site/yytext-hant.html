<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>YYText 是如何運作的</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>YYText 是如何運作的 | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="YYText 是如何運作的" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="hant" />
<meta name="description" content="上面的陰影效果是用以下代碼實現的：" />
<meta property="og:description" content="上面的陰影效果是用以下代碼實現的：" />
<link rel="canonical" href="https://lzwjava.github.io/yytext-hant" />
<meta property="og:url" content="https://lzwjava.github.io/yytext-hant" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-05-24T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="YYText 是如何運作的" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2016-05-24T00:00:00+08:00","datePublished":"2016-05-24T00:00:00+08:00","description":"上面的陰影效果是用以下代碼實現的：","headline":"YYText 是如何運作的","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/yytext-hant"},"url":"https://lzwjava.github.io/yytext-hant"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=16e03ee5079aafdb3fda4324ad58da139218089c">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=16e03ee5079aafdb3fda4324ad58da139218089c" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       YYText 是如何運作的 | 原創，AI翻譯
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/hant/2016-05-24-yytext-hant.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postshant2016-05-24-yytext-hant.md</span> -->
      

      <!-- <span>2016-05-24-yytext-hant.md</span> -->

      
        

        
          
          <a href="#" class="button">2016.05</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/yytext-en" >English</option>
        <option value="/yytext-zh" >中文</option>
        <option value="/yytext-ja" >日本語</option>
        <option value="/yytext-es" >Español</option>
        <option value="/yytext-hi" >हिंदी</option>
        <option value="/yytext-fr" >Français</option>
        <option value="/yytext-de" >Deutsch</option>
        <option value="/yytext-ar" >العربية</option>
        <option value="/yytext-hant" selected>繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>上面的陰影效果是用以下代碼實現的：</p>

<p>可以看到先生成了 <code class="language-plaintext highlighter-rouge">YYTextShadow</code>， 然後賦值給了 <code class="language-plaintext highlighter-rouge">attributedString</code> 的 <code class="language-plaintext highlighter-rouge">yy_textShadow</code>，然後再把 <code class="language-plaintext highlighter-rouge">attributedString</code> 賦值到 <code class="language-plaintext highlighter-rouge">YYLabel</code> 裡面，接著把 <code class="language-plaintext highlighter-rouge">YYLabel</code> 加入到 <code class="language-plaintext highlighter-rouge">UIView</code> 裡來顯示。跟蹤 <code class="language-plaintext highlighter-rouge">yy_textShadow</code> 發現，主要是把 <code class="language-plaintext highlighter-rouge">textShadow</code> 綁定到了 <code class="language-plaintext highlighter-rouge">NSAttributedString</code> 的 attribute 裡，key 是 <code class="language-plaintext highlighter-rouge">YYTextShadowAttributeName</code>，值是 <code class="language-plaintext highlighter-rouge">textShadow</code>，也就是先把 shadow 存起來，後來再使用。用 Shift + Command + J 快速跳轉到定義處：</p>

<p>這裡有個 <code class="language-plaintext highlighter-rouge">addAttribute</code>，它在 <code class="language-plaintext highlighter-rouge">NSAttributedString.h</code> 裡定義：</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addAttribute</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">value</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">range</span><span class="p">:(</span><span class="n">NSRange</span><span class="p">)</span><span class="nv">range</span><span class="p">;</span>
</code></pre></div></div>

<p>說明可以賦值任意的鍵值對給它。而 <code class="language-plaintext highlighter-rouge">YYTextShadowAttributeName</code> 的定義是一個普通的字符串，這意味著先是把 shadow 信息存起來，然後後面再使用。我們全局搜索一下 <code class="language-plaintext highlighter-rouge">YYTextShadowAttributeName</code>。</p>

<p>然後我們來到 <code class="language-plaintext highlighter-rouge">YYTextLayout</code> 裡的 <code class="language-plaintext highlighter-rouge">YYTextDrawShadow</code> 函數：</p>

<p><code class="language-plaintext highlighter-rouge">CGContextTranslateCTM</code> 是說改變一個 Context 裡的原點坐標，所以</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</code></pre></div></div>

<p>是說要把繪製的上下文移動到 <code class="language-plaintext highlighter-rouge">point</code> 點。我們還是先搞清楚哪裡調用了 <code class="language-plaintext highlighter-rouge">YYTextDrawShadow</code>，發現是在 <code class="language-plaintext highlighter-rouge">drawInContext</code> 裡調用的。</p>

<p>在 <code class="language-plaintext highlighter-rouge">drawInContext</code> 裡，依次繪製方塊的邊框，然後繪製背景邊框、陰影、下劃線、文字、附屬物、內陰影、刪除線、文字邊框、調試線。</p>

<p>那麼到底哪裡用了 <code class="language-plaintext highlighter-rouge">drawInContext</code> 呢？可以看到裡面有個參數 <code class="language-plaintext highlighter-rouge">YYTextDebugOption</code>，所以這個函數一定不是系統的回調，而是 YYText 裡面自己調用的。</p>

<p>按住 Ctrl + 1 彈出快捷鍵，發現有四個地方調用了它。</p>

<p><code class="language-plaintext highlighter-rouge">drawInContext:size:debug</code> 仍然是 YYText 自己的調用，因為 <code class="language-plaintext highlighter-rouge">debug</code> 的類型是 <code class="language-plaintext highlighter-rouge">YYTextDebugOption *</code>， 是 YY 自身的。<code class="language-plaintext highlighter-rouge">newAsyncTask</code> 不像是系統的調用，<code class="language-plaintext highlighter-rouge">addAttachmentToView:layer:</code> 同理，所以極有可能是 <code class="language-plaintext highlighter-rouge">drawRect:</code>。</p>

<p>果然是，看右邊的快速幫助，有詳盡的解釋，幫助的下面也說明了是在 <code class="language-plaintext highlighter-rouge">UIView</code> 裡定義的。再看 <code class="language-plaintext highlighter-rouge">YYTextContainerView</code>，它是繼承了 <code class="language-plaintext highlighter-rouge">UIView</code> 的。</p>

<p>所以 <code class="language-plaintext highlighter-rouge">YYLabel</code> 是用了 <code class="language-plaintext highlighter-rouge">YYTextContainerView</code> 咯？然後讓系統調用 <code class="language-plaintext highlighter-rouge">YYTextContainerView</code> 裡的 <code class="language-plaintext highlighter-rouge">drawRect:</code> 畫出來？</p>

<p>奇怪，<code class="language-plaintext highlighter-rouge">YYLabel</code> 可繼承了 <code class="language-plaintext highlighter-rouge">UIView</code>。所以，YYText 裡應該有兩套東西！一套 <code class="language-plaintext highlighter-rouge">YYLabel</code>，一套 <code class="language-plaintext highlighter-rouge">YYTextView</code>，像 <code class="language-plaintext highlighter-rouge">UILabel</code> 和 <code class="language-plaintext highlighter-rouge">UITextView</code> 一樣。接著我們再回去看之前的 <code class="language-plaintext highlighter-rouge">YYLabel</code> 的 <code class="language-plaintext highlighter-rouge">newAsyncDisplayTask</code>，</p>

<p>很長，在中間的位置調用了 <code class="language-plaintext highlighter-rouge">YYTextLayout</code> 裡的 <code class="language-plaintext highlighter-rouge">drawInContext</code>。<code class="language-plaintext highlighter-rouge">newAsyncDisplayTask</code>，它又是在哪裡調用的呢？</p>

<p>在第二行被調用了。所以可以簡單地理解為 <code class="language-plaintext highlighter-rouge">YYLabel</code> 用了異步來繪製文本。而 <code class="language-plaintext highlighter-rouge">_displayAsync</code> 被上面的 <code class="language-plaintext highlighter-rouge">display</code> 調用了。看 <code class="language-plaintext highlighter-rouge">display</code> 的文檔，說是系統會在恰當的時間來調用來更新 layer 的內容，你不要直接去調用它。我們也可以給它打個斷點。</p>

<p>說明 <code class="language-plaintext highlighter-rouge">display</code> 是在 <code class="language-plaintext highlighter-rouge">CALayer</code> 的一次事務中調用的。為何用事務，大概是因為想批量更新，效率高點吧？不像是數據庫裡的回滾需求。</p>

<p><code class="language-plaintext highlighter-rouge">display</code> 的系統文檔還說，如果你想你的 layer 繪製不一樣，那你可以複寫這個方法，來實現你自己的繪製。</p>

<p>所以，我們簡單的有了一點思路。<code class="language-plaintext highlighter-rouge">YYLabel</code> 通過複寫 <code class="language-plaintext highlighter-rouge">UIView</code> 的 <code class="language-plaintext highlighter-rouge">display</code> 方法，來異步繪製自己的陰影等各種效果，陰影效果先保存在了 <code class="language-plaintext highlighter-rouge">YYLabel</code> 的 <code class="language-plaintext highlighter-rouge">attributedText</code> 裡的 attribute 中，在 <code class="language-plaintext highlighter-rouge">display</code> 中繪製的時候再取出來，繪製的時候用了系統的 CoreGraphics 框架。</p>

<p>理清了一些思路後，會發現，真正強大的是什麼？一邊是把這麼多效果、異步調用等組織起來，一邊是對底層 CoreGraphics 框架熟練運用。所以對前面的代碼組織有了些了解後，接著我們深入到 CoreGraphics 框架上去。看看是怎麼繪製上去的。</p>

<p>讓我們重新回到 <code class="language-plaintext highlighter-rouge">YYTextDrawShadow</code>。</p>

<p>這裡，<code class="language-plaintext highlighter-rouge">CGContextSaveGState</code> 和 <code class="language-plaintext highlighter-rouge">CGContextRestoreGState</code> 包圍起了一段繪製的代碼。<code class="language-plaintext highlighter-rouge">CGContextSaveGState</code> 的意思是說，把當前的繪圖狀態拷貝一份，放到繪製棧裡。每個繪製的 Context 都維護著一個繪製棧。我也不清楚，裡面棧到底是怎麼操作的。先暫且理解為繪製 Context 前要調用 <code class="language-plaintext highlighter-rouge">CGContextSaveGState</code>，繪製 Context 後要調用 <code class="language-plaintext highlighter-rouge">CGContextRestoreGState</code>，之後中間的繪製就能有效地出現在 Context 裡。<code class="language-plaintext highlighter-rouge">CGContextTranslateCTM</code> 是移動到 Context 移動到相應的位置。先是移動到 <code class="language-plaintext highlighter-rouge">point.x</code> 和 <code class="language-plaintext highlighter-rouge">point.y</code> ，繪製的相應位置，至於後面移動到 0 和 <code class="language-plaintext highlighter-rouge">size.height</code>，倒不清楚了，後續再看看。接著取出了 <code class="language-plaintext highlighter-rouge">lines</code>，執行了 <code class="language-plaintext highlighter-rouge">for</code> 循環。</p>

<p><code class="language-plaintext highlighter-rouge">lines</code> 是什麼？發現在 <code class="language-plaintext highlighter-rouge">YYTextLayout</code> 裡的 <code class="language-plaintext highlighter-rouge">(YYTextLayout *)layoutWithContainer:(YYTextContainer *)container text:(NSAttributedString *)text range:(NSRange)range </code> 賦值的。</p>

<p>接著翻到這個函數的定義處：</p>

<p>這個函數非常長，367 到 861 行，500 行代碼！看了頭尾，可見它的用處就是得到這些變量。<code class="language-plaintext highlighter-rouge">lines</code> 是怎麼得到的呢？</p>

<p>可以見到在一個大的 <code class="language-plaintext highlighter-rouge">for</code> 循環裡把一條一條 <code class="language-plaintext highlighter-rouge">line</code> 加入到 <code class="language-plaintext highlighter-rouge">lines</code> 裡。那 <code class="language-plaintext highlighter-rouge">lineCount</code> 是怎麼得到的呢？</p>

<p>第 472 行創建了一個 <code class="language-plaintext highlighter-rouge">framesetter</code> 對象，<code class="language-plaintext highlighter-rouge">text</code> 參數是 <code class="language-plaintext highlighter-rouge">NSAttributedString</code>，接著在 <code class="language-plaintext highlighter-rouge">frameSetter</code> 對象中創建了一個 <code class="language-plaintext highlighter-rouge">CTFrameRef</code>，接著從 <code class="language-plaintext highlighter-rouge">CTFrameRef</code> 得到了 <code class="language-plaintext highlighter-rouge">lines</code>。 <code class="language-plaintext highlighter-rouge">line</code> 到底是什麼呢？我們給它打個斷點。</p>

<p>發現，<code class="language-plaintext highlighter-rouge">shadow</code> 這個字的 <code class="language-plaintext highlighter-rouge">lineCount = 2</code>，並不是我們想像中的字母個數。</p>

<p>所以猜測，白色的 <code class="language-plaintext highlighter-rouge">Shadow</code> 整個是一條 <code class="language-plaintext highlighter-rouge">line</code>，陰影也是一條 <code class="language-plaintext highlighter-rouge">line</code>？</p>

<p>YYText 裡有好幾個例子，只顯示其中一種效果，把其它的代碼註釋掉。發現很奇怪，Shadow 的 <code class="language-plaintext highlighter-rouge">lineCount = 2</code>，Multiple Shadows 的 <code class="language-plaintext highlighter-rouge">lineCount</code> 也是 2，可 Multiple Shadows 還有內陰影啊，應該是 3 條啊？</p>

<p>去找 CTLine 的蘋果文檔，說 CTLine 代表著一行的文本，一個 CTLine 對象包含著一組的 <code class="language-plaintext highlighter-rouge">glyph runs</code>。所以就是簡單的行數而已！看上面的斷點截圖，剛剛 <code class="language-plaintext highlighter-rouge">shadow</code> 之所以為 2 ，是因為它的文本是 <code class="language-plaintext highlighter-rouge">shadow\n\n</code>，看剛剛，<code class="language-plaintext highlighter-rouge">\n\n</code> 是故意加的，為了顯示美觀：</p>

<p>所以 <code class="language-plaintext highlighter-rouge">shadow\n\n</code> 就是兩行文本。CTLine 就是我們平時說的行。接著回去看我們的 <code class="language-plaintext highlighter-rouge">lineCount</code>：</p>

<p>這裡得到 <code class="language-plaintext highlighter-rouge">CTLines</code> 數組，從裡面的個數，然後如果 <code class="language-plaintext highlighter-rouge">lineCount</code> 大於 0 的話，得到每行的坐標原點。好了，有了 <code class="language-plaintext highlighter-rouge">lineCount</code>，我們接著看 <code class="language-plaintext highlighter-rouge">for</code> 循環。</p>

<p>從 <code class="language-plaintext highlighter-rouge">ctLines</code> 數組裡得到 <code class="language-plaintext highlighter-rouge">CTLine</code>，接著得到 <code class="language-plaintext highlighter-rouge">YYTextLine</code> 對象，然後加入到 <code class="language-plaintext highlighter-rouge">lines</code> 數組中。然後做一些 <code class="language-plaintext highlighter-rouge">line</code> 的 frame 計算。<code class="language-plaintext highlighter-rouge">YYTextLine</code> 的構造函數很簡單，先保存著位置、是否垂直排版、<code class="language-plaintext highlighter-rouge">CTLine</code> 對象：</p>

<p><code class="language-plaintext highlighter-rouge">lines</code> 搞清楚之後，我們再回去之前的 <code class="language-plaintext highlighter-rouge">YYTextDrawShadow</code> 中去：</p>

<p>這下代碼簡單了。先獲取到行數，遍歷它，然後取得 <code class="language-plaintext highlighter-rouge">GlyphRuns</code> 數組，再遍歷它，<code class="language-plaintext highlighter-rouge">GlyphRun</code> 可以理解為一個圖元，或者繪製單元。然後從中得到 <code class="language-plaintext highlighter-rouge">attributes</code> 數組，用我們之前的 <code class="language-plaintext highlighter-rouge">YYTextShadowAttributeName</code>，獲取我們一開始賦值的 <code class="language-plaintext highlighter-rouge">shadow</code>，接著開始繪製陰影：</p>

<p>一個 <code class="language-plaintext highlighter-rouge">while</code> 循環，不斷繪製子陰影。調用 <code class="language-plaintext highlighter-rouge">CGContextSetShadowWithColor</code> 設好陰影的位移、半徑、顏色。接著調用 <code class="language-plaintext highlighter-rouge">YYTextDrawRun</code> 來真正的繪製。<code class="language-plaintext highlighter-rouge">YYTextDrawRun</code> 被三個地方調用了：</p>

<p>用來繪製內陰影和文本陰影以及文本。說明它是個通用方法，用來畫 <code class="language-plaintext highlighter-rouge">Run</code> 這個對象。</p>

<p>一開始獲取文字的變換矩陣，用 <code class="language-plaintext highlighter-rouge">runTextMatrixIsID</code> 來看看它是否原地不變，如果不是垂直排版或沒有設置圖元轉換的話，就直接上來畫。調用 <code class="language-plaintext highlighter-rouge">CTRunDraw</code> 來畫 <code class="language-plaintext highlighter-rouge">run</code> 對象。接著斷點發現，繪製一開始那個陰影時只進入了 <code class="language-plaintext highlighter-rouge">if</code> 裡面，沒有進入 <code class="language-plaintext highlighter-rouge">else</code> 裡面。</p>

<p>所以我們的陰影繪製就到此結束了！</p>

<p>總結一下，<code class="language-plaintext highlighter-rouge">YYLabel</code> 先把陰影等效果保存在 <code class="language-plaintext highlighter-rouge">attributedText</code> 裡的 attributes，複寫了 <code class="language-plaintext highlighter-rouge">UIView</code> 的 <code class="language-plaintext highlighter-rouge">display</code> 方法，在 <code class="language-plaintext highlighter-rouge">display</code> 中進行異步繪製，用 <code class="language-plaintext highlighter-rouge">CoreText</code> 框架得到 <code class="language-plaintext highlighter-rouge">CTLine</code>、<code class="language-plaintext highlighter-rouge">CTRun</code> 對象，從 <code class="language-plaintext highlighter-rouge">CTRun</code> 獲取到 attributes，之後再根據 attributes 裡的各屬性，用 <code class="language-plaintext highlighter-rouge">CoreGraphics</code> 框架把 <code class="language-plaintext highlighter-rouge">CTRun</code> 對象繪製到 Context 中。</p>

<p>理解還是不夠，等後續再來品讀。不覺感嘆 YY 實在太強了！今天理了理思路，讓自己邊寫邊讀代碼，不至於枯燥，同時供大家參考。得去睡覺了。</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-hant" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
