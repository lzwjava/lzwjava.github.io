<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Actualización del disparador de artículos de NYTimes News (CN)</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Actualización del disparador de artículos de NYTimes News (CN) | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Actualización del disparador de artículos de NYTimes News (CN)" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="es" />
<meta name="description" content="Haga clic en el botón a continuación para actualizar los artículos de NYTimes CN." />
<meta property="og:description" content="Haga clic en el botón a continuación para actualizar los artículos de NYTimes CN." />
<link rel="canonical" href="https://lzwjava.github.io/nytimes-update-es" />
<meta property="og:url" content="https://lzwjava.github.io/nytimes-update-es" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-03-16T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Actualización del disparador de artículos de NYTimes News (CN)" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2025-03-16T00:00:00+08:00","datePublished":"2025-03-16T00:00:00+08:00","description":"Haga clic en el botón a continuación para actualizar los artículos de NYTimes CN.","headline":"Actualización del disparador de artículos de NYTimes News (CN)","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/nytimes-update-es"},"url":"https://lzwjava.github.io/nytimes-update-es"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=99b941d1f99a8508470f88432ce9a36a1e29f244">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=99b941d1f99a8508470f88432ce9a36a1e29f244" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Actualización del disparador de artículos de NYTimes News (CN) | Original, traducido por IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/es/2025-03-16-nytimes-update-es.md">PDF</a> -->

    <!-- Audio Button -->



    <!-- 
    <a href="#" id="playAudioButton" class="button audio-button" data-file-path="_posts/es/2025-03-16-nytimes-update-es.md">Audio</a>
     -->

        <!-- Date Button -->
    
      
      <!-- <span>_postses2025-03-16-nytimes-update-es.md</span> -->
      

      <!-- <span>2025-03-16-nytimes-update-es.md</span> -->

      
        

        
          
          <a href="#" class="button">2025.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/nytimes-update-en" >English</option>
        <option value="/nytimes-update-zh" >中文</option>
        <option value="/nytimes-update-ja" >日本語</option>
        <option value="/nytimes-update-es" selected>Español</option>
        <option value="/nytimes-update-hi" >हिंदी</option>
        <option value="/nytimes-update-fr" >Français</option>
        <option value="/nytimes-update-de" >Deutsch</option>
        <option value="/nytimes-update-ar" >العربية</option>
        <option value="/nytimes-update-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Haga clic en el botón a continuación para actualizar los artículos de <a href="./notes/2025-03-14-nytimes-en">NYTimes CN</a>.</p>

<script async="" src="../assets/js/nytimes.js"></script>

<div class="nytimes"></div>

<p>Esta página le permite activar una actualización de los artículos de NYTimes CN. Hacer clic en el botón iniciará un flujo de trabajo que obtiene los artículos más recientes, los traduce y actualiza el contenido en este sitio. Tenga en cuenta que puede tardar unos minutos en que los cambios aparezcan después de que se active la actualización.</p>

<p>Código Python:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">load_dotenv</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">call_mistral_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">"mistral-small-2501"</span><span class="p">):</span>
    <span class="s">"""Llama a la API de Mistral para traducir texto."""</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"MISTRAL_API_KEY"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Error: La variable de entorno MISTRAL_API_KEY no está configurada."</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.mistral.ai/v1/chat/completions"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">,</span>
        <span class="s">"Accept"</span><span class="p">:</span> <span class="s">"application/json"</span><span class="p">,</span>
        <span class="s">"Authorization"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"Bearer </span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="s">"</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s">"messages"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span>
                <span class="s">"content"</span><span class="p">:</span> <span class="n">prompt</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Llamando a la API de Mistral con el modelo: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Solicitud enviada: </span><span class="si">{</span><span class="n">prompt</span><span class="p">[</span><span class="si">:</span><span class="mi">1000</span><span class="p">]</span><span class="si">}</span><span class="s">..."</span><span class="p">)</span>  <span class="c1"># Imprime los primeros 100 caracteres de la solicitud
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">response_json</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Respuesta de la API de Mistral: </span><span class="si">{</span><span class="n">response_json</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response_json</span> <span class="ow">and</span> <span class="n">response_json</span><span class="p">[</span><span class="s">'choices'</span><span class="p">]:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">response_json</span><span class="p">[</span><span class="s">'choices'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'message'</span><span class="p">][</span><span class="s">'content'</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Contenido de la API de Mistral: </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error de la API de Mistral: Formato de respuesta no válido: </span><span class="si">{</span><span class="n">response_json</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error de la API de Mistral: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Código de estado de la respuesta: </span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Contenido de la respuesta: </span><span class="si">{</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">fetch_html_content</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="s">"""Obtiene el contenido HTML de una URL dada."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Crear un contexto SSL no verificado
</span>        <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="p">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Obteniendo contenido HTML desde: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Levantar HTTPError para respuestas incorrectas (4xx o 5xx)
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Contenido HTML obtenido con éxito desde: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"No se pudo obtener la URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">extract_links</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="s">"""Extrae enlaces de la página principal de cn.nytimes.com."""</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s">'href'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'https://cn.nytimes.com/'</span><span class="p">):</span>
            <span class="n">links</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">'url'</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s">'text'</span><span class="p">:</span> <span class="n">a</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Se extrajeron </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="si">}</span><span class="s"> enlaces de la página principal."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">links</span>

<span class="k">def</span> <span class="nf">translate_title</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
    <span class="s">"""Traducir el título del chino al inglés usando Mistral."""</span>
    <span class="n">base_prompt</span> <span class="o">=</span> <span class="s">"Traducir el siguiente título a {target_language}. Proporcionar solo el título traducido, sin notas adicionales o explicaciones. No repetir ni mencionar el texto de entrada.</span><span class="se">\n</span><span class="s">"</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">base_prompt</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">target_language</span><span class="o">=</span><span class="s">"English"</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Traducir título: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">translated_title</span> <span class="o">=</span> <span class="n">call_mistral_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">translated_title</span><span class="p">:</span>
        <span class="n">translated_title</span> <span class="o">=</span> <span class="n">translated_title</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Título traducido: </span><span class="si">{</span><span class="n">translated_title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">translated_title</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">"No se pudo traducir el título: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">summarize_article</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="s">"""Resumir el contenido del artículo usando la API de Mistral en inglés."""</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s">'html.parser'</span><span class="p">)</span>
    <span class="n">title_element</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">select_one</span><span class="p">(</span><span class="s">'.article-area .article-content .article-header header h1'</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">title_element</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">title_element</span> <span class="k">else</span> <span class="s">''</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Título extraído: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="c1"># Extraer el texto principal del artículo
</span>    <span class="n">article_area</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'div'</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">'article-area'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">article_area</span><span class="p">:</span>
        <span class="n">article_text</span> <span class="o">=</span> <span class="n">article_area</span><span class="p">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">article_text</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">article_text</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"No se pudo extraer el texto del artículo."</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="c1"># Crear una solicitud para que Mistral resuma
</span>    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"Resumir el siguiente artículo en inglés, centrándose en los puntos principales y evitando frases introductorias como 'Resumen:' o 'Este artículo trata sobre:'.</span><span class="se">\n\n</span><span class="si">{</span><span class="n">article_text</span><span class="p">[</span><span class="si">:</span><span class="mi">30000</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span>  <span class="c1"># Limitar el texto del artículo a 30000 caracteres
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Creando resumen para el título: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">call_mistral_api</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">summary</span><span class="p">:</span>
        <span class="c1"># Limpiar el resumen eliminando "Resumen:" o frases similares al principio
</span>        <span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"Summary:"</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Resumen generado: </span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">summary</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"No se pudo generar el resumen para el título: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">generate_markdown_list</span><span class="p">(</span><span class="n">articles</span><span class="p">):</span>
    <span class="s">"""Genera una lista en Markdown a partir de una lista de resúmenes de artículos."""</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">articles</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'* No se encontraron artículos.</span><span class="se">\n</span><span class="s">'</span>

    <span class="n">markdown_list</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span><span class="p">:</span>
        <span class="n">title</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">article</span>
        <span class="n">translated_title</span> <span class="o">=</span> <span class="n">translate_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">markdown_list</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">'## </span><span class="si">{</span><span class="n">translated_title</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="se">\n\n</span><span class="s">'</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Lista en Markdown generada."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">markdown_list</span>

<span class="k">def</span> <span class="nf">update_markdown_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">markdown_content</span><span class="p">):</span>
    <span class="s">"""Actualiza un archivo Markdown con el contenido dado."""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Leer el contenido existente del archivo
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Leyendo contenido existente desde </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">existing_content</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c1"># Encontrar las posiciones de inicio y fin del contenido después de los metadatos iniciales
</span>        <span class="n">start_index</span> <span class="o">=</span> <span class="n">existing_content</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'---'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>  <span class="c1"># Encontrar el segundo '---' y moverse más allá de él
</span>        <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_content</span><span class="p">)</span>

        <span class="c1"># Construir el contenido actualizado
</span>        <span class="n">updated_content</span> <span class="o">=</span> <span class="n">existing_content</span><span class="p">[:</span><span class="n">start_index</span><span class="p">].</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">'</span>  <span class="c1"># Mantener los metadatos y agregar una nueva línea
</span>        <span class="n">updated_content</span> <span class="o">+=</span> <span class="n">markdown_content</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span>  <span class="c1"># Agregar la nueva lista en Markdown
</span>        <span class="c1"># updated_content += existing_content[end_index:].strip() # Anexar cualquier cosa después de la lista, si existe
</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">updated_content</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Se actualizó </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> con éxito"</span><span class="p">)</span>
        <span class="n">markdown_changed</span> <span class="o">=</span> <span class="n">existing_content</span> <span class="o">!=</span> <span class="n">updated_content</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Markdown cambiado: </span><span class="si">{</span><span class="n">markdown_changed</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">markdown_changed</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error al actualizar </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">"""Función principal para obtener, procesar y actualizar el archivo Markdown."""</span>
    <span class="n">nytimes_url</span> <span class="o">=</span> <span class="s">'https://m.cn.nytimes.com'</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Obteniendo enlaces de NYTimes desde: </span><span class="si">{</span><span class="n">nytimes_url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="n">html_content</span> <span class="o">=</span> <span class="n">fetch_html_content</span><span class="p">(</span><span class="n">nytimes_url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">html_content</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"No se pudo obtener el contenido de la página principal."</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">links</span> <span class="o">=</span> <span class="n">extract_links</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Se encontraron </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="si">}</span><span class="s"> enlaces en la página principal. Extrayendo enlaces...'</span><span class="p">)</span>

    <span class="n">all_articles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'/dual/'</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'/'</span><span class="p">):</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s">'/dual/'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s">'dual/'</span>

        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Procesando enlace </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s"> de </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
        <span class="n">article_html</span> <span class="o">=</span> <span class="n">fetch_html_content</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">article_html</span><span class="p">:</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">summarize_article</span><span class="p">(</span><span class="n">article_html</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">title</span> <span class="ow">and</span> <span class="n">summary</span><span class="p">:</span>
                <span class="n">all_articles</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">title</span><span class="p">,</span> <span class="n">summary</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'No se pudo obtener el contenido desde </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="s">"url"</span><span class="p">]</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="n">markdown_list</span> <span class="o">=</span> <span class="n">generate_markdown_list</span><span class="p">(</span><span class="n">all_articles</span><span class="p">)</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="s">'original/2025-03-14-nytimes-en.md'</span>
    <span class="n">markdown_changed</span> <span class="o">=</span> <span class="n">update_markdown_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">markdown_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">markdown_changed</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"El archivo Markdown se actualizó con nuevos enlaces."</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"El archivo Markdown no se actualizó (sin cambios)."</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>Código del frontend:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nytimesDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.nytimes</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">nytimesDiv</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">updateButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">updateButton</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Actualizar Artículos de NYTimes</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">nytimesDiv</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">updateButton</span><span class="p">);</span>

    <span class="nx">updateButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://api.github.com/repos/lzwjava/lzwjava.github.io/actions/workflows/nytimes.yml/dispatches</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">Accept</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/vnd.github+json</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bearer token</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">X-GitHub-Api-Version</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2022-11-28</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span>
            <span class="p">},</span>
            <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">ref</span><span class="p">:</span> <span class="dl">'</span><span class="s1">main</span><span class="dl">'</span> <span class="p">})</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">204</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Actualización iniciada con éxito. Por favor, espere unos minutos para ver el resultado.</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">`La actualización falló. Código de estado: </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">La actualización falló:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">La actualización falló. Consulte la consola para ver los errores.</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error al iniciar la actualización:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">¡No se encontró el div de nytimes!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-es" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
