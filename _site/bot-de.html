<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Erstelle einen KI-gestützten Story-Bot</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Erstelle einen KI-gestützten Story-Bot | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Erstelle einen KI-gestützten Story-Bot" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="de" />
<meta name="description" content="Dieser Blogbeitrag wurde mit Unterstützung von ChatGPT-4 verfasst." />
<meta property="og:description" content="Dieser Blogbeitrag wurde mit Unterstützung von ChatGPT-4 verfasst." />
<link rel="canonical" href="https://lzwjava.github.io/bot-de" />
<meta property="og:url" content="https://lzwjava.github.io/bot-de" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Erstelle einen KI-gestützten Story-Bot" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2024-07-07T00:00:00+08:00","datePublished":"2024-07-07T00:00:00+08:00","description":"Dieser Blogbeitrag wurde mit Unterstützung von ChatGPT-4 verfasst.","headline":"Erstelle einen KI-gestützten Story-Bot","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/bot-de"},"url":"https://lzwjava.github.io/bot-de"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=c3cd72ad871eaca5fdcdbbfa8c96a0abce1d7b33">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=c3cd72ad871eaca5fdcdbbfa8c96a0abce1d7b33" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Erstelle einen KI-gestützten Story-Bot | Original, von KI übersetzt
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/de/2024-07-07-bot-de.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsde2024-07-07-bot-de.md</span> -->
      

      <!-- <span>2024-07-07-bot-de.md</span> -->

      
        

        
          
          <a href="#" class="button">2024.07</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/bot-en" >English</option>
        <option value="/bot-zh" >中文</option>
        <option value="/bot-ja" >日本語</option>
        <option value="/bot-es" >Español</option>
        <option value="/bot-hi" >हिंदी</option>
        <option value="/bot-fr" >Français</option>
        <option value="/bot-de" selected>Deutsch</option>
        <option value="/bot-ar" >العربية</option>
        <option value="/bot-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p><em>Dieser Blogbeitrag wurde mit Unterstützung von ChatGPT-4 verfasst.</em></p>

<hr />

<h3 id="inhaltsverzeichnis">Inhaltsverzeichnis</h3>

<ul>
  <li><a href="#einführung">Einführung</a></li>
  <li><a href="#projektarchitektur">Projektarchitektur</a>
    <ul>
      <li><a href="#backend">Backend</a>
        <ul>
          <li><a href="#flask-anwendungseinrichtung">Flask-Anwendungseinrichtung</a></li>
          <li><a href="#protokollierung-und-überwachung">Protokollierung und Überwachung</a></li>
          <li><a href="#anfragebehandlung">Anfragebehandlung</a></li>
        </ul>
      </li>
      <li><a href="#frontend">Frontend</a>
        <ul>
          <li><a href="#react-komponenten">React-Komponenten</a></li>
          <li><a href="#api-integration">API-Integration</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#bereitstellung">Bereitstellung</a>
    <ul>
      <li><a href="#bereitstellungsskript">Bereitstellungsskript</a></li>
      <li><a href="#elasticsearch-konfiguration">ElasticSearch-Konfiguration</a></li>
      <li><a href="#kibana-konfiguration">Kibana-Konfiguration</a></li>
      <li><a href="#logstash-konfiguration">Logstash-Konfiguration</a></li>
    </ul>
  </li>
  <li><a href="#nginx-konfiguration-und-lets-encrypt-ssl-zertifikat">Nginx-Konfiguration und Let’s Encrypt SSL-Zertifikat</a>
    <ul>
      <li><a href="#definieren-einer-map-zur-handhabung-der-erlaubten-ursprünge">Definieren einer Map zur Handhabung der erlaubten Ursprünge</a></li>
      <li><a href="#http-zu-https-umleiten">HTTP zu HTTPS umleiten</a></li>
      <li><a href="#hauptseitenkonfiguration-für-examplecom">Hauptseitenkonfiguration für <code class="language-plaintext highlighter-rouge">example.com</code></a></li>
      <li><a href="#api-konfiguration-für-apiexamplecom">API-Konfiguration für <code class="language-plaintext highlighter-rouge">api.example.com</code></a></li>
    </ul>
  </li>
  <li><a href="#fazit">Fazit</a></li>
</ul>

<hr />

<h3 id="einführung">Einführung</h3>

<p>Dieser Blogbeitrag bietet einen umfassenden Leitfaden zur Architektur und Implementierung einer KI-gestützten Story-Bot-Anwendung. Das Projekt beinhaltet die Generierung personalisierter Geschichten über eine Web-Oberfläche. Für die Entwicklung verwenden wir Python, Flask und React und setzen die Anwendung auf AWS ein. Zusätzlich nutzen wir Prometheus für die Überwachung sowie ElasticSearch, Kibana und Logstash für das Log-Management. Das DNS-Management wird über GoDaddy und Cloudflare abgewickelt, während Nginx als Gateway für das SSL-Zertifikat und die Verwaltung von Anfrage-Headern dient.</p>

<h3 id="projektarchitektur">Projektarchitektur</h3>

<h4 id="backend">Backend</h4>

<p>Das Backend des Projekts wurde mit Flask erstellt, einem leichtgewichtigen WSGI-Webanwendungsframework in Python. Das Backend verarbeitet API-Anfragen, verwaltet die Datenbank, protokolliert Anwendungsaktivitäten und integriert Prometheus zur Überwachung.</p>

<p>Hier ist eine Aufschlüsselung der Backend-Komponenten:</p>

<ol>
  <li>Flask-Anwendungseinrichtung:
    <ul>
      <li>Die Flask-App wird initialisiert und so konfiguriert, dass sie verschiedene Erweiterungen wie Flask-CORS für die Handhabung von Cross-Origin Resource Sharing und Flask-Migrate für die Verwaltung von Datenbankmigrationen verwendet.</li>
      <li>Die Anwendungsrouten werden initialisiert, und CORS wird aktiviert, um Cross-Origin-Anfragen zu ermöglichen.</li>
      <li>Die Datenbank wird mit Standardkonfigurationen initialisiert, und ein benutzerdefinierter Logger wird eingerichtet, um Logeinträge für Logstash zu formatieren.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
 <span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span>
 <span class="kn">from</span> <span class="nn">.routes</span> <span class="kn">import</span> <span class="n">initialize_routes</span>
 <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">insert_default_config</span>
 <span class="kn">from</span> <span class="nn">flask_migrate</span> <span class="kn">import</span> <span class="n">Migrate</span>
 <span class="kn">import</span> <span class="nn">logging</span>
 <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">RotatingFileHandler</span>
 <span class="kn">from</span> <span class="nn">prometheus_client</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">generate_latest</span><span class="p">,</span> <span class="n">Gauge</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'api.config.BaseConfig'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">initialize_routes</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>Protokollierung und Überwachung:
    <ul>
      <li>Die Anwendung verwendet RotatingFileHandler, um Logdateien zu verwalten und formatiert die Protokolle mit einem benutzerdefinierten Formatter.</li>
      <li>Prometheus-Metriken sind in die Anwendung integriert, um die Anzahl der Anfragen und die Latenz zu verfolgen.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">REQUEST_COUNT</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s">'flask_app_request_count'</span><span class="p">,</span> <span class="s">'Gesamtzahl der Anfragen der Flask-App'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">,</span> <span class="s">'http_status'</span><span class="p">])</span>
 <span class="n">REQUEST_LATENCY</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s">'flask_app_request_latency_seconds'</span><span class="p">,</span> <span class="s">'Anfragelatenz'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">])</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setup_loggers</span><span class="p">():</span>
    <span class="n">logstash_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span><span class="s">'app.log'</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">logstash_formatter</span> <span class="o">=</span> <span class="n">CustomLogstashFormatter</span><span class="p">()</span>
    <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logstash_formatter</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">()</span>
        <span class="n">root_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">root_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
<span class="n">werkzeug_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'werkzeug'</span><span class="p">)</span>
<span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setup_loggers()
```
</code></pre></div></div>

<ol>
  <li>Anfragebehandlung:
    <ul>
      <li>Die Anwendung erfasst Metriken vor und nach jeder Anfrage und generiert eine Trace-ID, um den Anfragefluss zu verfolgen.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">def</span> <span class="nf">generate_trace_id</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
     <span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
     <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">before_request</span>
<span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="n">request</span><span class="p">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">trace_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'X-Trace-Id'</span><span class="p">,</span> <span class="n">generate_trace_id</span><span class="p">())</span>
    <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">after_request</span>
    <span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Trace-Id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span>
        <span class="n">request_latency</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'start_time'</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">REQUEST_COUNT</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="n">http_status</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">).</span><span class="n">inc</span><span class="p">()</span>
        <span class="n">REQUEST_LATENCY</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">).</span><span class="nb">set</span><span class="p">(</span><span class="n">request_latency</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>

<h4 id="frontend">Frontend</h4>

<p>Das Frontend des Projekts wurde mit React erstellt, einer JavaScript-Bibliothek zur Entwicklung von Benutzeroberflächen. Es interagiert mit der Backend-API, um Story-Prompts zu verwalten, und bietet eine interaktive Benutzeroberfläche zur Erstellung und Verwaltung personalisierter Geschichten.</p>

<ol>
  <li>React-Komponenten:
    <ul>
      <li>Die Hauptkomponente verwaltet die Benutzereingaben für Story-Prompts und interagiert mit der Backend-API, um diese Geschichten zu verwalten.</li>
    </ul>

    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="p">{</span> <span class="nx">ToastContainer</span><span class="p">,</span> <span class="nx">toast</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-toastify</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="dl">'</span><span class="s1">react-toastify/dist/ReactToastify.css</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="p">{</span> <span class="nx">apiFetch</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./api</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div>    </div>

    <p>function App() {
   const [prompts, setPrompts] = useState([]);
   const [newPrompt, setNewPrompt] = useState(‘’);
   const [isLoading, setIsLoading] = useState(false);</p>
  </li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">fetchPrompts</span><span class="p">();</span>
<span class="p">},</span> <span class="p">[]);</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  const fetchPrompts = async () =&gt; {
    setIsLoading(true);
    try {
      const response = await apiFetch('prompts');
      if (response.ok) {
        const data = await response.json();
        setPrompts(data);
      } else {
        toast.error('Fehler beim Abrufen der Prompts');
      }
    } catch (error) {
      toast.error('Ein Fehler ist beim Abrufen der Prompts aufgetreten');
    } finally {
      setIsLoading(false);
    }
  };

  const addPrompt = async () =&gt; {
    if (!newPrompt) {
      toast.warn('Der Prompt-Inhalt darf nicht leer sein');
      return;
    }
    setIsLoading(true);
    try {
      const response = await apiFetch('prompts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ content: newPrompt }),
      });
      if (response.ok) {
        fetchPrompts();
        setNewPrompt('');
        toast.success('Prompt erfolgreich hinzugefügt');
      } else {
        toast.error('Fehler beim Hinzufügen des Prompts');
      }
    } catch (error) {
      toast.error('Ein Fehler ist beim Hinzufügen des Prompts aufgetreten');
    } finally {
      setIsLoading(false);
    }
  };

  const deletePrompt = async (promptId) =&gt; {
    setIsLoading(true);
    try {
      const response = await apiFetch(`prompts/${promptId}`, {
        method: 'DELETE',
      });
      if (response.ok) {
        fetchPrompts();
        toast.success('Prompt erfolgreich gelöscht');
      } else {
        toast.error('Löschen des Prompts fehlgeschlagen');
      }
    } catch (error) {
      toast.error('Ein Fehler ist beim Löschen des Prompts aufgetreten');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    &lt;div className="app"&gt;
      &lt;h1&gt;KI-gestützter Story-Bot&lt;/h1&gt;
      &lt;div&gt;
        &lt;input
          type="text"
          value={newPrompt}
          onChange={(e) =&gt; setNewPrompt(e.target.value)}
          placeholder="Neuer Prompt"
        /&gt;
        &lt;button onClick={addPrompt} disabled={isLoading}&gt;Prompt hinzufügen&lt;/button&gt;
      &lt;/div&gt;
      {isLoading ? (
        &lt;p&gt;Lade...&lt;/p&gt;
      ) : (
        &lt;ul&gt;
          {prompts.map((prompt) =&gt; (
            &lt;li key={prompt.id}&gt;
              {prompt.content}
              &lt;button onClick={() =&gt; deletePrompt(prompt.id)}&gt;Löschen&lt;/button&gt;
            &lt;/li&gt;
          ))}
        &lt;/ul&gt;
      )}
      &lt;ToastContainer /&gt;
    &lt;/div&gt;
  );
}

export default App;
```
</code></pre></div></div>

<ol>
  <li>API-Integration:
    <ul>
      <li>Das Frontend interagiert mit dem Backend-API über Fetch-Requests, um Story-Prompts zu verwalten.</li>
    </ul>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">export</span> <span class="kd">const</span> <span class="nx">apiFetch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">`https://api.yourdomain.com/</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
 <span class="p">};</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="bereitstellung">Bereitstellung</h3>

<p>Das Projekt ist auf AWS bereitgestellt, wobei das DNS-Management über GoDaddy und Cloudflare abgewickelt wird. Nginx wird als Gateway für das SSL-Zertifikat und die Verwaltung der Anfrageheader verwendet. Für die Überwachung nutzen wir Prometheus, und für die Protokollverwaltung setzen wir ElasticSearch, Kibana und Logstash ein.</p>

<ol>
  <li>Deployment-Skript:
    <ul>
      <li>Wir verwenden Fabric, um Bereitstellungsaufgaben wie die Vorbereitung lokaler und entfernter Verzeichnisse, das Synchronisieren von Dateien und das Setzen von Berechtigungen zu automatisieren.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">task</span>
 <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">Connection</span>
</code></pre></div>    </div>

    <p>server_dir = ‘/home/project/server’
 web_tmp_dir = ‘/home/project/server/tmp’</p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="n">task</span>
    <span class="k">def</span> <span class="nf">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s">'test -d </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'mkdir -p </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 755 </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 777 </span><span class="si">{</span><span class="n">web_tmp_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@task
def deploy(c, install='false'):
    prepare_remote_dirs(c)
    pem_file = './aws-keypair.pem'
    rsync_command = (f'rsync -avz --exclude="api/db.sqlite3" '
                     f'-e "ssh -i {pem_file}" --rsync-path="sudo rsync" '
                     f'{tmp_dir}/ {c.user}@{c.host}:{server_dir}')
    c.local(rsync_command)
    c.sudo(f'chown -R ec2-user:ec2-user {server_dir}')
```
</code></pre></div></div>

<ol>
  <li>ElasticSearch-Konfiguration:
    <ul>
      <li>Die ElasticSearch-Einrichtung umfasst Konfigurationen für den Cluster, den Knoten und die Netzwerkeinstellungen.</li>
    </ul>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">cluster.name</span><span class="pi">:</span> <span class="s">my-application</span>
 <span class="na">node.name</span><span class="pi">:</span> <span class="s">node-1</span>
 <span class="na">path.data</span><span class="pi">:</span> <span class="s">/var/lib/elasticsearch</span>
 <span class="na">path.logs</span><span class="pi">:</span> <span class="s">/var/log/elasticsearch</span>
 <span class="na">network.host</span><span class="pi">:</span> <span class="s">0.0.0.0</span>
 <span class="na">http.port</span><span class="pi">:</span> <span class="m">9200</span>
 <span class="na">discovery.seed_hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">]</span>
 <span class="na">cluster.initial_master_nodes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">node-1"</span><span class="pi">]</span>
</code></pre></div>    </div>
  </li>
  <li>Kibana-Konfiguration:
    <ul>
      <li>Die Kibana-Einrichtung umfasst Konfigurationen für den Server und die ElasticSearch-Hosts.</li>
    </ul>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">server.port</span><span class="pi">:</span> <span class="m">5601</span>
 <span class="na">server.host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span>
 <span class="na">elasticsearch.hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">http://localhost:9200"</span><span class="pi">]</span>
</code></pre></div>    </div>
  </li>
  <li>Logstash-Konfiguration:
    <ul>
      <li>Logstash ist so konfiguriert, dass es Logdateien liest, sie analysiert und die analysierten Logs an ElasticSearch weiterleitet.</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> input {
   file {
     path =&gt; "/home/project/server/app.log"
     start_position =&gt; "beginning"
     sincedb_path =&gt; "/dev/null"
   }
 }
</code></pre></div>    </div>

    <p>filter {
   json {
     source =&gt; “message”
   }
 }</p>

    <p>output {
   elasticsearch {
     hosts =&gt; [“http://localhost:9200”]
     index =&gt; “flask-logs-%{+YYYY.MM.dd}”
   }
 }
 ```</p>
  </li>
</ol>

<h3 id="nginx-konfiguration-und-lets-encrypt-ssl-zertifikat">Nginx-Konfiguration und Let’s Encrypt SSL-Zertifikat</h3>

<p>Um eine sichere Kommunikation zu gewährleisten, verwenden wir Nginx als Reverse-Proxy und Let’s Encrypt für SSL-Zertifikate. Im Folgenden finden Sie die Nginx-Konfiguration für die Umleitung von HTTP zu HTTPS und die Einrichtung der SSL-Zertifikate.</p>

<ol>
  <li>
    <p>Definiere eine Map, um die erlaubten Ursprünge zu verwalten:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">map</span> <span class="nv">$http_origin</span> <span class="nv">$cors_origin</span> <span class="p">{</span>
     <span class="kn">default</span> <span class="s">"https://example.com"</span><span class="p">;</span>
     <span class="kn">"http://localhost:3000"</span> <span class="s">"http://localhost:3000"</span><span class="p">;</span>
     <span class="kn">"https://example.com"</span> <span class="s">"https://example.com"</span><span class="p">;</span>
     <span class="kn">"https://www.example.com"</span> <span class="s">"https://www.example.com"</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>HTTP auf HTTPS umleiten:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">server</span> <span class="p">{</span>
     <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
     <span class="kn">server_name</span> <span class="s">example.com</span> <span class="s">api.example.com</span><span class="p">;</span>
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> return 301 https://$host$request_uri;  }  ```
</code></pre></div>    </div>
  </li>
  <li>
    <p>Hauptseitenkonfiguration für <code class="language-plaintext highlighter-rouge">example.com</code>:</p>

    <p>```nginx
 server {
     listen 443 ssl;
     server_name example.com;</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
 ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
        <span class="k">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
        <span class="k">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root /home/projekt/web;
    index index.html index.htm index.php default.html default.htm default.php;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
        expires 30d;
    }

    location ~ .*\.(js|css)?$ {
        expires 12h;
    }

    error_page 404 /index.html;
}
```
</code></pre></div></div>

<ol>
  <li>
    <p>API-Konfiguration für <code class="language-plaintext highlighter-rouge">api.example.com</code>:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">server</span> <span class="p">{</span>
     <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
     <span class="kn">server_name</span> <span class="s">api.example.com</span><span class="p">;</span>
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssl_certificate /etc/letsencrypt/live/example.com-0001/fullchain.pem;
 ssl_certificate_key /etc/letsencrypt/live/example.com-0001/privkey.pem;
</code></pre></div>    </div>
  </li>
</ol>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
        <span class="k">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
        <span class="k">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    location / {
        # Alle vorhandenen Access-Control-Header löschen
        more_clear_headers 'Access-Control-Allow-Origin';

        # CORS-Preflight-Anfragen behandeln
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' $cors_origin;
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
            add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization, X-Client-Info, X-Trace-Id, X-Requested-With, X-HTTP-Method-Override, DNT, Keep-Alive, User-Agent, If-Modified-Since, Cache-Control, Content-Range, Range';
            add_header 'Access-Control-Max-Age' 3600;
            return 204;
        }

        add_header 'Access-Control-Allow-Origin' $cors_origin always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE' always;
        add_header 'Access-Control-Allow-Headers' 'Origin, Content-Type, Accept, Authorization, X-Client-Info, X-Trace-Id, X-Requested-With, X-HTTP-Method-Override, DNT, Keep-Alive, User-Agent, If-Modified-Since, Cache-Control, Content-Range, Range' always;
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">nginx
            proxy_pass http://127.0.0.1:5000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_connect_timeout 600s;
            proxy_send_timeout 600s;
            proxy_read_timeout 600s;
            send_timeout 600s;
        }
    }
   </code></p>

<h3 id="fazit">Fazit</h3>

<p>Dieses Projekt präsentiert eine robuste Architektur für eine KI-gestützte Story-Bot-Anwendung, die moderne Webentwicklungspraktiken und -tools nutzt. Das Backend wurde mit Flask entwickelt, um eine effiziente Anfrageverarbeitung und Integration mit verschiedenen Diensten für Protokollierung und Überwachung zu gewährleisten. Das Frontend, das mit React erstellt wurde, bietet eine interaktive Benutzeroberfläche zur Verwaltung von Story-Prompts. Durch die Nutzung von AWS für die Bereitstellung, Nginx für sichere Kommunikation und den ELK-Stack für die Protokollverwaltung stellen wir Skalierbarkeit, Zuverlässigkeit und Wartbarkeit sicher. Dieses umfassende Setup demonstriert die Kraft der Kombination modernster Technologien, um ein nahtloses Benutzererlebnis zu liefern.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-de" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
