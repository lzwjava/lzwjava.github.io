<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Analyse du système de connexion de l'Université Forestière de Pékin</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Analyse du système de connexion de l’Université Forestière de Pékin | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Analyse du système de connexion de l’Université Forestière de Pékin" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="fr" />
<meta name="description" content="Ce message a été initialement rédigé en chinois et publié sur CSDN." />
<meta property="og:description" content="Ce message a été initialement rédigé en chinois et publié sur CSDN." />
<link rel="canonical" href="https://lzwjava.github.io/bjfu-web-fr" />
<meta property="og:url" content="https://lzwjava.github.io/bjfu-web-fr" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-01-09T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Analyse du système de connexion de l’Université Forestière de Pékin" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2014-01-09T00:00:00+08:00","datePublished":"2014-01-09T00:00:00+08:00","description":"Ce message a été initialement rédigé en chinois et publié sur CSDN.","headline":"Analyse du système de connexion de l’Université Forestière de Pékin","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/bjfu-web-fr"},"url":"https://lzwjava.github.io/bjfu-web-fr"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=ba3325344181e7d5ce78f7fc917735e4f568c4b5">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=ba3325344181e7d5ce78f7fc917735e4f568c4b5" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Analyse du système de connexion de l'Université Forestière de Pékin | Original, traduit par l'IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/fr/2014-01-09-bjfu-web-fr.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsfr2014-01-09-bjfu-web-fr.md</span> -->
      

      <!-- <span>2014-01-09-bjfu-web-fr.md</span> -->

      
        

        
          
          <a href="#" class="button">2014.01</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/bjfu-web-en" >English</option>
        <option value="/bjfu-web-zh" >中文</option>
        <option value="/bjfu-web-ja" >日本語</option>
        <option value="/bjfu-web-es" >Español</option>
        <option value="/bjfu-web-hi" >हिंदी</option>
        <option value="/bjfu-web-fr" selected>Français</option>
        <option value="/bjfu-web-de" >Deutsch</option>
        <option value="/bjfu-web-ar" >العربية</option>
        <option value="/bjfu-web-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Ce message a été initialement rédigé en chinois et publié sur <a href="https://blog.csdn.net/lzw_java/article/details/18049581">CSDN</a>.</p>

<hr />

<p>Ce message détaille le processus de l’ingénierie inverse du système de connexion réseau utilisé à l’Université Forestière de Pékin.</p>

<p>L’objectif est de simuler le processus de connexion de manière programmatique, en imitant efficacement les actions d’un utilisateur se connectant au réseau via un navigateur web.</p>

<p>En utilisant les outils de développement de Chrome, nous pouvons observer les requêtes réseau effectuées pendant le processus de connexion.</p>

<p>La première requête est envoyée à <code class="language-plaintext highlighter-rouge">CheckLogin.jsp</code>, suivie d’une requête vers <code class="language-plaintext highlighter-rouge">index.jsp</code> déclenchée par <code class="language-plaintext highlighter-rouge">CheckLogin.jsp</code>.</p>

<p>Examinons de plus près <code class="language-plaintext highlighter-rouge">CheckLogin.jsp</code>.</p>

<p>On peut voir qu’il utilise une requête POST et inclut plusieurs paires clé-valeur. Mais quelle est l’action <code class="language-plaintext highlighter-rouge">action</code>?</p>

<p>En inspectant les “Form Data” dans les outils de développement, nous pouvons voir la source :</p>

<p>Pour trouver la valeur réelle de <code class="language-plaintext highlighter-rouge">action</code>, nous pouvons inspecter le code source de la page :</p>

<p>La valeur de <code class="language-plaintext highlighter-rouge">action</code> est la chaîne dans la deuxième ligne.</p>

<p>Maintenant, comment obtenir l’adresse IP ? Le système de connexion peut être accès de n’importe où sur le campus, que ce soit via Wi-Fi ou une connexion filaire dans une chambre. L’adresse IP est dynamique. Comment pouvons-nous l’obtenir automatiquement ?</p>

<p>Souvenez-vous de la première image ?</p>

<p>La page web fournit automatiquement l’adresse IP. Le système de connexion connaît l’IP qui y accède. Nous pouvons simplement l’extraire de la page web.</p>

<p>Chrome fournit des outils pratiques pour localiser rapidement des parties spécifiques du code de la page web. Firefox dispose d’un plugin similaire appelé Firebug.</p>

<p>En utilisant l’outil “inspecter l’élément” (l’icône de la loupe), nous pouvons cliquer sur l’adresse IP sur la page.</p>

<p>Les outils de développement montreront la structure HTML, révélant que l’adresse IP se trouve dans une balise <code class="language-plaintext highlighter-rouge">&lt;span&gt;</code> avec la classe <code class="language-plaintext highlighter-rouge">login_txt</code>, précisément dans son contenu texte.</p>

<p>La fonction <code class="language-plaintext highlighter-rouge">select</code> de Jsoup peut trouver les éléments correspondant à une requête CSS, et <code class="language-plaintext highlighter-rouge">first()</code> renvoie le premier élément correspondant.</p>

<p>Avec toutes les paires clé-valeur, nous pouvons maintenant simuler le processus de connexion.</p>

<p>La requête POST envoie les paires clé-valeur dans le corps de la requête. L’appel <code class="language-plaintext highlighter-rouge">post.abort()</code> interrompt la requête. Cela est dû au fait que nous réutiliserons le <code class="language-plaintext highlighter-rouge">httpClient</code> pour les requêtes suivantes. Les classes <code class="language-plaintext highlighter-rouge">org.apache.http</code> tentent de réutiliser la connexion HTTP autant que possible. Si une requête n’est pas terminée, l’envoi d’une autre requête en utilisant la même connexion peut provoquer une exception.</p>

<p>Pourquoi devons-nous réutiliser le <code class="language-plaintext highlighter-rouge">httpClient</code> ? Je vais l’expliquer plus tard.</p>

<p>Soumettre à <code class="language-plaintext highlighter-rouge">checkLogin.jsp</code> ne suffit pas pour se connecter au réseau. Ce JSP vérifie seulement si le nom d’utilisateur et le mot de passe sont corrects.</p>

<p>En ajoutant une instruction d’impression, nous pouvons voir le code de réponse.</p>

<p>Un code de réponse 200 indique une connexion réussie, 303 indique des informations d’identification incorrectes, et 404 indique une erreur de connexion.</p>

<p>Le deuxième script JSP exécuté est <code class="language-plaintext highlighter-rouge">index.jsp</code>, qui est une requête GET.</p>

<p>Après cela, nous ne pouvons toujours pas nous connecter au réseau. Nous devons simuler une requête vers <code class="language-plaintext highlighter-rouge">connect_action.jsp</code>, qui nécessite un paramètre <code class="language-plaintext highlighter-rouge">userid</code> (par exemple, <code class="language-plaintext highlighter-rouge">userid=88888</code>), correspondant à une carte d’étudiant. J’ai remarqué que le <code class="language-plaintext highlighter-rouge">userid</code> de l’étudiant ayant l’identifiant étudiant précédent était simplement un de moins que le mien. Comment pouvons-nous obtenir cette valeur ?</p>

<p>Heureusement, je me suis souvenu que nous avons extrait l’adresse IP de la page web. Pouvons-nous faire de même pour le <code class="language-plaintext highlighter-rouge">userid</code> ?</p>

<p>Cette capture d’écran provient de la page déconnectée, mais la même logique s’applique à <code class="language-plaintext highlighter-rouge">connect.jsp</code>. Le code source de la page retournée par le deuxième JSP contient la paire clé-valeur pour le prochain JSP que nous devons demander.</p>

<p>Ici, nous utilisons une expression régulière. <code class="language-plaintext highlighter-rouge">group(0)</code> est la correspondance entière (par exemple, <code class="language-plaintext highlighter-rouge">userid=88888</code>), et <code class="language-plaintext highlighter-rouge">group(1)</code> est le contenu à l’intérieur des parenthèses (par exemple, <code class="language-plaintext highlighter-rouge">88888</code>). <code class="language-plaintext highlighter-rouge">\d</code> correspond à tout chiffre, et <code class="language-plaintext highlighter-rouge">+</code> signifie une ou plusieurs occurrences. <code class="language-plaintext highlighter-rouge">find()</code> vérifie si l’expression correspond à une partie de la chaîne, tandis que <code class="language-plaintext highlighter-rouge">matches()</code> vérifie si l’expression correspond à la chaîne entière. Par conséquent, si le <code class="language-plaintext highlighter-rouge">src</code> est comme <code class="language-plaintext highlighter-rouge">&lt;frame userid=88888&amp;ip="</code>, <code class="language-plaintext highlighter-rouge">matches()</code> retournera <code class="language-plaintext highlighter-rouge">false</code> car le regex ne correspond pas à la chaîne entière.</p>

<p>Voici le code Java :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.NameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.HttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.entity.UrlEncodedFormEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.utils.URLEncodedUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.cookie.Cookie</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.AbstractHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.DefaultHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.protocol.HTTP</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.Jsoup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Element</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.select.Elements</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Login</span> <span class="o">{</span>

	<span class="kd">static</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">format</span><span class="o">,</span> <span class="nc">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">format</span><span class="o">,</span> <span class="n">args</span><span class="o">));</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultHttpClient</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">ip</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">userId</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">username</span><span class="o">=</span><span class="s">"130888888"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"88888888"</span><span class="o">;</span>

		<span class="n">ip</span><span class="o">=</span><span class="n">cssQueryFirstText</span><span class="o">(</span><span class="s">"http://login.bjfu.edu.cn/index.jsp"</span><span class="o">,</span><span class="s">"span.login_txt"</span><span class="o">);</span>

		<span class="n">doPost</span><span class="o">(</span><span class="n">httpClient</span><span class="o">,</span><span class="s">"http://login.bjfu.edu.cn/checkLogin.jsp"</span><span class="o">,</span>
				<span class="s">"username"</span><span class="o">,</span><span class="n">username</span><span class="o">,</span><span class="s">"password"</span><span class="o">,</span><span class="n">password</span><span class="o">,</span>
				<span class="s">"ip"</span><span class="o">,</span><span class="n">ip</span><span class="o">,</span><span class="s">"action"</span><span class="o">,</span><span class="s">"checkLogin.jsp"</span><span class="o">);</span>
		<span class="nc">String</span> <span class="n">content</span><span class="o">=</span><span class="n">doGet</span><span class="o">(</span><span class="n">httpClient</span><span class="o">,</span><span class="s">"http://login.bjfu.edu.cn/user/index.jsp"</span><span class="o">,</span>
		  <span class="s">"ip"</span><span class="o">,</span><span class="n">ip</span><span class="o">,</span><span class="s">"action"</span><span class="o">,</span><span class="s">"connect"</span><span class="o">);</span>
		<span class="n">userId</span><span class="o">=</span><span class="n">userId</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
		<span class="n">doGet</span><span class="o">(</span><span class="n">httpClient</span><span class="o">,</span><span class="s">"http://login.bjfu.edu.cn/user/network/connect_action.jsp"</span><span class="o">,</span>
			<span class="s">"userid"</span><span class="o">,</span><span class="n">userId</span><span class="o">,</span><span class="s">"ip"</span><span class="o">,</span><span class="n">ip</span><span class="o">,</span><span class="s">"type"</span><span class="o">,</span><span class="s">"2"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">userId</span><span class="o">(</span><span class="nc">String</span> <span class="n">html</span><span class="o">){</span>
		<span class="nc">Document</span> <span class="n">doc</span><span class="o">=</span><span class="nc">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">html</span><span class="o">);</span>
		<span class="nc">Element</span> <span class="n">elem</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"frame#main"</span><span class="o">).</span><span class="na">first</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">src</span><span class="o">=</span><span class="n">elem</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"src"</span><span class="o">);</span>
		<span class="nc">Pattern</span> <span class="n">pattern</span><span class="o">=</span><span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"userid=(\\d+)"</span><span class="o">);</span>
		<span class="nc">Matcher</span> <span class="n">matcher</span><span class="o">=</span><span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
		<span class="nc">String</span> <span class="n">ans</span><span class="o">=</span><span class="s">""</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">matcher</span><span class="o">.</span><span class="na">find</span><span class="o">()){</span>
		  <span class="n">ans</span><span class="o">=</span><span class="n">matcher</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">cssQueryFirstText</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span><span class="nc">String</span> <span class="n">cssQuery</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">ip</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">Document</span> <span class="n">doc</span><span class="o">=</span><span class="nc">Jsoup</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
			<span class="nc">Elements</span> <span class="n">elems</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">cssQuery</span><span class="o">);</span>
			<span class="nc">Element</span> <span class="n">elem</span><span class="o">=</span><span class="n">elems</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
			<span class="n">ip</span><span class="o">=</span><span class="n">elem</span><span class="o">.</span><span class="na">text</span><span class="o">();</span>
		<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpClient</span> <span class="n">httpClient</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">entityContent</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">url</span> <span class="o">=</span> <span class="n">makeGetSrl</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">pairs</span><span class="o">);</span>
			<span class="nc">HttpGet</span> <span class="n">get</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpGet</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
			<span class="nc">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">get</span><span class="o">);</span>
			<span class="c1">//print("%d", response.getStatusLine().getStatusCode());</span>
			<span class="n">entityContent</span> <span class="o">=</span> <span class="n">entity</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
			<span class="nc">EntityUtils</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">());</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">entityContent</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="kt">void</span> <span class="nf">printEntity</span><span class="o">(</span><span class="nc">HttpResponse</span> <span class="n">rp</span><span class="o">){</span>
		<span class="n">print</span><span class="o">(</span><span class="s">"%s"</span><span class="o">,</span><span class="n">entity</span><span class="o">(</span><span class="n">rp</span><span class="o">));</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">entity</span><span class="o">(</span><span class="nc">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span>
						<span class="n">entity</span><span class="o">.</span><span class="na">getContent</span><span class="o">()));</span>
				<span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
				<span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">makeGetSrl</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span><span class="nc">String</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span><span class="o">(!</span><span class="n">url</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"?"</span><span class="o">)){</span>
			<span class="n">url</span><span class="o">+=</span><span class="s">"?"</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;</span><span class="n">params</span><span class="o">=</span><span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;();</span>
		<span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
			<span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">BasicNameValuePair</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">],</span><span class="n">pairs</span><span class="o">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">]));</span>
		<span class="o">}</span>
		<span class="nc">String</span> <span class="n">paramsStr</span><span class="o">=</span><span class="nc">URLEncodedUtils</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">params</span><span class="o">,</span><span class="s">"utf-8"</span><span class="o">);</span>
		<span class="n">url</span><span class="o">+=</span><span class="n">paramsStr</span><span class="o">;</span>
		<span class="k">return</span> <span class="n">url</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpClient</span> <span class="n">httpClient</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">entityContent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">HttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpPost</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;();</span>
			<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pairs</span><span class="o">.</span><span class="na">length</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
				<span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">BasicNameValuePair</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="o">],</span> <span class="n">pairs</span><span class="o">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]));</span>
			<span class="o">}</span>
			<span class="n">post</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="nc">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="no">HTTP</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
			<span class="nc">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
			<span class="n">entityContent</span> <span class="o">=</span> <span class="n">entity</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
			<span class="c1">//print("%d", response.getStatusLine().getStatusCode());</span>
			<span class="n">post</span><span class="o">.</span><span class="na">abort</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">entityContent</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getCookies</span><span class="o">(</span><span class="nc">HttpClient</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cookie</span><span class="o">&gt;</span> <span class="n">cookies</span> <span class="o">=</span> <span class="o">((</span><span class="nc">AbstractHttpClient</span><span class="o">)</span>
        		<span class="n">client</span><span class="o">).</span><span class="na">getCookieStore</span><span class="o">().</span><span class="na">getCookies</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Cookie</span> <span class="nl">cookie:</span> <span class="n">cookies</span><span class="o">)</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cookie</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">cookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">";"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Le code source complet est disponible sur GitHub. Notez que vous pourriez ne pas pouvoir l’exécuter sans un compte valide pour le réseau de l’université.</p>

<p>La raison pour laquelle nous réutilisons le même <code class="language-plaintext highlighter-rouge">HttpClient</code> est qu’il stocke automatiquement les cookies. Les scripts JSP utilisent les cookies pour déterminer si les requêtes proviennent de la même session. C’est pourquoi copier une URL de Taobao dans un autre navigateur peut entraîner une erreur de délai d’attente.</p>

<p><code class="language-plaintext highlighter-rouge">jsoup</code> et les expressions régulières sont des outils très utiles. Il existe des outils en ligne pour pratiquer les expressions régulières. Amusez-vous à les utiliser !</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-fr" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
