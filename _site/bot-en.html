<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Build an AI-Powered Story Bot</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Build an AI-Powered Story Bot | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Build an AI-Powered Story Bot" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="en" />
<meta name="description" content="This blog post was written with the assistance of ChatGPT-4." />
<meta property="og:description" content="This blog post was written with the assistance of ChatGPT-4." />
<link rel="canonical" href="https://lzwjava.github.io/bot-en" />
<meta property="og:url" content="https://lzwjava.github.io/bot-en" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Build an AI-Powered Story Bot" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2024-07-07T00:00:00+08:00","datePublished":"2024-07-07T00:00:00+08:00","description":"This blog post was written with the assistance of ChatGPT-4.","headline":"Build an AI-Powered Story Bot","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/bot-en"},"url":"https://lzwjava.github.io/bot-en"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=4e19962fa6064547f6e963b3b92fbf0d54e757c1">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=4e19962fa6064547f6e963b3b92fbf0d54e757c1" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Build an AI-Powered Story Bot | Original
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/en/2024-07-07-bot-en.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsen2024-07-07-bot-en.md</span> -->
      

      <!-- <span>2024-07-07-bot-en.md</span> -->

      
        

        
          
          <a href="#" class="button">2024.07</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/bot-en" selected>English</option>
        <option value="/bot-zh" >中文</option>
        <option value="/bot-ja" >日本語</option>
        <option value="/bot-es" >Español</option>
        <option value="/bot-hi" >हिंदी</option>
        <option value="/bot-fr" >Français</option>
        <option value="/bot-de" >Deutsch</option>
        <option value="/bot-ar" >العربية</option>
        <option value="/bot-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p><em>This blog post was written with the assistance of ChatGPT-4.</em></p>

<hr />

<h3 id="table-of-contents">Table of Contents</h3>

<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#project-architecture">Project Architecture</a>
    <ul>
      <li><a href="#backend">Backend</a>
        <ul>
          <li><a href="#flask-application-setup">Flask Application Setup</a></li>
          <li><a href="#logging-and-monitoring">Logging and Monitoring</a></li>
          <li><a href="#request-handling">Request Handling</a></li>
        </ul>
      </li>
      <li><a href="#frontend">Frontend</a>
        <ul>
          <li><a href="#react-components">React Components</a></li>
          <li><a href="#api-integration">API Integration</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#deployment">Deployment</a>
    <ul>
      <li><a href="#deployment-script">Deployment Script</a></li>
      <li><a href="#elasticsearch-configuration">ElasticSearch Configuration</a></li>
      <li><a href="#kibana-configuration">Kibana Configuration</a></li>
      <li><a href="#logstash-configuration">Logstash Configuration</a></li>
    </ul>
  </li>
  <li><a href="#nginx-configuration-and-lets-encrypt-ssl-certificate">Nginx Configuration and Let’s Encrypt SSL Certificate</a>
    <ul>
      <li><a href="#define-a-map-to-handle-the-allowed-origins">Define a map to handle the allowed origins</a></li>
      <li><a href="#redirect-http-to-https">Redirect HTTP to HTTPS</a></li>
      <li><a href="#main-site-configuration-for-examplecom">Main site configuration for <code class="language-plaintext highlighter-rouge">example.com</code></a></li>
      <li><a href="#api-configuration-for-apiexamplecom">API configuration for <code class="language-plaintext highlighter-rouge">api.example.com</code></a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

<hr />

<h3 id="introduction">Introduction</h3>

<p>This blog post provides a comprehensive guide to the architecture and implementation of an AI-powered story bot application. The project involves generating personalized stories using a web interface. We use Python, Flask, and React for development and deploy on AWS. Additionally, we use Prometheus for monitoring and ElasticSearch, Kibana, and Logstash for log management. DNS management is handled through GoDaddy and Cloudflare, with Nginx serving as a gateway for SSL certificate and request header management.</p>

<h3 id="project-architecture">Project Architecture</h3>

<h4 id="backend">Backend</h4>

<p>The backend of the project is built using Flask, a lightweight WSGI web application framework in Python. The backend handles API requests, manages the database, logs application activities, and integrates with Prometheus for monitoring.</p>

<p>Here’s a breakdown of the backend components:</p>

<ol>
  <li>Flask Application Setup:
    <ul>
      <li>The Flask app is initialized and configured to use various extensions like Flask-CORS for handling Cross-Origin Resource Sharing and Flask-Migrate for managing database migrations.</li>
      <li>The application routes are initialized, and CORS is enabled to allow cross-origin requests.</li>
      <li>The database is initialized with default configurations, and a custom logger is set up to format log entries for Logstash.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
 <span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span>
 <span class="kn">from</span> <span class="nn">.routes</span> <span class="kn">import</span> <span class="n">initialize_routes</span>
 <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">insert_default_config</span>
 <span class="kn">from</span> <span class="nn">flask_migrate</span> <span class="kn">import</span> <span class="n">Migrate</span>
 <span class="kn">import</span> <span class="nn">logging</span>
 <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">RotatingFileHandler</span>
 <span class="kn">from</span> <span class="nn">prometheus_client</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">generate_latest</span><span class="p">,</span> <span class="n">Gauge</span>

 <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
 <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'api.config.BaseConfig'</span><span class="p">)</span>

 <span class="n">db</span><span class="p">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
 <span class="n">initialize_routes</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
 <span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
 <span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Logging and Monitoring:
    <ul>
      <li>The application uses RotatingFileHandler to manage log files and formats logs using a custom formatter.</li>
      <li>Prometheus metrics are integrated into the application to track request count and latency.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">REQUEST_COUNT</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s">'flask_app_request_count'</span><span class="p">,</span> <span class="s">'Total request count of the Flask App'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">,</span> <span class="s">'http_status'</span><span class="p">])</span>
 <span class="n">REQUEST_LATENCY</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s">'flask_app_request_latency_seconds'</span><span class="p">,</span> <span class="s">'Request latency'</span><span class="p">,</span> <span class="p">[</span><span class="s">'method'</span><span class="p">,</span> <span class="s">'endpoint'</span><span class="p">])</span>

 <span class="k">def</span> <span class="nf">setup_loggers</span><span class="p">():</span>
     <span class="n">logstash_handler</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span><span class="p">(</span><span class="s">'app.log'</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
     <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
     <span class="n">logstash_formatter</span> <span class="o">=</span> <span class="n">CustomLogstashFormatter</span><span class="p">()</span>
     <span class="n">logstash_handler</span><span class="p">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logstash_formatter</span><span class="p">)</span>

     <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">()</span>
     <span class="n">root_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
     <span class="n">root_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>

     <span class="n">app</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>
     <span class="n">werkzeug_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'werkzeug'</span><span class="p">)</span>
     <span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
     <span class="n">werkzeug_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logstash_handler</span><span class="p">)</span>

 <span class="n">setup_loggers</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>Request Handling:
    <ul>
      <li>The application captures metrics before and after each request, generating a trace ID to track request flow.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">def</span> <span class="nf">generate_trace_id</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
     <span class="n">characters</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
     <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>

 <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">before_request</span>
 <span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
     <span class="n">request</span><span class="p">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
     <span class="n">trace_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'X-Trace-Id'</span><span class="p">,</span> <span class="n">generate_trace_id</span><span class="p">())</span>
     <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span> <span class="o">=</span> <span class="n">trace_id</span>

 <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">after_request</span>
 <span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
     <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'X-Trace-Id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">trace_id</span>
     <span class="n">request_latency</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'start_time'</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span>
     <span class="n">REQUEST_COUNT</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="n">http_status</span><span class="o">=</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">).</span><span class="n">inc</span><span class="p">()</span>
     <span class="n">REQUEST_LATENCY</span><span class="p">.</span><span class="n">labels</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">path</span><span class="p">).</span><span class="nb">set</span><span class="p">(</span><span class="n">request_latency</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">response</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="frontend">Frontend</h4>

<p>The frontend of the project is built using React, a JavaScript library for building user interfaces. It interacts with the backend API to manage story prompts and provides an interactive user interface for generating and managing personalized stories.</p>

<ol>
  <li>React Components:
    <ul>
      <li>The main component handles user input for story prompts and interacts with the backend API to manage these stories.</li>
    </ul>

    <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="p">{</span> <span class="nx">ToastContainer</span><span class="p">,</span> <span class="nx">toast</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-toastify</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="dl">'</span><span class="s1">react-toastify/dist/ReactToastify.css</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="p">{</span> <span class="nx">apiFetch</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./api</span><span class="dl">'</span><span class="p">;</span>
 <span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span><span class="p">;</span>

 <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">prompts</span><span class="p">,</span> <span class="nx">setPrompts</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([]);</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">newPrompt</span><span class="p">,</span> <span class="nx">setNewPrompt</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
   <span class="kd">const</span> <span class="p">[</span><span class="nx">isLoading</span><span class="p">,</span> <span class="nx">setIsLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

   <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="nx">fetchPrompts</span><span class="p">();</span>
   <span class="p">},</span> <span class="p">[]);</span>

   <span class="kd">const</span> <span class="nx">fetchPrompts</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
     <span class="k">try</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">prompts</span><span class="dl">'</span><span class="p">);</span>
       <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
         <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
         <span class="nx">setPrompts</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to fetch prompts</span><span class="dl">'</span><span class="p">);</span>
       <span class="p">}</span>
     <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">An error occurred while fetching prompts</span><span class="dl">'</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
       <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
     <span class="p">}</span>
   <span class="p">};</span>

   <span class="kd">const</span> <span class="nx">addPrompt</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">newPrompt</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">toast</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">Prompt content cannot be empty</span><span class="dl">'</span><span class="p">);</span>
       <span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
     <span class="k">try</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">prompts</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
         <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
         <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
           <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
         <span class="p">},</span>
         <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">content</span><span class="p">:</span> <span class="nx">newPrompt</span> <span class="p">}),</span>
       <span class="p">});</span>
       <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">fetchPrompts</span><span class="p">();</span>
         <span class="nx">setNewPrompt</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
         <span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="dl">'</span><span class="s1">Prompt added successfully</span><span class="dl">'</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to add prompt</span><span class="dl">'</span><span class="p">);</span>
       <span class="p">}</span>
     <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">An error occurred while adding the prompt</span><span class="dl">'</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
       <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
     <span class="p">}</span>
   <span class="p">};</span>

   <span class="kd">const</span> <span class="nx">deletePrompt</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">promptId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
     <span class="k">try</span> <span class="p">{</span>
       <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">apiFetch</span><span class="p">(</span><span class="s2">`prompts/</span><span class="p">${</span><span class="nx">promptId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
         <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span><span class="p">,</span>
       <span class="p">});</span>
       <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">fetchPrompts</span><span class="p">();</span>
         <span class="nx">toast</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="dl">'</span><span class="s1">Prompt deleted successfully</span><span class="dl">'</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to delete prompt</span><span class="dl">'</span><span class="p">);</span>
       <span class="p">}</span>
     <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">An error occurred while deleting the prompt</span><span class="dl">'</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
       <span class="nx">setIsLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
     <span class="p">}</span>
   <span class="p">};</span>

   <span class="k">return</span> <span class="p">(</span>
     <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"app"</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>AI-Powered Story Bot<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
       <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">input</span>
           <span class="na">type</span><span class="p">=</span><span class="s">"text"</span>
           <span class="na">value</span><span class="p">=</span><span class="si">{</span><span class="nx">newPrompt</span><span class="si">}</span>
           <span class="na">onChange</span><span class="p">=</span><span class="si">{</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setNewPrompt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span>
           <span class="na">placeholder</span><span class="p">=</span><span class="s">"New Prompt"</span>
         <span class="p">/&gt;</span>
         <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="nx">addPrompt</span><span class="si">}</span> <span class="na">disabled</span><span class="p">=</span><span class="si">{</span><span class="nx">isLoading</span><span class="si">}</span><span class="p">&gt;</span>Add Prompt<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
       <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
       <span class="si">{</span><span class="nx">isLoading</span> <span class="p">?</span> <span class="p">(</span>
         <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Loading...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
       <span class="p">)</span> <span class="p">:</span> <span class="p">(</span>
         <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
           <span class="si">{</span><span class="nx">prompts</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">prompt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
             <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="p">=</span><span class="si">{</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="p">&gt;</span>
               <span class="si">{</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span>
               <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">deletePrompt</span><span class="p">(</span><span class="nx">prompt</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
             <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
           <span class="p">))</span><span class="si">}</span>
         <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
       <span class="p">)</span><span class="si">}</span>
       <span class="p">&lt;</span><span class="nc">ToastContainer</span> <span class="p">/&gt;</span>
     <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="p">);</span>
 <span class="p">}</span>

 <span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>API Integration:
    <ul>
      <li>The frontend interacts with the backend API using fetch requests to manage story prompts.</li>
    </ul>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">export</span> <span class="kd">const</span> <span class="nx">apiFetch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">`https://api.yourdomain.com/</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
 <span class="p">};</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="deployment">Deployment</h3>

<p>The project is deployed on AWS, with DNS management handled through GoDaddy and Cloudflare. Nginx is used as a gateway for SSL certificate and request header management. We use Prometheus for monitoring and ElasticSearch, Kibana, and Logstash for log management.</p>

<ol>
  <li>Deployment Script:
    <ul>
      <li>We use Fabric to automate deployment tasks such as preparing local and remote directories, syncing files, and setting permissions.</li>
    </ul>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">task</span>
 <span class="kn">from</span> <span class="nn">fabric</span> <span class="kn">import</span> <span class="n">Connection</span>

 <span class="n">server_dir</span> <span class="o">=</span> <span class="s">'/home/project/server'</span>
 <span class="n">web_tmp_dir</span> <span class="o">=</span> <span class="s">'/home/project/server/tmp'</span>

 <span class="o">@</span><span class="n">task</span>
 <span class="k">def</span> <span class="nf">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s">'test -d </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">ok</span><span class="p">:</span>
         <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'mkdir -p </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
         <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 755 </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
         <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chmod -R 777 </span><span class="si">{</span><span class="n">web_tmp_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
         <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

 <span class="o">@</span><span class="n">task</span>
 <span class="k">def</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">install</span><span class="o">=</span><span class="s">'false'</span><span class="p">):</span>
     <span class="n">prepare_remote_dirs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
     <span class="n">pem_file</span> <span class="o">=</span> <span class="s">'./aws-keypair.pem'</span>
     <span class="n">rsync_command</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s">'rsync -avz --exclude="api/db.sqlite3" '</span>
                      <span class="sa">f</span><span class="s">'-e "ssh -i </span><span class="si">{</span><span class="n">pem_file</span><span class="si">}</span><span class="s">" --rsync-path="sudo rsync" '</span>
                      <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">tmp_dir</span><span class="si">}</span><span class="s">/ </span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">user</span><span class="si">}</span><span class="s">@</span><span class="si">{</span><span class="n">c</span><span class="p">.</span><span class="n">host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
     <span class="n">c</span><span class="p">.</span><span class="n">local</span><span class="p">(</span><span class="n">rsync_command</span><span class="p">)</span>
     <span class="n">c</span><span class="p">.</span><span class="n">sudo</span><span class="p">(</span><span class="sa">f</span><span class="s">'chown -R ec2-user:ec2-user </span><span class="si">{</span><span class="n">server_dir</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>ElasticSearch Configuration:
    <ul>
      <li>The ElasticSearch setup includes configurations for the cluster, node, and network settings.</li>
    </ul>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">cluster.name</span><span class="pi">:</span> <span class="s">my-application</span>
 <span class="na">node.name</span><span class="pi">:</span> <span class="s">node-1</span>
 <span class="na">path.data</span><span class="pi">:</span> <span class="s">/var/lib/elasticsearch</span>
 <span class="na">path.logs</span><span class="pi">:</span> <span class="s">/var/log/elasticsearch</span>
 <span class="na">network.host</span><span class="pi">:</span> <span class="s">0.0.0.0</span>
 <span class="na">http.port</span><span class="pi">:</span> <span class="m">9200</span>
 <span class="na">discovery.seed_hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">]</span>
 <span class="na">cluster.initial_master_nodes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">node-1"</span><span class="pi">]</span>
</code></pre></div>    </div>
  </li>
  <li>Kibana Configuration:
    <ul>
      <li>The Kibana setup includes configurations for the server and ElasticSearch hosts.</li>
    </ul>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">server.port</span><span class="pi">:</span> <span class="m">5601</span>
 <span class="na">server.host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span>
 <span class="na">elasticsearch.hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">http://localhost:9200"</span><span class="pi">]</span>
</code></pre></div>    </div>
  </li>
  <li>Logstash Configuration:
    <ul>
      <li>Logstash is configured to read log files, parse them, and output the parsed logs to ElasticSearch.</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> input {
   file {
     path =&gt; "/home/project/server/app.log"
     start_position =&gt; "beginning"
     sincedb_path =&gt; "/dev/null"
   }
 }

 filter {
   json {
     source =&gt; "message"
   }
 }

 output {
   elasticsearch {
     hosts =&gt; ["http://localhost:9200"]
     index =&gt; "flask-logs-%{+YYYY.MM.dd}"
   }
 }
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="nginx-configuration-and-lets-encrypt-ssl-certificate">Nginx Configuration and Let’s Encrypt SSL Certificate</h3>

<p>To ensure secure communication, we use Nginx as a reverse proxy and Let’s Encrypt for SSL certificates. Below is the Nginx configuration for handling HTTP to HTTPS redirection and setting up the SSL certificates.</p>

<ol>
  <li>
    <p>Define a map to handle the allowed origins:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">map</span> <span class="nv">$http_origin</span> <span class="nv">$cors_origin</span> <span class="p">{</span>
     <span class="kn">default</span> <span class="s">"https://example.com"</span><span class="p">;</span>
     <span class="kn">"http://localhost:3000"</span> <span class="s">"http://localhost:3000"</span><span class="p">;</span>
     <span class="kn">"https://example.com"</span> <span class="s">"https://example.com"</span><span class="p">;</span>
     <span class="kn">"https://www.example.com"</span> <span class="s">"https://www.example.com"</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Redirect HTTP to HTTPS:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">server</span> <span class="p">{</span>
     <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
     <span class="kn">server_name</span> <span class="s">example.com</span> <span class="s">api.example.com</span><span class="p">;</span>

     <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Main site configuration for <code class="language-plaintext highlighter-rouge">example.com</code>:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">server</span> <span class="p">{</span>
     <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
     <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>

     <span class="kn">ssl_certificate</span> <span class="n">/etc/letsencrypt/live/example.com/fullchain.pem</span><span class="p">;</span>
     <span class="kn">ssl_certificate_key</span> <span class="n">/etc/letsencrypt/live/example.com/privkey.pem</span><span class="p">;</span>

     <span class="kn">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
     <span class="kn">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
     <span class="kn">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>

     <span class="kn">root</span> <span class="n">/home/project/web</span><span class="p">;</span>
     <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span> <span class="s">default.html</span> <span class="s">default.htm</span> <span class="s">default.php</span><span class="p">;</span>

     <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
         <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kn">location</span> <span class="p">~</span> <span class="sr">.*\.(gif|jpg|jpeg|png|bmp|swf)$</span> <span class="p">{</span>
         <span class="kn">expires</span> <span class="s">30d</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kn">location</span> <span class="p">~</span> <span class="sr">.*\.(js|css)?$</span> <span class="p">{</span>
         <span class="kn">expires</span> <span class="s">12h</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kn">error_page</span> <span class="mi">404</span> <span class="n">/index.html</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>API configuration for <code class="language-plaintext highlighter-rouge">api.example.com</code>:</p>

    <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">server</span> <span class="p">{</span>
     <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
     <span class="kn">server_name</span> <span class="s">api.example.com</span><span class="p">;</span>

     <span class="kn">ssl_certificate</span> <span class="n">/etc/letsencrypt/live/example.com-0001/fullchain.pem</span><span class="p">;</span>
     <span class="kn">ssl_certificate_key</span> <span class="n">/etc/letsencrypt/live/example.com-0001/privkey.pem</span><span class="p">;</span>

     <span class="kn">ssl_protocols</span> <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
     <span class="kn">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
     <span class="kn">ssl_ciphers</span> <span class="s">"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH"</span><span class="p">;</span>

     <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
         <span class="c1"># Clear any pre-existing Access-Control headers</span>
         <span class="kn">more_clear_headers</span> <span class="s">'Access-Control-Allow-Origin'</span><span class="p">;</span>

         <span class="c1"># Handle CORS preflight requests</span>
         <span class="kn">if</span> <span class="s">(</span><span class="nv">$request_method</span> <span class="p">=</span> <span class="s">'OPTIONS')</span> <span class="p">{</span>
             <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Origin'</span> <span class="nv">$cors_origin</span><span class="p">;</span>
             <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Methods'</span> <span class="s">'GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">PUT,</span> <span class="s">DELETE'</span><span class="p">;</span>
             <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Headers'</span> <span class="s">'Origin,</span> <span class="s">Content-Type,</span> <span class="s">Accept,</span> <span class="s">Authorization,</span> <span class="s">X-Client-Info,</span> <span class="s">X-Trace-Id,</span> <span class="s">X-Requested-With,</span> <span class="s">X-HTTP-Method-Override,</span> <span class="s">DNT,</span> <span class="s">Keep-Alive,</span> <span class="s">User-Agent,</span> <span class="s">If-Modified-Since,</span> <span class="s">Cache-Control,</span> <span class="s">Content-Range,</span> <span class="s">Range'</span><span class="p">;</span>
             <span class="kn">add_header</span> <span class="s">'Access-Control-Max-Age'</span> <span class="mi">3600</span><span class="p">;</span>
             <span class="kn">return</span> <span class="mi">204</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Origin'</span> <span class="nv">$cors_origin</span> <span class="s">always</span><span class="p">;</span>
         <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Methods'</span> <span class="s">'GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">PUT,</span> <span class="s">DELETE'</span> <span class="s">always</span><span class="p">;</span>
         <span class="kn">add_header</span> <span class="s">'Access-Control-Allow-Headers'</span> <span class="s">'Origin,</span> <span class="s">Content-Type,</span> <span class="s">Accept,</span> <span class="s">Authorization,</span> <span class="s">X-Client-Info,</span> <span class="s">X-Trace-Id,</span> <span class="s">X-Requested-With,</span> <span class="s">X-HTTP-Method-Override,</span> <span class="s">DNT,</span> <span class="s">Keep-Alive,</span> <span class="s">User-Agent,</span> <span class="s">If-Modified-Since,</span> <span class="s">Cache-Control,</span> <span class="s">Content-Range,</span> <span class="s">Range'</span> <span class="s">always</span><span class="p">;</span>

         <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:5000/</span><span class="p">;</span>
         <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
         <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
         <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
         <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="nv">$scheme</span><span class="p">;</span>
         <span class="kn">proxy_connect_timeout</span> <span class="s">600s</span><span class="p">;</span>
         <span class="kn">proxy_send_timeout</span> <span class="s">600s</span><span class="p">;</span>
         <span class="kn">proxy_read_timeout</span> <span class="s">600s</span><span class="p">;</span>
         <span class="kn">send_timeout</span> <span class="s">600s</span><span class="p">;</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="conclusion">Conclusion</h3>

<p>This project showcases a robust architecture for an AI-powered story bot application, utilizing modern web development practices and tools. The backend is built with Flask, ensuring efficient request handling and integration with various services for logging and monitoring. The frontend, built with React, provides an interactive user interface for managing story prompts. By leveraging AWS for deployment, Nginx for secure communication, and the ELK stack for log management, we ensure scalability, reliability, and maintainability. This comprehensive setup demonstrates the power of combining cutting-edge technologies to deliver a seamless user experience.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-en" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
