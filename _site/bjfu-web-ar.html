<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>تحليل نظام تسجيل الدخول بجامعة بكين للغابات</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>تحليل نظام تسجيل الدخول بجامعة بكين للغابات | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="تحليل نظام تسجيل الدخول بجامعة بكين للغابات" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="ar" />
<meta name="description" content="هذا المقال كان مكتوبًا بالأصل بالعربية ونُشرت على CSDN." />
<meta property="og:description" content="هذا المقال كان مكتوبًا بالأصل بالعربية ونُشرت على CSDN." />
<link rel="canonical" href="https://lzwjava.github.io/bjfu-web-ar" />
<meta property="og:url" content="https://lzwjava.github.io/bjfu-web-ar" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-01-09T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="تحليل نظام تسجيل الدخول بجامعة بكين للغابات" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2014-01-09T00:00:00+08:00","datePublished":"2014-01-09T00:00:00+08:00","description":"هذا المقال كان مكتوبًا بالأصل بالعربية ونُشرت على CSDN.","headline":"تحليل نظام تسجيل الدخول بجامعة بكين للغابات","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/bjfu-web-ar"},"url":"https://lzwjava.github.io/bjfu-web-ar"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=aaa5a1d86d232ad75c2494b30fddf619d77cee12">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=aaa5a1d86d232ad75c2494b30fddf619d77cee12" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       تحليل نظام تسجيل الدخول بجامعة بكين للغابات | أصلي، ترجم بواسطة AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/ar/2014-01-09-bjfu-web-ar.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsar2014-01-09-bjfu-web-ar.md</span> -->
      

      <!-- <span>2014-01-09-bjfu-web-ar.md</span> -->

      
        

        
          
          <a href="#" class="button">2014.01</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/bjfu-web-en" >English</option>
        <option value="/bjfu-web-zh" >中文</option>
        <option value="/bjfu-web-ja" >日本語</option>
        <option value="/bjfu-web-es" >Español</option>
        <option value="/bjfu-web-hi" >हिंदी</option>
        <option value="/bjfu-web-fr" >Français</option>
        <option value="/bjfu-web-de" >Deutsch</option>
        <option value="/bjfu-web-ar" selected>العربية</option>
        <option value="/bjfu-web-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>هذا المقال كان مكتوبًا بالأصل بالعربية ونُشرت على <a href="https://blog.csdn.net/lzw_java/article/details/18049581">CSDN</a>.</p>

<hr />

<p>يتناول هذا المقال عملية الهندسة العكسية للنظام الذي يستخدمه جامعة بكين للزراعة في تسجيل الدخول عبر الإنترنت.</p>

<p>الهدف هو تقليد عملية تسجيل الدخول بنظام برنامجي، مما يتيح لك تقليد أفعال المستخدم الذي يتصل بالشبكة من خلال متصفح ويب.</p>

<p>باستخدام أدوات تطوير Google Chrome، يمكننا مراقبة الطلبات الشبكية التي يتم إرسالها خلال عملية تسجيل الدخول.</p>

<p>الطلب الأول هو إلى <code class="language-plaintext highlighter-rouge">CheckLogin.jsp</code>، يليه طلب إلى <code class="language-plaintext highlighter-rouge">index.jsp</code> الذي يتم إبداله بناءً على <code class="language-plaintext highlighter-rouge">CheckLogin.jsp</code>.</p>

<p>دعونا ننظر إلى <code class="language-plaintext highlighter-rouge">CheckLogin.jsp</code> بشكل أقرب.</p>

<p>نرى أنه يستخدم طلب POST ويحتوي على عدة أزواج من المفتاح والقيمة. ولكن ما هو <code class="language-plaintext highlighter-rouge">action</code>؟ من خلال فحص “Form Data” في أدوات التطوير، يمكننا مشاهدتها المصدر:</p>

<p>لإيجاد القيمة الفعلية لـ <code class="language-plaintext highlighter-rouge">action</code> ، يمكننا فحص مصدر الصفحة:</p>

<p>قيمة <code class="language-plaintext highlighter-rouge">action</code> هي السطر الثاني.</p>

<p>ولكن كيف نحصل على عنوان IP؟ يمكن الوصول إلى نظام تسجيل الدخول من أي مكان في الحرم الجامعي، سواء كانت عبر Wi-Fi أو اتصال باسلكي في غرفة نوم. عنوان IP هو ديناميكي. كيف يمكننا الحصول عليه بشكل تلقائي؟</p>

<p>تذكر الصورة الأولى؟</p>

<p>توفر الصفحة الويب عنوان IP تلقائيًا. يعرف النظام تسجيل الدخول أي IP لا يمكن الوصول إليه. يمكننا استخراجها من الصفحة الويب.</p>

<p>يوفر Chrome أدواتًا مفيدة لإنشاء أجزاء محددة من كود الصفحة الويب بسرعة. وفيرفوكس يوجد ملحق مماثل يسمى Firebug.</p>

<p>على الرغم من أننا استخدمنا “أداة فحص العنصر” (أيقونة الميكروسكوب)، يمكننا النقر على عنوان IP على الصفحة.</p>

<p>سيعرض أدوات التطوير بنية HTML وتكشف أن عنوان IP هو داخل علامة <code class="language-plaintext highlighter-rouge">&lt;span&gt;</code> مع الفئة <code class="language-plaintext highlighter-rouge">login_txt</code>، تحديدًا داخل محتوا النص.</p>

<p>يمكن أن يجد وظيفة <code class="language-plaintext highlighter-rouge">select</code> في Jsoup العناصر التي تتطابق مع استعلام CSS، ويمثل <code class="language-plaintext highlighter-rouge">first()</code> العنصر الأول المطابق.</p>

<p>مع جميع أزواج المفتاح والقيمة، يمكننا الآن تقليد عملية تسجيل الدخول.</p>

<p>envie من POST يرسل أزواج المفتاح والقيمة في جسم الطلب. يوقف <code class="language-plaintext highlighter-rouge">post.abort()</code> الطلب. ذلك لأننا سنستخدم <code class="language-plaintext highlighter-rouge">httpClient</code> مرة أخرى في طلبات لاحقة. تفضل فئات <code class="language-plaintext highlighter-rouge">org.apache.http</code> إعادة استخدام اتصال HTTP قدر الإمكان. إذا لم يتم إنهاء الطلب، يمكن أن يسبب إرسال طلب آخر باستخدام نفس الاتصال استثناء.</p>

<p>لماذا نريد إعادة استخدام <code class="language-plaintext highlighter-rouge">httpClient</code>؟ سأشرح ذلك لاحقًا.</p>

<p>إرسال إلى <code class="language-plaintext highlighter-rouge">checkLogin.jsp</code> غير كافٍ للرابطة بالشبكة. هذه الصفحة JSP فقط تحقق من صحة اسم المستخدم وكلمة المرور.</p>

<p>من خلال إضافة بيان طباعة، يمكننا رؤية الرمز الرد.</p>

<p>يرمز 200 إلى تسجيل دخول ناجح، يرمز 303 إلى بيانات اعتماد خاطئة، و404 إلى خطأ في التوصيل.</p>

<p>الصفحة JSP الثانية التي يتم تنفيذها هي <code class="language-plaintext highlighter-rouge">index.jsp</code>، وهي طلب GET.</p>

<p>بعد ذلك، لا يمكننا بلوغ الشبكة. علينا تقليد طلب إلى <code class="language-plaintext highlighter-rouge">connect_action.jsp</code>، الذي يتطلب مبرر <code class="language-plaintext highlighter-rouge">userid</code> (مثل <code class="language-plaintext highlighter-rouge">userid=88888</code>) الذي يتوافق مع رقم طالب. لاحظت أن <code class="language-plaintext highlighter-rouge">userid</code> للطالب الذي لديه الرقم السابق هو أقل من 1 من الرقم. كيف يمكننا الحصول على هذه القيمة؟</p>

<p>لحسن الحظ، تذكرت أننا استخرجنا عنوان IP من الصفحة الويب. هل يمكننا القيام بنفس الشيء مع <code class="language-plaintext highlighter-rouge">userid</code>؟</p>

<p>هذه الصورة من الصفحة المنقطعة، ولكن نفس اللوجيك 적용 على <code class="language-plaintext highlighter-rouge">connect.jsp</code>. يحتوي مصدر الصفحة الذي يُرجعه JSP الثاني على زوج المفتاح والقيمة المطلوبين لصفحة JSP التالية التي يجب علينا إرسالها.</p>

<p>في هذه الحالة، نعتمد على تعبيرًا معياريًا. <code class="language-plaintext highlighter-rouge">group(0)</code> هو التطابق الكامل (مثل <code class="language-plaintext highlighter-rouge">userid=88888</code>)، <code class="language-plaintext highlighter-rouge">group(1)</code> هو المحتوى داخل الأقواس (مثل <code class="language-plaintext highlighter-rouge">88888</code>). <code class="language-plaintext highlighter-rouge">\d</code> تطابق أي رقم، و <code class="language-plaintext highlighter-rouge">+</code> يعني حدوث مرة واحدة أو أكثر. <code class="language-plaintext highlighter-rouge">find()</code> يحدد ما إذا كان التعبير يتطابق مع أي جزء من السلسلة بينما <code class="language-plaintext highlighter-rouge">matches()</code> يحدد ما إذا كان التعبير يتطابق مع السلسلة بأكملها. إذا كان <code class="language-plaintext highlighter-rouge">src</code> مثل <code class="language-plaintext highlighter-rouge">&lt;frame userid=88888&amp;ip="</code>، فإن <code class="language-plaintext highlighter-rouge">matches()</code> سيرجع <code class="language-plaintext highlighter-rouge">false</code> لأن التعبير المعتاد لا يتطابق مع السلسلة بأكملها.</p>

<p>هذا هو الكود Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.NameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.HttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.entity.UrlEncodedFormEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.utils.URLEncodedUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.cookie.Cookie</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.AbstractHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.DefaultHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.message.BasicNameValuePair</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.protocol.HTTP</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.Jsoup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.nodes.Element</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jsoup.select.Elements</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Login</span><span class="o">{</span>

	<span class="kd">static</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(</span><span class="nc">String</span> <span class="n">format</span><span class="o">,</span> <span class="nc">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">format</span><span class="o">,</span> <span class="n">args</span><span class="o">));</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DefaultHttpClient</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">ip</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">userId</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">username</span><span class="o">=</span><span class="s">"130888888"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"88888888"</span><span class="o">;</span>

		<span class="n">ip</span><span class="o">=</span><span class="n">cssQueryFirstText</span><span class="o">(</span><span class="s">"http://login.bjfu.edu.cn/index.jsp"</span><span class="o">,</span><span class="s">"span.login_txt"</span><span class="o">);</span>

		<span class="n">doPost</span><span class="o">(</span><span class="n">httpClient</span><span class="o">,</span><span class="s">"http://login.bjfu.edu.cn/checkLogin.jsp"</span><span class="o">,</span>
				<span class="s">"username"</span><span class="o">,</span><span class="n">username</span><span class="o">,</span><span class="s">"password"</span><span class="o">,</span><span class="n">password</span><span class="o">,</span>
				<span class="s">"ip"</span><span class="o">,</span><span class="n">ip</span><span class="o">,</span><span class="s">"action"</span><span class="o">,</span><span class="s">"checkLogin.jsp"</span><span class="o">);</span>
		<span class="nc">String</span> <span class="n">content</span><span class="o">=</span><span class="n">doGet</span><span class="o">(</span><span class="n">httpClient</span><span class="o">,</span><span class="s">"http://login.bjfu.edu.cn/user/index.jsp"</span><span class="o">,</span>
		  <span class="s">"ip"</span><span class="o">,</span><span class="n">ip</span><span class="o">,</span><span class="s">"action"</span><span class="o">,</span><span class="s">"connect"</span><span class="o">);</span>
		<span class="n">userId</span><span class="o">=</span><span class="n">userId</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
		<span class="n">doGet</span><span class="o">(</span><span class="n">httpClient</span><span class="o">,</span><span class="s">"http://login.bjfu.edu.cn/user/network/connect_action.jsp"</span><span class="o">,</span>
			<span class="s">"userid"</span><span class="o">,</span><span class="n">userId</span><span class="o">,</span><span class="s">"ip"</span><span class="o">,</span><span class="n">ip</span><span class="o">,</span><span class="s">"type"</span><span class="o">,</span><span class="s">"2"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">userId</span><span class="o">(</span><span class="nc">String</span> <span class="n">html</span><span class="o">){</span>
		<span class="nc">Document</span> <span class="n">doc</span><span class="o">=</span><span class="nc">Jsoup</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">html</span><span class="o">);</span>
		<span class="nc">Element</span> <span class="n">elem</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"frame#main"</span><span class="o">).</span><span class="na">first</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">src</span><span class="o">=</span><span class="n">elem</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"src"</span><span class="o">);</span>
		<span class="nc">Pattern</span> <span class="n">pattern</span><span class="o">=</span><span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"userid=(\\d+)"</span><span class="o">);</span>
		<span class="nc">Matcher</span> <span class="n">matcher</span><span class="o">=</span><span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
		<span class="nc">String</span> <span class="n">ans</span><span class="o">=</span><span class="s">""</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">matcher</span><span class="o">.</span><span class="na">find</span><span class="o">()){</span>
		  <span class="n">ans</span><span class="o">=</span><span class="n">matcher</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">cssQueryFirstText</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span><span class="nc">String</span> <span class="n">cssQuery</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">ip</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">Document</span> <span class="n">doc</span><span class="o">=</span><span class="nc">Jsoup</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
			<span class="nc">Elements</span> <span class="n">elems</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">cssQuery</span><span class="o">);</span>
			<span class="nc">Element</span> <span class="n">elem</span><span class="o">=</span><span class="n">elems</span><span class="o">.</span><span class="na">first</span><span class="o">();</span>
			<span class="n">ip</span><span class="o">=</span><span class="n">elem</span><span class="o">.</span><span class="na">text</span><span class="o">();</span>
		<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpClient</span> <span class="n">httpClient</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">entityContent</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">url</span> <span class="o">=</span> <span class="n">makeGetSrl</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">pairs</span><span class="o">);</span>
			<span class="nc">HttpGet</span> <span class="n">get</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpGet</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
			<span class="nc">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">get</span><span class="o">);</span>
			<span class="c1">//print("%d", response.getStatusLine().getStatusCode());</span>
			<span class="n">entityContent</span> <span class="o">=</span> <span class="n">entity</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
			<span class="nc">EntityUtils</span><span class="o">.</span><span class="na">consume</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">());</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">entityContent</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="kt">void</span> <span class="nf">printEntity</span><span class="o">(</span><span class="nc">HttpResponse</span> <span class="n">rp</span><span class="o">){</span>
		<span class="n">print</span><span class="o">(</span><span class="s">"%s"</span><span class="o">,</span><span class="n">entity</span><span class="o">(</span><span class="n">rp</span><span class="o">));</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">entity</span><span class="o">(</span><span class="nc">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span>
						<span class="n">entity</span><span class="o">.</span><span class="na">getContent</span><span class="o">()));</span>
				<span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
				<span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">makeGetSrl</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span><span class="nc">String</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span><span class="o">(!</span><span class="n">url</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"?"</span><span class="o">)){</span>
			<span class="n">url</span><span class="o">+=</span><span class="s">"?"</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;</span><span class="n">params</span><span class="o">=</span><span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;();</span>
		<span class="kt">int</span> <span class="n">len</span><span class="o">=</span><span class="n">pairs</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span><span class="n">i</span><span class="o">++){</span>
			<span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">BasicNameValuePair</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">],</span><span class="n">pairs</span><span class="o">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">]));</span>
		<span class="o">}</span>
		<span class="nc">String</span> <span class="n">paramsStr</span><span class="o">=</span><span class="nc">URLEncodedUtils</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">params</span><span class="o">,</span><span class="s">"utf-8"</span><span class="o">);</span>
		<span class="n">url</span><span class="o">+=</span><span class="n">paramsStr</span><span class="o">;</span>
		<span class="k">return</span> <span class="n">url</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">static</span> <span class="nc">String</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpClient</span> <span class="n">httpClient</span><span class="o">,</span> <span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">pairs</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">String</span> <span class="n">entityContent</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">HttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpPost</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
			<span class="nc">List</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">NameValuePair</span><span class="o">&gt;();</span>
			<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pairs</span><span class="o">.</span><span class="na">length</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
				<span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">BasicNameValuePair</span><span class="o">(</span><span class="n">pairs</span><span class="o">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="o">],</span> <span class="n">pairs</span><span class="o">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]));</span>
			<span class="o">}</span>
			<span class="n">post</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="k">new</span> <span class="nc">UrlEncodedFormEntity</span><span class="o">(</span><span class="n">params</span><span class="o">,</span> <span class="no">HTTP</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
			<span class="nc">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">httpClient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
			<span class="n">entityContent</span> <span class="o">=</span> <span class="n">entity</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
			<span class="c1">//print("%d", response.getStatusLine().getStatusCode());</span>
			<span class="n">post</span><span class="o">.</span><span class="na">abort</span><span class="o">();</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">entityContent</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getCookies</span><span class="o">(</span><span class="nc">HttpClient</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cookie</span><span class="o">&gt;</span> <span class="n">cookies</span> <span class="o">=</span> <span class="o">((</span><span class="nc">AbstractHttpClient</span><span class="o">)</span>
        		<span class="n">client</span><span class="o">).</span><span class="na">getCookieStore</span><span class="o">().</span><span class="na">getCookies</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Cookie</span> <span class="nl">cookie:</span> <span class="n">cookies</span><span class="o">)</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cookie</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"="</span> <span class="o">+</span> <span class="n">cookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">";"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>يوجد الكود الكامل على GitHub. لاحظ أنه قد لا يمكنك تشغيله دون حساب صالح لشبكة الجامعة.</p>

<p>سبب إعادة استخدام نفس <code class="language-plaintext highlighter-rouge">HttpClient</code> هو أنه يوفر تخزين الطعنات تلقائيًا. تستخدم صفحات JSP الطعنات لتحديد ما إذا كان الطلبات من نفس الجلسة. هذا هو السبب في أن نسخ رابط من Taobao إلى متصفح آخر قد يؤدي إلى خطأ في الوقت.</p>

<p><code class="language-plaintext highlighter-rouge">jsoup</code> وعبارات معيارية هي أدوات مفيدة جدًا. توجد أدوات على الإنترنت لتمارين عبارات معيارية. استمتع باستخدامها!</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-ar" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
