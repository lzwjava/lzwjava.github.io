<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>mathjax2mobi: تحويل MathJax HTML إلى كتب إلكترونية</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>mathjax2mobi: تحويل MathJax HTML إلى كتب إلكترونية | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="mathjax2mobi: تحويل MathJax HTML إلى كتب إلكترونية" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="ar" />
<meta name="description" content="نظرة عامة على المشروع" />
<meta property="og:description" content="نظرة عامة على المشروع" />
<link rel="canonical" href="https://lzwjava.github.io/feynman-ar" />
<meta property="og:url" content="https://lzwjava.github.io/feynman-ar" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="mathjax2mobi: تحويل MathJax HTML إلى كتب إلكترونية" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2021-03-15T00:00:00+08:00","datePublished":"2021-03-15T00:00:00+08:00","description":"نظرة عامة على المشروع","headline":"mathjax2mobi: تحويل MathJax HTML إلى كتب إلكترونية","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/feynman-ar"},"url":"https://lzwjava.github.io/feynman-ar"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=39970ad55eeefbde2205b9b7393fa3714b68d045">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=39970ad55eeefbde2205b9b7393fa3714b68d045" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       mathjax2mobi: تحويل MathJax HTML إلى كتب إلكترونية | أصلي، ترجم بواسطة AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/ar/2021-03-15-feynman-ar.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsar2021-03-15-feynman-ar.md</span> -->
      

      <!-- <span>2021-03-15-feynman-ar.md</span> -->

      
        

        
          
          <a href="#" class="button">2021.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/feynman-en" >English</option>
        <option value="/feynman-zh" >中文</option>
        <option value="/feynman-ja" >日本語</option>
        <option value="/feynman-es" >Español</option>
        <option value="/feynman-hi" >हिंदी</option>
        <option value="/feynman-fr" >Français</option>
        <option value="/feynman-de" >Deutsch</option>
        <option value="/feynman-ar" selected>العربية</option>
        <option value="/feynman-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <h3 id="نظرة-عامة-على-المشروع">نظرة عامة على المشروع</h3>

<p>دعونا أولاً نلقي نظرة عامة على حالة المشروع.</p>

<p><img src="assets/images/feynman/feynman_online.jpg" alt="فاينمان_أونلاين" /></p>

<p><img src="/assets/images/feynman/change.JPG" alt="التغيير" style="zoom:50%;" /></p>

<p><img src="assets/images/feynman/latex.JPG" alt="لَاتِكْس" /></p>

<p><img src="assets/images/feynman/epub_black.JPG" alt="epub_black" /></p>

<p><img src="assets/images/feynman/epub_beautiful.JPG" alt="epub_beautiful" /></p>

<p>بعد الانتهاء من المشروع، شعرت ببعض السعادة. كتبت هذه الجملة.</p>

<p>كتبت الكود طوال اليوم، وأخيرًا حصلت على كتاب إلكتروني جميل لمحاضرات فيزياء فاينمان! محاضرات فيزياء فاينمان متاحة على الإنترنت، وهي مكتوبة باستخدام <code class="language-plaintext highlighter-rouge">latex</code> الذي يتميز بعرض رائع للمعادلات الرياضية. وعندما يتم نشرها على الإنترنت، يتم استخدام مكتبة <code class="language-plaintext highlighter-rouge">mathjax</code> لتحويل كود <code class="language-plaintext highlighter-rouge">latex</code> إلى كود <code class="language-plaintext highlighter-rouge">html</code>، مما ينتج عنه الكثير من علامات <code class="language-plaintext highlighter-rouge">div</code> و <code class="language-plaintext highlighter-rouge">span</code>. لكن الكتب الإلكترونية لا تدعم هذه الطريقة. لذا، كانت الفكرة هي استخراج صفحات الويب، وعكس عملية عرض <code class="language-plaintext highlighter-rouge">mathjax</code>، ثم استبدالها بصور <code class="language-plaintext highlighter-rouge">svg</code>. واجهت العديد من المشاكل، أولها أن الكود يحتوي على الكثير من وحدات <code class="language-plaintext highlighter-rouge">latex</code> المخصصة التي يجب إضافتها؛ وثانيًا، أن تضمين الكثير من صور <code class="language-plaintext highlighter-rouge">svg</code> يسبب مشاكل. إذا كانت الصورة واحدة فلا مشكلة، ولكن عند وجود الكثير منها تظهر مشاكل. ربما يكون هذا بسبب بعض الأخطاء الغريبة في المتصفحات و <code class="language-plaintext highlighter-rouge">svg</code>. الحل كان ببساطة حفظ <code class="language-plaintext highlighter-rouge">svg</code> كملفات واستخدام علامة <code class="language-plaintext highlighter-rouge">img</code> لإدراجها. المعادلات أيضًا تنقسم إلى نوعين: معادلات داخل النص ومعادلات منفردة في سطر خاص. وهكذا، حصلت أخيرًا على كتاب إلكتروني جميل!</p>

<h3 id="البيانات-التي-تم-البحث-عنها">البيانات التي تم البحث عنها</h3>

<p>هنا يتم تسجيل المواد التي تم الوصول إليها أثناء حل المشروع. نظرًا لأن هذا برنامج تعليمي، فسأعرض للطلاب تجربة كيفية تنفيذ مشروع بشكل عام.</p>

<p><img src="assets/images/feynman/s1.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s2.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s3.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s4.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s5.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s6.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s7.PNG" alt="" /></p>

<p><img src="assets/images/feynman/s8.PNG" alt="" /></p>

<h3 id="بدء-المشروع">بدء المشروع</h3>

<p>محاضرات فينمان في الفيزياء أصبحت متاحة للقراءة على الإنترنت. أرغب في قراءتها على جهاز <code class="language-plaintext highlighter-rouge">Kindle</code>. ومع ذلك، نظرًا لاحتوائها على العديد من الصيغ الرياضية، فإن المسودة الأصلية ربما تم إعدادها باستخدام <code class="language-plaintext highlighter-rouge">latex</code>. يتم استخدام مكتبة <code class="language-plaintext highlighter-rouge">mathjax</code> لعرض محتوى بتنسيق <code class="language-plaintext highlighter-rouge">latex</code> على صفحات الويب.</p>

<p>لنأخذ مثالًا.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax_Preview"</span> <span class="na">style=</span><span class="s">"color: inherit; display: none;"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"MathJax_Display"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax MathJax_FullWidth"</span> <span class="na">id=</span><span class="s">"MathJax-Element-10-Frame"</span> <span class="na">tabindex=</span><span class="s">"0"</span> <span class="na">style=</span><span class="s">""</span><span class="nt">&gt;</span>
              <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"mi"</span> <span class="na">id=</span><span class="s">"MathJax-Span-159"</span> <span class="na">style=</span><span class="s">"font-family: MathJax_Math-italic;"</span><span class="nt">&gt;</span>d<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/span&gt;</span>  
    <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"math/tex; mode=display"</span> <span class="na">id=</span><span class="s">"MathJax-Element-10"</span><span class="nt">&gt;</span><span class="err">\</span><span class="nx">begin</span><span class="p">{</span><span class="nx">equation</span><span class="p">}</span>
<span class="err">\</span><span class="nx">label</span><span class="p">{</span><span class="nl">Eq</span><span class="p">:</span><span class="nl">I</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="nx">dT</span><span class="o">/</span><span class="nx">dt</span> <span class="o">=</span> <span class="nx">Fv</span><span class="p">.</span>
<span class="err">\</span><span class="nx">end</span><span class="p">{</span><span class="nx">equation</span><span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>في الأعلى مقتطف من كود <code class="language-plaintext highlighter-rouge">html</code>. في هذا الجزء من كود <code class="language-plaintext highlighter-rouge">html</code>، يوجد نص <code class="language-plaintext highlighter-rouge">latex</code> كما هو تحت علامة <code class="language-plaintext highlighter-rouge">script</code>. يقوم <code class="language-plaintext highlighter-rouge">mathjax</code> بتحويله إلى العديد من علامات <code class="language-plaintext highlighter-rouge">span</code> لعرضه.</p>

<p>لدينا الآن فكرة. وهي تغيير طريقة عرض <code class="language-plaintext highlighter-rouge">mathjax</code> إلى صور <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<p>وجدت مشروعًا على GitHub باسم <code class="language-plaintext highlighter-rouge">tuxu/latex2svg</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">latex2svg</span> <span class="kn">import</span> <span class="n">latex2svg</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="sa">r</span><span class="s">'\( e^{i \pi} + 1 = 0 \)'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'depth'</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
</code></pre></div></div>

<p>حاولت التشغيل، لكن حدث خطأ.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    raise RuntimeError<span class="o">(</span><span class="s1">'latex not found'</span><span class="o">)</span>
RuntimeError: latex not found
</code></pre></div></div>

<p>انظر إلى الكود.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># تشغيل LaTeX وإنشاء ملف DVI
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'latex_cmd'</span><span class="p">]</span><span class="o">+</span><span class="s">' code.tex'</span><span class="p">),</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">check_returncode</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'latex غير موجود'</span><span class="p">)</span>
</code></pre></div></div>

<p>يبدو أن هذا يعتمد أيضًا على أمر <code class="language-plaintext highlighter-rouge">latex</code>.</p>

<p>قم بالتثبيت.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install</span> <span class="nt">--cask</span> mactex
<span class="o">==&gt;</span> ملاحظات
يجب عليك إعادة تشغيل نافذة الطرفية الخاصة بك حتى يتم تفعيل تثبيت أدوات MacTex CLI.
بدلاً من ذلك، يمكن لمستخدمي Bash و Zsh تشغيل الأمر:
  <span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>/usr/libexec/path_helper<span class="si">)</span><span class="s2">"</span>
<span class="o">==&gt;</span> جاري التحميل http://mirror.ctan.org/systems/mac/mactex/mactex-20200407.pkg
<span class="o">==&gt;</span> جاري التحميل من https://mirrors.aliyun.com/CTAN/systems/mac/mactex/mactex-20200407.pkg
<span class="c">######################################################################## 100.0%</span>
تم تلبية جميع تبعيات الصيغة.
<span class="o">==&gt;</span> جاري تثبيت Cask mactex
<span class="o">==&gt;</span> جاري تشغيل المثبت لـ mactex؛ قد يلزم إدخال كلمة المرور الخاصة بك.
installer: اسم الحزمة هو MacTeX
installer: تم تطبيق ملف تغييرات الاختيارات <span class="s1">'/private/tmp/choices20210315-4643-5884ro.xml'</span>
installer: جاري التثبيت في المسار الأساسي /
installer: تم التثبيت بنجاح.
🍺  تم تثبيت mactex بنجاح!
</code></pre></div></div>

<p>تم التثبيت بنجاح.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% latex
هذا هو pdfTeX، الإصدار 3.14159265-2.6-1.40.21 <span class="o">(</span>TeX Live 2020<span class="o">)</span> <span class="o">(</span>تنسيق مسبق التحميل<span class="o">=</span>latex<span class="o">)</span>
 تم تمكين <span class="se">\w</span>rite18 المقيد.
<span class="k">**</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="sa">r</span><span class="s">'\( e^{i \pi} + 1 = 0 \)'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'depth'</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
</code></pre></div></div>

<p>في الكود أعلاه، يتم استخدام الدالة <code class="language-plaintext highlighter-rouge">latex2svg</code> لتحويل التعبير الرياضي ( e^{i \pi} + 1 = 0 ) إلى صيغة SVG. بعد ذلك، يتم طباعة عمق الصورة (<code class="language-plaintext highlighter-rouge">depth</code>) ورمز SVG الناتج (<code class="language-plaintext highlighter-rouge">svg</code>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">svg</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'1.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">svg</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
<span class="n">svg</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>يمكن الآن إنشاء ملفات <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<p>لذا، جرب إنشاء نص <code class="language-plaintext highlighter-rouge">latex</code> الذي تحصل عليه من <code class="language-plaintext highlighter-rouge">mathjax</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">latex2svg</span> <span class="kn">import</span> <span class="n">latex2svg</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html'</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
<span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
</code></pre></div></div>

<p>للأسف حدث خطأ.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">raise</span> <span class="n">CalledProcessError</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">returncode</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">stdout</span><span class="p">,</span>
<span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span><span class="p">:</span> <span class="n">الأمر</span> <span class="s">'['</span><span class="n">latex</span><span class="s">', '</span><span class="o">-</span><span class="n">interaction</span><span class="s">', '</span><span class="n">nonstopmode</span><span class="s">', '</span><span class="o">-</span><span class="n">halt</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">error</span><span class="s">', '</span><span class="n">code</span><span class="p">.</span><span class="n">tex</span><span class="s">']'</span> <span class="n">أعاد</span> <span class="n">حالة</span> <span class="n">خروج</span> <span class="n">غير</span> <span class="n">صفرية</span> <span class="mf">1.</span>
</code></pre></div></div>

<p>أي صيغة محددة كانت خاطئة؟</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2
</code></pre></div></div>

<h2 id="لاتيكس">لاتيكس</h2>

<p>لاتيكس (LaTeX) هو نظام لإعداد المستندات عالية الجودة، يستخدم بشكل شائع في الأوساط الأكاديمية والعلمية لإنتاج أوراق بحثية وكتب وعروض تقديمية. يتميز لاتيكس بقدرته على التعامل مع المعادلات الرياضية المعقدة والرموز العلمية بسهولة، مما يجعله الخيار المفضل للعديد من الباحثين والطلاب.</p>

<h3 id="مثال-بسيط-في-لاتيكس">مثال بسيط في لاتيكس</h3>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[utf8]</span><span class="p">{</span>inputenc<span class="p">}</span>

<span class="k">\title</span><span class="p">{</span>عنوان المستند<span class="p">}</span>
<span class="k">\author</span><span class="p">{</span>اسم المؤلف<span class="p">}</span>
<span class="k">\date</span><span class="p">{</span><span class="k">\today</span><span class="p">}</span>

<span class="nt">\begin{document}</span>

<span class="k">\maketitle</span>

<span class="k">\section</span><span class="p">{</span>مقدمة<span class="p">}</span>
هذا مثال بسيط لمستند لاتيكس. يمكنك كتابة النصوص وإضافة المعادلات الرياضية بسهولة.

<span class="k">\section</span><span class="p">{</span>معادلة رياضية<span class="p">}</span>
هنا معادلة رياضية بسيطة:

<span class="p">\[</span><span class="nb">
E </span><span class="o">=</span><span class="nb"> mc</span><span class="p">^</span><span class="m">2</span><span class="nb">
</span><span class="p">\]</span>

<span class="nt">\end{document}</span>
</code></pre></div></div>

<p>في هذا المثال، يتم إنشاء مستند بسيط يحتوي على عنوان ومقدمة ومعادلة رياضية. يمكنك تعديل النصوص وإضافة المزيد من الأقسام حسب الحاجة.</p>

<p>لنتعلم <code class="language-plaintext highlighter-rouge">latex</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt]</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>lingmacros<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>tree-dvips<span class="p">}</span>
<span class="nt">\begin{document}</span>
</code></pre></div></div>

<p>\section*{ملاحظات حول ورقة البحث الخاصة بي}</p>

<p>لا تنسَ تضمين أمثلة على التخصيص الموضعي.<br />
تبدو هكذا:</p>

<p>{\small
\enumsentence{التركيز من خلال الموضوع الجملة:<br />
\shortex{7}{a John$_i$ [a &amp; kltukl &amp; [el &amp; 
  {\bf l-}oltoir &amp; er &amp; ngii$_i$ &amp; a Mary]]}
{ &amp; {\bf R-}clear &amp; {\sc comp} &amp; 
  {\bf IR}.{\sc 3s}-love   &amp; P &amp; him &amp; }
{جون، (من) الواضح أن ماري تحبه.}}
}</p>

<p>\subsection*{كيفية التعامل مع التوبيكالايزيشن (التركيز على موضوع الجملة)}</p>

<p>سأفترض ببساطة بنية شجرة مثل (\ex{1}).</p>

<p>{\small
\enumsentence{هيكل إسقاطات A$’$:\ [2ex]
\begin{tabular}[t]{cccc}
    &amp; \node{i}{CP}\ [2ex]
    \node{ii}{Spec} &amp;   &amp;\node{iii}{C$’$}\ [2ex]
        &amp;\node{iv}{C} &amp; &amp; \node{v}{SAgrP}
\end{tabular}
\nodeconnect{i}{ii}
\nodeconnect{i}{iii}
\nodeconnect{iii}{iv}
\nodeconnect{iii}{v}
}
}</p>

<p>\subsection*{المزاج}</p>

<p>يتغير المزاج عندما يكون هناك موضوع، وكذلك عندما يكون هناك حركة WH. \emph{Irrealis} هو المزاج عندما يكون هناك موضوع غير فاعل أو عبارة WH في Comp. \emph{Realis} هو المزاج عندما يكون هناك موضوع فاعل أو عبارة WH.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\end{document}</span>
</code></pre></div></div>

<p>عثرت على نموذج لشفرة <code class="language-plaintext highlighter-rouge">latex</code> على الإنترنت.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% latex code.tex
This is pdfTeX, Version 3.14159265-2.6-1.40.21 <span class="o">(</span>TeX Live 2020<span class="o">)</span> <span class="o">(</span>preloaded <span class="nv">format</span><span class="o">=</span>latex<span class="o">)</span>
 restricted <span class="se">\w</span>rite18 enabled.
entering extended mode
<span class="o">(</span>./code.tex
LaTeX2e &lt;2020-02-02&gt; patch level 5
L3 programming layer &lt;2020-03-06&gt;
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/base/article.cls
Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/base/size12.clo<span class="o">))</span>
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/lingmacros.sty<span class="o">)</span>
<span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/tree-dvips/tree-dvips.sty
tree-dvips version .91 of May 16, 1995
<span class="o">)</span> <span class="o">(</span>/usr/local/texlive/2020/texmf-dist/tex/latex/l3backend/l3backend-dvips.def<span class="o">)</span>
<span class="o">(</span>./code.aux<span class="o">)</span> <span class="o">[</span>1] <span class="o">(</span>./code.aux<span class="o">)</span> <span class="o">)</span>
Output written on code.dvi <span class="o">(</span>1 page, 3416 bytes<span class="o">)</span><span class="nb">.</span>
Transcript written on code.log.
</code></pre></div></div>

<p><img src="assets/images/feynman/latex.png" alt="latex" /></p>

<p>لنلقِ نظرة على الكود المصدري والنتيجة المقدمة بعد التصيير، لنرى ما يمكننا تعلمه.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<p>هكذا يتم تغليف المستند.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\section*</span><span class="p">{</span>ملاحظات لورقتي البحثية<span class="p">}</span>
</code></pre></div></div>

<p>هذا يشير إلى بداية عنوان <code class="language-plaintext highlighter-rouge">section</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\subsection*</span><span class="p">{</span>كيفية التعامل مع التوبيكاليزيشن (التركيز على الموضوع)<span class="p">}</span>
</code></pre></div></div>

<p>هذا يشير إلى العنوان الفرعي.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\shortex</span><span class="p">{</span>7<span class="p">}{</span>a John<span class="p">$_</span><span class="nb">i</span><span class="p">$</span> [a <span class="p">&amp;</span> kltukl <span class="p">&amp;</span> [el <span class="p">&amp;</span> 
  <span class="p">{</span><span class="k">\bf</span> l-<span class="p">}</span>oltoir <span class="p">&amp;</span> er <span class="p">&amp;</span> ngii<span class="p">$_</span><span class="nb">i</span><span class="p">$</span> <span class="p">&amp;</span> a Mary]]<span class="p">}</span>
</code></pre></div></div>

<p><img src="assets/images/feynman/shortex.png" alt="shortex" /></p>

<p>يمكن استخدام <code class="language-plaintext highlighter-rouge">$_i$</code> لتمثيل الحروف السفلية. واستخدام <code class="language-plaintext highlighter-rouge">{\bf l-}</code> لتمثيل النص الغامق.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\enumsentence</span><span class="p">{</span>هيكل إسقاطات A<span class="p">$</span><span class="nb">'</span><span class="p">$</span>:<span class="k">\\</span> [2ex]
<span class="nt">\begin{tabular}</span>[t]<span class="p">{</span>cccc<span class="p">}</span>
    <span class="p">&amp;</span> <span class="k">\node</span><span class="p">{</span>i<span class="p">}{</span>CP<span class="p">}</span><span class="k">\\</span> [2ex]
    <span class="k">\node</span><span class="p">{</span>ii<span class="p">}{</span>Spec<span class="p">}</span> <span class="p">&amp;</span>   <span class="p">&amp;</span><span class="k">\node</span><span class="p">{</span>iii<span class="p">}{</span>C<span class="p">$</span><span class="nb">'</span><span class="p">$}</span><span class="k">\\</span> [2ex]
        <span class="p">&amp;</span><span class="k">\node</span><span class="p">{</span>iv<span class="p">}{</span>C<span class="p">}</span> <span class="p">&amp;</span> <span class="p">&amp;</span> <span class="k">\node</span><span class="p">{</span>v<span class="p">}{</span>SAgrP<span class="p">}</span>
<span class="nt">\end{tabular}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>i<span class="p">}{</span>ii<span class="p">}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>i<span class="p">}{</span>iii<span class="p">}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>iii<span class="p">}{</span>iv<span class="p">}</span>
<span class="k">\nodeconnect</span><span class="p">{</span>iii<span class="p">}{</span>v<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/feynman/node.png" alt="node" style="zoom:50%;" /></p>

<p>لاحظ استخدام <code class="language-plaintext highlighter-rouge">nodeconnect</code> للإشارة إلى الاتصال بين العقد.</p>

<h3 id="تحويل-latex-إلى-svg">تحويل LaTeX إلى SVG</h3>

<p>لتحويل معادلات LaTeX إلى صور بتنسيق SVG، يمكنك استخدام أدوات مختلفة. فيما يلي بعض الطرق الشائعة:</p>

<h4 id="1-استخدام-mathjax-مع-svg-كتنسيق-إخراج">1. استخدام <code class="language-plaintext highlighter-rouge">MathJax</code> مع <code class="language-plaintext highlighter-rouge">svg</code> كتنسيق إخراج</h4>
<p>يمكنك استخدام <code class="language-plaintext highlighter-rouge">MathJax</code> لتحويل معادلات LaTeX إلى SVG مباشرة في المتصفح. إليك مثال بسيط:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://polyfill.io/v3/polyfill.min.js?features=es6"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"MathJax-script"</span> <span class="na">async</span> <span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p>ثم يمكنك كتابة معادلات LaTeX داخل عناصر <code class="language-plaintext highlighter-rouge">script</code> من نوع <code class="language-plaintext highlighter-rouge">math/tex</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"math/tex"</span><span class="nt">&gt;</span><span class="nx">E</span> <span class="o">=</span> <span class="nx">mc</span><span class="o">^</span><span class="mi">2</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h4 id="2-استخدام-latex-مع-dvisvgm">2. استخدام <code class="language-plaintext highlighter-rouge">LaTeX</code> مع <code class="language-plaintext highlighter-rouge">dvisvgm</code></h4>
<p>إذا كنت تريد تحويل ملفات LaTeX إلى SVG محليًا، يمكنك استخدام <code class="language-plaintext highlighter-rouge">dvisvgm</code>. أولاً، قم بتحويل ملف LaTeX إلى DVI باستخدام <code class="language-plaintext highlighter-rouge">latex</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>latex input.tex
</code></pre></div></div>

<p>ثم قم بتحويل ملف DVI إلى SVG باستخدام <code class="language-plaintext highlighter-rouge">dvisvgm</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dvisvgm input.dvi
</code></pre></div></div>

<h4 id="3-استخدام-pandoc-مع-mathjax">3. استخدام <code class="language-plaintext highlighter-rouge">pandoc</code> مع <code class="language-plaintext highlighter-rouge">MathJax</code></h4>
<p>يمكنك أيضًا استخدام <code class="language-plaintext highlighter-rouge">pandoc</code> لتحويل مستندات LaTeX إلى HTML مع معادلات SVG:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc input.tex <span class="nt">-o</span> output.html <span class="nt">--mathjax</span>
</code></pre></div></div>

<h4 id="4-استخدام-mathjax-node">4. استخدام <code class="language-plaintext highlighter-rouge">MathJax-Node</code></h4>
<p>إذا كنت تريد تحويل معادلات LaTeX إلى SVG برمجيًا باستخدام Node.js، يمكنك استخدام <code class="language-plaintext highlighter-rouge">mathjax-node</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>mathjax-node
</code></pre></div></div>

<p>ثم يمكنك استخدام الكود التالي لتحويل معادلة LaTeX إلى SVG:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mjAPI</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">mathjax-node</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">mjAPI</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
  <span class="na">MathJax</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">svg</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fontCache</span><span class="p">:</span> <span class="dl">'</span><span class="s1">global</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">mjAPI</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

<span class="nx">mjAPI</span><span class="p">.</span><span class="nx">typeset</span><span class="p">({</span>
  <span class="na">math</span><span class="p">:</span> <span class="dl">'</span><span class="s1">E = mc^2</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">format</span><span class="p">:</span> <span class="dl">'</span><span class="s1">TeX</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">svg</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">svg</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>هذه بعض الطرق الشائعة لتحويل معادلات LaTeX إلى SVG. يمكنك اختيار الطريقة التي تناسب احتياجاتك بناءً على البيئة التي تعمل فيها.</p>

<p>استمرار المشروع.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[16pt]</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="nt">\begin{document}</span>
</code></pre></div></div>

<p>[\tfrac{1}{2}mv^2]</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\end{document}</span>
</code></pre></div></div>

<p><img src="/assets/images/feynman/frac.png" alt="frac" style="zoom:50%;" /></p>

<p>هذا يمكن أن يتم عرضه بشكل صحيح. في الكود، قد لا يتم عرضه بشكل صحيح، ربما لأنه لم يتم إضافة <code class="language-plaintext highlighter-rouge">\usepackage{amsmath}</code>.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt,preview]</span><span class="p">{</span>standalone<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="na">[utf8x]</span><span class="p">{</span>inputenc<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsfonts<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amssymb<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>newtxtext<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[libertine]</span><span class="p">{</span>newtxmath<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\begin{preview}</span>
<span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2
<span class="nt">\end{preview}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">!</span> تم إدخال علامة <span class="nv">$ </span>مفقودة.
&lt;النص المُدخل&gt;
                <span class="err">$</span>
l.12 <span class="se">\t</span>frac<span class="o">{</span>1<span class="o">}{</span>2<span class="o">}</span>
                 <span class="nb">mv</span>^2
</code></pre></div></div>

<p>هذا خطأ. وبعد التعديل إلى ما يلي، سيعمل بشكل صحيح.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">\[</span><span class="nv">\tfrac</span><span class="p">{</span><span class="m">1</span><span class="p">}{</span><span class="m">2</span><span class="p">}</span><span class="nb">mv</span><span class="p">^</span><span class="m">2</span><span class="p">\]</span>
</code></pre></div></div>

<p>هذا التعبير الرياضي يمثل الطاقة الحركية لجسم ما، حيث:</p>
<ul>
  <li>( m ) هي كتلة الجسم.</li>
  <li>( v ) هي سرعة الجسم.</li>
  <li>(\tfrac{1}{2}mv^2) هي الطاقة الحركية للجسم.</li>
</ul>

<p>إجراء اختبارات مختلفة.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">latex2svg</span> <span class="kn">import</span> <span class="n">latex2svg</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13: Work and Potential Energy (A).html'</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
<span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="s">'$'</span> <span class="o">+</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span> <span class="o">+</span> <span class="s">'$'</span>
    <span class="c1"># إذا كانت 'frac' موجودة في النص الرياضي
</span>    <span class="c1"># wrap = '$' + mathjax.string + '$'
</span>    <span class="k">if</span> <span class="s">'FLP'</span> <span class="ow">in</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="s">'Fig'</span> <span class="ow">in</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">elif</span> <span class="s">'eps'</span> <span class="ow">in</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>
    <span class="c1"># طباعة الناتج
</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">],</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
    <span class="n">svg</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'svg'</span><span class="p">)</span>
    <span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
    <span class="c1"># طباعة SVG الناتج
</span>    <span class="c1"># break
</span>    <span class="c1"># mathjax.replaceWith(out['svg'])    
</span>    
    <span class="c1"># طباعة خصائص mathjax
</span>    <span class="c1"># break
</span>    
    <span class="c1"># out = latex2svg(wrap)    
</span>    <span class="c1"># طباعة SVG الناتج
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># طباعة عدد العناصر داخل soup
</span><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">contents</span><span class="p">))</span>

<span class="c1"># فتح ملف الإخراج للكتابة
</span><span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="c1"># كتابة المحتوى المنسق لـ soup في الملف
</span><span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
<span class="c1"># إغلاق الملف بعد الانتهاء من الكتابة
</span><span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># طباعة محتويات soup (معلّق)
# print(soup.contents)
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># out = latex2svg(r'\( e^{i \pi} + 1 = 0 \)')
# print(out['depth'])
# print(out['svg'])
</span></code></pre></div></div>

<p>في الكود أعلاه، يتم استخدام الدالة <code class="language-plaintext highlighter-rouge">latex2svg</code> لتحويل معادلة لاتيكس إلى صيغة SVG. يتم تمرير المعادلة ( e^{i \pi} + 1 = 0 ) كسلسلة نصية إلى الدالة. الناتج <code class="language-plaintext highlighter-rouge">out</code> هو قاموس يحتوي على معلومات حول الصورة الناتجة، بما في ذلك العمق (<code class="language-plaintext highlighter-rouge">depth</code>) والصيغة SVG (<code class="language-plaintext highlighter-rouge">svg</code>). يتم طباعة هذه القيم باستخدام <code class="language-plaintext highlighter-rouge">print</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># svg = open('1.svg', 'w')
# svg.write(out['svg'])
# svg.close()
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
أنا أختبر كل هذه الأشياء لأي سبب؟

```python
    if 'FLP' in mathjax.string:
        continue
    elif 'Fig' in mathjax.string:
        continue
    elif 'eps' in mathjax.string:
        continue
</code></pre></div></div>

<p>تم الاحتفاظ بالكود كما هو لأنه يحتوي على أسماء متغيرات وشروط منطقية لا تحتاج إلى ترجمة.</p>

<p>هنا عند التحليل إلى وجود <code class="language-plaintext highlighter-rouge">FLP</code> و<code class="language-plaintext highlighter-rouge">Fig</code> و<code class="language-plaintext highlighter-rouge">eps</code> في مصدر <code class="language-plaintext highlighter-rouge">latex</code>، حدث خطأ في عملية التحويل.</p>

<p>على سبيل المثال، في <code class="language-plaintext highlighter-rouge">HTML</code>، قد تجد نصًا برمجيًا مثل هذا:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"math/tex"</span> <span class="na">id=</span><span class="s">"MathJax-Element-11"</span><span class="nt">&gt;</span><span class="err">\</span><span class="nx">FLPF</span><span class="err">\</span><span class="nx">cdot</span><span class="err">\</span><span class="nx">FLPv</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>تحليل الحصول على:</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\FLPF\cdot\FLPv</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> النص الموجود في الكود هو رمز رياضي يستخدم في لغة LaTeX لتمثيل الضرب النقطي بين متجه القوة (\FLPF) ومتجه السرعة (\FLPv). لا يتم ترجمة الرموز الرياضية أو الأكواد البرمجية.</p>

<p>عندما حدث خطأ أثناء التحويل في الكود. أي أن <code class="language-plaintext highlighter-rouge">latex2svg.py</code> قد فشل. هنا يتم استخدام برنامج <code class="language-plaintext highlighter-rouge">latex</code> لإجراء التحويل.</p>

<div class="language-tex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>listings<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>xcolor<span class="p">}</span>

<span class="k">\definecolor</span><span class="p">{</span>codegreen<span class="p">}{</span>rgb<span class="p">}{</span>0,0.6,0<span class="p">}</span>
<span class="k">\definecolor</span><span class="p">{</span>codegray<span class="p">}{</span>rgb<span class="p">}{</span>0.5,0.5,0.5<span class="p">}</span>
<span class="k">\definecolor</span><span class="p">{</span>codepurple<span class="p">}{</span>rgb<span class="p">}{</span>0.58,0,0.82<span class="p">}</span>
<span class="k">\definecolor</span><span class="p">{</span>backcolour<span class="p">}{</span>rgb<span class="p">}{</span>0.95,0.95,0.92<span class="p">}</span>

<span class="k">\lstdefinestyle</span><span class="p">{</span>mystyle<span class="p">}{</span>
    backgroundcolor=<span class="k">\color</span><span class="p">{</span>backcolour<span class="p">}</span>,   
    commentstyle=<span class="k">\color</span><span class="p">{</span>codegreen<span class="p">}</span>,
    keywordstyle=<span class="k">\color</span><span class="p">{</span>magenta<span class="p">}</span>,
    numberstyle=<span class="k">\tiny\color</span><span class="p">{</span>codegray<span class="p">}</span>,
    stringstyle=<span class="k">\color</span><span class="p">{</span>codepurple<span class="p">}</span>,
    basicstyle=<span class="k">\ttfamily\footnotesize</span>,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
<span class="p">}</span>

<span class="k">\lstset</span><span class="p">{</span>style=mystyle<span class="p">}</span>

<span class="nt">\begin{document}</span>

<span class="nt">\begin{lstlisting}</span>[language=Python]
def hello<span class="p">_</span>world():
    print("Hello, world!")
<span class="nt">\end{lstlisting}</span>

<span class="nt">\end{document}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt,preview]</span><span class="p">{</span>standalone<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="na">[utf8x]</span><span class="p">{</span>inputenc<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsfonts<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amssymb<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>newtxtext<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[libertine]</span><span class="p">{</span>newtxmath<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\begin{preview}</span>
<span class="nt">\begin{equation}</span>
    <span class="k">\FLPF\cdot\FLPv</span>
<span class="nt">\end{equation}</span>
<span class="nt">\end{preview}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$latex</span> code.tex
<span class="o">!</span> تسلسل تحكم غير معروف.
l.13     <span class="se">\F</span>LPF
              <span class="se">\c</span>dot<span class="se">\F</span>LPv
؟
</code></pre></div></div>

<p>ما هي هذه المشكلة بالتحديد. لاحظت لاحقًا هذا الجزء من الكود في <code class="language-plaintext highlighter-rouge">html</code>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/x-mathjax-config;executed=true"</span><span class="nt">&gt;</span>
      <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
        <span class="na">TeX</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">Macros</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">FLPvec</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">boldsymbol{#1}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
            <span class="na">Figvec</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">mathbf{#1}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
            <span class="na">FLPC</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{C}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FLPF</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{F}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FLPa</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{a}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FLPb</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{b}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FLPr</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{r}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FLPs</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{s}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FLPv</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">FLPvec{v}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">ddt</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">frac{d#1}{d#2}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> 
            <span class="na">epsO</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">epsilon_0</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
            <span class="na">FigC</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="se">\\</span><span class="s2">Figvec{C}</span><span class="dl">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>هذا يعني أنه عند عرض الصفحة، تم تعيين وحدات الماكرو لـ <code class="language-plaintext highlighter-rouge">MathJax</code>. لذلك يجب علينا أيضًا إضافتها في كود تحويل <code class="language-plaintext highlighter-rouge">latex</code>. دعنا نضيفها.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[12pt,preview]</span><span class="p">{</span>standalone<span class="p">}</span>
</code></pre></div></div>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="na">[utf8x]</span><span class="p">{</span>inputenc<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsmath<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amsfonts<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>amssymb<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>newtxtext<span class="p">}</span>
<span class="k">\usepackage</span><span class="na">[libertine]</span><span class="p">{</span>newtxmath<span class="p">}</span>
</code></pre></div></div>

<p>\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
\begin{document}
\begin{preview}
\begin{equation}
    \FLPF\cdot\FLPv
\end{equation}
\end{preview}
\end{document}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
هذا صحيح.

![fv1](assets/images/feynman/fv1.png)

### تحليل الكود

لنلقِ نظرة على الكود النهائي.

```python
import subprocess
from bs4 import BeautifulSoup
from latex2svg import latex2svg
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
    <span class="n">previews</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="n">cls</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">preview</span> <span class="ow">in</span> <span class="n">previews</span><span class="p">:</span>
        <span class="n">preview</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>
        
<span class="k">def</span> <span class="nf">clean_script</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
    <span class="n">scripts</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scripts</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>    
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="s">'$'</span> <span class="o">+</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span> <span class="o">+</span> <span class="s">'$'</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'label'</span><span class="p">,</span> <span class="s">'tag'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrap</span>
 
<span class="k">def</span> <span class="nf">wrap_svg</span><span class="p">(</span><span class="n">svg</span><span class="p">,</span> <span class="n">equation</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="sa">f</span><span class="s">'&lt;div style="text-align:center;"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">div</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">svg</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'eq_'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'in_'</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>     
        <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">)</span>   
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>   
        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>      
            
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
        <span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div>

<p>ترجمة الكود أعلاه:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'eq_'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'in_'</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">mathjax</span> <span class="ow">in</span> <span class="n">mathjaxs</span><span class="p">:</span>     
        <span class="k">print</span><span class="p">(</span><span class="n">mathjax</span><span class="p">.</span><span class="n">string</span><span class="p">)</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">)</span>   
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>   
        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>      
            
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s">'svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s">'svg'</span><span class="p">])</span>
        <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
        <span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>
</code></pre></div></div>

<p>ملاحظة: الكود يبدو أنه يقوم بتحويل معادلات LaTeX إلى صور SVG وحفظها في ملفات، ثم إدراجها في مستند HTML باستخدام BeautifulSoup. الترجمة الحرفية للكود لا تغير من وظيفته، لذا تم ترك الكود كما هو مع شرح بسيط للوظيفة.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>    
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html'</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
    <span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'span'</span><span class="p">,</span> <span class="s">'MathJax'</span><span class="p">)</span>
    <span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'div'</span><span class="p">,</span> <span class="s">'MathJax_Display'</span><span class="p">)</span>
    <span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'span'</span><span class="p">,</span> <span class="s">'MathJax_Preview'</span><span class="p">)</span>
    
    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex; mode=display'</span><span class="p">})</span>   
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="n">clean_script</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
    
    <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>    
</code></pre></div></div>

<pre><code class="language-main()">
</code></pre>

<p>عندما نرغب في تحويل كتاب إلكتروني بالكامل، يمكننا أولاً تجربة صفحة واحدة.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'The Feynman Lectures on Physics Vol. I Ch. 13_ Work and Potential Energy (A).html'</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></div>

<p>هنا تم تنزيل صفحة واحدة.</p>

<p><code class="language-plaintext highlighter-rouge">MathJax</code> يُنشئ الكثير من عناصر <code class="language-plaintext highlighter-rouge">div</code> و <code class="language-plaintext highlighter-rouge">span</code>. على سبيل المثال، المعادلة <code class="language-plaintext highlighter-rouge">T+U=const</code> يتم إنشاؤها بواسطة MathJax بهذه الطريقة.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>T<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>+<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>U<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>=<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"MathJax"</span><span class="nt">&gt;</span>ثابت<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<p>هذه الأشياء مزعجة وقد تؤثر على نصنا. نظرًا لأن لدينا بالفعل <code class="language-plaintext highlighter-rouge">svg</code>، فلا نحتاج إلى هذه الأشياء.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
    <span class="n">previews</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="n">cls</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">preview</span> <span class="ow">in</span> <span class="n">previews</span><span class="p">:</span>
        <span class="n">preview</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></div>

<p>تمت ترجمة الكود إلى:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
    <span class="n">previews</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="n">cls</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">preview</span> <span class="ow">in</span> <span class="n">previews</span><span class="p">:</span>
        <span class="n">preview</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>
</code></pre></div></div>

<p>ملاحظة: الكود بقي كما هو لأنه مكتوب بلغة برمجة (Python) ولا يتم ترجمته.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'span'</span><span class="p">,</span> <span class="s">'MathJax'</span><span class="p">)</span>
<span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'div'</span><span class="p">,</span> <span class="s">'MathJax_Display'</span><span class="p">)</span>
<span class="n">clean_mathjax</span><span class="p">(</span><span class="n">soup</span><span class="p">,</span> <span class="s">'span'</span><span class="p">,</span> <span class="s">'MathJax_Preview'</span><span class="p">)</span>
</code></pre></div></div>

<p>قم بإزالتها جميعًا.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex'</span><span class="p">})</span>
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="n">mathjaxs</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">,</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'math/tex; mode=display'</span><span class="p">})</span>   
    <span class="n">to_svg</span><span class="p">(</span><span class="n">mathjaxs</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود أعلاه مكتوب بلغة Python ويستخدم مكتبة BeautifulSoup لاستخراج عناصر النصوص الرياضية من صفحة ويب وتحويلها إلى صيغة SVG. لا يحتاج الكود إلى ترجمة حيث أن الأوامر والمتغيرات مكتوبة بالإنجليزية وهي جزء من بناء الجملة البرمجية.</p>

<p>لاحظ أن هناك نوعين من <code class="language-plaintext highlighter-rouge">script</code> هنا.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code>m(dv/dt)=F
</code></pre></div></div>

<p><strong>ترجمة المعادلة:</strong></p>

<p>تُعبر المعادلة عن القانون الثاني لنيوتن للحركة، حيث:</p>
<ul>
  <li>( m ) هي كتلة الجسم.</li>
  <li>( \frac{dv}{dt} ) هي معدل تغير السرعة بالنسبة للزمن (التسارع).</li>
  <li>( F ) هي القوة المؤثرة على الجسم.</li>
</ul>

<p><strong>الصيغة الرياضية:</strong>
[ m \frac{dv}{dt} = F ]</p>

<p><strong>التفسير:</strong>
القوة المؤثرة على جسم ما تساوي كتلة الجسم مضروبة في تسارعه.</p>

<p>هذا هو النموذج المضمن.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{equation}</span>
<span class="k">\underset</span><span class="p">{</span><span class="k">\text</span><span class="p">{</span>الطاقة الحركية<span class="p">}}{</span><span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2<span class="p">}</span>+
<span class="k">\underset</span><span class="p">{</span><span class="k">\text</span><span class="p">{</span>الطاقة الكامنة<span class="p">}}{</span><span class="k">\vphantom</span><span class="p">{</span><span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}}</span>mgh<span class="p">}</span>=<span class="k">\text</span><span class="p">{</span>ثابت<span class="p">}</span>,<span class="k">\notag</span>
</code></pre></div></div>

<p>هذا هو النص بشكل فقرات.</p>

<p>عند استخدام الصيغة المضمنة، يجب إضافة <code class="language-plaintext highlighter-rouge">$</code> أو <code class="language-plaintext highlighter-rouge">[]</code> حول التعبير. وإلا فقد يحدث خطأ.</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\begin{preview}</span>
<span class="k">\tfrac</span><span class="p">{</span>1<span class="p">}{</span>2<span class="p">}</span>mv<span class="p">^</span>2
<span class="nt">\end{preview}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">!</span> تم إدخال علامة <span class="nv">$ </span>مفقودة.
&lt;النص المُدخل&gt;
                <span class="err">$</span>
l.26 <span class="se">\t</span>frac<span class="o">{</span>1<span class="o">}{</span>2<span class="o">}</span>
                 <span class="nb">mv</span>^2
</code></pre></div></div>

<p>يجب أن يتم تغييره إلى هذا:</p>

<div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">\begin{document}</span>
<span class="nt">\begin{preview}</span>
<span class="p">$</span><span class="nv">\tfrac</span><span class="p">{</span><span class="m">1</span><span class="p">}{</span><span class="m">2</span><span class="p">}</span><span class="nb">mv</span><span class="p">^</span><span class="m">2</span><span class="p">$</span>
<span class="nt">\end{preview}</span>
<span class="nt">\end{document}</span>
</code></pre></div></div>

<p>لنرى الآن كيفية تحويل <code class="language-plaintext highlighter-rouge">latex</code> إلى <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'eq_'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svg_prefix</span> <span class="o">=</span> <span class="s">'in_'</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% tree svgs
svgs
├── eq_0.svg
├── eq_1.svg
├── in_0.svg
</code></pre></div></div>

<p>هكذا يتم حفظ <code class="language-plaintext highlighter-rouge">svg</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_latex</span><span class="p">(</span><span class="n">mathjax</span><span class="p">,</span> <span class="n">equation</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="s">'$'</span> <span class="o">+</span> <span class="n">mathjax</span><span class="p">.</span><span class="n">string</span> <span class="o">+</span> <span class="s">'$'</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'label'</span><span class="p">,</span> <span class="s">'tag'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrap</span>
</code></pre></div></div>

<p>هنا سنقوم بإجراء بعض التعديلات على كود <code class="language-plaintext highlighter-rouge">latex</code>. لاحظ أن <code class="language-plaintext highlighter-rouge">label</code> قد تحولت إلى <code class="language-plaintext highlighter-rouge">tag</code>.</p>

<p><img src="assets/images/feynman/tag.png" alt="علامة" /></p>

<p>لاحظ <code class="language-plaintext highlighter-rouge">(Eq:I:13:14)</code> على الجانب الأيمن. إذا كان <code class="language-plaintext highlighter-rouge">label</code>، فإنه لم يتم تحليله بنجاح. سيظهر هذا كـ <code class="language-plaintext highlighter-rouge">(1)</code>. هنا نستخدم <code class="language-plaintext highlighter-rouge">tag</code> للإشارة إليه مؤقتًا، ولم نتعمق في البحث بعد.</p>

<p>ثم يتم استدعاء <code class="language-plaintext highlighter-rouge">latex2svg.py</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">latex2svg</span><span class="p">(</span><span class="n">wrap</span><span class="p">)</span>   
        <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>    
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود الموجود في الملف الأصلي مكتوب بلغة Python ولا يحتاج إلى ترجمة، حيث أن الأكواد البرمجية تبقى كما هي بغض النظر عن اللغة المستخدمة في الوثيقة.</p>

<p>اطلع على <code class="language-plaintext highlighter-rouge">latex2svg.py</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># تشغيل LaTeX وإنشاء ملف DVI
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'latex_cmd'</span><span class="p">]</span><span class="o">+</span><span class="s">' code.tex'</span><span class="p">),</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">check_returncode</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'latex غير موجود'</span><span class="p">)</span>
</code></pre></div></div>

<p>هنا يتم استدعاء أمر <code class="language-plaintext highlighter-rouge">latex</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> % latex <span class="nt">--help</span>
الاستخدام: pdftex <span class="o">[</span>خيار]... <span class="o">[</span>اسم الملف[.tex]] <span class="o">[</span>أوامر]
   أو: pdftex <span class="o">[</span>خيار]... <span class="se">\ا</span>لسطر الأول
   أو: pdftex <span class="o">[</span>خيار]... &amp;تنسيق ARGS
  تشغيل pdfTeX على اسم الملف، عادةً ما يتم إنشاء اسم الملف.pdf.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">try</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">shlex</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'dvisvgm_cmd'</span><span class="p">]</span><span class="o">+</span><span class="s">' code.dvi'</span><span class="p">),</span>
                             <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
                             <span class="n">cwd</span><span class="o">=</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">.</span><span class="n">check_returncode</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'لم يتم العثور على dvisvgm'</span><span class="p">)</span>
</code></pre></div></div>

<p>هنا يتم استدعاء أمر <code class="language-plaintext highlighter-rouge">dvisvgm</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% dvisvgm
dvisvgm 2.9.1
</code></pre></div></div>

<p>هذا البرنامج يحول ملفات DVI، التي يتم إنشاؤها بواسطة TeX/LaTeX، بالإضافة إلى ملفات EPS وPDF، إلى تنسيق SVG القائم على XML والذي يعتبر تنسيقًا متجهيًا قابلًا للتحجيم.</p>

<p>الاستخدام: dvisvgm [خيارات] ملف_dvi
       dvisvgm –eps [خيارات] ملف_eps
       dvisvgm –pdf [خيارات] ملف_pdf</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
أين تكتب وحدات الماكرو المخصصة لـ `latex` التي تم ذكرها أعلاه؟ هنا يجب تعديل `latex2svg.py`. قم بتعديل `default_preamble`.

```python
default_preamble = r"""
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{newtxtext}
\usepackage[libertine]{newtxmath}
</code></pre></div></div>

<p>\newcommand{\FLPvec}[1]{\boldsymbol{#1}}
\newcommand{\Figvec}[1]{\mathbf{#1}}
\newcommand{\FLPC}{\FLPvec{C}}
\newcommand{\FLPF}{\FLPvec{F}}
\newcommand{\FLPa}{\FLPvec{a}}
\newcommand{\FLPb}{\FLPvec{a}}
\newcommand{\FLPr}{\FLPvec{r}}
\newcommand{\FLPs}{\FLPvec{s}}
\newcommand{\FLPv}{\FLPvec{v}}
\newcommand{\ddt}[2]{\frac{d#1}{d#2}}
\newcommand{\epsO}{\epsilon_0}
\newcommand{\FigC}{\Figvec{C}}
“””</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
بعد التحويل بنجاح، يتم الكتابة إلى الملف.

```python
        f = open(f'svgs/{svg_prefix}{i}.svg', 'w')
        f.write(out['svg'])
        f.close()
</code></pre></div></div>

<p>استمر.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>
        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>
</code></pre></div></div>

<p><strong>ترجمة الكود إلى العربية:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">node</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="s">'&lt;img&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>  <span class="c1"># إنشاء كائن BeautifulSoup من وسم &lt;img&gt;
</span>        <span class="n">img</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'img'</span><span class="p">)</span>  <span class="c1"># البحث عن وسم &lt;img&gt; داخل الكائن
</span>        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./svgs/</span><span class="si">{</span><span class="n">svg_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s">.svg'</span>  <span class="c1"># تعيين السمة 'src' لمسار ملف SVG
</span>        <span class="n">img</span><span class="p">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">'style'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'vertical-align: middle; margin: 0.5em 0;'</span>  <span class="c1"># تعيين السمة 'style' لتنسيق الصورة
</span></code></pre></div></div>

<p><strong>ملاحظة:</strong> تم الحفاظ على الكود الأصلي كما هو لأنه يتضمن أسماء مكتبات ووظائف محددة (مثل <code class="language-plaintext highlighter-rouge">BeautifulSoup</code>) والتي لا يتم ترجمتها عادةً. تمت إضافة التعليقات باللغة العربية لشرح الكود.</p>

<p>هنا نقوم بإنشاء وسم <code class="language-plaintext highlighter-rouge">img</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_svg</span><span class="p">(</span><span class="n">svg</span><span class="p">,</span> <span class="n">equation</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="sa">f</span><span class="s">'&lt;div style="text-align:center;"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">div</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">svg</span>
      
<span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">wrap_svg</span><span class="p">(</span><span class="n">svg</span><span class="p">,</span> <span class="n">equation</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">equation</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="sa">f</span><span class="s">'&lt;div style="text-align:center;"&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s">"lxml"</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">div</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">svg</span>
      
<span class="n">p</span> <span class="o">=</span> <span class="n">wrap_svg</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">equation</span><span class="p">)</span>
</code></pre></div></div>

<p>ملاحظة: الكود لم يتغير لأنه يحتوي على أسماء متغيرات ودوال بالإنجليزية، ولم يتم تغييرها وفقًا للتعليمات.</p>

<p>إذا كانت <code class="language-plaintext highlighter-rouge">latex</code> عبارة عن فقرة واحدة، فقم بتغليفها باستخدام <code class="language-plaintext highlighter-rouge">div</code> وتوسيطها.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mathjax</span><span class="p">.</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div></div>

<p>هنا يتم إضافة وسم <code class="language-plaintext highlighter-rouge">div</code> أو وسم <code class="language-plaintext highlighter-rouge">img</code> بعد وسم <code class="language-plaintext highlighter-rouge">script</code> الأصلي.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">clean_script</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
    <span class="n">scripts</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scripts</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>    
        
<span class="n">clean_script</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ترجمة الكود إلى العربية:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">تنظيف_النصي</span><span class="p">(</span><span class="n">soup</span><span class="p">):</span>
    <span class="n">النصوص</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">'script'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">نص</span> <span class="ow">in</span> <span class="n">النصوص</span><span class="p">:</span>
        <span class="n">نص</span><span class="p">.</span><span class="n">decompose</span><span class="p">()</span>    
        
<span class="n">تنظيف_النصي</span><span class="p">(</span><span class="n">soup</span><span class="p">)</span>
</code></pre></div></div>

<p>في هذا الكود، يتم تعريف دالة <code class="language-plaintext highlighter-rouge">تنظيف_النصي</code> التي تقوم بإزالة جميع عناصر النصوص البرمجية (<code class="language-plaintext highlighter-rouge">script</code>) من كائن <code class="language-plaintext highlighter-rouge">soup</code> الذي يمثل وثيقة HTML. يتم استخدام <code class="language-plaintext highlighter-rouge">findAll</code> للعثور على جميع العناصر من نوع <code class="language-plaintext highlighter-rouge">script</code>، ثم يتم استخدام <code class="language-plaintext highlighter-rouge">decompose</code> لإزالة كل عنصر نصي من الوثيقة.</p>

<p>بعد استبدال جميع عناصر <code class="language-plaintext highlighter-rouge">latex</code> بـ <code class="language-plaintext highlighter-rouge">svg</code>، لن تكون هناك حاجة إلى <code class="language-plaintext highlighter-rouge">script</code>. قم بحذفها لجعل الكود أكثر نظافة.</p>

<p>أخيرًا، يتم كتابة <code class="language-plaintext highlighter-rouge">html</code> المعدل بالكامل في ملف.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">soup</span><span class="p">.</span><span class="n">prettify</span><span class="p">())</span>
    <span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>    
</code></pre></div></div>

<p>ثم استخدم أداة <code class="language-plaintext highlighter-rouge">pandoc</code> لتحويلها إلى صيغة <code class="language-plaintext highlighter-rouge">epub</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandoc <span class="nt">-s</span> <span class="nt">-r</span> html out.html <span class="nt">-o</span> feynman.epub
</code></pre></div></div>

<p>سيتم فتح كتاب إلكتروني جميل.</p>

<p>لماذا لا يتم تضمين علامة <code class="language-plaintext highlighter-rouge">svg</code> مباشرة، بدلاً من استخدام <code class="language-plaintext highlighter-rouge">img</code> لإدراجها؟ أي بكتابة مثل هذا:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p&gt;&lt;/p&gt;</span>
<span class="nt">&lt;svg&gt;&lt;/svg&gt;</span>
<span class="nt">&lt;p&gt;&lt;/p&gt;</span>
</code></pre></div></div>

<p>هناك <code class="language-plaintext highlighter-rouge">bug</code> غريب جدًا. عندما يكون هناك الكثير من ملفات <code class="language-plaintext highlighter-rouge">svg</code>، يحدث شيء مثل هذا.</p>

<p><img src="/assets/images/feynman/svg_p1.png" alt="svg_p1" style="zoom:40%;" /></p>

<p>لاحقًا اكتشفت أنه يمكن استخدام <code class="language-plaintext highlighter-rouge">img</code> لإدراج الصور. أما عن سبب ذلك، لم أفهمه تمامًا. عندما أخذت هذا الـ <code class="language-plaintext highlighter-rouge">svg</code> الفردي وعرضته في المتصفح، لم تكن هناك مشكلة. يبدو أن المشكلة تحدث عندما يقوم المتصفح بعرض عدد كبير جدًا من ملفات <code class="language-plaintext highlighter-rouge">svg</code> في نفس الوقت.</p>

<h3 id="الختام">الختام</h3>

<p>أما بالنسبة لكيفية تحويل <code class="language-plaintext highlighter-rouge">epub</code> إلى <code class="language-plaintext highlighter-rouge">mobi</code>، يمكنك استخدام الأداة الرسمية من <code class="language-plaintext highlighter-rouge">Kindle</code> وهي <code class="language-plaintext highlighter-rouge">Kindle Previewer 3</code>. لاحظ أن هذا مجرد فصل واحد.</p>

<p>كود المشروع موجود في <a href="https://github.com/lzwjava/feynman-lectures-mobi">feynman-lectures-mobi@lzwjava</a>.</p>

<p>كيف يمكن استخراج جميع الصفحات وتنظيمها في كتاب إلكتروني؟ سنتحدث عن ذلك لاحقًا. ولكن هذا الفصل من محاضرات فينمان في الفيزياء كافٍ للقراءة. حسنًا، لنبدأ القراءة على جهاز Kindle.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-ar" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
