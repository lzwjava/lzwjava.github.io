<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>紅襪隊在行動</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>紅襪隊在行動 | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="紅襪隊在行動" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="hant" />
<meta name="description" content="當然可以！我將指導您如何使用您的Mac電腦設置Shadowsocks代理，並配置您的OpenWRT路由器，以將所有連接設備的流量通過此代理路由。此設置涉及以下主要步驟：" />
<meta property="og:description" content="當然可以！我將指導您如何使用您的Mac電腦設置Shadowsocks代理，並配置您的OpenWRT路由器，以將所有連接設備的流量通過此代理路由。此設置涉及以下主要步驟：" />
<link rel="canonical" href="https://lzwjava.github.io/redsocks-hant" />
<meta property="og:url" content="https://lzwjava.github.io/redsocks-hant" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-18T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="紅襪隊在行動" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2024-12-18T00:00:00+08:00","datePublished":"2024-12-18T00:00:00+08:00","description":"當然可以！我將指導您如何使用您的Mac電腦設置Shadowsocks代理，並配置您的OpenWRT路由器，以將所有連接設備的流量通過此代理路由。此設置涉及以下主要步驟：","headline":"紅襪隊在行動","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/redsocks-hant"},"url":"https://lzwjava.github.io/redsocks-hant"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=fe13842666dd2631771e2916b70907f46ff54eb6">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=fe13842666dd2631771e2916b70907f46ff54eb6" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       紅襪隊在行動 | 原創，AI翻譯
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/hant/2024-12-18-redsocks-hant.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postshant2024-12-18-redsocks-hant.md</span> -->
      

      <!-- <span>2024-12-18-redsocks-hant.md</span> -->

      
        

        
          
          <a href="#" class="button">2024.12</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/redsocks-en" >English</option>
        <option value="/redsocks-zh" >中文</option>
        <option value="/redsocks-ja" >日本語</option>
        <option value="/redsocks-es" >Español</option>
        <option value="/redsocks-hi" >हिंदी</option>
        <option value="/redsocks-fr" >Français</option>
        <option value="/redsocks-de" >Deutsch</option>
        <option value="/redsocks-ar" >العربية</option>
        <option value="/redsocks-hant" selected>繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>當然可以！我將指導您如何使用您的Mac電腦設置Shadowsocks代理，並配置您的OpenWRT路由器，以將所有連接設備的流量通過此代理路由。此設置涉及以下主要步驟：</p>

<ol>
  <li>在macOS上設置Shadowsocks客戶端（使用Shadowsocks-NG或Clash）</li>
  <li>配置macOS以允許外部代理連接</li>
  <li>為您的Mac分配靜態IP</li>
  <li>在OpenWRT上安裝和配置Redsocks</li>
  <li>將OpenWRT的流量重定向通過macOS代理</li>
  <li>測試代理設置</li>
</ol>

<p>讓我們詳細介紹每個步驟。</p>

<hr />

<h2 id="1-在macos上設置shadowsocks客戶端">1. 在macOS上設置Shadowsocks客戶端</h2>

<p>您可以使用Shadowsocks-NG或Clash作為您的Shadowsocks客戶端。以下是兩者的說明。</p>

<h3 id="選項a使用shadowsocks-ng">選項A：使用Shadowsocks-NG</h3>

<p>Shadowsocks-NG是macOS上流行且用戶友好的Shadowsocks客戶端。</p>

<h4 id="步驟1下載並安裝shadowsocks-ng">步驟1：下載並安裝Shadowsocks-NG</h4>

<ol>
  <li>下載Shadowsocks-NG：
    <ul>
      <li>訪問<a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases">Shadowsocks-NG GitHub Releases頁面</a>。</li>
      <li>下載最新的<code class="language-plaintext highlighter-rouge">.dmg</code>文件。</li>
    </ul>
  </li>
  <li>安裝應用程序：
    <ul>
      <li>打開下載的<code class="language-plaintext highlighter-rouge">.dmg</code>文件。</li>
      <li>將ShadowsocksX-NG應用程序拖到您的應用程序文件夾中。</li>
    </ul>
  </li>
  <li>啟動Shadowsocks-NG：
    <ul>
      <li>從您的應用程序文件夾中打開ShadowsocksX-NG。</li>
      <li>您可能需要在系統偏好設置中授予應用程序必要的權限。</li>
    </ul>
  </li>
</ol>

<h4 id="步驟2配置shadowsocks-ng">步驟2：配置Shadowsocks-NG</h4>

<ol>
  <li>打開偏好設置：
    <ul>
      <li>點擊菜單欄中的ShadowsocksX-NG圖標。</li>
      <li>選擇“打開ShadowsocksX-NG” &gt; “偏好設置”。</li>
    </ul>
  </li>
  <li>添加新服務器：
    <ul>
      <li>導航到“服務器”選項卡。</li>
      <li>點擊“+”按鈕以添加新服務器。</li>
    </ul>
  </li>
  <li>導入Shadowsocks URL：
    <ul>
      <li>複製您的Shadowsocks URL：
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ss://[ENCRYPTED_PASSWORD]@xxx.xxx.xxx.xxx:xxxxx/?outline=1
</code></pre></div>        </div>
      </li>
      <li>導入方法：
        <ul>
          <li>點擊“導入”。</li>
          <li>粘貼您的Shadowsocks URL。</li>
          <li>Shadowsocks-NG應自動解析並填寫服務器詳細信息。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>設置本地代理：
    <ul>
      <li>確保“啟用SOCKS5代理”已勾選。</li>
      <li>記下本地端口（默認通常為<code class="language-plaintext highlighter-rouge">1080</code>）。</li>
    </ul>
  </li>
  <li>保存並激活：
    <ul>
      <li>點擊“確定”以保存服務器。</li>
      <li>切換“啟用Shadowsocks”開關為ON。</li>
    </ul>
  </li>
</ol>

<h3 id="選項b使用clash">選項B：使用Clash</h3>

<p>Clash是一個支持多種協議（包括Shadowsocks）的多功能代理客戶端。</p>

<h4 id="步驟1下載並安裝clash">步驟1：下載並安裝Clash</h4>

<ol>
  <li>下載Clash for macOS：
    <ul>
      <li>訪問<a href="https://github.com/Dreamacro/clash/releases">Clash GitHub Releases頁面</a>。</li>
      <li>下載最新的Clash for macOS二進制文件。</li>
    </ul>
  </li>
  <li>安裝應用程序：
    <ul>
      <li>將下載的Clash應用程序移動到您的應用程序文件夾中。</li>
    </ul>
  </li>
  <li>啟動Clash：
    <ul>
      <li>從您的應用程序文件夾中打開Clash。</li>
      <li>您可能需要在系統偏好設置中授予必要的權限。</li>
    </ul>
  </li>
</ol>

<h4 id="步驟2配置clash">步驟2：配置Clash</h4>

<ol>
  <li>訪問配置文件：
    <ul>
      <li>Clash使用YAML配置文件。您可以使用TextEdit或Visual Studio Code等文本編輯器創建或編輯它。</li>
    </ul>
  </li>
  <li>添加您的Shadowsocks服務器：
    <ul>
      <li>
        <p>創建一個配置文件（例如，<code class="language-plaintext highlighter-rouge">config.yaml</code>），內容如下：</p>

        <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">port</span><span class="pi">:</span> <span class="m">7890</span>
<span class="na">socks-port</span><span class="pi">:</span> <span class="m">7891</span>
<span class="na">allow-lan</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">Rule</span>
<span class="na">log-level</span><span class="pi">:</span> <span class="s">info</span>

<span class="na">proxies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">MyShadowsocks"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ss</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">xxx.xxx.xxx.xxx</span>
    <span class="na">port</span><span class="pi">:</span> <span class="s">xxxxx</span>
    <span class="na">cipher</span><span class="pi">:</span> <span class="s">chacha20-ietf-poly1305</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s2">"</span><span class="s">xxxxxx"</span>

<span class="na">proxy-groups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Default"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">select</span>
    <span class="na">proxies</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">MyShadowsocks"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">DIRECT"</span>

<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">MATCH,Default</span>
</code></pre></div>        </div>

        <p>注意：</p>
        <ul>
          <li><code class="language-plaintext highlighter-rouge">port</code>和<code class="language-plaintext highlighter-rouge">socks-port</code>定義Clash將監聽的HTTP和SOCKS5代理端口。</li>
          <li><code class="language-plaintext highlighter-rouge">allow-lan: true</code>允許LAN設備使用代理。</li>
          <li><code class="language-plaintext highlighter-rouge">proxies</code>部分包括您的Shadowsocks服務器詳細信息。</li>
          <li><code class="language-plaintext highlighter-rouge">proxy-groups</code>和<code class="language-plaintext highlighter-rouge">rules</code>確定流量如何路由。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>使用配置啟動Clash：
    <ul>
      <li>啟動Clash並確保它使用您的<code class="language-plaintext highlighter-rouge">config.yaml</code>文件。</li>
      <li>啟動Clash時可能需要指定配置路徑。</li>
    </ul>
  </li>
  <li>驗證代理是否運行：
    <ul>
      <li>確保Clash已激活並連接到您的Shadowsocks服務器。</li>
      <li>檢查菜單欄圖標以獲取狀態。</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="2-配置macos以允許外部代理連接">2. 配置macOS以允許外部代理連接</h2>

<p>默認情況下，Shadowsocks客戶端將代理綁定到<code class="language-plaintext highlighter-rouge">localhost</code>（<code class="language-plaintext highlighter-rouge">127.0.0.1</code>），這意味著只有Mac可以使用代理。要允許您的OpenWRT路由器使用此代理，您需要將代理綁定到Mac的LAN IP。</p>

<h3 id="對於shadowsocks-ng">對於Shadowsocks-NG：</h3>

<ol>
  <li>打開偏好設置：
    <ul>
      <li>點擊菜單欄中的ShadowsocksX-NG圖標。</li>
      <li>選擇“打開ShadowsocksX-NG” &gt; “偏好設置”。</li>
    </ul>
  </li>
  <li>轉到高級選項卡：
    <ul>
      <li>導航到“高級”選項卡。</li>
    </ul>
  </li>
  <li>設置監聽地址：
    <ul>
      <li>將“監聽地址”從<code class="language-plaintext highlighter-rouge">127.0.0.1</code>更改為<code class="language-plaintext highlighter-rouge">0.0.0.0</code>以允許來自任何接口的連接。</li>
      <li>或者，指定Mac的LAN IP（例如，<code class="language-plaintext highlighter-rouge">192.168.1.xxx</code>）。</li>
    </ul>
  </li>
  <li>保存並重新啟動Shadowsocks-NG：
    <ul>
      <li>點擊“確定”以保存更改。</li>
      <li>重新啟動Shadowsocks-NG客戶端以應用新設置。</li>
    </ul>
  </li>
</ol>

<h3 id="對於clash">對於Clash：</h3>

<ol>
  <li>編輯配置文件：
    <ul>
      <li>確保在您的<code class="language-plaintext highlighter-rouge">config.yaml</code>中啟用了<code class="language-plaintext highlighter-rouge">allow-lan: true</code>設置。</li>
    </ul>
  </li>
  <li>綁定到所有接口：
    <ul>
      <li>在配置中，設置<code class="language-plaintext highlighter-rouge">allow-lan: true</code>通常會將代理綁定到所有可用接口，包括LAN。</li>
    </ul>
  </li>
  <li>重新啟動Clash：
    <ul>
      <li>重新啟動Clash客戶端以應用更改。</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="3-為您的mac分配靜態ip">3. 為您的Mac分配靜態IP</h2>

<p>為了確保OpenWRT路由器和Mac之間的連接穩定，請為您的Mac分配一個靜態IP。</p>

<h3 id="在macos上分配靜態ip的步驟">在macOS上分配靜態IP的步驟：</h3>

<ol>
  <li>打開系統偏好設置：
    <ul>
      <li>點擊Apple菜單並選擇“系統偏好設置”。</li>
    </ul>
  </li>
  <li>導航到網絡設置：
    <ul>
      <li>點擊“網絡”。</li>
    </ul>
  </li>
  <li>選擇您的活動連接：
    <ul>
      <li>從左側邊欄中選擇“Wi-Fi”或“以太網”，具體取決於您的Mac如何連接到路由器。</li>
    </ul>
  </li>
  <li>配置IPv4設置：
    <ul>
      <li>點擊“高級…”。</li>
      <li>轉到“TCP/IP”選項卡。</li>
      <li>將“配置IPv4”從“使用DHCP”更改為“手動”。</li>
    </ul>
  </li>
  <li>設置靜態IP地址：
    <ul>
      <li>IP地址：選擇一個在路由器DHCP範圍之外的IP以防止衝突（例如，<code class="language-plaintext highlighter-rouge">192.168.1.xxx</code>）。</li>
      <li>子網掩碼：通常為<code class="language-plaintext highlighter-rouge">255.255.255.0</code>。</li>
      <li>路由器：您的路由器IP地址（例如，<code class="language-plaintext highlighter-rouge">192.168.1.1</code>）。</li>
      <li>DNS服務器：您可以使用路由器的IP或其他DNS服務，如<code class="language-plaintext highlighter-rouge">8.8.8.8</code>。</li>
    </ul>
  </li>
  <li>應用設置：
    <ul>
      <li>點擊“確定”，然後點擊“應用”以保存更改。</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="4-在openwrt上安裝和配置redsocks">4. 在OpenWRT上安裝和配置Redsocks</h2>

<p>Redsocks是一個透明的socks重定向器，允許您通過SOCKS5代理路由網絡流量。我們將使用Redsocks將OpenWRT的流量重定向通過在您的Mac上運行的Shadowsocks代理。</p>

<h3 id="步驟1安裝redsocks">步驟1：安裝Redsocks</h3>

<ol>
  <li>
    <p>更新軟件包列表：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@&lt;router_ip&gt;
opkg update
</code></pre></div>    </div>
  </li>
  <li>
    <p>安裝Redsocks：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opkg <span class="nb">install </span>redsocks
</code></pre></div>    </div>

    <p><em>如果Redsocks在您的OpenWRT存儲庫中不可用，您可能需要手動編譯或使用替代軟件包。</em></p>
  </li>
</ol>

<h3 id="步驟2配置redsocks">步驟2：配置Redsocks</h3>

<ol>
  <li>
    <p>創建或編輯Redsocks配置文件：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /etc/redsocks.conf
</code></pre></div>    </div>
  </li>
  <li>
    <p>添加以下配置：</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">base</span> {
    <span class="n">log_debug</span> = <span class="n">on</span>;
    <span class="n">log_info</span> = <span class="n">on</span>;
    <span class="n">log</span> = <span class="s2">"file:/var/log/redsocks.log"</span>;
    <span class="n">daemon</span> = <span class="n">on</span>;
    <span class="n">redirector</span> = <span class="n">iptables</span>;
}

<span class="n">redsocks</span> {
    <span class="n">local_ip</span> = <span class="m">0</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">0</span>;
    <span class="n">local_port</span> = <span class="m">12345</span>;  <span class="c"># Redsocks監聽的本地端口
</span>    <span class="n">ip</span> = <span class="n">xxx</span>.<span class="n">xxx</span>.<span class="n">xxx</span>.<span class="n">xxx</span>;  <span class="c"># Mac的靜態IP
</span>    <span class="n">port</span> = <span class="n">xxxxx</span>;          <span class="c"># Shadowsocks-NG的本地SOCKS5代理端口
</span>    <span class="n">type</span> = <span class="n">socks5</span>;
    <span class="n">login</span> = <span class="s2">""</span>;           <span class="c"># 如果您的代理需要身份驗證
</span>    <span class="n">password</span> = <span class="s2">""</span>;
}
</code></pre></div>    </div>

    <p>注意：</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">local_port</code>：Redsocks監聽來自iptables重定向的傳入連接的端口。</li>
      <li><code class="language-plaintext highlighter-rouge">ip</code>和<code class="language-plaintext highlighter-rouge">port</code>：指向您的Mac的Shadowsocks SOCKS5代理（基於之前的步驟的<code class="language-plaintext highlighter-rouge">xxx.xxx.xxx.xxx:xxxxx</code>）。</li>
      <li><code class="language-plaintext highlighter-rouge">type</code>：設置為<code class="language-plaintext highlighter-rouge">socks5</code>，因為Shadowsocks提供SOCKS5代理。</li>
    </ul>
  </li>
  <li>保存並退出：
    <ul>
      <li>按<code class="language-plaintext highlighter-rouge">ESC</code>，輸入<code class="language-plaintext highlighter-rouge">:wq</code>，然後按<code class="language-plaintext highlighter-rouge">Enter</code>。</li>
    </ul>
  </li>
  <li>
    <p>創建日誌文件：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch</span> /var/log/redsocks.log
<span class="nb">chmod </span>644 /var/log/redsocks.log
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="步驟3啟動redsocks服務">步驟3：啟動Redsocks服務</h3>

<ol>
  <li>
    <p>啟用Redsocks在啟動時啟動：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/init.d/redsocks <span class="nb">enable</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>啟動Redsocks：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/init.d/redsocks start
</code></pre></div>    </div>
  </li>
  <li>
    <p>驗證Redsocks是否運行：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps | <span class="nb">grep </span>redsocks
</code></pre></div>    </div>

    <p>您應該看到一個Redsocks進程正在運行。</p>
  </li>
</ol>

<hr />

<h2 id="5-將openwrt的流量重定向通過macos代理">5. 將OpenWRT的流量重定向通過macOS代理</h2>

<p>現在Redsocks已在OpenWRT上設置完畢，配置iptables以將所有出站TCP流量重定向通過Redsocks，Redsocks再將其路由通過您的Mac的Shadowsocks代理。</p>

<h3 id="步驟1配置iptables規則">步驟1：配置iptables規則</h3>

<ol>
  <li>
    <p>添加iptables規則以重定向流量：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 將所有TCP流量重定向到Redsocks（除了代理本身的流量）</span>
iptables <span class="nt">-t</span> nat <span class="nt">-N</span> REDSOCKS
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> REDSOCKS <span class="nt">-d</span> xxx.xxx.xxx.xxx <span class="nt">-p</span> tcp <span class="nt">--dport</span> xxxxx <span class="nt">-j</span> RETURN
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> REDSOCKS <span class="nt">-p</span> tcp <span class="nt">-j</span> REDIRECT <span class="nt">--to-ports</span> 12345

<span class="c"># 將REDSOCKS鏈應用於所有出站流量</span>
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">-j</span> REDSOCKS
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">-j</span> REDSOCKS
</code></pre></div>    </div>

    <p>解釋：</p>
    <ul>
      <li>創建新鏈：<code class="language-plaintext highlighter-rouge">REDSOCKS</code></li>
      <li>排除代理流量：確保目的地為代理本身的流量不被重定向。</li>
      <li>重定向其他TCP流量：將其他TCP流量轉發到Redsocks的監聽端口（<code class="language-plaintext highlighter-rouge">12345</code>）。</li>
    </ul>
  </li>
  <li>
    <p>保存iptables規則：</p>

    <p>要使這些規則在重啟後持久化，請將它們添加到防火牆配置中。</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /etc/firewall.user
</code></pre></div>    </div>

    <p>添加iptables規則：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 將所有TCP流量重定向到Redsocks（除了代理）</span>
iptables <span class="nt">-t</span> nat <span class="nt">-N</span> REDSOCKS
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> REDSOCKS <span class="nt">-d</span> xxx.xxx.xxx.xxx <span class="nt">-p</span> tcp <span class="nt">--dport</span> xxxxx <span class="nt">-j</span> RETURN
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> REDSOCKS <span class="nt">-p</span> tcp <span class="nt">-j</span> REDIRECT <span class="nt">--to-ports</span> 12345

<span class="c"># 應用REDSOCKS鏈</span>
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">-j</span> REDSOCKS
iptables <span class="nt">-t</span> nat <span class="nt">-A</span> PREROUTING <span class="nt">-p</span> tcp <span class="nt">-j</span> REDSOCKS
</code></pre></div>    </div>

    <p>保存並退出：</p>
    <ul>
      <li>按<code class="language-plaintext highlighter-rouge">ESC</code>，輸入<code class="language-plaintext highlighter-rouge">:wq</code>，然後按<code class="language-plaintext highlighter-rouge">Enter</code>。</li>
    </ul>
  </li>
  <li>
    <p>重新啟動防火牆以應用更改：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/init.d/firewall restart
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="步驟2驗證流量是否被重定向">步驟2：驗證流量是否被重定向</h3>

<ol>
  <li>
    <p>檢查Redsocks日誌：</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /var/log/redsocks.log
</code></pre></div>    </div>

    <p>您應該看到日誌指示流量正在通過Redsocks處理。</p>
  </li>
  <li>
    <p>從客戶端設備測試：</p>
    <ul>
      <li>將設備連接到您的OpenWRT路由器。</li>
      <li>訪問網站或執行使用互聯網的操作。</li>
      <li>通過檢查外部IP地址（例如，通過<a href="https://www.whatismyip.com/">WhatIsMyIP.com</a>）驗證流量是否通過Shadowsocks代理路由，以查看是否反映代理的IP。</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="6-測試代理設置">6. 測試代理設置</h2>

<p>通過執行以下測試確保整個設置按預期工作。</p>

<h3 id="步驟1在mac上驗證shadowsocks連接">步驟1：在Mac上驗證Shadowsocks連接</h3>

<ol>
  <li>檢查Shadowsocks客戶端狀態：
    <ul>
      <li>確保Shadowsocks-NG或Clash已主動連接到Shadowsocks服務器。</li>
      <li>驗證本地代理（例如，<code class="language-plaintext highlighter-rouge">xxx.xxx.xxx.xxx:xxxxx</code>）是否可訪問。</li>
    </ul>
  </li>
  <li>本地測試代理：
    <ul>
      <li>在您的Mac上，打開瀏覽器並將其配置為使用<code class="language-plaintext highlighter-rouge">localhost:1080</code>作為SOCKS5代理。</li>
      <li>訪問<a href="https://www.whatismyip.com/">WhatIsMyIP.com</a>以確認IP是否匹配Shadowsocks服務器。</li>
    </ul>
  </li>
</ol>

<h3 id="步驟2驗證openwrt的流量是否通過代理路由">步驟2：驗證OpenWRT的流量是否通過代理路由</h3>

<ol>
  <li>檢查OpenWRT的外部IP：
    <ul>
      <li>從連接到OpenWRT的設備，訪問<a href="https://www.whatismyip.com/">WhatIsMyIP.com</a>以查看IP是否反映Shadowsocks服務器的IP。</li>
    </ul>
  </li>
  <li>監控Redsocks日誌：
    <ul>
      <li>在OpenWRT上，監控Redsocks日誌以確保流量正在被重定向。</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tail</span> <span class="nt">-f</span> /var/log/redsocks.log
</code></pre></div>    </div>
  </li>
  <li>如有必要進行故障排除：
    <ul>
      <li>如果流量未正確路由：
        <ul>
          <li>確保Mac上的Shadowsocks客戶端正在運行且可訪問。</li>
          <li>驗證iptables規則是否正確設置。</li>
          <li>檢查Mac和OpenWRT上的防火牆設置。</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="其他注意事項">其他注意事項</h2>

<h3 id="1-安全性">1. 安全性</h3>

<ul>
  <li>保護您的代理：
    <ul>
      <li>確保只有受信任的設備可以訪問代理。由於您正在通過Redsocks重定向所有流量，請確保Mac的防火牆僅允許來自OpenWRT路由器的連接。</li>
    </ul>

    <p>在macOS上：</p>

    <ul>
      <li>轉到系統偏好設置 &gt; 安全與隱私 &gt; 防火牆。</li>
      <li>配置防火牆以僅允許來自OpenWRT路由器IP的代理端口（<code class="language-plaintext highlighter-rouge">xxxxx</code>）的傳入連接。</li>
    </ul>
  </li>
  <li>身份驗證：
    <ul>
      <li>Shadowsocks已經通過加密提供了一定程度的安全性。確保使用強密碼和加密方法。</li>
    </ul>
  </li>
</ul>

<h3 id="2-性能">2. 性能</h3>

<ul>
  <li>路由器資源：
    <ul>
      <li>運行Redsocks等代理服務可能會消耗OpenWRT路由器上的額外CPU和內存。確保您的路由器有足夠的資源。</li>
    </ul>
  </li>
  <li>Mac性能：
    <ul>
      <li>確保您的Mac保持開機並連接到網絡以維持代理可用性。</li>
    </ul>
  </li>
</ul>

<h3 id="3-維護">3. 維護</h3>

<ul>
  <li>監控日誌：
    <ul>
      <li>定期檢查Redsocks和Shadowsocks日誌以查找任何異常活動或錯誤。</li>
    </ul>
  </li>
  <li>更新軟件：
    <ul>
      <li>保持OpenWRT、Redsocks和您的Shadowsocks客戶端更新，以受益於安全補丁和性能改進。</li>
    </ul>
  </li>
</ul>

<h3 id="4-替代方法">4. 替代方法</h3>

<p>雖然使用Mac作為中介代理服務器是可行的，但考慮以下替代方案以實現更簡單的設置：</p>

<ul>
  <li>直接在OpenWRT上配置Shadowsocks客戶端：
    <ul>
      <li>OpenWRT通過<code class="language-plaintext highlighter-rouge">shadowsocks-libev</code>等軟件包直接支持Shadowsocks。此方法消除了對Mac中介的需求。</li>
    </ul>
  </li>
  <li>使用專用代理/VPN設備：
    <ul>
      <li>像Raspberry Pi這樣的設備可以運行代理服務並充當專用網關。</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="結論">結論</h2>

<p>通過按照上述步驟操作，您已將Mac設置為Shadowsocks代理服務器，並配置了OpenWRT路由器以將所有連接設備的流量通過此代理路由。此設置通過利用Shadowsocks協議增強了網絡的隱私和控制。</p>

<p>關鍵點回顧：</p>

<ol>
  <li>Mac上的Shadowsocks客戶端：
    <ul>
      <li>安裝並配置了Shadowsocks-NG或Clash與您提供的Shadowsocks URL。</li>
      <li>配置客戶端以監聽Mac的LAN IP。</li>
    </ul>
  </li>
  <li>代理可訪問性：
    <ul>
      <li>為Mac分配了靜態IP以確保一致的代理訪問。</li>
      <li>配置了macOS防火牆以允許傳入代理連接。</li>
    </ul>
  </li>
  <li>OpenWRT配置：
    <ul>
      <li>安裝並配置了Redsocks以將所有出站TCP流量重定向通過Shadowsocks代理。</li>
      <li>應用了必要的iptables規則以強制流量重定向。</li>
    </ul>
  </li>
  <li>測試：
    <ul>
      <li>通過檢查外部IP地址驗證了來自連接設備的流量</li>
    </ul>
  </li>
</ol>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-hant" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
