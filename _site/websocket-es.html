<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Explorando WebSocket</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Explorando WebSocket | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Explorando WebSocket" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="es" />
<meta name="description" content="Esta entrada del blog fue organizada con la asistencia de ChatGPT-4o." />
<meta property="og:description" content="Esta entrada del blog fue organizada con la asistencia de ChatGPT-4o." />
<link rel="canonical" href="https://lzwjava.github.io/websocket-es" />
<meta property="og:url" content="https://lzwjava.github.io/websocket-es" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-05-29T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Explorando WebSocket" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2016-05-29T00:00:00+08:00","datePublished":"2016-05-29T00:00:00+08:00","description":"Esta entrada del blog fue organizada con la asistencia de ChatGPT-4o.","headline":"Explorando WebSocket","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/websocket-es"},"url":"https://lzwjava.github.io/websocket-es"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=87e91a03bcb5d06a64a4cd8249d20948a11c81e0">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=87e91a03bcb5d06a64a4cd8249d20948a11c81e0" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Explorando WebSocket | Original, traducido por IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/es/2016-05-29-websocket-es.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postses2016-05-29-websocket-es.md</span> -->
      

      <!-- <span>2016-05-29-websocket-es.md</span> -->

      
        

        
          
          <a href="#" class="button">2016.05</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/websocket-en" >English</option>
        <option value="/websocket-zh" >中文</option>
        <option value="/websocket-ja" >日本語</option>
        <option value="/websocket-es" selected>Español</option>
        <option value="/websocket-hi" >हिंदी</option>
        <option value="/websocket-fr" >Français</option>
        <option value="/websocket-de" >Deutsch</option>
        <option value="/websocket-ar" >العربية</option>
        <option value="/websocket-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p><em>Esta entrada del blog fue organizada con la asistencia de ChatGPT-4o.</em></p>

<hr />

<h3 id="introducción">Introducción</h3>
<p>Hola a todos, soy Li Zhiwei. Como fundador y CTO de la plataforma CodeReview, y ex ingeniero de LeanCloud, tengo una amplia experiencia en WebSocket, especialmente en el desarrollo de SDKs de mensajería instantánea (IM).</p>

<h3 id="la-importancia-de-websocket">La importancia de WebSocket</h3>
<p>WebSocket es un protocolo que proporciona un canal de comunicación full-duplex sobre una única conexión TCP. Se utiliza ampliamente en aplicaciones modernas que requieren interacción en tiempo real, como mensajería instantánea, comentarios en tiempo real, juegos multijugador, edición colaborativa y precios de acciones en tiempo real.</p>

<h3 id="aplicaciones-modernas-de-websocket">Aplicaciones Modernas de WebSocket</h3>
<p>WebSocket se utiliza ampliamente en las siguientes áreas:</p>
<ul>
  <li><strong>Mensajería Instantánea (IM)</strong></li>
  <li><strong>Comentarios en Tiempo Real</strong></li>
  <li><strong>Juegos Multijugador</strong></li>
  <li><strong>Edición Colaborativa</strong></li>
  <li><strong>Precios de Acciones en Tiempo Real</strong></li>
</ul>

<h3 id="la-evolución-de-websocket">La evolución de WebSocket</h3>
<p><strong>Sondeo (Polling):</strong> El cliente solicita frecuentemente actualizaciones al servidor.
<strong>Sondeo largo (Long Polling):</strong> El servidor mantiene la solicitud abierta hasta que hay nueva información disponible.
<strong>Conexión bidireccional HTTP:</strong> Requiere múltiples conexiones para enviar y recibir, y cada solicitud incluye cabeceras HTTP.
<strong>Conexión única TCP (WebSocket):</strong> Supera las limitaciones de la conexión bidireccional HTTP, ofreciendo mayor capacidad en tiempo real y menor latencia.</p>

<h3 id="implementación-de-websocket-en-ios">Implementación de WebSocket en iOS</h3>

<p>WebSocket es un protocolo de comunicación que permite una conexión bidireccional entre un cliente y un servidor. En iOS, puedes utilizar la clase <code class="language-plaintext highlighter-rouge">URLSessionWebSocketTask</code> para implementar WebSocket en tu aplicación. A continuación, te guiaré a través de los pasos básicos para configurar y utilizar WebSocket en una aplicación iOS.</p>

<h4 id="1-crear-una-instancia-de-urlsessionwebsockettask">1. Crear una instancia de <code class="language-plaintext highlighter-rouge">URLSessionWebSocketTask</code></h4>

<p>Primero, necesitas crear una instancia de <code class="language-plaintext highlighter-rouge">URLSessionWebSocketTask</code> utilizando una URL de WebSocket. Aquí tienes un ejemplo de cómo hacerlo:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://your.websocket.server"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">webSocketTask</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">webSocketTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="2-conectar-al-servidor-websocket">2. Conectar al servidor WebSocket</h4>

<p>Una vez que hayas creado la instancia de <code class="language-plaintext highlighter-rouge">URLSessionWebSocketTask</code>, puedes conectarte al servidor WebSocket utilizando el método <code class="language-plaintext highlighter-rouge">resume()</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">webSocketTask</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="3-enviar-mensajes-al-servidor">3. Enviar mensajes al servidor</h4>

<p>Para enviar un mensaje al servidor, puedes utilizar el método <code class="language-plaintext highlighter-rouge">send(_:)</code> de <code class="language-plaintext highlighter-rouge">URLSessionWebSocketTask</code>. Aquí tienes un ejemplo de cómo enviar un mensaje de texto:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="kt">URLSessionWebSocketTask</span><span class="o">.</span><span class="kt">Message</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="s">"Hello, WebSocket!"</span><span class="p">)</span>
<span class="n">webSocketTask</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error sending message: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="4-recibir-mensajes-del-servidor">4. Recibir mensajes del servidor</h4>

<p>Para recibir mensajes del servidor, puedes utilizar el método <code class="language-plaintext highlighter-rouge">receive(completionHandler:)</code>. Este método te permite recibir mensajes de forma asíncrona:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">webSocketTask</span><span class="o">.</span><span class="n">receive</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Error receiving message: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="k">let</span> <span class="nv">message</span><span class="p">):</span>
        <span class="k">switch</span> <span class="n">message</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="k">let</span> <span class="nv">text</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Received text: </span><span class="se">\(</span><span class="n">text</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="k">let</span> <span class="nv">data</span><span class="p">):</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Received data: </span><span class="se">\(</span><span class="n">data</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="kd">@unknown</span> <span class="k">default</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Received unknown message type"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="5-cerrar-la-conexión-websocket">5. Cerrar la conexión WebSocket</h4>

<p>Cuando ya no necesites la conexión WebSocket, puedes cerrarla utilizando el método <code class="language-plaintext highlighter-rouge">cancel(with:reason:)</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">webSocketTask</span><span class="o">.</span><span class="nf">cancel</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="o">.</span><span class="n">goingAway</span><span class="p">,</span> <span class="nv">reason</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="6-manejar-errores-y-reconexiones">6. Manejar errores y reconexiones</h4>

<p>Es importante manejar los errores y las reconexiones en tu aplicación. Puedes utilizar el método <code class="language-plaintext highlighter-rouge">URLSessionDelegate</code> para manejar eventos de conexión y desconexión.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">WebSocketManager</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">URLSessionWebSocketDelegate</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">webSocketTask</span><span class="p">:</span> <span class="kt">URLSessionWebSocketTask</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"wss://your.websocket.server"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">delegateQueue</span><span class="p">:</span> <span class="kt">OperationQueue</span><span class="p">())</span>
        <span class="n">webSocketTask</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="nf">webSocketTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">webSocketTask</span><span class="p">?</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">urlSession</span><span class="p">(</span><span class="n">_</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">URLSession</span><span class="p">,</span> <span class="nv">webSocketTask</span><span class="p">:</span> <span class="kt">URLSessionWebSocketTask</span><span class="p">,</span> <span class="n">didOpenWithProtocol</span> <span class="nv">protocol</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"WebSocket connected"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">urlSession</span><span class="p">(</span><span class="n">_</span> <span class="nv">session</span><span class="p">:</span> <span class="kt">URLSession</span><span class="p">,</span> <span class="nv">webSocketTask</span><span class="p">:</span> <span class="kt">URLSessionWebSocketTask</span><span class="p">,</span> <span class="n">didCloseWith</span> <span class="nv">closeCode</span><span class="p">:</span> <span class="kt">URLSessionWebSocketTask</span><span class="o">.</span><span class="kt">CloseCode</span><span class="p">,</span> <span class="nv">reason</span><span class="p">:</span> <span class="kt">Data</span><span class="p">?)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"WebSocket disconnected"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="conclusión">Conclusión</h4>

<p>Implementar WebSocket en iOS es relativamente sencillo utilizando las APIs proporcionadas por <code class="language-plaintext highlighter-rouge">URLSession</code>. Con esta guía, deberías poder configurar una conexión WebSocket, enviar y recibir mensajes, y manejar errores y reconexiones en tu aplicación iOS. ¡Buena suerte con tu implementación!</p>

<p><strong>Bibliotecas populares de WebSocket para iOS:</strong></p>
<ul>
  <li><strong>SocketRocket (Objective-C, 4910 estrellas)</strong></li>
  <li><strong>Starscream (Swift, 1714 estrellas)</strong></li>
  <li><strong>SwiftWebSocket (Swift, 435 estrellas)</strong></li>
</ul>

<h3 id="usando-srwebsocket">Usando SRWebSocket</h3>

<ol>
  <li><strong>Inicialización y conexión:</strong>
    <pre><code class="language-objective-c">SRWebSocket *webSocket = [[SRWebSocket alloc] initWithURLRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@"ws://echo.websocket.org"]]];
webSocket.delegate = self;
[webSocket open];
</code></pre>
  </li>
  <li><strong>Enviar mensaje:</strong>
    <pre><code class="language-objective-c">[webSocket send:@"Hello, World!"];
</code></pre>
  </li>
  <li>
    <p><strong>Recibir mensajes:</strong>
Implementa los métodos de <code class="language-plaintext highlighter-rouge">SRWebSocketDelegate</code> para manejar los mensajes entrantes y eventos.</p>
  </li>
  <li><strong>Manejo de errores y notificaciones de eventos:</strong>
Maneja adecuadamente los errores y notifica a los usuarios sobre problemas de conexión.</li>
</ol>

<h3 id="explicación-detallada-del-protocolo-websocket">Explicación detallada del protocolo WebSocket</h3>

<p>WebSocket opera sobre TCP e introduce varias mejoras:</p>
<ul>
  <li><strong>Modelo de seguridad:</strong> Añade un modelo de verificación de seguridad basado en el origen del navegador.</li>
  <li><strong>Direccionamiento y nomenclatura de protocolos:</strong> Soporta múltiples servicios en un solo puerto y múltiples nombres de dominio en una sola dirección IP.</li>
  <li><strong>Mecanismo de tramas:</strong> Mejora TCP con un mecanismo de tramas similar a los paquetes IP, sin límite de longitud.</li>
  <li><strong>Protocolo de cierre:</strong> Asegura un cierre limpio de la conexión.</li>
</ul>

<h3 id="el-núcleo-del-protocolo-websocket">El núcleo del protocolo WebSocket</h3>

<p>El protocolo WebSocket es un protocolo de comunicación bidireccional que permite la transmisión de datos en tiempo real entre un cliente y un servidor. A diferencia de HTTP, que es un protocolo de solicitud-respuesta, WebSocket mantiene una conexión persistente entre el cliente y el servidor, lo que permite la transmisión de datos en ambos sentidos sin necesidad de realizar múltiples solicitudes.</p>

<h4 id="características-clave-de-websocket">Características clave de WebSocket:</h4>

<ol>
  <li>
    <p><strong>Conexión persistente</strong>: Una vez establecida la conexión WebSocket, esta permanece abierta, lo que permite la transmisión de datos en tiempo real sin la sobrecarga de establecer y cerrar conexiones repetidamente.</p>
  </li>
  <li>
    <p><strong>Bidireccional</strong>: Tanto el cliente como el servidor pueden enviar datos en cualquier momento, lo que facilita la comunicación en tiempo real.</p>
  </li>
  <li>
    <p><strong>Baja latencia</strong>: Debido a la naturaleza persistente de la conexión, la latencia en la transmisión de datos es significativamente menor en comparación con HTTP.</p>
  </li>
  <li>
    <p><strong>Soporte para datos binarios y de texto</strong>: WebSocket puede transmitir tanto datos binarios como de texto, lo que lo hace versátil para una variedad de aplicaciones.</p>
  </li>
</ol>

<h4 id="establecimiento-de-la-conexión-websocket">Establecimiento de la conexión WebSocket</h4>

<p>El proceso de establecimiento de una conexión WebSocket comienza con un “handshake” HTTP. El cliente envía una solicitud HTTP al servidor con un encabezado especial <code class="language-plaintext highlighter-rouge">Upgrade: websocket</code>, indicando que desea cambiar al protocolo WebSocket. Si el servidor acepta la solicitud, responde con un código de estado <code class="language-plaintext highlighter-rouge">101 Switching Protocols</code>, y la conexión se actualiza a WebSocket.</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/chat</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">server.example.com</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">websocket</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade</span>
<span class="na">Sec-WebSocket-Key</span><span class="p">:</span> <span class="s">dGhlIHNhbXBsZSBub25jZQ==</span>
<span class="na">Sec-WebSocket-Version</span><span class="p">:</span> <span class="s">13</span>
</code></pre></div></div>

<p>El servidor responde con:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">101</span> <span class="ne">Switching Protocols</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">websocket</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade</span>
<span class="na">Sec-WebSocket-Accept</span><span class="p">:</span> <span class="s">s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span>
</code></pre></div></div>

<p>Una vez completado el handshake, la conexión se convierte en una conexión WebSocket y puede comenzar la transmisión de datos.</p>

<h4 id="transmisión-de-datos">Transmisión de datos</h4>

<p>Los datos en WebSocket se transmiten en forma de “frames”. Un frame puede contener datos de texto o binarios, y puede ser enviado en cualquier dirección. Los frames están diseñados para ser eficientes y tienen un encabezado pequeño que incluye información como el tipo de frame y la longitud de los datos.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Ejemplo de envío de datos desde el cliente</span>
<span class="kd">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws://example.com/chat</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hola, servidor!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mensaje recibido del servidor: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="cierre-de-la-conexión">Cierre de la conexión</h4>

<p>La conexión WebSocket puede cerrarse en cualquier momento por cualquiera de las partes (cliente o servidor). El cierre se realiza enviando un frame de cierre, que puede incluir un código de estado y un mensaje opcional que indica la razón del cierre.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Ejemplo de cierre de conexión desde el cliente</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Cierre normal</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="conclusión-1">Conclusión</h4>

<p>El protocolo WebSocket es una herramienta poderosa para aplicaciones que requieren comunicación en tiempo real, como chats en línea, juegos multijugador y actualizaciones en vivo. Su capacidad para mantener una conexión persistente y bidireccional lo hace ideal para escenarios donde la latencia y la eficiencia son críticas.</p>

<p><strong>1. Apretón de manos (Handshake):</strong>
   El apretón de manos de WebSocket utiliza el mecanismo de actualización de HTTP:</p>
<ul>
  <li><strong>Solicitud del cliente:</strong>
    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/chat</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">server.example.com</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">websocket</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade</span>
<span class="na">Sec-WebSocket-Key</span><span class="p">:</span> <span class="s">dGhlIHNhbXBsZSBub25jZQ==</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://example.com</span>
<span class="na">Sec-WebSocket-Protocol</span><span class="p">:</span> <span class="s">chat, superchat</span>
<span class="na">Sec-WebSocket-Version</span><span class="p">:</span> <span class="s">13</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Respuesta del servidor:</strong>
    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">101</span> <span class="ne">Switching Protocols</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">websocket</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade</span>
<span class="na">Sec-WebSocket-Accept</span><span class="p">:</span> <span class="s">s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span>
<span class="na">Sec-WebSocket-Protocol</span><span class="p">:</span> <span class="s">chat</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>2. Transferencia de datos:</strong>
   Los frames de WebSocket pueden contener texto en UTF-8, datos binarios y frames de control, como cierre, ping y pong.</p>

<p><strong>3. Seguridad:</strong>
   El navegador agrega automáticamente la cabecera <code class="language-plaintext highlighter-rouge">Origin</code>, la cual no puede ser falsificada por otros clientes.</p>

<h3 id="uri-de-websocket">URI de WebSocket</h3>

<ul>
  <li><strong>ws-URI：</strong> <code class="language-plaintext highlighter-rouge">ws://host:port/path?query</code></li>
  <li><strong>wss-URI：</strong> <code class="language-plaintext highlighter-rouge">wss://host:port/path?query</code></li>
</ul>

<h3 id="protocolo-de-tramas-websocket">Protocolo de tramas WebSocket</h3>

<p><strong>Estructura del Frame:</strong></p>
<ul>
  <li><strong>FIN (1 bit):</strong> Indica si este es el último fragmento del mensaje.</li>
  <li><strong>RSV1, RSV2, RSV3 (1 bit cada uno):</strong> Reservados para uso futuro.</li>
  <li><strong>Opcode (4 bits):</strong> Define cómo se debe interpretar la carga útil.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">0x0:</code> Frame de continuación</li>
      <li><code class="language-plaintext highlighter-rouge">0x1:</code> Frame de texto</li>
      <li><code class="language-plaintext highlighter-rouge">0x2:</code> Frame binario</li>
      <li><code class="language-plaintext highlighter-rouge">0x8:</code> Cierre de conexión</li>
      <li><code class="language-plaintext highlighter-rouge">0x9:</code> Ping</li>
      <li><code class="language-plaintext highlighter-rouge">0xA:</code> Pong</li>
    </ul>
  </li>
  <li><strong>Mask (1 bit):</strong> Indica si la carga útil está enmascarada.</li>
  <li><strong>Longitud de la carga útil (7 bits):</strong> Longitud de los datos de la carga útil.</li>
</ul>

<p><strong>Clave de máscara:</strong> Se utiliza para prevenir ataques de intermediario al enmascarar los fotogramas del cliente.</p>

<h3 id="cierre-del-apretón-de-manos-handshake">Cierre del apretón de manos (Handshake)</h3>

<p><strong>Marco de cierre:</strong></p>
<ul>
  <li>Puede contener un cuerpo que indique la razón del cierre.</li>
  <li>Ambas partes deben enviar y responder al marco de cierre.</li>
</ul>

<h3 id="ejemplo">Ejemplo</h3>

<p><strong>Ejemplo 1: Mensaje de texto sin enmascarar en un solo frame</strong></p>
<pre><code class="language-hex">0x81 0x05 0x48 0x65 0x6c 0x6c 0x6f
</code></pre>
<p>Contiene “Hello”</p>

<p><strong>Ejemplo 2: Mensaje de texto enmascarado en un solo marco</strong></p>
<pre><code class="language-hex">0x81 0x85 0x37 0xfa 0x21 0x3d 0x7f 0x9f 0x4d 0x51 0x58
</code></pre>
<p>Contiene “Hello”, con clave de enmascaramiento.</p>

<p><strong>Ejemplo 3: Mensaje de texto fragmentado sin enmascarar</strong></p>
<pre><code class="language-hex">0x01 0x03 0x48 0x65 0x6c
0x80 0x02 0x6c 0x6f
</code></pre>
<p>El mensaje fragmentado contiene dos tramas: “Hel” y “lo”.</p>

<h3 id="temas-avanzados">Temas avanzados</h3>

<p><strong>Enmascaramiento y Desenmascaramiento:</strong></p>
<ul>
  <li>El enmascaramiento se utiliza para prevenir ataques de intermediario (man-in-the-middle).</li>
  <li>Cada trama enviada desde el cliente debe estar enmascarada.</li>
  <li>La clave de enmascaramiento para cada trama se selecciona aleatoriamente.</li>
</ul>

<p><strong>Fragmentación:</strong></p>
<ul>
  <li>Se utiliza para enviar datos de longitud desconocida.</li>
  <li>Los mensajes fragmentados comienzan con un frame donde FIN es 0 y terminan con un frame donde FIN es 1.</li>
</ul>

<p><strong>Marcos de Control:</strong></p>
<ul>
  <li>Los marcos de control (como cierre, ping y pong) tienen códigos de operación específicos.</li>
  <li>Estos marcos se utilizan para gestionar el estado de la conexión WebSocket.</li>
</ul>

<h3 id="escalabilidad">Escalabilidad</h3>

<p><strong>Los datos de extensión pueden colocarse antes de los datos de la aplicación en el cuerpo del mensaje:</strong></p>
<ul>
  <li>Los bits reservados pueden controlar cada trama.</li>
  <li>Se reservan algunos códigos de operación para futuras definiciones.</li>
  <li>Si se necesitan más códigos de operación, se pueden utilizar los bits reservados.</li>
</ul>

<p><strong>Envío:</strong></p>
<ul>
  <li>Es necesario asegurarse de que la conexión esté en estado OPEN.</li>
  <li>Los datos se encapsulan en tramas, y si los datos son demasiado grandes, se puede optar por enviarlos en fragmentos.</li>
  <li>El valor de la primera trama debe ser correcto, indicando al receptor el tipo de datos (texto o binario).</li>
  <li>El FIN de la última trama debe estar configurado en 1.</li>
</ul>

<p><strong>Cierre del apretón de manos (Handshake):</strong></p>
<ul>
  <li>Ambas partes pueden enviar un marco de cierre.</li>
  <li>Después de enviar el marco de cierre, no se envía más datos.</li>
  <li>Al recibir un marco de cierre, se descartan todos los datos recibidos posteriormente.</li>
</ul>

<p><strong>Cerrar la conexión:</strong></p>
<ul>
  <li>Cerrar la conexión WebSocket, es decir, cerrar la conexión TCP subyacente.</li>
  <li>Después de enviar o recibir un marco de cierre, el estado de la conexión WebSocket es “cerrando”.</li>
  <li>Cuando la conexión TCP subyacente se cierra, el estado de la conexión WebSocket es “cerrada”.</li>
</ul>

<h3 id="referencias">Referencias</h3>

<ul>
  <li>WebSocket RFC: <a href="https://tools.ietf.org/html/rfc6455">RFC6455</a></li>
  <li>Zhihu《¿Cuál es el principio de WebSocket?》: <a href="https://www.zhihu.com/question/20215561">Enlace de Zhihu</a></li>
  <li>SocketRocket: <a href="https://github.com/square/SocketRocket">Enlace de GitHub</a></li>
</ul>

<h3 id="agradecimientos">Agradecimientos</h3>

<p>Gracias a todos por su atención. Si tienen más preguntas o desean discutir algún tema, no duden en contactarme en GitHub o Weibo.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-es" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
