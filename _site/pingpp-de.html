<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Ping++ SDK in das CodeIgniter Framework integrieren</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Ping++ SDK in das CodeIgniter Framework integrieren | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Ping++ SDK in das CodeIgniter Framework integrieren" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="de" />
<meta name="description" content="Unten ist ein vollständiges, schrittweise Beispiel, wie man Pingpp (Ping++) eine Zahlungsverarbeitungs-SDK in eine PHP-Anwendung mit dem CodeIgniter-Framework integriert, basierend auf der bereitgestellten BaseController-Klasse. Diese Anleitung setzt voraus, dass Sie eine grundlegende CodeIgniter-Einrichtung haben und sich auf die Integration von Pingpp für die Zahlungsverarbeitung konzentriert, wie z.B. das Ermöglichen von Zahlungen über Alipay PC Direct (obwohl Sie es für andere Kanäle anpassen können)." />
<meta property="og:description" content="Unten ist ein vollständiges, schrittweise Beispiel, wie man Pingpp (Ping++) eine Zahlungsverarbeitungs-SDK in eine PHP-Anwendung mit dem CodeIgniter-Framework integriert, basierend auf der bereitgestellten BaseController-Klasse. Diese Anleitung setzt voraus, dass Sie eine grundlegende CodeIgniter-Einrichtung haben und sich auf die Integration von Pingpp für die Zahlungsverarbeitung konzentriert, wie z.B. das Ermöglichen von Zahlungen über Alipay PC Direct (obwohl Sie es für andere Kanäle anpassen können)." />
<link rel="canonical" href="https://lzwjava.github.io/pingpp-de" />
<meta property="og:url" content="https://lzwjava.github.io/pingpp-de" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Ping++ SDK in das CodeIgniter Framework integrieren" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2016-03-07T00:00:00+08:00","datePublished":"2016-03-07T00:00:00+08:00","description":"Unten ist ein vollständiges, schrittweise Beispiel, wie man Pingpp (Ping++) eine Zahlungsverarbeitungs-SDK in eine PHP-Anwendung mit dem CodeIgniter-Framework integriert, basierend auf der bereitgestellten BaseController-Klasse. Diese Anleitung setzt voraus, dass Sie eine grundlegende CodeIgniter-Einrichtung haben und sich auf die Integration von Pingpp für die Zahlungsverarbeitung konzentriert, wie z.B. das Ermöglichen von Zahlungen über Alipay PC Direct (obwohl Sie es für andere Kanäle anpassen können).","headline":"Ping++ SDK in das CodeIgniter Framework integrieren","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/pingpp-de"},"url":"https://lzwjava.github.io/pingpp-de"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=654650831ecf8938f52ac82541c28354f6cc3698">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=654650831ecf8938f52ac82541c28354f6cc3698" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Ping++ SDK in das CodeIgniter Framework integrieren | Original, von KI übersetzt
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/de/2016-03-07-pingpp-de.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsde2016-03-07-pingpp-de.md</span> -->
      

      <!-- <span>2016-03-07-pingpp-de.md</span> -->

      
        

        
          
          <a href="#" class="button">2016.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/pingpp-en" >English</option>
        <option value="/pingpp-zh" >中文</option>
        <option value="/pingpp-ja" >日本語</option>
        <option value="/pingpp-es" >Español</option>
        <option value="/pingpp-hi" >हिंदी</option>
        <option value="/pingpp-fr" >Français</option>
        <option value="/pingpp-de" selected>Deutsch</option>
        <option value="/pingpp-ar" >العربية</option>
        <option value="/pingpp-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>Unten ist ein vollständiges, schrittweise Beispiel, wie man <strong>Pingpp</strong> (Ping++) eine Zahlungsverarbeitungs-SDK in eine PHP-Anwendung mit dem CodeIgniter-Framework integriert, basierend auf der bereitgestellten <code class="language-plaintext highlighter-rouge">BaseController</code>-Klasse. Diese Anleitung setzt voraus, dass Sie eine grundlegende CodeIgniter-Einrichtung haben und sich auf die Integration von Pingpp für die Zahlungsverarbeitung konzentriert, wie z.B. das Ermöglichen von Zahlungen über Alipay PC Direct (obwohl Sie es für andere Kanäle anpassen können).</p>

<hr />

<h3 id="voraussetzungen">Voraussetzungen</h3>
<ol>
  <li><strong>Pingpp-Konto</strong>: Registrieren Sie sich bei <a href="https://www.pingxx.com/">Ping++</a> und erhalten Sie Ihren <strong>API-Schlüssel</strong> und <strong>App-ID</strong>. Sie haben einen Testschlüssel (<code class="language-plaintext highlighter-rouge">sk_test_...</code>) für die Entwicklung und einen Live-Schlüssel (<code class="language-plaintext highlighter-rouge">sk_live_...</code>) für die Produktion.</li>
  <li><strong>Pingpp PHP SDK</strong>: Installieren Sie das Pingpp PHP SDK über Composer:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require pingplusplus/pingpp-php
</code></pre></div>    </div>
    <p>Stellen Sie sicher, dass die SDK in Ihrer CodeIgniter-Anwendung autogeladen wird (z.B. legen Sie sie in <code class="language-plaintext highlighter-rouge">application/libraries</code> ab oder konfigurieren Sie das Composer-Autoloading).</p>
  </li>
  <li><strong>CodeIgniter-Einrichtung</strong>: Sie sollten eine funktionierende CodeIgniter-Anwendung mit einem Controller und Datenbankmodellen für Benutzer und Gebühren haben.</li>
</ol>

<hr />

<h3 id="schritt-für-schritt-integration">Schritt-für-Schritt-Integration</h3>

<h4 id="1-controller-einrichten">1. Controller einrichten</h4>
<p>Erstellen Sie einen Controller (z.B. <code class="language-plaintext highlighter-rouge">PaymentController.php</code>), der eine Basiscontroller ähnlich wie <code class="language-plaintext highlighter-rouge">BaseController</code> erweitert. Konfigurieren Sie den Pingpp API-Schlüssel im Konstruktor basierend auf Ihrer Umgebung (Entwicklung oder Produktion).</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">defined</span><span class="p">(</span><span class="s1">'BASEPATH'</span><span class="p">)</span> <span class="k">OR</span> <span class="k">exit</span><span class="p">(</span><span class="s1">'Kein direkter Skriptzugriff erlaubt'</span><span class="p">);</span>

<span class="k">require_once</span> <span class="no">APPPATH</span> <span class="mf">.</span> <span class="s1">'/libraries/REST_Controller.php'</span><span class="p">;</span>
<span class="k">require_once</span> <span class="no">APPPATH</span> <span class="mf">.</span> <span class="s1">'/vendor/autoload.php'</span><span class="p">;</span> <span class="c1">// Angenommen, Composer Autoload</span>

<span class="kd">class</span> <span class="nc">PaymentController</span> <span class="kd">extends</span> <span class="nc">REST_Controller</span> <span class="p">{</span>

    <span class="k">public</span> <span class="nv">$userDao</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$chargeDao</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="nf">__construct</span><span class="p">();</span>

        <span class="c1">// Setzen Sie den Pingpp API-Schlüssel basierend auf der Umgebung</span>
        <span class="nv">$isLocalDebug</span> <span class="o">=</span> <span class="no">ENVIRONMENT</span> <span class="o">===</span> <span class="s1">'development'</span><span class="p">;</span> <span class="c1">// CodeIgniter-Umgebung</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$isLocalDebug</span><span class="p">)</span> <span class="p">{</span>
            <span class="err">\</span><span class="nc">Pingpp\Pingpp</span><span class="o">::</span><span class="nf">setApiKey</span><span class="p">(</span><span class="s1">'sk_test_your_test_key_here'</span><span class="p">);</span> <span class="c1">// Ersetzen Sie durch Ihren Testschlüssel</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="err">\</span><span class="nc">Pingpp\Pingpp</span><span class="o">::</span><span class="nf">setApiKey</span><span class="p">(</span><span class="s1">'sk_live_your_live_key_here'</span><span class="p">);</span> <span class="c1">// Ersetzen Sie durch Ihren Live-Schlüssel</span>
        <span class="p">}</span>

        <span class="c1">// Laden Sie Modelle</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">load</span><span class="o">-&gt;</span><span class="nf">model</span><span class="p">(</span><span class="s1">'UserDao'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">userDao</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserDao</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">load</span><span class="o">-&gt;</span><span class="nf">model</span><span class="p">(</span><span class="s1">'ChargeDao'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">chargeDao</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChargeDao</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Ersetzen Sie <code class="language-plaintext highlighter-rouge">'sk_test_your_test_key_here'</code> und <code class="language-plaintext highlighter-rouge">'sk_live_your_live_key_here'</code> durch Ihre tatsächlichen Pingpp API-Schlüssel.</li>
  <li>Stellen Sie sicher, dass <code class="language-plaintext highlighter-rouge">UserDao</code> und <code class="language-plaintext highlighter-rouge">ChargeDao</code> implementiert sind, um die Benutzerauthentifizierung und die Gebührenverwaltung zu handhaben (siehe Schritt 2).</li>
</ul>

<h4 id="2-unterstützende-modelle-erstellen">2. Unterstützende Modelle erstellen</h4>
<p>Sie benötigen Modelle, um Benutzersitzungen zu verwalten und Gebührendetails zu speichern.</p>

<p><strong>UserDao.php</strong> (vereinfachtes Beispiel):</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">UserDao</span> <span class="kd">extends</span> <span class="nc">CI_Model</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">findUserBySessionToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="nf">get_where</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'session_token'</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="p">]);</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">row</span><span class="p">();</span> <span class="c1">// Gibt ein Benutzerobjekt oder null zurück</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>ChargeDao.php</strong> (vereinfachtes Beispiel):</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">ChargeDao</span> <span class="kd">extends</span> <span class="nc">CI_Model</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">add</span><span class="p">(</span><span class="nv">$orderNo</span><span class="p">,</span> <span class="nv">$amount</span><span class="p">,</span> <span class="nv">$userId</span><span class="p">,</span> <span class="nv">$ipAddress</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">'order_no'</span> <span class="o">=&gt;</span> <span class="nv">$orderNo</span><span class="p">,</span>
            <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="nv">$amount</span><span class="p">,</span>
            <span class="s1">'user_id'</span> <span class="o">=&gt;</span> <span class="nv">$userId</span><span class="p">,</span>
            <span class="s1">'client_ip'</span> <span class="o">=&gt;</span> <span class="nv">$ipAddress</span><span class="p">,</span>
            <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'pending'</span><span class="p">,</span>
            <span class="s1">'created_at'</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">)</span>
        <span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">db</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">(</span><span class="s1">'charges'</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Erstellen Sie entsprechende Datenbanktabellen (<code class="language-plaintext highlighter-rouge">users</code> und <code class="language-plaintext highlighter-rouge">charges</code>) mit den entsprechenden Feldern.</p>

<h4 id="3-gebührenerstellungsmethode-implementieren">3. Gebührenerstellungsmethode implementieren</h4>
<p>Fügen Sie eine Methode hinzu, um eine Pingpp-Gebühr zu erstellen und sie an den Client zurückzugeben. Dieses Beispiel verwendet Alipay PC Direct als Zahlungskanal.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">createChargeThenResponse</span><span class="p">(</span><span class="nv">$amount</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$body</span><span class="p">,</span> <span class="nv">$metaData</span><span class="p">,</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Generieren Sie eine eindeutige Bestellnummer</span>
    <span class="nv">$orderNo</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">generateOrderNo</span><span class="p">();</span>

    <span class="c1">// Setzen Sie die App-ID basierend auf der Umgebung</span>
    <span class="nv">$isLocalDebug</span> <span class="o">=</span> <span class="no">ENVIRONMENT</span> <span class="o">===</span> <span class="s1">'development'</span><span class="p">;</span>
    <span class="nv">$appId</span> <span class="o">=</span> <span class="nv">$isLocalDebug</span> <span class="o">?</span> <span class="s1">'app_your_test_app_id'</span> <span class="o">:</span> <span class="s1">'app_your_live_app_id'</span><span class="p">;</span>

    <span class="c1">// Holen Sie sich die IP-Adresse des Clients</span>
    <span class="nv">$ipAddress</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">input</span><span class="o">-&gt;</span><span class="nf">ip_address</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$ipAddress</span> <span class="o">===</span> <span class="s1">'::1'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Behandeln Sie den lokalen Debug-Fall</span>
        <span class="nv">$ipAddress</span> <span class="o">=</span> <span class="s1">'127.0.0.1'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Erstellen Sie die Gebühr</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$charge</span> <span class="o">=</span> <span class="err">\</span><span class="nc">Pingpp\Charge</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'order_no'</span> <span class="o">=&gt;</span> <span class="nv">$orderNo</span><span class="p">,</span>
            <span class="s1">'app'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$appId</span><span class="p">],</span>
            <span class="s1">'channel'</span> <span class="o">=&gt;</span> <span class="s1">'alipay_pc_direct'</span><span class="p">,</span> <span class="c1">// Ändern Sie dies für andere Kanäle (z.B. 'wx' für WeChat)</span>
            <span class="s1">'amount'</span> <span class="o">=&gt;</span> <span class="nv">$amount</span><span class="p">,</span> <span class="c1">// In Cent (z.B. 1000 = 10 CNY)</span>
            <span class="s1">'client_ip'</span> <span class="o">=&gt;</span> <span class="nv">$ipAddress</span><span class="p">,</span>
            <span class="s1">'currency'</span> <span class="o">=&gt;</span> <span class="s1">'cny'</span><span class="p">,</span>
            <span class="s1">'subject'</span> <span class="o">=&gt;</span> <span class="nv">$subject</span><span class="p">,</span>
            <span class="s1">'body'</span> <span class="o">=&gt;</span> <span class="nv">$body</span><span class="p">,</span>
            <span class="s1">'metadata'</span> <span class="o">=&gt;</span> <span class="nv">$metaData</span><span class="p">,</span>
            <span class="s1">'extra'</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">'success_url'</span> <span class="o">=&gt;</span> <span class="s1">'http://yourdomain.com/payment/success'</span> <span class="c1">// Ersetzen Sie durch Ihre Erfolg-URL</span>
            <span class="p">]</span>
        <span class="p">]);</span>

        <span class="c1">// Speichern Sie die Gebührendetails in der Datenbank</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">chargeDao</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="nv">$orderNo</span><span class="p">,</span> <span class="nv">$amount</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="nv">$ipAddress</span><span class="p">);</span>

        <span class="c1">// Geben Sie das Gebührenobjekt als JSON zurück</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">output</span>
            <span class="o">-&gt;</span><span class="nf">set_status_header</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">set_content_type</span><span class="p">(</span><span class="s1">'application/json'</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">set_output</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$charge</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">Pingpp\Error\Base</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">log_message</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="s1">'Pingpp Charge Failed: '</span> <span class="mf">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">response</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'Erstellung der Zahlung fehlgeschlagen'</span><span class="p">],</span> <span class="mi">500</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">function</span> <span class="n">generateOrderNo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">uniqid</span><span class="p">();</span> <span class="c1">// Einfache eindeutige ID; ersetzen Sie durch einen robusteren Generator, wenn nötig</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Ersetzen Sie <code class="language-plaintext highlighter-rouge">'app_your_test_app_id'</code> und <code class="language-plaintext highlighter-rouge">'app_your_live_app_id'</code> durch Ihre Pingpp App-IDs.</li>
  <li>Passen Sie <code class="language-plaintext highlighter-rouge">'success_url'</code> an Ihre Anwendungs-Erfolgseite-URL an.</li>
</ul>

<h4 id="4-checkout-methode-erstellen">4. Checkout-Methode erstellen</h4>
<p>Fügen Sie eine öffentliche Methode hinzu, um den Benutzer-Checkout zu verarbeiten, indem Sie die Gebührenerstellungsmethode aufrufen.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">checkout_post</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Überprüfen Sie, ob der Benutzer angemeldet ist</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getSessionUser</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">response</span><span class="p">([</span><span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'Benutzer nicht angemeldet'</span><span class="p">],</span> <span class="mi">401</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Beispiel-Bestelldetails</span>
    <span class="nv">$amount</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// 10 CNY (Beispiel; berechnen Sie dies dynamisch in einer echten App)</span>
    <span class="nv">$subject</span> <span class="o">=</span> <span class="s1">'Bestellzahlung'</span><span class="p">;</span>
    <span class="nv">$body</span> <span class="o">=</span> <span class="s1">'Zahlung für Bestellung #123'</span><span class="p">;</span>
    <span class="nv">$metaData</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'order_id'</span> <span class="o">=&gt;</span> <span class="s1">'123'</span><span class="p">];</span> <span class="c1">// Fügen Sie bestellenspezifische Daten hinzu</span>

    <span class="c1">// Erstellen Sie eine Gebühr und antworten Sie</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">createChargeThenResponse</span><span class="p">(</span><span class="nv">$amount</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$body</span><span class="p">,</span> <span class="nv">$metaData</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">function</span> <span class="n">getSessionUser</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">input</span><span class="o">-&gt;</span><span class="nf">get_request_header</span><span class="p">(</span><span class="s1">'Authorization'</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">);</span> <span class="c1">// Passen Sie dies basierend auf Ihrem Auth-Verfahren an</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$token</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">userDao</span><span class="o">-&gt;</span><span class="nf">findUserBySessionToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="5-clientseitige-antwort-verarbeiten">5. Clientseitige Antwort verarbeiten</h4>
<p>Die Methode <code class="language-plaintext highlighter-rouge">createChargeThenResponse</code> gibt ein JSON <code class="language-plaintext highlighter-rouge">charge</code>-Objekt zurück. Für <code class="language-plaintext highlighter-rouge">alipay_pc_direct</code> enthält es ein <code class="language-plaintext highlighter-rouge">credential</code>-Feld mit einer Zahlungs-URL. Verarbeiten Sie dies auf der Clientseite (z.B. mit JavaScript).</p>

<p><strong>Beispiel (Frontend JavaScript):</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/payment/checkout</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-session-token</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">})</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">charge</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">charge</span><span class="p">.</span><span class="nx">credential</span> <span class="o">&amp;&amp;</span> <span class="nx">charge</span><span class="p">.</span><span class="nx">credential</span><span class="p">.</span><span class="nx">alipay_pc_direct</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">charge</span><span class="p">.</span><span class="nx">credential</span><span class="p">.</span><span class="nx">alipay_pc_direct</span><span class="p">;</span> <span class="c1">// Weiterleitung zu Alipay</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Zahlungsfehler:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">charge</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Fehler:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">));</span>
</code></pre></div></div>

<h4 id="6-erfolgseite">6. Erfolgseite</h4>
<p>Erstellen Sie eine Erfolgseite (z.B. <code class="language-plaintext highlighter-rouge">payment/success</code>), um eine Bestätigung nach der Zahlung anzuzeigen. Aktualisieren Sie den Bestellstatus hier manuell, falls erforderlich, obwohl Webhooks für die Zuverlässigkeit empfohlen werden (siehe Schritt 7).</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">success_get</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Optional: Überprüfen Sie hier den Zahlungsstatus</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">load</span><span class="o">-&gt;</span><span class="nf">view</span><span class="p">(</span><span class="s1">'payment_success'</span><span class="p">);</span> <span class="c1">// Laden Sie eine Ansicht</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="7-optional-webhooks-verarbeiten">7. (Optional) Webhooks verarbeiten</h4>
<p>Pingpp sendet asynchrone Zahlungsstatusaktualisierungen über Webhooks. Richten Sie ein Endpunkt ein, um diese Benachrichtigungen zu empfangen und Ihre Datenbank zu aktualisieren.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">webhook_post</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$rawData</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'php://input'</span><span class="p">);</span>
    <span class="nv">$event</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$rawData</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'charge.succeeded'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$charge</span> <span class="o">=</span> <span class="nv">$event</span><span class="p">[</span><span class="s1">'data'</span><span class="p">][</span><span class="s1">'object'</span><span class="p">];</span>
        <span class="nv">$orderNo</span> <span class="o">=</span> <span class="nv">$charge</span><span class="p">[</span><span class="s1">'order_no'</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">chargeDao</span><span class="o">-&gt;</span><span class="nf">updateStatus</span><span class="p">(</span><span class="nv">$orderNo</span><span class="p">,</span> <span class="s1">'paid'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">response</span><span class="p">([</span><span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'ok'</span><span class="p">],</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Fügen Sie eine <code class="language-plaintext highlighter-rouge">updateStatus</code>-Methode zu <code class="language-plaintext highlighter-rouge">ChargeDao</code> hinzu, um den Gebührenstatus zu aktualisieren.</li>
  <li>Konfigurieren Sie Ihre Webhook-URL im Pingpp-Dashboard (z.B. <code class="language-plaintext highlighter-rouge">http://yourdomain.com/payment/webhook</code>).</li>
</ul>

<hr />

<h3 id="vollständiges-beispiel-zur-verwendung">Vollständiges Beispiel zur Verwendung</h3>
<ol>
  <li><strong>Benutzeraktion</strong>: Ein Benutzer meldet sich an und initiiert einen Checkout über eine POST-Anfrage an <code class="language-plaintext highlighter-rouge">/payment/checkout</code>.</li>
  <li><strong>Serverantwort</strong>: Der Server erstellt eine Gebühr und gibt ein JSON-Objekt mit Zahlungsdetails zurück.</li>
  <li><strong>Client-Verarbeitung</strong>: Die Frontend-App leitet den Benutzer zur Alipay-Zahlungsseite weiter.</li>
  <li><strong>Zahlungsabschluss</strong>: Nach der Zahlung wird der Benutzer zur Erfolg-URL weitergeleitet.</li>
  <li><strong>Webhook-Aktualisierung</strong>: Pingpp benachrichtigt Ihren Webhook-Endpunkt, und Sie aktualisieren den Gebührenstatus.</li>
</ol>

<hr />

<h3 id="zusätzliche-hinweise">Zusätzliche Hinweise</h3>
<ul>
  <li><strong>Zahlungskanäle</strong>: Ersetzen Sie <code class="language-plaintext highlighter-rouge">'alipay_pc_direct'</code> durch andere Kanäle (z.B. <code class="language-plaintext highlighter-rouge">'wx'</code> für WeChat) nach Bedarf. Überprüfen Sie die <a href="https://www.pingxx.com/api">Pingpp-Dokumentation</a> für kanalbezogene <code class="language-plaintext highlighter-rouge">extra</code>-Parameter.</li>
  <li><strong>Fehlerbehandlung</strong>: Verbessern Sie die Fehlerbehandlung für die Produktion (z.B. Wiederholungslogik, detaillierte Fehlermeldungen).</li>
  <li><strong>Sicherheit</strong>: Validieren Sie die Benutzereingaben (<code class="language-plaintext highlighter-rouge">$amount</code> usw.) und sichern Sie Ihre API-Endpunkte.</li>
</ul>

<p>Dieses Beispiel bietet eine solide Grundlage für die Integration von Pingpp in Ihre CodeIgniter-Anwendung, die für verschiedene Anwendungsfälle wie E-Commerce oder Spenden angepasst werden kann.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-de" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
