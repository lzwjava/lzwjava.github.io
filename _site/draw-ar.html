<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>في هذه المدونة، سنستعرض فئة </title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>في هذه المدونة، سنستعرض فئة | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="في هذه المدونة، سنستعرض فئة" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="ar" />
<meta name="description" content="تمت كتابة هذه المدونة بمساعدة ChatGPT-4o." />
<meta property="og:description" content="تمت كتابة هذه المدونة بمساعدة ChatGPT-4o." />
<link rel="canonical" href="https://lzwjava.github.io/draw-ar" />
<meta property="og:url" content="https://lzwjava.github.io/draw-ar" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-04-25T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="في هذه المدونة، سنستعرض فئة" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2014-04-25T00:00:00+08:00","datePublished":"2014-04-25T00:00:00+08:00","description":"تمت كتابة هذه المدونة بمساعدة ChatGPT-4o.","headline":"في هذه المدونة، سنستعرض فئة","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/draw-ar"},"url":"https://lzwjava.github.io/draw-ar"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=85a797b07cc50aafed505a630368ecf2b89a797d">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=85a797b07cc50aafed505a630368ecf2b89a797d" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       في هذه المدونة، سنستعرض فئة  | أصلي، ترجم بواسطة AI
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/ar/2014-04-25-draw-ar.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsar2014-04-25-draw-ar.md</span> -->
      

      <!-- <span>2014-04-25-draw-ar.md</span> -->

      
        

        
          
          <a href="#" class="button">2014.04</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/draw-en" >English</option>
        <option value="/draw-zh" >中文</option>
        <option value="/draw-ja" >日本語</option>
        <option value="/draw-es" >Español</option>
        <option value="/draw-hi" >हिंदी</option>
        <option value="/draw-fr" >Français</option>
        <option value="/draw-de" >Deutsch</option>
        <option value="/draw-ar" selected>العربية</option>
        <option value="/draw-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p><em>تمت كتابة هذه المدونة بمساعدة ChatGPT-4o.</em></p>

<hr />

<h3 id="مقدمة">مقدمة</h3>

<p>في هذه المدونة، سنستعرض فئة <code class="language-plaintext highlighter-rouge">DrawActivity</code>، وهي مثال شامل لتنفيذ واجهة رسم مخصصة في تطبيقات Android. سنقوم بتفكيك كل مكون والخوارزميات المستخدمة، مع شرح مفصل لكيفية عملها معًا لتحقيق الوظائف المطلوبة.</p>

<hr />

<h3 id="جدول-المحتويات">جدول المحتويات</h3>
<p><a href="#نظرة-عامة-على-DrawActivity">نظرة عامة على DrawActivity</a><br />
<a href="#تهيئة-Activity">تهيئة Activity</a><br />
<a href="#معالجة-عمليات-الصورة">معالجة عمليات الصورة</a><br />
<a href="#إدارة-Fragment">إدارة Fragment</a><br />
<a href="#معالجة-الأحداث">معالجة الأحداث</a><br />
<a href="#ميزات-التراجع-والإعادة">ميزات التراجع والإعادة</a><br />
<a href="#تخصيص-DrawView">تخصيص DrawView</a><br />
<a href="#إدارة-التاريخ">إدارة التاريخ</a><br />
<a href="#الخلاصة">الخلاصة</a></p>

<hr />

<h3 id="نظرة-عامة-على-drawactivity">نظرة عامة على DrawActivity</h3>

<p><code class="language-plaintext highlighter-rouge">DrawActivity</code> هي فئة رئيسية في تطبيق الرسم الذي نقوم بتطويره. هذه الفئة مسؤولة عن إدارة واجهة المستخدم الخاصة بالرسم وتوفير الأدوات اللازمة للمستخدم لإنشاء وتعديل الرسومات. في هذا القسم، سنلقي نظرة عامة على المكونات الرئيسية لوظيفة <code class="language-plaintext highlighter-rouge">DrawActivity</code> وكيفية تفاعلها مع المستخدم.</p>

<h4 id="المكونات-الرئيسية">المكونات الرئيسية</h4>

<ol>
  <li><strong>Canvas (اللوحة)</strong>:
    <ul>
      <li>هذه هي المنطقة التي يتم فيها رسم الأشكال والخطوط. يتم تمثيلها بواسطة كائن <code class="language-plaintext highlighter-rouge">Canvas</code> في الكود.</li>
      <li>يمكن للمستخدم التفاعل مع اللوحة باستخدام اللمس أو الفأرة لإنشاء رسومات.</li>
    </ul>
  </li>
  <li><strong>الأدوات (Tools)</strong>:
    <ul>
      <li>يتضمن التطبيق مجموعة من الأدوات التي تسمح للمستخدم برسم أشكال مختلفة مثل الخطوط والدوائر والمستطيلات.</li>
      <li>يتم تمثيل كل أداة بواسطة فئة خاصة بها، مثل <code class="language-plaintext highlighter-rouge">LineTool</code>، <code class="language-plaintext highlighter-rouge">CircleTool</code>، <code class="language-plaintext highlighter-rouge">RectangleTool</code>.</li>
    </ul>
  </li>
  <li><strong>الألوان والفرش (Colors and Brushes)</strong>:
    <ul>
      <li>يمكن للمستخدم اختيار الألوان والفرش المختلفة لتخصيص الرسومات.</li>
      <li>يتم إدارة الألوان والفرش عبر فئة <code class="language-plaintext highlighter-rouge">Paint</code> في Android.</li>
    </ul>
  </li>
  <li><strong>حفظ الرسومات (Saving Drawings)</strong>:
    <ul>
      <li>يمكن للمستخدم حفظ الرسومات التي قام بإنشائها في صيغة ملفات مختلفة مثل PNG أو JPEG.</li>
      <li>يتم تنفيذ هذه الوظيفة عبر مكتبات معالجة الصور في Android.</li>
    </ul>
  </li>
</ol>

<h4 id="تفاعل-المستخدم">تفاعل المستخدم</h4>

<ul>
  <li><strong>الرسم</strong>: يقوم المستخدم باختيار أداة من شريط الأدوات ثم يبدأ بالرسم على اللوحة.</li>
  <li><strong>التعديل</strong>: يمكن للمستخدم تعديل الرسومات عن طريق تغيير الألوان أو استخدام أدوات التعديل مثل المسح.</li>
  <li><strong>الحفظ</strong>: بعد الانتهاء من الرسم، يمكن للمستخدم حفظ العمل في الجهاز أو مشاركته مع الآخرين.</li>
</ul>

<h4 id="مثال-على-الكود">مثال على الكود</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DrawActivity</span> <span class="kd">extends</span> <span class="nc">AppCompatActivity</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">CanvasView</span> <span class="n">canvasView</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_draw</span><span class="o">);</span>

        <span class="n">canvasView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">canvas</span><span class="o">);</span>
        <span class="nc">Toolbar</span> <span class="n">toolbar</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">);</span>
        <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearCanvas</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">canvasView</span><span class="o">.</span><span class="na">clearCanvas</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveDrawing</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">canvasView</span><span class="o">.</span><span class="na">getBitmap</span><span class="o">();</span>
        <span class="c1">// Save bitmap to file or share it</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>في هذا المثال، نرى كيف يتم تهيئة <code class="language-plaintext highlighter-rouge">DrawActivity</code> وإعداد اللوحة والأدوات. يتم تنفيذ وظائف مثل مسح اللوحة وحفظ الرسم عبر طرق محددة.</p>

<h4 id="الخلاصة">الخلاصة</h4>

<p><code class="language-plaintext highlighter-rouge">DrawActivity</code> هي الواجهة الرئيسية التي يتفاعل معها المستخدم لإنشاء الرسومات. من خلال فهم المكونات الرئيسية وكيفية تفاعلها، يمكننا تطوير تطبيق رسم قوي وسهل الاستخدام.</p>

<p><code class="language-plaintext highlighter-rouge">DrawActivity</code> هي النشاط الرئيسي الذي يتعامل مع عمليات الرسم، اقتصاص الصور، والتفاعل مع المكونات الأخرى مثل الأجزاء (fragments) ورفع الصور. يوفر واجهة مستخدم تمكن المستخدم من الرسم، التراجع، إعادة التنفيذ، ومعالجة الصور.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DrawActivity</span> <span class="kd">extends</span> <span class="nc">Activity</span> <span class="kd">implements</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span> <span class="o">{</span>
  <span class="c1">// ثوابت لرموز الطلبات ومعرفات الأجزاء (fragments)</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CAMERA_RESULT</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">CROP_RESULT</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DRAW_FRAGMENT</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">RECOG_FRAGMENT</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">RESULT_FRAGMENT</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">WAIT_FRAGMENT</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">MATERIAL_RESULT</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">RESULT_JSON</span> <span class="o">=</span> <span class="s">"resultJson"</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">INIT_FLOWER_ID</span> <span class="o">=</span> <span class="no">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">flower_b</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">LOGOUT</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">IMAGE_RESULT</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  
  <span class="c1">// متغيرات للتعامل مع الصور وعمليات الرسم</span>
  <span class="nc">String</span> <span class="n">baseUrl</span><span class="o">;</span>
  <span class="nc">DrawView</span> <span class="n">drawView</span><span class="o">;</span>
  <span class="nc">Bitmap</span> <span class="n">originImg</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">DrawActivity</span> <span class="n">instance</span><span class="o">;</span>
  <span class="nc">View</span> <span class="n">dir</span><span class="o">,</span> <span class="n">clear</span><span class="o">,</span> <span class="n">cameraView</span><span class="o">,</span> <span class="n">materialView</span><span class="o">,</span> <span class="n">scale</span><span class="o">;</span>
  <span class="nc">ImageView</span> <span class="n">undoView</span><span class="o">,</span> <span class="n">redoView</span><span class="o">;</span>
  <span class="nc">View</span> <span class="n">upload</span><span class="o">;</span>
  <span class="nc">String</span> <span class="n">cropPath</span><span class="o">;</span>
  <span class="nc">Tooltip</span> <span class="n">toolTip</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">curFragmentId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">serverId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Bitmap</span> <span class="n">resultBitmap</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">RadioGroup</span> <span class="n">radioGroup</span><span class="o">;</span>
  <span class="nc">Fragment</span> <span class="n">curFragment</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">curDrawMode</span><span class="o">;</span>
  <span class="nc">RadioButton</span> <span class="n">drawBackBtn</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Activity</span> <span class="n">cxt</span><span class="o">;</span>
  <span class="nc">Uri</span> <span class="n">curPicUri</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<h3 id="تهيئة-النشاط-activity">تهيئة النشاط (Activity)</h3>

<p>عند إنشاء نشاط جديد في تطبيق Android، يتم استدعاء دورة حياة النشاط (Activity Lifecycle) والتي تبدأ بمرحلة التهيئة. هذه المرحلة تُعرف بـ <code class="language-plaintext highlighter-rouge">onCreate()</code> وهي أول دالة يتم استدعاؤها عند إنشاء النشاط. في هذه الدالة، يتم تنفيذ المهام الأساسية مثل تهيئة واجهة المستخدم (UI) وتعيين المتغيرات الأولية.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span> <span class="c1">// تعيين ملف التخطيط (layout) للنشاط</span>

    <span class="c1">// تهيئة المتغيرات والمكونات الأخرى هنا</span>
<span class="o">}</span>
</code></pre></div></div>

<p>في الكود أعلاه:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">super.onCreate(savedInstanceState)</code> يستدعي الدالة الأصلية لضمان تنفيذ المهام الأساسية التي يقوم بها النظام.</li>
  <li><code class="language-plaintext highlighter-rouge">setContentView(R.layout.activity_main)</code> يعين ملف التخطيط الذي سيتم استخدامه لعرض واجهة المستخدم. في هذا المثال، يتم استخدام ملف <code class="language-plaintext highlighter-rouge">activity_main.xml</code>.</li>
</ul>

<p>بعد تنفيذ <code class="language-plaintext highlighter-rouge">onCreate()</code>، يتم استدعاء الدوال الأخرى في دورة حياة النشاط مثل <code class="language-plaintext highlighter-rouge">onStart()</code> و <code class="language-plaintext highlighter-rouge">onResume()</code>، والتي تعني أن النشاط أصبح مرئيًا وجاهزًا للتفاعل مع المستخدم.</p>

<p>عند إنشاء Activity، يتم تنفيذ عمليات التهيئة المختلفة مثل إعداد العرض، تحميل الصور الأولية، وتهيئة مستمعي الأحداث.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
  <span class="n">instance</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="n">cxt</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
  <span class="n">cropPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getCropPath</span><span class="o">();</span>
  <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">draw_layout</span><span class="o">);</span>
  <span class="n">findView</span><span class="o">();</span>
  <span class="n">setSize</span><span class="o">();</span>
  <span class="n">initOriginImage</span><span class="o">();</span>
  <span class="n">toolTip</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tooltip</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="n">initUndoRedoEnable</span><span class="o">();</span>
  <span class="n">setIp</span><span class="o">();</span>
  <span class="n">initDrawmode</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود المقدم مكتوب بلغة Java وهو جزء من طريقة <code class="language-plaintext highlighter-rouge">onCreate</code> في تطبيق Android. لا يتم ترجمة أسماء الدوال أو المتغيرات أو الكود نفسه، حيث أن هذه الأسماء يجب أن تبقى كما هي لضمان عمل التطبيق بشكل صحيح.</p>

<p><strong>findView()</strong><br />
تُستخدم هذه الطريقة لتهيئة العرض (View) المستخدم في النشاط (Activity).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">findView</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">drawView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">drawView</span><span class="o">);</span>
  <span class="n">undoView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">undo</span><span class="o">);</span>
  <span class="n">redoView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">redo</span><span class="o">);</span>
  <span class="n">scale</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">scale</span><span class="o">);</span>
  <span class="n">upload</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">upload</span><span class="o">);</span>
  <span class="n">clear</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">clear</span><span class="o">);</span>
  <span class="n">dir</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">dir</span><span class="o">);</span>
  <span class="n">materialView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">material</span><span class="o">);</span>
  <span class="n">cameraView</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">camera</span><span class="o">);</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dir</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">materialView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">undoView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">scale</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">redoView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">clear</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">cameraView</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">upload</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="n">initRadio</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تم تعيين مستمعين للنقر (<code class="language-plaintext highlighter-rouge">OnClickListener</code>) للعناصر التالية:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">dir</code></li>
  <li><code class="language-plaintext highlighter-rouge">materialView</code></li>
  <li><code class="language-plaintext highlighter-rouge">undoView</code></li>
  <li><code class="language-plaintext highlighter-rouge">scale</code></li>
  <li><code class="language-plaintext highlighter-rouge">redoView</code></li>
  <li><code class="language-plaintext highlighter-rouge">clear</code></li>
  <li><code class="language-plaintext highlighter-rouge">cameraView</code></li>
  <li><code class="language-plaintext highlighter-rouge">upload</code></li>
</ul>

<p>ثم تم استدعاء الدالة <code class="language-plaintext highlighter-rouge">initRadio()</code> لتهيئة الراديو.</p>

<p><strong>setSize()</strong><br />
تعيين حجم عرض الرسم.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">setSizeByResourceSize</span><span class="o">();</span>
  <span class="n">setViewSize</span><span class="o">(</span><span class="n">drawView</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setSize</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">setSizeByResourceSize</span><span class="o">();</span>
  <span class="n">setViewSize</span><span class="o">(</span><span class="n">drawView</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>لا يوجد تغيير في الكود لأنه مكتوب بلغة Java، وهي لغة برمجة عالمية ولا يتم ترجمتها.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setSizeByResourceSize</span><span class="o">()</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">dimen</span><span class="o">.</span><span class="na">draw_width</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">dimen</span><span class="o">.</span><span class="na">draw_height</span><span class="o">);</span>
  <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
  <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setSizeByResourceSize</span><span class="o">()</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">dimen</span><span class="o">.</span><span class="na">draw_width</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getDimensionPixelSize</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">dimen</span><span class="o">.</span><span class="na">draw_height</span><span class="o">);</span>
  <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
  <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>في هذه الدالة، يتم تعيين حجم العرض والارتفاع بناءً على القيم المحددة في ملف الموارد (<code class="language-plaintext highlighter-rouge">R.dimen.draw_width</code> و <code class="language-plaintext highlighter-rouge">R.dimen.draw_height</code>)، ثم يتم تعيين هذه القيم في المتغيرات العامة <code class="language-plaintext highlighter-rouge">App.drawWidth</code> و <code class="language-plaintext highlighter-rouge">App.drawHeight</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setViewSize</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span> <span class="n">lp</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">getLayoutParams</span><span class="o">();</span>
  <span class="n">lp</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span><span class="o">;</span>
  <span class="n">lp</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">;</span>
  <span class="n">v</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="n">lp</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>initOriginImage()</strong><br />
تحميل الصورة الأولية التي سيتم استخدامها للرسم.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">initOriginImage</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="no">INIT_FLOWER_ID</span><span class="o">);</span>
  <span class="nc">String</span> <span class="n">imgPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getCameraPath</span><span class="o">();</span>
  <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">saveBitmapToPath</span><span class="o">(</span><span class="n">bitmap</span><span class="o">,</span> <span class="n">imgPath</span><span class="o">);</span>
  <span class="nc">Uri</span> <span class="n">uri1</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">imgPath</span><span class="o">));</span>
  <span class="n">setImageByUri</span><span class="o">(</span><span class="n">uri1</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ترجمة الكود إلى العربية:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">initOriginImage</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// تحميل صورة من الموارد باستخدام معرف الصورة الأولية</span>
  <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapFactory</span><span class="o">.</span><span class="na">decodeResource</span><span class="o">(</span><span class="n">getResources</span><span class="o">(),</span> <span class="no">INIT_FLOWER_ID</span><span class="o">);</span>
  
  <span class="c1">// الحصول على مسار حفظ الصورة من الكاميرا</span>
  <span class="nc">String</span> <span class="n">imgPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getCameraPath</span><span class="o">();</span>
  
  <span class="c1">// حفظ الصورة في المسار المحدد</span>
  <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">saveBitmapToPath</span><span class="o">(</span><span class="n">bitmap</span><span class="o">,</span> <span class="n">imgPath</span><span class="o">);</span>
  
  <span class="c1">// إنشاء Uri من الملف المحفوظ</span>
  <span class="nc">Uri</span> <span class="n">uri1</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">imgPath</span><span class="o">));</span>
  
  <span class="c1">// تعيين الصورة باستخدام الـ Uri</span>
  <span class="n">setImageByUri</span><span class="o">(</span><span class="n">uri1</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود يبقى كما هو باللغة الإنجليزية لأن أسماء الدوال والمتغيرات لا تُترجم في البرمجة. الترجمة هنا هي للتوضيح فقط.</p>

<hr />

<h3 id="معالجة-عمليات-الصور">معالجة عمليات الصور</h3>

<p>يقوم النشاط (Activity) بمعالجة عمليات الصور المختلفة، مثل تعيين الصور عبر URI، واقتصاص الصور، وحفظ الصور المرسومة كـ Bitmap.</p>

<p><strong>setImageByUri(Uri uri)</strong><br />
يقوم بتحميل الصورة من الـ URI المحدد وإعدادها للرسم.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setImageByUri</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nf">Handler</span><span class="o">().</span><span class="na">postDelayed</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">curPicUri</span> <span class="o">=</span> <span class="n">uri</span><span class="o">;</span>
      <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">uri</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">getBitmapByUri</span><span class="o">(</span><span class="nc">DrawActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">uri</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setImageByUri</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nf">Handler</span><span class="o">().</span><span class="na">postDelayed</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">curPicUri</span> <span class="o">=</span> <span class="n">uri</span><span class="o">;</span>
      <span class="nc">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">uri</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">getBitmapByUri</span><span class="o">(</span><span class="nc">DrawActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span> <span class="n">uri</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">originW</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">originH</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">originW</span> <span class="o">!=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span> <span class="o">||</span> <span class="n">originH</span> <span class="o">!=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">originRadio</span> <span class="o">=</span> <span class="n">originW</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">originH</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">radio</span> <span class="o">=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">originRadio</span> <span class="o">-</span> <span class="n">radio</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Bitmap</span> <span class="n">originBm</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">;</span>
    <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">Bitmap</span><span class="o">.</span><span class="na">createScaledBitmap</span><span class="o">(</span><span class="n">originBm</span><span class="o">,</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span><span class="o">,</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="n">originBm</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">cropIt</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="nc">ImageLoader</span> <span class="n">imageLoader</span> <span class="o">=</span> <span class="nc">ImageLoader</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">imageLoader</span><span class="o">.</span><span class="na">addOrReplaceToMemoryCache</span><span class="o">(</span><span class="s">"origin"</span><span class="o">,</span> <span class="n">bitmap</span><span class="o">);</span>
<span class="n">originImg</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">;</span>
<span class="n">serverId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</code></pre></div></div>

<p>ترجمة الكود إلى العربية:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">originW</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">originH</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">originW</span> <span class="o">!=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span> <span class="o">||</span> <span class="n">originH</span> <span class="o">!=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">originRadio</span> <span class="o">=</span> <span class="n">originW</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">originH</span><span class="o">;</span>
  <span class="kt">float</span> <span class="n">radio</span> <span class="o">=</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">originRadio</span> <span class="o">-</span> <span class="n">radio</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Bitmap</span> <span class="n">originBm</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">;</span>
    <span class="n">bitmap</span> <span class="o">=</span> <span class="nc">Bitmap</span><span class="o">.</span><span class="na">createScaledBitmap</span><span class="o">(</span><span class="n">originBm</span><span class="o">,</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawWidth</span><span class="o">,</span> <span class="nc">App</span><span class="o">.</span><span class="na">drawHeight</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="n">originBm</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">cropIt</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="nc">ImageLoader</span> <span class="n">imageLoader</span> <span class="o">=</span> <span class="nc">ImageLoader</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">imageLoader</span><span class="o">.</span><span class="na">addOrReplaceToMemoryCache</span><span class="o">(</span><span class="s">"origin"</span><span class="o">,</span> <span class="n">bitmap</span><span class="o">);</span>
<span class="n">originImg</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">;</span>
<span class="n">serverId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
</code></pre></div></div>

<p>ملاحظة: تم الحفاظ على أسماء المتغيرات والوظائف كما هي لأنها أسماء تقنية ولا يتم ترجمتها عادةً.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drawView</span><span class="o">.</span><span class="na">setSrcBitmap</span><span class="o">(</span><span class="n">originImg</span><span class="o">);</span>
<span class="n">showDrawFragment</span><span class="o">(</span><span class="nc">App</span><span class="o">.</span><span class="na">ALL_INFO</span><span class="o">);</span>
<span class="n">curDrawMode</span> <span class="o">=</span> <span class="nc">App</span><span class="o">.</span><span class="na">DRAW_FORE</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">},</span> <span class="mi">500</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تم تعيين الصورة الأصلية <code class="language-plaintext highlighter-rouge">originImg</code> كصورة مصدرية لعنصر الرسم <code class="language-plaintext highlighter-rouge">drawView</code>.<br />
تم استدعاء الدالة <code class="language-plaintext highlighter-rouge">showDrawFragment</code> لعرض جزء الرسم مع جميع المعلومات <code class="language-plaintext highlighter-rouge">App.ALL_INFO</code>.<br />
تم تعيين وضع الرسم الحالي <code class="language-plaintext highlighter-rouge">curDrawMode</code> إلى وضع الرسم الأمامي <code class="language-plaintext highlighter-rouge">App.DRAW_FORE</code>.<br />
يتم تنفيذ هذه الأوامر بعد تأخير قدره 500 مللي ثانية.</p>

<p><strong>cropIt(Uri uri)</strong><br />
بدء نشاط اقتصاص الصورة.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">cropIt</span><span class="o">(</span><span class="nc">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Crop</span><span class="o">.</span><span class="na">startPhotoCrop</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">uri</span><span class="o">,</span> <span class="n">cropPath</span><span class="o">,</span> <span class="no">CROP_RESULT</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>saveBitmap()</strong><br />
يحفظ الصورة النقطية المرسومة إلى ملف ويقوم بتحميلها إلى الخادم.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveBitmap</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Bitmap</span> <span class="n">handBitmap</span> <span class="o">=</span> <span class="n">drawView</span><span class="o">.</span><span class="na">getHandBitmap</span><span class="o">();</span>
  <span class="nc">Bitmap</span> <span class="n">originBitmap</span> <span class="o">=</span> <span class="n">drawView</span><span class="o">.</span><span class="na">getSrcBitmap</span><span class="o">();</span>
  <span class="n">saveBitmapToFileAndUpload</span><span class="o">(</span><span class="n">handBitmap</span><span class="o">,</span> <span class="n">originBitmap</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>saveBitmapToFileAndUpload(Bitmap handBitmap, Bitmap originBitmap)</strong><br />
يحفظ الصورة النقطية في ملف ويقوم بتحميلها بشكل غير متزامن.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">saveBitmapToFileAndUpload</span><span class="o">(</span><span class="nc">Bitmap</span> <span class="n">handBitmap</span><span class="o">,</span> <span class="nc">Bitmap</span> <span class="n">originBitmap</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="nc">String</span> <span class="n">originPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getOriginPath</span><span class="o">();</span>
  <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">saveBitmapToPath</span><span class="o">(</span><span class="n">originBitmap</span><span class="o">,</span> <span class="n">originPath</span><span class="o">);</span>
  <span class="kd">final</span> <span class="nc">String</span> <span class="n">handPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getHandPath</span><span class="o">();</span>
  <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">saveBitmapToPath</span><span class="o">(</span><span class="n">handBitmap</span><span class="o">,</span> <span class="n">handPath</span><span class="o">);</span>
  <span class="k">new</span> <span class="nc">AsyncTask</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">,</span> <span class="nc">Void</span><span class="o">,</span> <span class="nc">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">res</span><span class="o">;</span>
    <span class="nc">Bitmap</span> <span class="n">foreBitmap</span><span class="o">;</span>
    <span class="nc">Bitmap</span> <span class="n">backBitmap</span><span class="o">;</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">saveBitmapToFileAndUpload</span><span class="o">(</span><span class="nc">Bitmap</span> <span class="n">handBitmap</span><span class="o">,</span> <span class="nc">Bitmap</span> <span class="n">originBitmap</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="nc">String</span> <span class="n">originPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getOriginPath</span><span class="o">();</span>
  <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">saveBitmapToPath</span><span class="o">(</span><span class="n">originBitmap</span><span class="o">,</span> <span class="n">originPath</span><span class="o">);</span>
  <span class="kd">final</span> <span class="nc">String</span> <span class="n">handPath</span> <span class="o">=</span> <span class="nc">PathUtils</span><span class="o">.</span><span class="na">getHandPath</span><span class="o">();</span>
  <span class="nc">BitmapUtils</span><span class="o">.</span><span class="na">saveBitmapToPath</span><span class="o">(</span><span class="n">handBitmap</span><span class="o">,</span> <span class="n">handPath</span><span class="o">);</span>
  <span class="k">new</span> <span class="nc">AsyncTask</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">,</span> <span class="nc">Void</span><span class="o">,</span> <span class="nc">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">res</span><span class="o">;</span>
    <span class="nc">Bitmap</span> <span class="n">foreBitmap</span><span class="o">;</span>
    <span class="nc">Bitmap</span> <span class="n">backBitmap</span><span class="o">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
protected void onPreExecute() {
  super.onPreExecute();
  showWaitFragment();
}

@Override
protected Void doInBackground(Void... params) {
  try {
    if (baseUrl == null) {
      throw new Exception("baseUrl is null");
    }
    String jsonRes = UploadImage.upload(baseUrl, serverId, Web.STATUS_CONTINUE, originPath, handPath, null, false);
    getJsonData(jsonRes);
    res = true;
  } catch (Exception e) {
    res = false;
    e.printStackTrace();
  }
  return null;
}
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">getJsonData</span><span class="o">(</span><span class="nc">String</span> <span class="n">jsonRes</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">JSONObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JSONObject</span><span class="o">(</span><span class="n">jsonRes</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">serverId</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">serverId</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="nc">Web</span><span class="o">.</span><span class="na">ID</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">String</span> <span class="n">foreUrl</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="nc">Web</span><span class="o">.</span><span class="na">FORE</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">backUrl</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="nc">Web</span><span class="o">.</span><span class="na">BACK</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">resultUrl</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="nc">Web</span><span class="o">.</span><span class="na">RESULT</span><span class="o">);</span>
    <span class="n">foreBitmap</span> <span class="o">=</span> <span class="nc">Web</span><span class="o">.</span><span class="na">getBitmapFromUrlByStream1</span><span class="o">(</span><span class="n">foreUrl</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="n">backBitmap</span> <span class="o">=</span> <span class="nc">Web</span><span class="o">.</span><span class="na">getBitmapFromUrlByStream1</span><span class="o">(</span><span class="n">backUrl</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="n">resultBitmap</span> <span class="o">=</span> <span class="nc">Web</span><span class="o">.</span><span class="na">getBitmapFromUrlByStream1</span><span class="o">(</span><span class="n">resultUrl</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Override
protected void onPostExecute(Void aVoid) {
  super.onPostExecute(aVoid);
  if (res) {
    showRecogFragment(foreBitmap, backBitmap);
  } else {
    Utils.toast(DrawActivity.this, R.string.server_error);
    recogNo();
  }
}
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">}.</span><span class="nx">execute</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h3 id="إدارة-fragment">إدارة Fragment</h3>

<p>تدير Activity إدارة fragment المختلفة للتعامل مع الحالات المختلفة للتطبيق، مثل الرسم والتعرف والانتظار.</p>

<p><strong>showDrawFragment(int infoId)</strong><br />
يعرض جزء الرسم (fragment).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showDrawFragment</span><span class="o">(</span><span class="kt">int</span> <span class="n">infoId</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">curFragmentId</span> <span class="o">=</span> <span class="no">DRAW_FRAGMENT</span><span class="o">;</span>
  <span class="n">curFragment</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrawFragment</span><span class="o">(</span><span class="n">infoId</span><span class="o">);</span>
  <span class="n">showFragment</span><span class="o">(</span><span class="n">curFragment</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>الترجمة:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showDrawFragment</span><span class="o">(</span><span class="kt">int</span> <span class="n">infoId</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">curFragmentId</span> <span class="o">=</span> <span class="no">DRAW_FRAGMENT</span><span class="o">;</span>
  <span class="n">curFragment</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DrawFragment</span><span class="o">(</span><span class="n">infoId</span><span class="o">);</span>
  <span class="n">showFragment</span><span class="o">(</span><span class="n">curFragment</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>في الكود أعلاه، يتم تعريف دالة خاصة تُسمى <code class="language-plaintext highlighter-rouge">showDrawFragment</code> تأخذ معاملًا من النوع <code class="language-plaintext highlighter-rouge">int</code> يُسمى <code class="language-plaintext highlighter-rouge">infoId</code>. داخل الدالة، يتم تعيين قيمة <code class="language-plaintext highlighter-rouge">DRAW_FRAGMENT</code> للمتغير <code class="language-plaintext highlighter-rouge">curFragmentId</code>، ثم يتم إنشاء كائن جديد من النوع <code class="language-plaintext highlighter-rouge">DrawFragment</code> باستخدام <code class="language-plaintext highlighter-rouge">infoId</code> كمعامل ويتم تعيينه للمتغير <code class="language-plaintext highlighter-rouge">curFragment</code>. أخيرًا، يتم استدعاء دالة <code class="language-plaintext highlighter-rouge">showFragment</code> مع تمرير الكائن <code class="language-plaintext highlighter-rouge">curFragment</code> كمعامل.</p>

<p><strong>showWaitFragment()</strong><br />
عرض جزء الانتظار (fragment).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showWaitFragment</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">curFragmentId</span> <span class="o">=</span> <span class="no">WAIT_FRAGMENT</span><span class="o">;</span>
  <span class="n">showFragment</span><span class="o">(</span><span class="k">new</span> <span class="nc">WaitFragment</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ترجمة:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showWaitFragment</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">curFragmentId</span> <span class="o">=</span> <span class="no">WAIT_FRAGMENT</span><span class="o">;</span>
  <span class="n">showFragment</span><span class="o">(</span><span class="k">new</span> <span class="nc">WaitFragment</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود الموجود في الكتلة البرمجية لم يتم ترجمته لأنه يحتوي على أسماء متغيرات ودوال باللغة الإنجليزية، والتي عادةً ما تبقى كما هي في البرمجة.</p>

<p><strong>showFragment(Fragment fragment)</strong><br />
استبدل الـ fragment الحالي بالـ fragment المحدد.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showFragment</span><span class="o">(</span><span class="nc">Fragment</span> <span class="n">fragment</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">FragmentTransaction</span> <span class="n">trans</span> <span class="o">=</span> <span class="n">getFragmentManager</span><span class="o">().</span><span class="na">beginTransaction</span><span class="o">();</span>
  <span class="n">trans</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">rightLayout</span><span class="o">,</span> <span class="n">fragment</span><span class="o">);</span>
  <span class="n">trans</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ترجمة الكود إلى العربية:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showFragment</span><span class="o">(</span><span class="nc">Fragment</span> <span class="n">fragment</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// بدء عملية تحويل Fragment</span>
  <span class="nc">FragmentTransaction</span> <span class="n">trans</span> <span class="o">=</span> <span class="n">getFragmentManager</span><span class="o">().</span><span class="na">beginTransaction</span><span class="o">();</span>
  
  <span class="c1">// استبدال الـ Fragment الحالي في الـ Layout المحدد بالـ Fragment الجديد</span>
  <span class="n">trans</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">rightLayout</span><span class="o">,</span> <span class="n">fragment</span><span class="o">);</span>
  
  <span class="c1">// تنفيذ عملية التحويل</span>
  <span class="n">trans</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>في هذا الكود، يتم استبدال الـ Fragment الحالي الموجود في الـ Layout المحدد (<code class="language-plaintext highlighter-rouge">R.id.rightLayout</code>) بآخر جديد (<code class="language-plaintext highlighter-rouge">fragment</code>). يتم ذلك عن طريق إنشاء كائن من نوع <code class="language-plaintext highlighter-rouge">FragmentTransaction</code> واستخدام الدالة <code class="language-plaintext highlighter-rouge">replace</code> لتنفيذ الاستبدال، ثم تأكيد العملية باستخدام <code class="language-plaintext highlighter-rouge">commit</code>.</p>

<hr />

<h3 id="معالجة-الأحداث">معالجة الأحداث</h3>

<p>تتعامل Activity مع مختلف تفاعلات المستخدم، مثل النقر على الأزرار واختيار القوائم.</p>

<p><strong>onClick(View v)</strong><br />
التعامل مع أحداث النقر على واجهات العرض المختلفة.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">drawOk</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">drawView</span><span class="o">.</span><span class="na">isDrawFinish</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">saveBitmap</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="nc">Utils</span><span class="o">.</span><span class="na">alertDialog</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">please_draw_finish</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">recogOk</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">recogOk</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">recogNo</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">recogNo</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">dir</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Utils</span><span class="o">.</span><span class="na">getGalleryPhoto</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="no">IMAGE_RESULT</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">clear</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">clearEverything</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">undo</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">drawView</span><span class="o">.</span><span class="na">undo</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">redo</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">drawView</span><span class="o">.</span><span class="na">redo</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">camera</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Utils</span><span class="o">.</span><span class="na">takePhoto</span><span class="o">(</span><span class="n">cxt</span><span class="o">,</span> <span class="no">CAMERA_RESULT</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">material</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">goMaterial</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">upload</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">com</span><span class="o">.</span><span class="na">lzw</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">Utils</span><span class="o">.</span><span class="na">goActivity</span><span class="o">(</span><span class="n">cxt</span><span class="o">,</span> <span class="nc">PhotoActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">scale</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">cropIt</span><span class="o">(</span><span class="n">curPicUri</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>onActivityResult(int requestCode, int resultCode, Intent data)</strong><br />
معالجة نتائج الأنشطة الأخرى، مثل اختيار الصور أو اقتصاصها.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">resultCode</span> <span class="o">!=</span> <span class="no">RESULT_CANCELED</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Uri</span> <span class="n">uri</span><span class="o">;</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">requestCode</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nl">IMAGE_RESULT:</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">setImageByUri</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="nl">CAMERA_RESULT:</span>
        <span class="n">setImageByUri</span><span class="o">(</span><span class="nc">Utils</span><span class="o">.</span><span class="na">getCameraUri</span><span class="o">());</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="nl">CROP_RESULT:</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">cropPath</span><span class="o">));</span>
        <span class="n">setImageByUri</span><span class="o">(</span><span class="n">uri</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="nl">MATERIAL_RESULT:</span>
        <span class="n">setImageByUri</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<h3 id="ميزات-التراجع-والإعادة">ميزات التراجع والإعادة</h3>

<p>يوفر Activity وظيفة التراجع والإعادة للعمليات الرسومية.</p>

<p><strong>initUndoRedoEnable()</strong><br />
يقوم بتهيئة وظائف التراجع والإعادة من خلال تعيين دوال الاستدعاء (callbacks).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">initUndoRedoEnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">drawView</span><span class="o">.</span><span class="na">history</span><span class="o">.</span><span class="na">setCallBack</span><span class="o">(</span><span class="k">new</span> <span class="nc">History</span><span class="o">.</span><span class="na">CallBack</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onHistoryChanged</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">setUndoRedoEnable</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">curFragmentId</span> <span class="o">!=</span> <span class="no">DRAW_FRAGMENT</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">showDrawFragment</span><span class="o">(</span><span class="n">curDrawMode</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ترجمة الكود إلى العربية:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">initUndoRedoEnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">drawView</span><span class="o">.</span><span class="na">history</span><span class="o">.</span><span class="na">setCallBack</span><span class="o">(</span><span class="k">new</span> <span class="nc">History</span><span class="o">.</span><span class="na">CallBack</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onHistoryChanged</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">setUndoRedoEnable</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">curFragmentId</span> <span class="o">!=</span> <span class="no">DRAW_FRAGMENT</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">showDrawFragment</span><span class="o">(</span><span class="n">curDrawMode</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>شرح الكود:</strong></p>

<ul>
  <li><strong>initUndoRedoEnable()</strong>: دالة لتهيئة إمكانية التراجع والإعادة (Undo/Redo).</li>
  <li><strong>drawView.history.setCallBack()</strong>: يتم تعيين رد نداء (Callback) لتتبع التغييرات في السجل (History).</li>
  <li><strong>onHistoryChanged()</strong>: يتم استدعاء هذه الدالة عند حدوث تغيير في السجل.</li>
  <li><strong>setUndoRedoEnable()</strong>: تفعيل أو تعطيل أزرار التراجع والإعادة بناءً على حالة السجل.</li>
  <li><strong>if (curFragmentId != DRAW_FRAGMENT)</strong>: إذا لم يكن الجزء الحالي هو جزء الرسم (DRAW_FRAGMENT)، يتم عرض جزء الرسم مع الوضع الحالي للرسم (curDrawMode).</li>
</ul>

<p><strong>ملاحظة:</strong> تم الحفاظ على أسماء الدوال والمتغيرات كما هي لأنها أسماء برمجية ولا يتم ترجمتها.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">setUndoRedoEnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">redoView</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="n">drawView</span><span class="o">.</span><span class="na">history</span><span class="o">.</span><span class="na">canRedo</span><span class="o">());</span>
  <span class="n">undoView</span><span class="o">.</span><span class="na">setEnabled</span><span class="o">(</span><span class="n">drawView</span><span class="o">.</span><span class="na">history</span><span class="o">.</span><span class="na">canUndo</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<h3 id="تخصيص-drawview">تخصيص DrawView</h3>

<p>في هذا المنشور، سنتعلم كيفية تخصيص <code class="language-plaintext highlighter-rouge">DrawView</code> لإنشاء واجهة مستخدم تفاعلية تسمح للمستخدمين بالرسم على الشاشة. سنستخدم Swift وUIKit لتحقيق ذلك.</p>

<h4 id="الخطوة-1-إنشاء-مشروع-جديد">الخطوة 1: إنشاء مشروع جديد</h4>

<p>أولاً، قم بإنشاء مشروع جديد في Xcode باستخدام قالب “Single View App”. قم بتسمية المشروع كما تريد، واختر Swift كلغة برمجة.</p>

<h4 id="الخطوة-2-إنشاء-drawview">الخطوة 2: إنشاء <code class="language-plaintext highlighter-rouge">DrawView</code></h4>

<p>قم بإنشاء ملف جديد باسم <code class="language-plaintext highlighter-rouge">DrawView.swift</code> وقم بتعريف فئة <code class="language-plaintext highlighter-rouge">DrawView</code> التي ترث من <code class="language-plaintext highlighter-rouge">UIView</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="kd">class</span> <span class="kt">DrawView</span><span class="p">:</span> <span class="kt">UIView</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">Line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">var</span> <span class="nv">lastPoint</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="o">!</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">touchesBegan</span><span class="p">(</span><span class="n">_</span> <span class="nv">touches</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">UITouch</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">UIEvent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">lastPoint</span> <span class="o">=</span> <span class="n">touches</span><span class="o">.</span><span class="n">first</span><span class="o">!.</span><span class="nf">location</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">touchesMoved</span><span class="p">(</span><span class="n">_</span> <span class="nv">touches</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">UITouch</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">UIEvent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">newPoint</span> <span class="o">=</span> <span class="n">touches</span><span class="o">.</span><span class="n">first</span><span class="o">!.</span><span class="nf">location</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Line</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="n">lastPoint</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="n">newPoint</span><span class="p">))</span>
        <span class="n">lastPoint</span> <span class="o">=</span> <span class="n">newPoint</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">setNeedsDisplay</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="n">_</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">context</span> <span class="o">=</span> <span class="kt">UIGraphicsGetCurrentContext</span><span class="p">()</span>
        <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">setStrokeColor</span><span class="p">(</span><span class="kt">UIColor</span><span class="o">.</span><span class="n">black</span><span class="o">.</span><span class="n">cgColor</span><span class="p">)</span>
        <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">setLineWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">setLineCap</span><span class="p">(</span><span class="o">.</span><span class="n">round</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">lines</span> <span class="p">{</span>
            <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">strokePath</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Line</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">start</span><span class="p">:</span> <span class="kt">CGPoint</span>
    <span class="k">var</span> <span class="nv">end</span><span class="p">:</span> <span class="kt">CGPoint</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="الخطوة-3-إضافة-drawview-إلى-الواجهة">الخطوة 3: إضافة <code class="language-plaintext highlighter-rouge">DrawView</code> إلى الواجهة</h4>

<p>افتح <code class="language-plaintext highlighter-rouge">Main.storyboard</code> وقم بإضافة <code class="language-plaintext highlighter-rouge">UIView</code> إلى الواجهة. قم بتغيير الفئة الخاصة بهذه <code class="language-plaintext highlighter-rouge">UIView</code> إلى <code class="language-plaintext highlighter-rouge">DrawView</code> في قسم “Identity Inspector”.</p>

<h4 id="الخطوة-4-تشغيل-التطبيق">الخطوة 4: تشغيل التطبيق</h4>

<p>قم بتشغيل التطبيق على جهاز محاكاة أو جهاز فعلي. الآن، يمكنك الرسم على الشاشة عن طريق تحريك إصبعك على الشاشة.</p>

<h4 id="الخطوة-5-تخصيص-drawview">الخطوة 5: تخصيص <code class="language-plaintext highlighter-rouge">DrawView</code></h4>

<p>يمكنك تخصيص <code class="language-plaintext highlighter-rouge">DrawView</code> بإضافة خصائص مثل تغيير لون الخط أو سمكه. على سبيل المثال، لإضافة خاصية تغيير لون الخط، يمكنك تعديل الكود كما يلي:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">DrawView</span><span class="p">:</span> <span class="kt">UIView</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">lines</span><span class="p">:</span> <span class="p">[</span><span class="kt">Line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">var</span> <span class="nv">lastPoint</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="o">!</span>
    <span class="k">var</span> <span class="nv">strokeColor</span><span class="p">:</span> <span class="kt">UIColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">black</span>
    <span class="k">var</span> <span class="nv">strokeWidth</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">touchesBegan</span><span class="p">(</span><span class="n">_</span> <span class="nv">touches</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">UITouch</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">UIEvent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">lastPoint</span> <span class="o">=</span> <span class="n">touches</span><span class="o">.</span><span class="n">first</span><span class="o">!.</span><span class="nf">location</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">touchesMoved</span><span class="p">(</span><span class="n">_</span> <span class="nv">touches</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">UITouch</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">with</span> <span class="nv">event</span><span class="p">:</span> <span class="kt">UIEvent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">newPoint</span> <span class="o">=</span> <span class="n">touches</span><span class="o">.</span><span class="n">first</span><span class="o">!.</span><span class="nf">location</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">Line</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="n">lastPoint</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="n">newPoint</span><span class="p">))</span>
        <span class="n">lastPoint</span> <span class="o">=</span> <span class="n">newPoint</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">setNeedsDisplay</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">draw</span><span class="p">(</span><span class="n">_</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">context</span> <span class="o">=</span> <span class="kt">UIGraphicsGetCurrentContext</span><span class="p">()</span>
        <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">setStrokeColor</span><span class="p">(</span><span class="n">strokeColor</span><span class="o">.</span><span class="n">cgColor</span><span class="p">)</span>
        <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">setLineWidth</span><span class="p">(</span><span class="n">strokeWidth</span><span class="p">)</span>
        <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">setLineCap</span><span class="p">(</span><span class="o">.</span><span class="n">round</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">lines</span> <span class="p">{</span>
            <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
            <span class="n">context</span><span class="p">?</span><span class="o">.</span><span class="nf">strokePath</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>الآن، يمكنك تغيير لون الخط وسمكه عن طريق تعديل خصائص <code class="language-plaintext highlighter-rouge">strokeColor</code> و <code class="language-plaintext highlighter-rouge">strokeWidth</code>.</p>

<h4 id="الخلاصة-1">الخلاصة</h4>

<p>في هذا المنشور، تعلمنا كيفية إنشاء <code class="language-plaintext highlighter-rouge">DrawView</code> مخصص يسمح للمستخدمين بالرسم على الشاشة. يمكنك توسيع هذه الوظيفة بإضافة المزيد من الخصائص والوظائف حسب احتياجاتك.</p>

<p><code class="language-plaintext highlighter-rouge">DrawView</code> هو عرض مخصص يستخدم لمعالجة عمليات الرسم، أحداث اللمس، والتحجيم.</p>

<p><strong>onTouchEvent(MotionEvent event)</strong><br />
معالجة أحداث اللمس للرسم والتحجيم.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">scaleMode</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">handleDrawTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">handleScaleTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ترجمة:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">scaleMode</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">handleDrawTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">handleScaleTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود الموجود في الكتلة البرمجية لم يتم تغييره لأنه كود برمجي، والكود البرمجي لا يتم ترجمته.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleDrawTouchEvent</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">action</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
  <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
  <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">path</span><span class="o">.</span><span class="na">moveTo</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">path</span><span class="o">.</span><span class="na">quadTo</span><span class="o">(</span><span class="n">preX</span><span class="o">,</span> <span class="n">preY</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Matrix</span> <span class="n">matrix1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Matrix</span><span class="o">();</span>
    <span class="n">matrix</span><span class="o">.</span><span class="na">invert</span><span class="o">(</span><span class="n">matrix1</span><span class="o">);</span>
    <span class="n">path</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">matrix1</span><span class="o">);</span>
    <span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">strokeWidth</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">totalRatio</span><span class="o">);</span>
    <span class="n">history</span><span class="o">.</span><span class="na">saveToStack</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
    <span class="n">cacheCanvas</span><span class="o">.</span><span class="na">drawPath</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
    <span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">strokeWidth</span><span class="o">);</span>
    <span class="n">path</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">setPrev</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="n">invalidate</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="الترجمة">الترجمة:</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleDrawTouchEvent</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">action</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
  <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
  <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">path</span><span class="o">.</span><span class="na">moveTo</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">path</span><span class="o">.</span><span class="na">quadTo</span><span class="o">(</span><span class="n">preX</span><span class="o">,</span> <span class="n">preY</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">action</span> <span class="o">==</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Matrix</span> <span class="n">matrix1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Matrix</span><span class="o">();</span>
    <span class="n">matrix</span><span class="o">.</span><span class="na">invert</span><span class="o">(</span><span class="n">matrix1</span><span class="o">);</span>
    <span class="n">path</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">matrix1</span><span class="o">);</span>
    <span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">strokeWidth</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">totalRatio</span><span class="o">);</span>
    <span class="n">history</span><span class="o">.</span><span class="na">saveToStack</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
    <span class="n">cacheCanvas</span><span class="o">.</span><span class="na">drawPath</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
    <span class="n">paint</span><span class="o">.</span><span class="na">setStrokeWidth</span><span class="o">(</span><span class="n">strokeWidth</span><span class="o">);</span>
    <span class="n">path</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">setPrev</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="n">invalidate</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="الشرح">الشرح:</h3>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">handleDrawTouchEvent</code></strong>: دالة تُعالج أحداث اللمس للرسم.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">MotionEvent</code></strong>: يمثل حدث اللمس.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">action</code></strong>: يحتفظ بنوع الحدث (مثل الضغط، الحركة، الرفع).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">y</code></strong>: إحداثيات نقطة اللمس.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">path.moveTo(x, y)</code></strong>: يبدأ مسار جديد من النقطة (x, y).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">path.quadTo(preX, preY, x, y)</code></strong>: يرسم منحنى بين النقطة السابقة (preX, preY) والنقطة الحالية (x, y).</li>
  <li><strong><code class="language-plaintext highlighter-rouge">Matrix</code></strong>: يستخدم لتحويل الإحداثيات.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">paint.setStrokeWidth</code></strong>: يحدد عرض الفرشاة.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">history.saveToStack</code></strong>: يحفظ المسار والفرشاة في التاريخ.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">cacheCanvas.drawPath</code></strong>: يرسم المسار على لوحة الرسم المؤقتة.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">path.reset()</code></strong>: يعيد تعيين المسار.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">setPrev(event)</code></strong>: يحفظ الإحداثيات السابقة.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">invalidate()</code></strong>: يعيد رسم الواجهة.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleScaleTouchEvent</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getActionMasked</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_POINTER_DOWN</span><span class="o">:</span>
      <span class="n">lastFingerDist</span> <span class="o">=</span> <span class="n">calFingerDistance</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">:</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getPointerCount</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">handleMove</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getPointerCount</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">handleZoom</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">:</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_POINTER_UP</span><span class="o">:</span>
      <span class="n">lastMoveX</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="n">lastMoveY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ترجمة الكود إلى العربية:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleScaleTouchEvent</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getActionMasked</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_POINTER_DOWN</span><span class="o">:</span>
      <span class="n">lastFingerDist</span> <span class="o">=</span> <span class="n">calFingerDistance</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">:</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getPointerCount</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">handleMove</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getPointerCount</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">handleZoom</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">:</span>
    <span class="k">case</span> <span class="nc">MotionEvent</span><span class="o">.</span><span class="na">ACTION_POINTER_UP</span><span class="o">:</span>
      <span class="n">lastMoveX</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="n">lastMoveY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">break</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ملاحظة: تم الحفاظ على أسماء الدوال والمتغيرات كما هي لأنها أسماء تقنية ولا يتم ترجمتها.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleMove</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">moveX</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
  <span class="kt">float</span> <span class="n">moveY</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">lastMoveX</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">lastMoveY</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">lastMoveX</span> <span class="o">=</span> <span class="n">moveX</span><span class="o">;</span>
    <span class="n">lastMoveY</span> <span class="o">=</span> <span class="n">moveY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">moveDistX</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">moveX</span> <span class="o">-</span> <span class="n">lastMoveX</span><span class="o">);</span>
  <span class="n">moveDistY</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">moveY</span> <span class="o">-</span> <span class="n">lastMoveY</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">moveDistX</span> <span class="o">+</span> <span class="n">totalTranslateX</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">moveDistX</span> <span class="o">+</span> <span class="n">totalTranslateX</span> <span class="o">+</span> <span class="n">curBitmapWidth</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">moveDistX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">moveDistY</span> <span class="o">+</span> <span class="n">totalTranslateY</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">moveDistY</span> <span class="o">+</span> <span class="n">totalTranslateY</span> <span class="o">+</span> <span class="n">curBitmapHeight</span> <span class="o">&lt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">moveDistY</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">status</span> <span class="o">=</span> <span class="no">STATUS_MOVE</span><span class="o">;</span>
  <span class="n">invalidate</span><span class="o">();</span>
  <span class="n">lastMoveX</span> <span class="o">=</span> <span class="n">moveX</span><span class="o">;</span>
  <span class="n">lastMoveY</span> <span class="o">=</span> <span class="n">moveY</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleMove</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">moveX</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getX</span><span class="o">();</span>
  <span class="kt">float</span> <span class="n">moveY</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getY</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">lastMoveX</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">lastMoveY</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">lastMoveX</span> <span class="o">=</span> <span class="n">moveX</span><span class="o">;</span>
    <span class="n">lastMoveY</span> <span class="o">=</span> <span class="n">moveY</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">moveDistX</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">moveX</span> <span class="o">-</span> <span class="n">lastMoveX</span><span class="o">);</span>
  <span class="n">moveDistY</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">moveY</span> <span class="o">-</span> <span class="n">lastMoveY</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">moveDistX</span> <span class="o">+</span> <span class="n">totalTranslateX</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">moveDistX</span> <span class="o">+</span> <span class="n">totalTranslateX</span> <span class="o">+</span> <span class="n">curBitmapWidth</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">moveDistX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">moveDistY</span> <span class="o">+</span> <span class="n">totalTranslateY</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">moveDistY</span> <span class="o">+</span> <span class="n">totalTranslateY</span> <span class="o">+</span> <span class="n">curBitmapHeight</span> <span class="o">&lt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">moveDistY</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">status</span> <span class="o">=</span> <span class="no">STATUS_MOVE</span><span class="o">;</span>
  <span class="n">invalidate</span><span class="o">();</span>
  <span class="n">lastMoveX</span> <span class="o">=</span> <span class="n">moveX</span><span class="o">;</span>
  <span class="n">lastMoveY</span> <span class="o">=</span> <span class="n">moveY</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ملاحظة: الكود لم يتم تغييره لأنه يحتوي على أسماء متغيرات ووظائف محددة بلغة البرمجة Java، والتي لا يتم ترجمتها عادةً.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">handleZoom</span><span class="o">(</span><span class="nc">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">float</span> <span class="n">fingerDist</span> <span class="o">=</span> <span class="n">calFingerDistance</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="n">calFingerCenter</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">fingerDist</span> <span class="o">&gt;</span> <span class="n">lastFingerDist</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="no">STATUS_ZOOM_OUT</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="no">STATUS_ZOOM_IN</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">scaledRatio</span> <span class="o">=</span> <span class="n">fingerDist</span> <span class="o">*</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">lastFingerDist</span><span class="o">;</span>
  <span class="n">totalRatio</span> <span class="o">=</span> <span class="n">totalRatio</span> <span class="o">*</span> <span class="n">scaledRatio</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">totalRatio</span> <span class="o">&lt;</span> <span class="n">initRatio</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">totalRatio</span> <span class="o">=</span> <span class="n">initRatio</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">totalRatio</span> <span class="o">&gt;</span> <span class="n">initRatio</span> <span class="o">*</span> <span class="mi">4</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">totalRatio</span> <span class="o">=</span> <span class="n">initRatio</span> <span class="o">*</span> <span class="mi">4</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">lastFingerDist</span> <span class="o">=</span> <span class="n">fingerDist</span><span class="o">;</span>
  <span class="n">invalidate</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>onDraw(Canvas canvas)</strong><br />
يرسم الحالة الحالية للعرض.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDraw</span><span class="o">(</span><span class="nc">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">super</span><span class="o">.</span><span class="na">onDraw</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">scaleMode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">status</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nl">STATUS_MOVE:</span>
        <span class="n">move</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">case</span> <span class="nl">STATUS_ZOOM_IN:</span>
      <span class="k">case</span> <span class="nl">STATUS_ZOOM_OUT:</span>
        <span class="n">zoom</span><span class="o">(</span><span class="n">canvas</span><span class="o">);</span>
        <span class="k">break</span><span class="o">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cacheBm</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
          <span class="n">canvas</span><span class="o">.</span><span class="na">drawPath</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">cacheBm</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
      <span class="n">canvas</span><span class="o">.</span><span class="na">drawPath</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">paint</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>move(Canvas canvas)</strong><br />
يتعامل مع عملية الحركة أثناء التكبير/التصغير.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="nc">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postScale</span><span class="o">(</span><span class="n">totalRatio</span><span class="o">,</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="n">totalTranslateX</span> <span class="o">=</span> <span class="n">moveDistX</span> <span class="o">+</span> <span class="n">totalTranslateX</span><span class="o">;</span>
  <span class="n">totalTranslateY</span> <span class="o">=</span> <span class="n">moveDistY</span> <span class="o">+</span> <span class="n">totalTranslateY</span><span class="o">;</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postTranslate</span><span class="o">(</span><span class="n">totalTranslateX</span><span class="o">,</span> <span class="n">totalTranslateY</span><span class="o">);</span>
  <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ترجمة الكود إلى العربية:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="nc">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span> <span class="c1">// إعادة تعيين المصفوفة</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postScale</span><span class="o">(</span><span class="n">totalRatio</span><span class="o">,</span> <span class="n">totalRatio</span><span class="o">);</span> <span class="c1">// تطبيق التحجيم باستخدام النسبة الكلية</span>
  <span class="n">totalTranslateX</span> <span class="o">=</span> <span class="n">moveDistX</span> <span class="o">+</span> <span class="n">totalTranslateX</span><span class="o">;</span> <span class="c1">// تحديث الإزاحة الأفقية الكلية</span>
  <span class="n">totalTranslateY</span> <span class="o">=</span> <span class="n">moveDistY</span> <span class="o">+</span> <span class="n">totalTranslateY</span><span class="o">;</span> <span class="c1">// تحديث الإزاحة الرأسية الكلية</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postTranslate</span><span class="o">(</span><span class="n">totalTranslateX</span><span class="o">,</span> <span class="n">totalTranslateY</span><span class="o">);</span> <span class="c1">// تطبيق الإزاحة على المصفوفة</span>
  <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span> <span class="c1">// رسم الصورة المخزنة باستخدام المصفوفة</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> تمت ترجمة التعليقات التوضيحية فقط، حيث أن الكود نفسه لا يتم ترجمته.</p>

<p><strong>zoom(Canvas canvas)</strong><br />
التعامل مع عملية التكبير/التصغير.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">zoom</span><span class="o">(</span><span class="nc">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postScale</span><span class="o">(</span><span class="n">totalRatio</span><span class="o">,</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">scaledWidth</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">cacheBm</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">*</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">scaledHeight</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">cacheBm</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">*</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">translateX</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">translateY</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">curBitmapWidth</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">translateX</span> <span class="o">=</span> <span class="o">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">scaledWidth</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">translateX</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">centerPointX</span> <span class="o">+</span> <span class="o">(</span><span class="n">totalTranslateX</span> <span class="o">-</span> <span class="n">centerPointX</span><span class="o">)</span> <span class="o">*</span> <span class="n">scaledRatio</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">translateX</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">scaledWidth</span> <span class="o">+</span> <span class="n">translateX</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateX</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">scaledWidth</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">curBitmapHeight</span> <span class="o">&lt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">translateY</span> <span class="o">=</span> <span class="o">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">scaledHeight</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">translateY</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">centerPointY</span> <span class="o">+</span> <span class="o">(</span><span class="n">totalTranslateY</span> <span class="o">-</span> <span class="n">centerPointY</span><span class="o">)</span> <span class="o">*</span> <span class="n">scaledRatio</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">translateY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateY</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">scaledHeight</span> <span class="o">+</span> <span class="n">translateY</span> <span class="o">&lt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateY</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">scaledHeight</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postTranslate</span><span class="o">(</span><span class="n">translateX</span><span class="o">,</span> <span class="n">translateY</span><span class="o">);</span>
  <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="الترجمة-1">الترجمة:</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">zoom</span><span class="o">(</span><span class="nc">Canvas</span> <span class="n">canvas</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postScale</span><span class="o">(</span><span class="n">totalRatio</span><span class="o">,</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">scaledWidth</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">cacheBm</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">*</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">scaledHeight</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">cacheBm</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">*</span> <span class="n">totalRatio</span><span class="o">);</span>
  <span class="kt">int</span> <span class="n">translateX</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">translateY</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">curBitmapWidth</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">translateX</span> <span class="o">=</span> <span class="o">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">scaledWidth</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">translateX</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">centerPointX</span> <span class="o">+</span> <span class="o">(</span><span class="n">totalTranslateX</span> <span class="o">-</span> <span class="n">centerPointX</span><span class="o">)</span> <span class="o">*</span> <span class="n">scaledRatio</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">translateX</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">scaledWidth</span> <span class="o">+</span> <span class="n">translateX</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateX</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">scaledWidth</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">curBitmapHeight</span> <span class="o">&lt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">translateY</span> <span class="o">=</span> <span class="o">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">scaledHeight</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">translateY</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">centerPointY</span> <span class="o">+</span> <span class="o">(</span><span class="n">totalTranslateY</span> <span class="o">-</span> <span class="n">centerPointY</span><span class="o">)</span> <span class="o">*</span> <span class="n">scaledRatio</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">translateY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateY</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">scaledHeight</span> <span class="o">+</span> <span class="n">translateY</span> <span class="o">&lt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">translateY</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">scaledHeight</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postTranslate</span><span class="o">(</span><span class="n">translateX</span><span class="o">,</span> <span class="n">translateY</span><span class="o">);</span>
  <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Y</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">scaledHeight</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">totalTranslateX</span> <span class="o">=</span> <span class="n">translateX</span><span class="o">;</span>
  <span class="n">totalTranslateY</span> <span class="o">=</span> <span class="n">translateY</span><span class="o">;</span>
  <span class="n">curBitmapWidth</span> <span class="o">=</span> <span class="n">scaledWidth</span><span class="o">;</span>
  <span class="n">curBitmapHeight</span> <span class="o">=</span> <span class="n">scaledHeight</span><span class="o">;</span>
  <span class="n">matrix</span><span class="o">.</span><span class="na">postTranslate</span><span class="o">(</span><span class="n">translateX</span><span class="o">,</span> <span class="n">translateY</span><span class="o">);</span>
  <span class="n">canvas</span><span class="o">.</span><span class="na">drawBitmap</span><span class="o">(</span><span class="n">cacheBm</span><span class="o">,</span> <span class="n">matrix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<h3 id="إدارة-التاريخ">إدارة التاريخ</h3>

<p>فئة <code class="language-plaintext highlighter-rouge">History</code> تدير سجل الرسم لتمكين وظائف التراجع والإعادة.</p>

<p><strong>saveToStack(Path path, Paint paint)</strong><br />
يحفظ المسار الحالي والفرشاة في المكدس.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveToStack</span><span class="o">(</span><span class="nc">Path</span> <span class="n">path</span><span class="o">,</span> <span class="nc">Paint</span> <span class="n">paint</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Draw</span> <span class="n">draw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Draw</span><span class="o">();</span>
  <span class="n">draw</span><span class="o">.</span><span class="na">path</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
  <span class="n">draw</span><span class="o">.</span><span class="na">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Paint</span><span class="o">(</span><span class="n">paint</span><span class="o">);</span>
  <span class="n">saveToStack</span><span class="o">(</span><span class="n">draw</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى العربية كما يلي:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveToStack</span><span class="o">(</span><span class="nc">Path</span> <span class="n">path</span><span class="o">,</span> <span class="nc">Paint</span> <span class="n">paint</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Draw</span> <span class="n">draw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Draw</span><span class="o">();</span>
  <span class="n">draw</span><span class="o">.</span><span class="na">path</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Path</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
  <span class="n">draw</span><span class="o">.</span><span class="na">paint</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Paint</span><span class="o">(</span><span class="n">paint</span><span class="o">);</span>
  <span class="n">saveToStack</span><span class="o">(</span><span class="n">draw</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ملاحظة: الكود المقدم مكتوب بلغة Java، ولا يتم ترجمة أسماء الدوال أو المتغيرات أو الكائنات مثل <code class="language-plaintext highlighter-rouge">Path</code>، <code class="language-plaintext highlighter-rouge">Paint</code>، <code class="language-plaintext highlighter-rouge">Draw</code>، إلخ. يتم الحفاظ على هذه الأسماء كما هي لأنها جزء من لغة البرمجة ولا يتم ترجمتها.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveToStack</span><span class="o">(</span><span class="nc">Draw</span> <span class="n">draw</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">curPos</span><span class="o">++;</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">histroy</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">curPos</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">histroy</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">histroy</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">draw</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">callBack</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">callBack</span><span class="o">.</span><span class="na">onHistoryChanged</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>تمت ترجمة الكود أعلاه إلى:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveToStack</span><span class="o">(</span><span class="nc">Draw</span> <span class="n">draw</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">curPos</span><span class="o">++;</span>
  <span class="k">while</span> <span class="o">(</span><span class="n">histroy</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">curPos</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">histroy</span><span class="o">.</span><span class="na">pop</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">histroy</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">draw</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">callBack</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">callBack</span><span class="o">.</span><span class="na">onHistoryChanged</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ملاحظة: الكود لم يتم تغييره لأنه يحتوي على أسماء متغيرات ووظائف بالإنجليزية، ويجب الحفاظ عليها كما هي لضمان عمل الكود بشكل صحيح.</p>

<p><strong>getBitmapAtDraw(int n)</strong><br />
تُرجع صورة نقطية (bitmap) تمثل حالة النقطة المحددة في سجل الرسم (history).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Bitmap</span> <span class="nf">getBitmapAtDraw</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">Canvas</span> <span class="n">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Canvas</span><span class="o">();</span>
  <span class="nc">Bitmap</span> <span class="n">bm</span> <span class="o">=</span> <span class="nc">Utils</span><span class="o">.</span><span class="na">getCopyBitmap</span><span class="o">(</span><span class="n">srcBitmap</span><span class="o">);</span>
  <span class="n">canvas</span><span class="o">.</span><span class="na">setBitmap</span><span class="o">(</span><span class="n">bm</span><span class="o">);</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">Draw</span> <span class="n">draw</span> <span class="o">=</span> <span class="n">histroy</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="n">canvas</span><span class="o">.</span><span class="na">drawPath</span><span class="o">(</span><span class="n">draw</span><span class="o">.</span><span class="na">path</span><span class="o">,</span> <span class="n">draw</span><span class="o">.</span><span class="na">paint</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">bm</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>undo()</strong><br />
يقوم بتنفيذ عملية التراجع.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Bitmap</span> <span class="nf">undo</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">UnsupportedOperationException</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">canUndo</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">curPos</span><span class="o">--;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">callBack</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">callBack</span><span class="o">.</span><span class="na">onHistoryChanged</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nf">getBitmapAtDraw</span><span class="o">(</span><span class="n">curPos</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">(</span><span class="s">"لا توجد سجلات يمكن التراجع عنها"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>redo()</strong><br />
يقوم بتنفيذ عملية الإعادة (Redo).</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Bitmap</span> <span class="nf">redo</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">UnsupportedOperationException</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">canRedo</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">curPos</span><span class="o">++;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">callBack</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">callBack</span><span class="o">.</span><span class="na">onHistoryChanged</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="nf">getBitmapAtDraw</span><span class="o">(</span><span class="n">curPos</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">(</span><span class="s">"لا توجد سجلات قابلة للإعادة"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>canUndo()</strong><br />
يتحقق مما إذا كان بالإمكان التراجع عن الإجراء الأخير.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canUndo</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">curPos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>الترجمة:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canUndo</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">curPos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود المقدم لا يحتاج إلى ترجمة حيث أنه مكتوب بلغة Java وهي لغة برمجة عالمية ولا تتغير باختلاف اللغة.</p>

<p><strong>canRedo()</strong><br />
يتحقق مما إذا كان بالإمكان إعادة الإجراء.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canRedo</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">curPos</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">histroy</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>الترجمة:</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canRedo</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">curPos</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">histroy</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>ملاحظة:</strong> الكود المقدم مكتوب بلغة Java ويبدو أنه جزء من تطبيق يتعامل مع إعادة تنفيذ الإجراءات (Redo). الكود يتحقق مما إذا كان بالإمكان تنفيذ إعادة الإجراء (Redo) عن طريق التحقق من أن الموضع الحالي (<code class="language-plaintext highlighter-rouge">curPos</code>) زائد واحد أقل من حجم قائمة التاريخ (<code class="language-plaintext highlighter-rouge">histroy.size()</code>). إذا كان الشرط صحيحًا، فهذا يعني أنه يمكن تنفيذ إعادة الإجراء.</p>

<hr />

<h3 id="الخلاصة-2">الخلاصة</h3>

<p>يوفر <code class="language-plaintext highlighter-rouge">DrawActivity</code> والفئات المرتبطة به مثالًا شاملاً لتنفيذ عرض رسم مخصص في نظام Android. يعرض هذا المثال تقنيات متنوعة، بما في ذلك التعامل مع أحداث اللمس، وإدارة سجل الرسم، والتكامل مع مكونات أخرى مثل الأجزاء (fragments) والمهام غير المتزامنة (async tasks). من خلال فهم كل مكون وخوارزمية، يمكنك الاستفادة من هذه التقنيات في تطبيقاتك الخاصة لإنشاء ميزات رسم قوية وتفاعلية.</p>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-ar" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
