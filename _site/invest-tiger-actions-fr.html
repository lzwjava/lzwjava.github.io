<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Investissements hebdomadaires en actions avec l'API TigerOpen</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Investissements hebdomadaires en actions avec l’API TigerOpen | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Investissements hebdomadaires en actions avec l’API TigerOpen" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="fr" />
<meta name="description" content="J’ai développé un script Python et un workflow GitHub Actions pour automatiser ma stratégie d’investissement hebdomadaire, achetant une action NVIDIA chaque mercredi à 22h35 en heure normale de Chine (CST). J’ai choisi les mercredis car, en 2025, il n’y a pas de jours fériés ce jour-là, assurant une exécution cohérente." />
<meta property="og:description" content="J’ai développé un script Python et un workflow GitHub Actions pour automatiser ma stratégie d’investissement hebdomadaire, achetant une action NVIDIA chaque mercredi à 22h35 en heure normale de Chine (CST). J’ai choisi les mercredis car, en 2025, il n’y a pas de jours fériés ce jour-là, assurant une exécution cohérente." />
<link rel="canonical" href="https://lzwjava.github.io/invest-tiger-actions-fr" />
<meta property="og:url" content="https://lzwjava.github.io/invest-tiger-actions-fr" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-23T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Investissements hebdomadaires en actions avec l’API TigerOpen" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2025-04-23T00:00:00+08:00","datePublished":"2025-04-23T00:00:00+08:00","description":"J’ai développé un script Python et un workflow GitHub Actions pour automatiser ma stratégie d’investissement hebdomadaire, achetant une action NVIDIA chaque mercredi à 22h35 en heure normale de Chine (CST). J’ai choisi les mercredis car, en 2025, il n’y a pas de jours fériés ce jour-là, assurant une exécution cohérente.","headline":"Investissements hebdomadaires en actions avec l’API TigerOpen","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/invest-tiger-actions-fr"},"url":"https://lzwjava.github.io/invest-tiger-actions-fr"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=12f98f629aa5bde359f8691d2062a846d50c782c">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=12f98f629aa5bde359f8691d2062a846d50c782c" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Investissements hebdomadaires en actions avec l'API TigerOpen | Original, traduit par l'IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/fr/2025-04-23-invest-tiger-actions-fr.md">PDF</a> -->

    <!-- Audio Button -->



    <!-- 
    <a href="#" id="playAudioButton" class="button audio-button" data-file-path="_posts/fr/2025-04-23-invest-tiger-actions-fr.md">Audio</a>
     -->

        <!-- Date Button -->
    
      
      <!-- <span>_postsfr2025-04-23-invest-tiger-actions-fr.md</span> -->
      

      <!-- <span>2025-04-23-invest-tiger-actions-fr.md</span> -->

      
        

        
          
          <a href="#" class="button">2025.04</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/invest-tiger-actions-en" >English</option>
        <option value="/invest-tiger-actions-zh" >中文</option>
        <option value="/invest-tiger-actions-ja" >日本語</option>
        <option value="/invest-tiger-actions-es" >Español</option>
        <option value="/invest-tiger-actions-hi" >हिंदी</option>
        <option value="/invest-tiger-actions-fr" selected>Français</option>
        <option value="/invest-tiger-actions-de" >Deutsch</option>
        <option value="/invest-tiger-actions-ar" >العربية</option>
        <option value="/invest-tiger-actions-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>J’ai développé un script Python et un workflow GitHub Actions pour automatiser ma stratégie d’investissement hebdomadaire, achetant une action NVIDIA chaque mercredi à 22h35 en heure normale de Chine (CST). J’ai choisi les mercredis car, en 2025, il n’y a pas de jours fériés ce jour-là, assurant une exécution cohérente.</p>

<h2 id="aperçu">Aperçu</h2>

<p>Le script utilise l’API TigerOpen pour passer une commande de marché pour les actions NVIDIA et surveille son statut. Le workflow GitHub Actions exécute le script selon un planning, gérant la configuration et l’authentification de manière sécurisée. Voici les détails des deux composants.</p>

<h2 id="script-python">Script Python</h2>

<p>Ce script passe une commande d’achat pour une action NVIDIA, vérifie son statut pendant jusqu’à 60 secondes, et l’annule si elle n’est pas exécutée.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">tigeropen.common.consts</span> <span class="kn">import</span> <span class="n">Language</span><span class="p">,</span> <span class="n">OrderStatus</span>
<span class="kn">from</span> <span class="nn">tigeropen.tiger_open_config</span> <span class="kn">import</span> <span class="n">TigerOpenClientConfig</span>
<span class="kn">from</span> <span class="nn">tigeropen.common.util.signature_utils</span> <span class="kn">import</span> <span class="n">read_private_key</span>
<span class="kn">from</span> <span class="nn">tigeropen.trade.trade_client</span> <span class="kn">import</span> <span class="n">TradeClient</span>
<span class="kn">from</span> <span class="nn">tigeropen.common.util.order_utils</span> <span class="kn">import</span> <span class="n">market_order</span>
<span class="kn">from</span> <span class="nn">tigeropen.common.util.contract_utils</span> <span class="kn">import</span> <span class="n">stock_contract</span>

<span class="k">def</span> <span class="nf">get_client_config</span><span class="p">(</span><span class="n">sandbox</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">client_config</span> <span class="o">=</span> <span class="n">TigerOpenClientConfig</span><span class="p">(</span><span class="n">sandbox_debug</span><span class="o">=</span><span class="n">sandbox</span><span class="p">)</span>
    <span class="n">client_config</span><span class="p">.</span><span class="n">private_key</span> <span class="o">=</span> <span class="n">read_private_key</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TIGER_PEM'</span><span class="p">))</span>
    <span class="n">client_config</span><span class="p">.</span><span class="n">tiger_id</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TIGER_TIGER_ID'</span><span class="p">)</span>
    <span class="n">client_config</span><span class="p">.</span><span class="n">account</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TIGER_ACCOUNT'</span><span class="p">)</span>
    <span class="n">client_config</span><span class="p">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">Language</span><span class="p">.</span><span class="n">zh_CN</span>
    <span class="k">return</span> <span class="n">client_config</span>

<span class="c1"># Fonction pour passer une commande
</span><span class="k">def</span> <span class="nf">place_order</span><span class="p">():</span>
    <span class="n">client_config</span> <span class="o">=</span> <span class="n">get_client_config</span><span class="p">()</span>
    <span class="n">trade_client</span> <span class="o">=</span> <span class="n">TradeClient</span><span class="p">(</span><span class="n">client_config</span><span class="p">)</span>
    <span class="n">account</span> <span class="o">=</span> <span class="n">client_config</span><span class="p">.</span><span class="n">account</span>  <span class="c1"># Stocker le compte pour une utilisation ultérieure
</span>
    <span class="n">contract</span> <span class="o">=</span> <span class="n">stock_contract</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="s">'NVDA'</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s">'USD'</span><span class="p">)</span>
    <span class="n">stock_order</span> <span class="o">=</span> <span class="n">market_order</span><span class="p">(</span>
        <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">contract</span><span class="o">=</span><span class="n">contract</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'BUY'</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="c1"># Passer la commande
</span>    <span class="n">order_id</span> <span class="o">=</span> <span class="n">trade_client</span><span class="p">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">stock_order</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Commande passée avec l'ID: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="c1"># Suivre le temps
</span>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>  <span class="c1"># Délai d'attente de 1 minute
</span>        <span class="c1"># Obtenir la commande et trouver celle que nous venons de passer
</span>        <span class="n">order</span> <span class="o">=</span> <span class="n">trade_client</span><span class="p">.</span><span class="n">get_order</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">order_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">order_id</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"ID de la commande correspondante! Vérification du statut de la commande: </span><span class="si">{</span><span class="n">order</span><span class="p">.</span><span class="n">status</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="c1"># Vérifier le statut de la commande en utilisant les valeurs de l'énumération OrderStatus
</span>            <span class="k">if</span> <span class="n">order</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">OrderStatus</span><span class="p">.</span><span class="n">FILLED</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Commande complétée avec succès."</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="n">order</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">OrderStatus</span><span class="p">.</span><span class="n">REJECTED</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Commande rejetée: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s">"La commande </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s"> a été rejetée"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">order</span><span class="p">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">OrderStatus</span><span class="p">.</span><span class="n">PENDING_NEW</span><span class="p">,</span>
                <span class="n">OrderStatus</span><span class="p">.</span><span class="n">NEW</span><span class="p">,</span>
                <span class="n">OrderStatus</span><span class="p">.</span><span class="n">HELD</span><span class="p">,</span>
                <span class="n">OrderStatus</span><span class="p">.</span><span class="n">PENDING_CANCEL</span>
            <span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"La commande est en attente, statut: </span><span class="si">{</span><span class="n">order</span><span class="p">.</span><span class="n">status</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Le statut de la commande est: </span><span class="si">{</span><span class="n">order</span><span class="p">.</span><span class="n">status</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="c1"># Pause avant de vérifier à nouveau
</span>        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Vérifier toutes les 5 secondes
</span>
    <span class="c1"># Si la commande n'est pas complétée en 1 minute, l'annuler
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"La commande n'a pas été complétée en 1 minute. Annulation de la commande."</span><span class="p">)</span>
    <span class="n">trade_client</span><span class="p">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">order_id</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Commande annulée: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">place_order</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="workflow-github-actions">Workflow GitHub Actions</h2>

<p>Le workflow s’exécute tous les mercredis à 14h35 UTC (22h35 UTC) et configure l’environnement, installe les dépendances et exécute le script.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Investissement Régulier</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">35</span><span class="nv"> </span><span class="s">14</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">3'</span>  <span class="c1"># S'exécute tous les mercredis à 14h35 UTC</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s1">'</span><span class="s">trading'</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="no">false</span>

<span class="na">permissions</span><span class="pi">:</span>
  <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span>
  <span class="na">contents</span><span class="pi">:</span> <span class="s">write</span>
  <span class="na">pages</span><span class="pi">:</span> <span class="s">write</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">invest</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Vérifier le dépôt</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">fetch-depth</span><span class="pi">:</span> <span class="m">5</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configurer Python 3.13.2</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">python-version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.13.2"</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Installer les dépendances</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">python -m pip install --upgrade pip</span>
          <span class="s">pip install -r requirements.txt</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configurer le fichier PEM Tiger</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo "$" &gt; tiger.pem</span>
          <span class="s">chmod 600 tiger.pem</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Exécuter le script Tiger</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">tiger_update</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">python invest.py</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">TIGER_TIGER_ID</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">TIGER_ACCOUNT</span><span class="pi">:</span> <span class="s">$</span>
          <span class="na">TIGER_PEM</span><span class="pi">:</span> <span class="s2">"</span><span class="s">tiger.pem"</span>
</code></pre></div></div>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-fr" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
