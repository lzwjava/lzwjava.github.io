<!DOCTYPE html>
<html lang=" en-US">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <link rel="manifest" href="/favicon/site.webmanifest">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Zhiwei Li"
    href="https://lzwjava.github.io/feeds/feed.xml" />

  <title>Introducción a la Programación Web</title>

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' 
          data-cf-beacon='{"token": "70fc8c466cc1445098b3fc6f209c22c2"}'>
  </script>

  <!-- 
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66656236-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-66656236-1');
  </script>
   -->
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Introducción a la Programación Web | Zhiwei Li</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Introducción a la Programación Web" />
<meta name="author" content="Zhiwei Li" />
<meta property="og:locale" content="es" />
<meta name="description" content="En la publicación anterior, hablamos sobre cómo reescribimos la funcionalidad de la secuencia de Fibonacci en una versión orientada a objetos, implementando una interfaz de terminal." />
<meta property="og:description" content="En la publicación anterior, hablamos sobre cómo reescribimos la funcionalidad de la secuencia de Fibonacci en una versión orientada a objetos, implementando una interfaz de terminal." />
<link rel="canonical" href="https://lzwjava.github.io/web-es" />
<meta property="og:url" content="https://lzwjava.github.io/web-es" />
<meta property="og:site_name" content="Zhiwei Li" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Introducción a la Programación Web" />
<meta name="twitter:site" content="@lzwjava" />
<meta name="twitter:creator" content="@lzwjava" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zhiwei Li"},"dateModified":"2021-03-07T00:00:00+08:00","datePublished":"2021-03-07T00:00:00+08:00","description":"En la publicación anterior, hablamos sobre cómo reescribimos la funcionalidad de la secuencia de Fibonacci en una versión orientada a objetos, implementando una interfaz de terminal.","headline":"Introducción a la Programación Web","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzwjava.github.io/web-es"},"url":"https://lzwjava.github.io/web-es"}</script>
<!-- End Jekyll SEO tag -->


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Facebook Meta Tags -->
  <!-- <meta property="og:url" content="https://lzwjava.github.io"> -->
  <meta property="og:type" content="website">
  <!-- <meta property="og:title" content="Zhiwei Li's Blog">
  <meta property="og:description" content="A personal blog featuring programming insights and projects."> -->
  
  
  
  
  
  
  
  
  <meta property="og:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@lzwjava">
  <meta property="twitter:domain" content="lzwjava.github.io">
  <!-- <meta property="twitter:url" content="https://lzwjava.github.io"> -->
  <!-- <meta name="twitter:title" content="Zhiwei Li's Blog">
  <meta name="twitter:description" content="A personal blog featuring programming insights and projects."> -->
  <meta name="twitter:image" content="https://lzwjava.github.io/assets/images/og/og4.jpg">


  <link rel="stylesheet" href="/assets/css/style.css?v=be66ac440d1a318d7814aeee6cbf8fb61112171d">

  <!-- for mathjax support -->
  <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [ ['\\(','\\)'], ['$', '$']],
            displayMath: [ ['$$','$$'], ['\\[','\\]']],
            processEscapes: false
          },
          "HTML-CSS": { linebreaks: { automatic: true } },
          "CommonHTML": {
            linebreaks: { automatic: true }
          },
          TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
      </script>

  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- <script src="/assets/js/donatePopup.js?v=be66ac440d1a318d7814aeee6cbf8fb61112171d" defer></script> -->
</head>

<body>
  <main id="content" class="main-content post-content" role="main">
  

  

  


  <div class="title-row post-title-row">
    <h2 class="title post-title">
       Introducción a la Programación Web | Original, traducido por IA
    </h2>
  </div>

  <div class="button-container">
    <a href="/" class="button left-button">Home</a>

    <!-- PDF Button -->
     
    <!-- <a href="#" id="downloadPdfButton" class="button pdf-button" data-file-path="_posts/es/2021-03-07-web-es.md">PDF</a> -->

    <!-- Audio Button -->



    <!--  -->

        <!-- Date Button -->
    
      
      <!-- <span>_postses2021-03-07-web-es.md</span> -->
      

      <!-- <span>2021-03-07-web-es.md</span> -->

      
        

        
          
          <a href="#" class="button">2021.03</a>
        

      
    

    <button id="themeTogglePost" class="button icon-button" aria-label="Toggle Theme" style="float: right;margin-bottom: 5px;">
      <!-- theme-icons.html -->
<svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

<svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
    <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
</svg>
    </button>    

    <!-- Language Select Section -->
    
    
    
    
    
    
    

    
    <select id="languageSelect" class="button right-button">
        
        <option value="/web-en" >English</option>
        <option value="/web-zh" >中文</option>
        <option value="/web-ja" >日本語</option>
        <option value="/web-es" selected>Español</option>
        <option value="/web-hi" >हिंदी</option>
        <option value="/web-fr" >Français</option>
        <option value="/web-de" >Deutsch</option>
        <option value="/web-ar" >العربية</option>
        <option value="/web-hant" >繁體中文</option>
    </select>
  </div>

  <!-- Audio player for text-to-speech -->
  <div class="audio-container">
    <audio id="audioPlayer" controls loop style="display:none;">
      <source id="audioSource" src="" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>

  <hr>

  <p>En la publicación anterior, hablamos sobre cómo reescribimos la funcionalidad de la secuencia de Fibonacci en una versión orientada a objetos, implementando una interfaz de terminal.</p>

<p><code class="language-plaintext highlighter-rouge">server.py</code>：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BaseHandler</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Server</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handlerClass</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">handlerClass</span> <span class="o">=</span> <span class="n">handlerClass</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">request</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">handlerClass</span><span class="p">().</span><span class="n">handle</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">fib_handle.py</code>：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fib</span> <span class="kn">import</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">server</span> <span class="kn">import</span> <span class="n">BaseHandler</span><span class="p">,</span> <span class="n">Server</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FibHandler</span><span class="p">(</span><span class="n">BaseHandler</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'f(n)='</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">pass</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">(</span><span class="n">FibHandler</span><span class="p">)</span>
<span class="n">server</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>  
</code></pre></div></div>
<h2 id="servidor-web-simple">Servidor Web Simple</h2>

<p>¿Cómo se puede cambiar a una interfaz <code class="language-plaintext highlighter-rouge">Web</code>?</p>

<p>Simplemente reemplazamos el <code class="language-plaintext highlighter-rouge">Server</code> anterior con un <code class="language-plaintext highlighter-rouge">Server</code> del <code class="language-plaintext highlighter-rouge">protocolo HTTP</code>. Primero, veamos cómo es un <code class="language-plaintext highlighter-rouge">servidor HTTP</code> en Python.</p>

<p>La biblioteca estándar de Python proporciona un servidor web.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m http.server
</code></pre></div></div>

<p><em>Nota: El comando anterior no necesita traducción, ya que es un comando específico en Python para iniciar un servidor HTTP simple.</em></p>

<p>Ejecútalo en la terminal.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-m</span> http.server
Sirviendo HTTP en :: puerto 8000 <span class="o">(</span>http://[::]:8000/<span class="o">)</span> ...
</code></pre></div></div>

<p>Al abrirlo en el navegador, podrás ver el efecto.</p>

<p><img src="/assets/images/web/webserver.png" alt="servidor web" style="zoom:50%;" /></p>

<p>Esto lista el directorio actual. Luego, cuando navegues por la página web, vuelve a mirar la terminal. Esto es bastante interesante.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-m</span> http.server
Sirviendo HTTP en :: puerto 8000 <span class="o">(</span>http://[::]:8000/<span class="o">)</span> ...
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET / HTTP/1.1"</span> 200 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] código 404, mensaje Archivo no encontrado
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET /favicon.ico HTTP/1.1"</span> 404 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] código 404, mensaje Archivo no encontrado
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET /apple-touch-icon-precomposed.png HTTP/1.1"</span> 404 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] código 404, mensaje Archivo no encontrado
::1 - - <span class="o">[</span>07/Mar/2021 15:30:35] <span class="s2">"GET /apple-touch-icon.png HTTP/1.1"</span> 404 -
::1 - - <span class="o">[</span>07/Mar/2021 15:30:38] <span class="s2">"GET / HTTP/1.1"</span> 200 -
</code></pre></div></div>

<p>Este es el registro de acceso de la página web. Aquí, <code class="language-plaintext highlighter-rouge">GET</code> representa una operación de acceso a datos en el servicio de la página web. <code class="language-plaintext highlighter-rouge">HTTP/1.1</code> indica que se está utilizando la versión <code class="language-plaintext highlighter-rouge">1.1</code> del protocolo <code class="language-plaintext highlighter-rouge">HTTP</code>.</p>

<p>Cómo usarlo para construir nuestro servicio de secuencia de Fibonacci. Primero, busquemos en línea un código de ejemplo, hagamos algunas modificaciones y escribamos un servidor web simple:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">SimpleHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s">"hola"</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>
</code></pre></div></div>

<p>servidor = HTTPServer((“127.0.0.1”, 8000), Manejador)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></div>

<p>¿No te resulta familiar? Es casi lo mismo que hicimos con <code class="language-plaintext highlighter-rouge">Server</code> anteriormente. Fíjate en que <code class="language-plaintext highlighter-rouge">SimpleHTTPRequestHandler</code> no es una clase base, sino que hay otra llamada <code class="language-plaintext highlighter-rouge">BaseHTTPRequestHandler</code>. <code class="language-plaintext highlighter-rouge">SimpleHTTPRequestHandler</code> maneja un poco más de contenido en comparación. Añadir la funcionalidad de procesamiento de la secuencia de Fibonacci a esto es sencillo.</p>

<p>Aquí, <code class="language-plaintext highlighter-rouge">127.0.0.1</code> representa la dirección de la máquina local, y <code class="language-plaintext highlighter-rouge">8000</code> representa el puerto de la máquina local. ¿Cómo entender el puerto? Es como una ventana en casa, un punto de comunicación entre el interior y el exterior. <code class="language-plaintext highlighter-rouge">bytes</code> indica que la cadena de texto se convierte en bytes. <code class="language-plaintext highlighter-rouge">utf-8</code> es un método de codificación de cadenas de texto. <code class="language-plaintext highlighter-rouge">send_response</code>, <code class="language-plaintext highlighter-rouge">send_header</code> y <code class="language-plaintext highlighter-rouge">end_headers</code> son funciones que se utilizan para enviar contenido, específicamente el contenido que define el protocolo <code class="language-plaintext highlighter-rouge">HTTP</code>, para que pueda ser interpretado por el navegador. Así es como vemos <code class="language-plaintext highlighter-rouge">hi</code> en la página web.</p>

<p><img src="/assets/images/web/hi.png" alt="hola" style="zoom:50%;" /></p>

<p>Luego, intenta obtener los parámetros desde la solicitud.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">SimpleHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
<span class="kn">from</span> <span class="nn">fib</span> <span class="kn">import</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>      
        <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>      
        <span class="n">result</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ns</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>          
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>
</code></pre></div></div>

<p>servidor = HTTPServer((“127.0.0.1”, 8000), Manejador)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/images/web/n10.png" alt="n10" style="zoom:50%;" /></p>

<p>Es un poco complicado, ¿verdad? Aquí simplemente estamos analizando algunos parámetros.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>self.path<span class="o">=</span>/?n<span class="o">=</span>3
<span class="nv">parsed</span><span class="o">=</span>ParseResult<span class="o">(</span><span class="nv">scheme</span><span class="o">=</span><span class="s1">''</span>, <span class="nv">netloc</span><span class="o">=</span><span class="s1">''</span>, <span class="nv">path</span><span class="o">=</span><span class="s1">'/'</span>, <span class="nv">params</span><span class="o">=</span><span class="s1">''</span>, <span class="nv">query</span><span class="o">=</span><span class="s1">'n=3'</span>, <span class="nv">fragment</span><span class="o">=</span><span class="s1">''</span><span class="o">)</span>
<span class="nv">qs</span><span class="o">={</span><span class="s1">'n'</span>: <span class="o">[</span><span class="s1">'3'</span><span class="o">]}</span>
<span class="nv">ns</span><span class="o">=[</span><span class="s1">'3'</span><span class="o">]</span>
<span class="nv">n</span><span class="o">=</span>3
</code></pre></div></div>

<h2 id="avanzando-en-la-recursión">Avanzando en la Recursión</h2>

<p>Vamos a refactorizar un poco el código.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">SimpleHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
<span class="kn">from</span> <span class="nn">fib</span> <span class="kn">import</span> <span class="n">f</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>
</code></pre></div></div>

<p>En este fragmento de código, se define una clase llamada <code class="language-plaintext highlighter-rouge">Handler</code> que hereda de <code class="language-plaintext highlighter-rouge">SimpleHTTPRequestHandler</code>. Esta clase se utiliza comúnmente en Python para manejar solicitudes HTTP simples, como servir archivos estáticos desde un directorio local. La clase <code class="language-plaintext highlighter-rouge">SimpleHTTPRequestHandler</code> es parte del módulo <code class="language-plaintext highlighter-rouge">http.server</code> en la biblioteca estándar de Python.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">parse_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
      <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="n">qs</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="s">'n'</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="k">return</span> <span class="n">n</span>
      <span class="k">return</span> <span class="bp">None</span>
      
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>
</code></pre></div></div>

<p>Traducción al español:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">parse_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
      <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="n">qs</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="p">.</span><span class="n">query</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="n">qs</span><span class="p">[</span><span class="s">'n'</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="k">return</span> <span class="n">n</span>
      <span class="k">return</span> <span class="bp">None</span>
      
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">'Content-type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">end_headers</span><span class="p">()</span>
</code></pre></div></div>

<p>Nota: El código no se traduce, ya que es un bloque de código y debe mantenerse en su idioma original para su correcto funcionamiento.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="n">result</span> <span class="o">=</span> <span class="s">""</span>
      <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parse_n</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
              
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">wfile</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>
</code></pre></div></div>

<p>servidor = HTTPServer((“127.0.0.1”, 8000), Manejador)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div></div>

<p>Introduce la función <code class="language-plaintext highlighter-rouge">parse_n</code> para encapsular la extracción de <code class="language-plaintext highlighter-rouge">n</code> desde la ruta de la solicitud.</p>

<p>El programa tiene el siguiente problema. Xiao Wang solicitó el término 10000 de la secuencia de Fibonacci, y unos días después, Xiao Ming también solicitó el término 10000 de la secuencia de Fibonacci. En ambas ocasiones, Xiao Wang y Xiao Ming tuvieron que esperar mucho tiempo para obtener el resultado. ¿Cómo podemos mejorar la eficiencia de este <code class="language-plaintext highlighter-rouge">servicio web</code>?</p>

<p>Observamos que si <code class="language-plaintext highlighter-rouge">n</code> es el mismo, el valor de <code class="language-plaintext highlighter-rouge">f(n)</code> siempre es el mismo. Realizamos algunos experimentos.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1 - - <span class="o">[</span>10/Mar/2021 00:33:01] <span class="s2">"GET /?n=1000 HTTP/1.1"</span> 200 -
<span class="nt">----------------------------------------</span>
Excepción ocurrida durante el procesamiento de la solicitud desde <span class="o">(</span><span class="s1">'127.0.0.1'</span>, 50783<span class="o">)</span>
Traceback <span class="o">(</span>última llamada más reciente<span class="o">)</span>:
    ...
    <span class="k">if </span>v[n] <span class="o">!=</span> <span class="nt">-1</span>:
IndexError: índice de lista fuera de rango
</code></pre></div></div>

<p>Si el array original no es lo suficientemente grande, entonces cambiemos el array <code class="language-plaintext highlighter-rouge">v</code> a un tamaño de 10000.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p><em>Nota: El código anterior está en Python y no necesita traducción, ya que es un lenguaje de programación universal. Sin embargo, si necesitas una explicación en español, aquí está:</em></p>

<p>Este código en Python crea una lista vacía llamada <code class="language-plaintext highlighter-rouge">v</code> y luego, en un bucle que se repite 10,000 veces, agrega el valor <code class="language-plaintext highlighter-rouge">-1</code> a la lista. Al final, la lista <code class="language-plaintext highlighter-rouge">v</code> contendrá 10,000 elementos, todos con el valor <code class="language-plaintext highlighter-rouge">-1</code>.</p>

<p>Sin embargo, cuando <code class="language-plaintext highlighter-rouge">n</code> es <code class="language-plaintext highlighter-rouge">2000</code>, ocurrió un error de desbordamiento de profundidad de recursión:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1 - - <span class="o">[</span>10/Mar/2021 00:34:00] <span class="s2">"GET /?n=2000 HTTP/1.1"</span> 200 -
<span class="nt">----------------------------------------</span>
Excepción ocurrida durante el procesamiento de la solicitud desde <span class="o">(</span><span class="s1">'127.0.0.1'</span>, 50821<span class="o">)</span>
Traceback <span class="o">(</span>última llamada más reciente<span class="o">)</span>:
    ...
    <span class="k">if </span>v[n] <span class="o">!=</span> <span class="nt">-1</span>:
RecursionError: se excedió la profundidad máxima de recursión en la comparación
</code></pre></div></div>

<p>Sin embargo, todo esto fue bastante rápido.</p>

<p>¿Por qué? Porque desde <code class="language-plaintext highlighter-rouge">f(1)</code> hasta <code class="language-plaintext highlighter-rouge">f(1000)</code>, solo necesitas calcular cada uno una vez. Esto significa que cuando estás calculando <code class="language-plaintext highlighter-rouge">f(1000)</code>, la operación <code class="language-plaintext highlighter-rouge">+</code> probablemente solo se haya ejecutado alrededor de 1000 veces. Sabemos que la profundidad de recursión en <code class="language-plaintext highlighter-rouge">Python</code> es aproximadamente de 1000. Esto significa que podemos optimizar el programa de esta manera: si queremos calcular <code class="language-plaintext highlighter-rouge">2000</code>, primero calculamos <code class="language-plaintext highlighter-rouge">1000</code>. No, esto aún podría generar un <code class="language-plaintext highlighter-rouge">error de desbordamiento de recursión</code>. Si queremos calcular 2000, primero calculemos 1200. Si queremos calcular 1200, primero calculemos 400.</p>

<p>Después de calcular 400 y 1200 de esta manera, al calcular 2000, la profundidad de la recursión será aproximadamente de 800, lo que evitará que se produzca un error de desbordamiento de la profundidad de recursión.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</code></pre></div></div>

<p>Se ha añadido la función <code class="language-plaintext highlighter-rouge">fplus</code>.</p>

<p>Sin embargo, no puedo evitar preguntarme, ¿qué pasaría si <code class="language-plaintext highlighter-rouge">fplus</code> se llama recursivamente <code class="language-plaintext highlighter-rouge">1000</code> veces? 1000 * 800 = 800000. Cuando configuré <code class="language-plaintext highlighter-rouge">n</code> en 800,000, apareció nuevamente un error de profundidad de recursión. Después de seguir probando, descubrí que la situación es aún más complicada. Sin embargo, con esta optimización, calcular 2000 es extremadamente fácil.</p>

<h2 id="lectura-y-escritura-de-archivos">Lectura y Escritura de Archivos</h2>

<p>Parece que me he desviado del tema. Volviendo al tema del desarrollo web, en la primera solicitud <code class="language-plaintext highlighter-rouge">f(400)</code>, y en la segunda solicitud <code class="language-plaintext highlighter-rouge">f(600)</code>, podemos aprovechar los valores del array <code class="language-plaintext highlighter-rouge">v</code> generados por la primera solicitud. Sin embargo, cuando cerramos el programa y lo volvemos a iniciar, ya no podemos usarlos. Según nuestro método, el cálculo de la secuencia de Fibonacci es bastante rápido. Pero imaginemos que si fuera lento, ¿qué haríamos? Especialmente como cuando no habíamos introducido el array <code class="language-plaintext highlighter-rouge">v</code>, había una gran cantidad de cálculos repetidos. En ese caso, querríamos guardar los resultados que tanto nos costó obtener.</p>

<p>En este momento, se introduce el concepto de <code class="language-plaintext highlighter-rouge">caché</code>. El array <code class="language-plaintext highlighter-rouge">v</code> aquí actúa como una caché. Sin embargo, solo existe durante el ciclo de vida del programa. Una vez que el programa se cierra, desaparece. Entonces, ¿qué hacer? Naturalmente, se nos ocurre guardarlo en un archivo.</p>

<p>¿Cómo guardar el arreglo <code class="language-plaintext highlighter-rouge">v</code> en un archivo?</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 0
1 1
2 1
3 2
4 3
...
</code></pre></div></div>

<p>Nuestro arreglo <code class="language-plaintext highlighter-rouge">v</code> se puede guardar de la siguiente manera. Cada fila se guarda como <code class="language-plaintext highlighter-rouge">n f(n)</code>. Dado que <code class="language-plaintext highlighter-rouge">n</code> crece de manera natural, tal vez podríamos guardar solo los valores de <code class="language-plaintext highlighter-rouge">f(n)</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
2
3
...
</code></pre></div></div>

<p>¡Ven a probarlo!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"demofile2.txt"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"¡Ahora el archivo tiene más contenido!"</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="abrir-y-leer-el-archivo-después-de-la-anexión">abrir y leer el archivo después de la anexión:</h1>
<p>f = open(“demofile2.txt”, “r”)
print(f.read())</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
El segundo parámetro de `open` puede ser `'a'`, lo que indica que se añadirá al final del archivo; o `'w'`, lo que indica que se sobrescribirá el archivo.

```python
file = open('fib_v', 'a')
file.write('hi')
file.close()
</code></pre></div></div>

<p>Al ejecutarlo, efectivamente aparece el archivo <code class="language-plaintext highlighter-rouge">fib_v</code>.</p>

<p><code class="language-plaintext highlighter-rouge">fib_v</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hola
</code></pre></div></div>

<p>Cuando lo ejecutamos nuevamente, se convirtió en esto.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hihi
</code></pre></div></div>

<p>¿Cómo hacer un salto de línea?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">'hola</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Esto se imprime una vez, aparece <code class="language-plaintext highlighter-rouge">hihihi</code>, no se ve un salto de línea. Sin embargo, al imprimirlo nuevamente, se produce un salto de línea. Esto indica que el salto de línea ya se imprimió la primera vez, pero estaba al final y no era visible.</p>

<p>¿Cómo se lee?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python fib.py
hihihi
hi
</code></pre></div></div>

<p>A continuación, modifiquemos nuestro programa de Fibonacci.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
   <span class="n">v</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
   <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">lines</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
           <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
   <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_v'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
   <span class="n">s</span> <span class="o">=</span> <span class="s">''</span>
   <span class="n">start</span> <span class="o">=</span> <span class="bp">True</span>
   <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">vv</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
         <span class="k">break</span>      
      <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
         <span class="n">s</span> <span class="o">+=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span>
      <span class="n">start</span> <span class="o">=</span> <span class="bp">False</span>   
      <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
   <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
   <span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fcache</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="n">save</span><span class="p">()</span>
   <span class="k">return</span> <span class="n">x</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</code></pre></div></div>

<p>read()
fcache(10)
save()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Finalmente, hemos terminado de escribir el programa. Después de ejecutar el programa, el archivo `fib_v` se ve así.

`fib_v`:

```shell
0
1
1
2
3
5
8
13
21
34
55
</code></pre></div></div>

<p>Sí, el análisis anterior puede resultar un poco complicado. <code class="language-plaintext highlighter-rouge">\n</code> es un carácter de nueva línea. ¿Existe una forma más simple y unificada de analizar estos datos? Para resolver este problema, las personas inventaron el formato de datos <code class="language-plaintext highlighter-rouge">JSON</code>.</p>

<h2 id="json">JSON</h2>

<p>El nombre completo de JSON es <code class="language-plaintext highlighter-rouge">JavaScript Object Notation</code>. A continuación se muestra un ejemplo de <code class="language-plaintext highlighter-rouge">JSON</code>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"John"</span><span class="p">,</span><span class="w"> </span><span class="nl">"age"</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="nl">"city"</span><span class="p">:</span><span class="s2">"New York"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>La representación anterior muestra una forma de mapeo.</p>

<p>JSON tiene los siguientes elementos básicos:</p>

<ol>
  <li>Números o cadenas de texto</li>
  <li>Listas</li>
  <li>Mapeos</li>
</ol>

<p>Estos elementos básicos también pueden anidarse de manera arbitraria. Es decir, una lista puede contener otras listas, un mapeo puede contener listas, y así sucesivamente.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"John"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"age"</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cars"</span><span class="p">:[</span><span class="w"> </span><span class="s2">"Ford"</span><span class="p">,</span><span class="w"> </span><span class="s2">"BMW"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Fiat"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Escribirlo en una línea y escribirlo de esta manera más estética tiene una diferencia en el significado. Quizás podamos imaginar sus gráficos de cálculo. Los espacios no afectarán sus gráficos de cálculo.</p>

<p>A continuación, necesitamos convertir el arreglo <code class="language-plaintext highlighter-rouge">v</code> en una cadena de texto en formato <code class="language-plaintext highlighter-rouge">json</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
</code></pre></div></div>

<p>v = []
for x in range(1000000):
   v.append(-1)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fplus</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Cuando escribimos esto, obtuvimos un error: <code class="language-plaintext highlighter-rouge">TypeError: dump() missing 1 required positional argument: 'fp'</code>. En <code class="language-plaintext highlighter-rouge">vscode</code>, puedes ver la definición de la función de la siguiente manera.</p>

<p><img src="assets/images/web/json.png" alt="json" /></p>

<p>Puedes mover el mouse sobre <code class="language-plaintext highlighter-rouge">dump</code> para verlo. Muy conveniente, ¿verdad?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fplus</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
<span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Calcular hasta 100 muestra demasiados números, así que aquí lo cambié a 10. Resulta que el segundo parámetro de <code class="language-plaintext highlighter-rouge">dump</code> puede recibir un objeto <code class="language-plaintext highlighter-rouge">file</code>.</p>

<p>De esta manera puedes ver el archivo:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Ten en cuenta que se han omitido muchos <code class="language-plaintext highlighter-rouge">-1</code> al final.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">leer</span><span class="p">():</span>
    <span class="n">archivo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">archivo</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sv</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">guardar</span><span class="p">():</span>
    <span class="n">archivo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">archivo</span><span class="p">)</span>
    <span class="n">archivo</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>read()</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">vv</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>
</code></pre></div></div>

<p>Cuando esto sucede, se puede ver que se imprime:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
2
3
5
8
13
21
34
55
</code></pre></div></div>

<p>Revisemos estas funciones juntas:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sv</span><span class="p">)):</span>
        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></div>

<p>En este código, se define una función llamada <code class="language-plaintext highlighter-rouge">read</code> que realiza las siguientes acciones:</p>

<ol>
  <li>Abre un archivo llamado <code class="language-plaintext highlighter-rouge">'fib_j'</code> en modo de lectura (<code class="language-plaintext highlighter-rouge">'r'</code>).</li>
  <li>Lee el contenido del archivo y lo almacena en la variable <code class="language-plaintext highlighter-rouge">s</code>.</li>
  <li>Convierte el contenido leído (que se asume es una cadena JSON) en una estructura de datos de Python utilizando <code class="language-plaintext highlighter-rouge">json.loads</code>.</li>
  <li>Itera sobre los elementos de la estructura de datos <code class="language-plaintext highlighter-rouge">sv</code> y los asigna a un arreglo o lista <code class="language-plaintext highlighter-rouge">v</code>.</li>
</ol>

<p>Nota: Asegúrate de que la variable <code class="language-plaintext highlighter-rouge">v</code> esté definida antes de usar esta función, ya que no se inicializa dentro de la función.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
    <span class="n">sv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sv</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>        
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fib_j'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
    <span class="nb">file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>read()
fplus(100)
save()
</code></pre></div></div>

<p>Luego, al revisar el archivo, efectivamente se guardaron los valores correctos, y de manera muy ordenada.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="mi">144</span><span class="p">,</span><span class="w"> </span><span class="mi">233</span><span class="p">,</span><span class="w"> </span><span class="mi">377</span><span class="p">,</span><span class="w"> </span><span class="mi">610</span><span class="p">,</span><span class="w"> </span><span class="mi">987</span><span class="p">,</span><span class="w"> </span><span class="mi">1597</span><span class="p">,</span><span class="w"> </span><span class="mi">2584</span><span class="p">,</span><span class="w"> </span><span class="mi">4181</span><span class="p">,</span><span class="w"> </span><span class="mi">6765</span><span class="p">,</span><span class="w"> </span><span class="mi">10946</span><span class="p">,</span><span class="w"> </span><span class="mi">17711</span><span class="p">,</span><span class="w"> </span><span class="mi">28657</span><span class="p">,</span><span class="w"> </span><span class="mi">46368</span><span class="p">,</span><span class="w"> </span><span class="mi">75025</span><span class="p">,</span><span class="w"> </span><span class="mi">121393</span><span class="p">,</span><span class="w"> </span><span class="mi">196418</span><span class="p">,</span><span class="w"> </span><span class="mi">317811</span><span class="p">,</span><span class="w"> </span><span class="mi">514229</span><span class="p">,</span><span class="w"> </span><span class="mi">832040</span><span class="p">,</span><span class="w"> </span><span class="mi">1346269</span><span class="p">,</span><span class="w"> </span><span class="mi">2178309</span><span class="p">,</span><span class="w"> </span><span class="mi">3524578</span><span class="p">,</span><span class="w"> </span><span class="mi">5702887</span><span class="p">,</span><span class="w"> </span><span class="mi">9227465</span><span class="p">,</span><span class="w"> </span><span class="mi">14930352</span><span class="p">,</span><span class="w"> </span><span class="mi">24157817</span><span class="p">,</span><span class="w"> </span><span class="mi">39088169</span><span class="p">,</span><span class="w"> </span><span class="mi">63245986</span><span class="p">,</span><span class="w"> </span><span class="mi">102334155</span><span class="p">,</span><span class="w"> </span><span class="mi">165580141</span><span class="p">,</span><span class="w"> </span><span class="mi">267914296</span><span class="p">,</span><span class="w"> </span><span class="mi">433494437</span><span class="p">,</span><span class="w"> </span><span class="mi">701408733</span><span class="p">,</span><span class="w"> </span><span class="mi">1134903170</span><span class="p">,</span><span class="w"> </span><span class="mi">1836311903</span><span class="p">,</span><span class="w"> </span><span class="mi">2971215073</span><span class="p">,</span><span class="w"> </span><span class="mi">4807526976</span><span class="p">,</span><span class="w"> </span><span class="mi">7778742049</span><span class="p">,</span><span class="w"> </span><span class="mi">12586269025</span><span class="p">,</span><span class="w"> </span><span class="mi">20365011074</span><span class="p">,</span><span class="w"> </span><span class="mi">32951280099</span><span class="p">,</span><span class="w"> </span><span class="mi">53316291173</span><span class="p">,</span><span class="w"> </span><span class="mi">86267571272</span><span class="p">,</span><span class="w"> </span><span class="mi">139583862445</span><span class="p">,</span><span class="w"> </span><span class="mi">225851433717</span><span class="p">,</span><span class="w"> </span><span class="mi">365435296162</span><span class="p">,</span><span class="w"> </span><span class="mi">591286729879</span><span class="p">,</span><span class="w"> </span><span class="mi">956722026041</span><span class="p">,</span><span class="w"> </span><span class="mi">1548008755920</span><span class="p">,</span><span class="w"> </span><span class="mi">2504730781961</span><span class="p">,</span><span class="w"> </span><span class="mi">4052739537881</span><span class="p">,</span><span class="w"> </span><span class="mi">6557470319842</span><span class="p">,</span><span class="w"> </span><span class="mi">10610209857723</span><span class="p">,</span><span class="w"> </span><span class="mi">17167680177565</span><span class="p">,</span><span class="w"> </span><span class="mi">27777890035288</span><span class="p">,</span><span class="w"> </span><span class="mi">44945570212853</span><span class="p">,</span><span class="w"> </span><span class="mi">72723460248141</span><span class="p">,</span><span class="w"> </span><span class="mi">117669030460994</span><span class="p">,</span><span class="w"> </span><span class="mi">190392490709135</span><span class="p">,</span><span class="w"> </span><span class="mi">308061521170129</span><span class="p">,</span><span class="w"> </span><span class="mi">498454011879264</span><span class="p">,</span><span class="w"> </span><span class="mi">806515533049393</span><span class="p">,</span><span class="w"> </span><span class="mi">1304969544928657</span><span class="p">,</span><span class="w"> </span><span class="mi">2111485077978050</span><span class="p">,</span><span class="w"> </span><span class="mi">3416454622906707</span><span class="p">,</span><span class="w"> </span><span class="mi">5527939700884757</span><span class="p">,</span><span class="w"> </span><span class="mi">8944394323791464</span><span class="p">,</span><span class="w"> </span><span class="mi">14472334024676221</span><span class="p">,</span><span class="w"> </span><span class="mi">23416728348467685</span><span class="p">,</span><span class="w"> </span><span class="mi">37889062373143906</span><span class="p">,</span><span class="w"> </span><span class="mi">61305790721611591</span><span class="p">,</span><span class="w"> </span><span class="mi">99194853094755497</span><span class="p">,</span><span class="w"> </span><span class="mi">160500643816367088</span><span class="p">,</span><span class="w"> </span><span class="mi">259695496911122585</span><span class="p">,</span><span class="w"> </span><span class="mi">420196140727489673</span><span class="p">,</span><span class="w"> </span><span class="mi">679891637638612258</span><span class="p">,</span><span class="w"> </span><span class="mi">1100087778366101931</span><span class="p">,</span><span class="w"> </span><span class="mi">1779979416004714189</span><span class="p">,</span><span class="w"> </span><span class="mi">2880067194370816120</span><span class="p">,</span><span class="w"> </span><span class="mi">4660046610375530309</span><span class="p">,</span><span class="w"> </span><span class="mi">7540113804746346429</span><span class="p">,</span><span class="w"> </span><span class="mi">12200160415121876738</span><span class="p">,</span><span class="w"> </span><span class="mi">19740274219868223167</span><span class="p">,</span><span class="w"> </span><span class="mi">31940434634990099905</span><span class="p">,</span><span class="w"> </span><span class="mi">51680708854858323072</span><span class="p">,</span><span class="w"> </span><span class="mi">83621143489848422977</span><span class="p">,</span><span class="w"> </span><span class="mi">135301852344706746049</span><span class="p">,</span><span class="w"> </span><span class="mi">218922995834555169026</span><span class="p">,</span><span class="w"> </span><span class="mi">354224848179261915075</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="base-de-datos">Base de datos</h2>

<p>Si los datos son grandes y la estructura es compleja, ¿qué hacer? Guardar los datos en archivos se volverá lento y engorroso. Aquí es donde entra en juego la <code class="language-plaintext highlighter-rouge">base de datos</code>. Es como una <code class="language-plaintext highlighter-rouge">hoja de cálculo Excel</code> programable. Una <code class="language-plaintext highlighter-rouge">hoja de cálculo Excel</code> que permite realizar operaciones de inserción, eliminación, modificación y consulta de manera conveniente mediante código.</p>

<p>Encontré un ejemplo en la documentación oficial.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'example.db'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="crear-tabla">Crear tabla</h1>
<p>cur.execute(‘'’CREATE TABLE stocks
               (date text, trans text, symbol text, qty real, price real)’’’)</p>

<h1 id="insertar-una-fila-de-datos">Insertar una fila de datos</h1>
<p>cur.execute(“INSERT INTO stocks VALUES (‘2006-01-05’,’BUY’,’RHAT’,100,35.14)”)</p>

<h1 id="guardar-confirmar-los-cambios">Guardar (confirmar) los cambios</h1>
<p>con.commit()</p>

<h1 id="también-podemos-cerrar-la-conexión-si-hemos-terminado-con-ella">También podemos cerrar la conexión si hemos terminado con ella.</h1>
<h1 id="solo-asegúrate-de-que-cualquier-cambio-haya-sido-confirmado-o-se-perderán">Solo asegúrate de que cualquier cambio haya sido confirmado, o se perderán.</h1>
<p>con.close()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
```python
for row in cur.execute('SELECT * FROM stocks ORDER BY price'):
        print(row)
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">cursor</code> representa un cursor, similar a un puntero. Lo anterior se refiere a conectar a la base de datos, crear una tabla, insertar datos, confirmar los cambios y cerrar la conexión. El último ejemplo es una demostración de cómo consultar datos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>
</code></pre></div></div>

<p>v = []
for x in range(1000000):
   v.append(-1)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">:</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">Connection</span><span class="p">):</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'CREATE TABLE vs(v text)'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">leer</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'fib.db'</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vv</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'INSERT INTO vs VALUES('</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="s">')'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">con</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>fplus(10)
guardar()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Escrito. Pruébalo.

Ya tengo `sqlite3` instalado en mi computadora.

```shell
$ sqlite3
SQLite versión 3.32.3 2020-06-18 14:16:19
Introduzca ".help" para ver sugerencias de uso.
Conectado a una base de datos transitoria en memoria.
Use ".open FILENAME" para reabrir en una base de datos persistente.
</code></pre></div></div>

<pre><code class="language-sqlite">sqlite&gt; .help
.auth ON|OFF             Mostrar llamadas de autorización
.backup ?DB? FILE        Hacer una copia de seguridad de la base de datos (por defecto "main") en FILE
.bail on|off             Detenerse después de encontrar un error. Por defecto OFF
.binary on|off           Activar o desactivar la salida binaria. Por defecto OFF
.cd DIRECTORY            Cambiar el directorio de trabajo a DIRECTORY
.changes on|off          Mostrar el número de filas cambiadas por SQL
.check GLOB              Fallar si la salida desde .testcase no coincide
.clone NEWDB             Clonar datos en NEWDB desde la base de datos existente
.databases               Listar nombres y archivos de las bases de datos adjuntas
.dbconfig ?op? ?val?     Listar o cambiar opciones de sqlite3_db_config()
.dbinfo ?DB?             Mostrar información de estado sobre la base de datos
.dump ?TABLE?            Renderizar el contenido de la base de datos como SQL
.echo on|off             Activar o desactivar el eco de comandos
.eqp on|off|full|...     Activar o desactivar el EXPLAIN QUERY PLAN automático
.excel                   Mostrar la salida del siguiente comando en una hoja de cálculo
.exit ?CODE?             Salir del programa con el código de retorno CODE
.expert                  EXPERIMENTAL. Sugerir índices para consultas
.explain ?on|off|auto?   Cambiar el modo de formato de EXPLAIN. Por defecto: auto
.filectrl CMD ...        Ejecutar varias operaciones de sqlite3_file_control()
.fullschema ?--indent?   Mostrar el esquema y el contenido de las tablas sqlite_stat
.headers on|off          Activar o desactivar la visualización de encabezados
.help ?-all? ?PATTERN?   Mostrar texto de ayuda para PATTERN
.import FILE TABLE       Importar datos desde FILE a TABLE
.imposter INDEX TABLE    Crear una tabla impostora TABLE en el índice INDEX
.indexes ?TABLE?         Mostrar nombres de índices
.limit ?LIMIT? ?VAL?     Mostrar o cambiar el valor de un SQLITE_LIMIT
.lint OPTIONS            Reportar posibles problemas de esquema
.log FILE|off            Activar o desactivar el registro. FILE puede ser stderr/stdout
.mode MODE ?TABLE?       Establecer el modo de salida
.nullvalue STRING        Usar STRING en lugar de valores NULL
.once ?OPTIONS? ?FILE?   Enviar la salida del siguiente comando SQL solo a FILE
.open ?OPTIONS? ?FILE?   Cerrar la base de datos existente y abrir FILE
.output ?FILE?           Enviar la salida a FILE o a stdout si se omite FILE
.parameter CMD ...       Gestionar enlaces de parámetros SQL
.print STRING...         Imprimir el STRING literal
.progress N              Invocar el manejador de progreso después de cada N opcodes
.prompt MAIN CONTINUE    Reemplazar los prompts estándar
.quit                    Salir del programa
.read FILE               Leer la entrada desde FILE
.recover                 Recuperar la mayor cantidad de datos posible de una base de datos corrupta
.restore ?DB? FILE       Restaurar el contenido de DB (por defecto "main") desde FILE
.save FILE               Escribir la base de datos en memoria en FILE
.scanstats on|off        Activar o desactivar las métricas de sqlite3_stmt_scanstatus()
.schema ?PATTERN?        Mostrar las declaraciones CREATE que coincidan con PATTERN
.selftest ?OPTIONS?      Ejecutar pruebas definidas en la tabla SELFTEST
.separator COL ?ROW?     Cambiar los separadores de columna y fila
.session ?NAME? CMD ...  Crear o controlar sesiones
.sha3sum ...             Calcular un hash SHA3 del contenido de la base de datos
.shell CMD ARGS...       Ejecutar CMD ARGS... en un shell del sistema
.show                    Mostrar los valores actuales de varias configuraciones
.stats ?on|off?          Mostrar estadísticas o activar/desactivar estadísticas
.system CMD ARGS...      Ejecutar CMD ARGS... en un shell del sistema
.tables ?TABLE?          Listar nombres de tablas que coincidan con el patrón LIKE TABLE
.testcase NAME           Comenzar a redirigir la salida a 'testcase-out.txt'
.testctrl CMD ...        Ejecutar varias operaciones de sqlite3_test_control()
.timeout MS              Intentar abrir tablas bloqueadas durante MS milisegundos
.timer on|off            Activar o desactivar el temporizador SQL
.trace ?OPTIONS?         Mostrar cada declaración SQL a medida que se ejecuta
.vfsinfo ?AUX?           Información sobre el VFS de nivel superior
.vfslist                 Listar todos los VFS disponibles
.vfsname ?AUX?           Imprimir el nombre de la pila VFS
.width NUM1 NUM2 ...     Establecer el ancho de las columnas para el modo "column"
</code></pre>

<p>Puedes ver que hay muchos comandos. Entre ellos, <code class="language-plaintext highlighter-rouge">.quit</code> significa salir.</p>

<p>Si no lo tienes, puedes descargarlo desde el sitio web oficial o ejecutar <code class="language-plaintext highlighter-rouge">brew install sqlite</code> para instalarlo.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sqlite3 fib.db
</code></pre></div></div>

<pre><code class="language-sqlite">sqlite&gt; show tables
   ...&gt; ;
Error: cerca de "show": error de sintaxis
sqlite&gt; tables;
Error: cerca de "tables": error de sintaxis
sqlite&gt; .schema
CREATE TABLE vs(v text);
</code></pre>

<p>Al principio pensé que sería como en <code class="language-plaintext highlighter-rouge">MySQL</code>, donde puedes usar <code class="language-plaintext highlighter-rouge">show tables</code> para ver qué tablas hay. Luego descubrí que en <code class="language-plaintext highlighter-rouge">SQLite</code> es diferente. <code class="language-plaintext highlighter-rouge">MySQL</code> es otro tipo de base de datos, y también es algo que aprenderemos en el futuro.</p>

<pre><code class="language-sqlite">sqlite&gt; select * from vs;
0
1
1
2
3
5
8
13
21
34
55
</code></pre>

<p>Efectivamente, hemos escrito los datos correctamente. Ten en cuenta que utilizamos <code class="language-plaintext highlighter-rouge">text</code> porque nuestros números son muy grandes y es posible que el tipo de dato entero de la base de datos no pueda almacenarlos.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlite3</span>
</code></pre></div></div>

<p>v = []
for x in range(1000000):
   v.append(-1)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fplus</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>         
      <span class="n">fplus</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">800</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
      <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">:</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">Connection</span><span class="p">):</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'CREATE TABLE vs(v text)'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'fib.db'</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>    
    <span class="n">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT * from vs'</span><span class="p">):</span>
         <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save</span><span class="p">():</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'fib.db'</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vv</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'INSERT INTO vs VALUES('</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="s">')'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">con</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">read</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div>

<p>Continuamos añadiendo la función <code class="language-plaintext highlighter-rouge">read</code>. Sin embargo, al ejecutarla, apareció un error.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="n">python</span> <span class="n">fib_db</span><span class="p">.</span><span class="n">py</span>
  <span class="p">...</span>
  <span class="n">File</span> <span class="s">"fib_db.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">27</span><span class="p">,</span> <span class="ow">in</span> <span class="n">create_table</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'CREATE TABLE vs(v text)'</span><span class="p">)</span>
<span class="n">sqlite3</span><span class="p">.</span><span class="n">OperationalError</span><span class="p">:</span> <span class="n">la</span> <span class="n">tabla</span> <span class="n">vs</span> <span class="n">ya</span> <span class="n">existe</span>
</code></pre></div></div>

<p>No podemos crear la tabla nuevamente, la tabla ya existe. Vamos a modificar ligeramente la sintaxis.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">:</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">Connection</span><span class="p">):</span>
    <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'CREATE TABLE IF NOT EXISTS vs(v text)'</span><span class="p">)</span>
</code></pre></div></div>

<p>Sin embargo, ocurrió un error.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    v[i] <span class="o">=</span> int<span class="o">(</span>row<span class="o">)</span>
TypeError: el argumento de int<span class="o">()</span> debe ser una cadena, un objeto tipo bytes o un número, no una <span class="s1">'tupla'</span>
</code></pre></div></div>

<p>¿Qué es un <code class="language-plaintext highlighter-rouge">tuple</code>? Significa que <code class="language-plaintext highlighter-rouge">row</code> devolvió un <code class="language-plaintext highlighter-rouge">tuple</code>. Vamos a imprimirlo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT * from vs'</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div></div>

<p>El resultado es:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="s1">'0'</span>,<span class="o">)</span>
</code></pre></div></div>

<p>En realidad, <code class="language-plaintext highlighter-rouge">tuple</code> es bastante similar a un array. La diferencia es que sus elementos pueden ser de diferentes tipos, a diferencia de los elementos de un array, que deben ser del mismo tipo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">read</span><span class="p">():</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">'fib.db'</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>    
    <span class="n">create_table</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT * from vs'</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">con</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Así lo cambié. Sin embargo, es bastante extraño. La salida es la siguiente:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>55
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
<span class="nt">-1</span>
</code></pre></div></div>

<p>Resulta que nuestro <code class="language-plaintext highlighter-rouge">i</code> no se estaba incrementando.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'SELECT * from vs'</span><span class="p">):</span>
        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></div>

<p>Así es como debe ser.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
1
1
2
3
5
8
13
21
34
</code></pre></div></div>

<p>Sin embargo, notamos que cuando los números son muy grandes, se guardan en la base de datos de esta manera:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4660046610375530309
7540113804746346429
1.22001604151219e+19
1.97402742198682e+19
3.19404346349901e+19
</code></pre></div></div>

<p>Al ejecutarlo nuevamente, se ve así.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python fib_db.py
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"fib_db.py"</span>, line 35, <span class="k">in </span><span class="nb">read
    </span>v[i] <span class="o">=</span> int<span class="o">(</span>row[0]<span class="o">)</span>
ValueError: literal no válido para int<span class="o">()</span> con base 10: <span class="s1">'1.22001604151219e+19'</span>
</code></pre></div></div>

<p>Modifícalo:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO vs VALUES('"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="o">+</span> <span class="s">"')"</span><span class="p">)</span>
</code></pre></div></div>

<p>Noté que aquí hemos cambiado las comillas simples alrededor de la declaración <code class="language-plaintext highlighter-rouge">INSERT</code> por comillas dobles, y además hemos añadido comillas a nuestra cadena numérica. Si antes lo escribíamos de esa manera, la base de datos interpretaba nuestra cadena como un número, pero ahora, al encerrarla entre comillas, se interpreta como una cadena de texto.</p>

<p>Luego, todo estará correcto. Sin embargo, ¿cómo se pueden eliminar los datos erróneos anteriores?</p>

<pre><code class="language-sqlite">$ sqlite3 fib.db
SQLite version 3.32.3 2020-06-18 14:16:19
Ingresa ".help" para ver sugerencias de uso.
sqlite&gt; delete * from vs;
</code></pre>

<p>A continuación, puedes probar otras declaraciones. <code class="language-plaintext highlighter-rouge">CRUD</code> (Crear, Leer, Actualizar, Eliminar). Aquí hemos proporcionado ejemplos de <code class="language-plaintext highlighter-rouge">Crear, Eliminar y Leer</code>.</p>

<h2 id="práctica">Práctica</h2>

<ul>
  <li>Los estudiantes exploran de manera similar como se muestra arriba.</li>
</ul>


  <hr>

  <div class="button-container">
    <a href="/" class="button left-button">Back</a>


    

    
    
    <a href="/donate-es" class="button right-button">Donate</a>
  </div>
</main>

<script src="/assets/js/dark-mode.js"></script>
<script src="/assets/js/audio.js" defer></script>
<script src="/assets/js/pdf.js" defer></script>
<script>
    document.getElementById('languageSelect').addEventListener('change', function() {
        var selectedValue = this.value;
        if (selectedValue) {
            window.location.href = selectedValue;
        }
    });
</script>

</body>

</html>
